webpackJsonp([2],{

/***/ "/n6Q":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("zQR9");
__webpack_require__("+tPU");
module.exports = __webpack_require__("Kh4W").f('iterator');


/***/ }),

/***/ "06OY":
/***/ (function(module, exports, __webpack_require__) {

var META = __webpack_require__("3Eo+")('meta');
var isObject = __webpack_require__("EqjI");
var has = __webpack_require__("D2L2");
var setDesc = __webpack_require__("evD5").f;
var id = 0;
var isExtensible = Object.isExtensible || function () {
  return true;
};
var FREEZE = !__webpack_require__("S82l")(function () {
  return isExtensible(Object.preventExtensions({}));
});
var setMeta = function (it) {
  setDesc(it, META, { value: {
    i: 'O' + ++id, // object ID
    w: {}          // weak collections IDs
  } });
};
var fastKey = function (it, create) {
  // return primitive with prefix
  if (!isObject(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;
  if (!has(it, META)) {
    // can't set metadata to uncaught frozen object
    if (!isExtensible(it)) return 'F';
    // not necessary to add metadata
    if (!create) return 'E';
    // add missing metadata
    setMeta(it);
  // return object ID
  } return it[META].i;
};
var getWeak = function (it, create) {
  if (!has(it, META)) {
    // can't set metadata to uncaught frozen object
    if (!isExtensible(it)) return true;
    // not necessary to add metadata
    if (!create) return false;
    // add missing metadata
    setMeta(it);
  // return hash weak collections IDs
  } return it[META].w;
};
// add metadata on freeze-family methods calling
var onFreeze = function (it) {
  if (FREEZE && meta.NEED && isExtensible(it) && !has(it, META)) setMeta(it);
  return it;
};
var meta = module.exports = {
  KEY: META,
  NEED: false,
  fastKey: fastKey,
  getWeak: getWeak,
  onFreeze: onFreeze
};


/***/ }),

/***/ "5QVw":
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__("BwfY"), __esModule: true };

/***/ }),

/***/ "7UMu":
/***/ (function(module, exports, __webpack_require__) {

// 7.2.2 IsArray(argument)
var cof = __webpack_require__("R9M2");
module.exports = Array.isArray || function isArray(arg) {
  return cof(arg) == 'Array';
};


/***/ }),

/***/ "9bBU":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("mClu");
var $Object = __webpack_require__("FeBl").Object;
module.exports = function defineProperty(it, key, desc) {
  return $Object.defineProperty(it, key, desc);
};


/***/ }),

/***/ "BwfY":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("fWfb");
__webpack_require__("M6a0");
__webpack_require__("OYls");
__webpack_require__("QWe/");
module.exports = __webpack_require__("FeBl").Symbol;


/***/ }),

/***/ "C4MV":
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__("9bBU"), __esModule: true };

/***/ }),

/***/ "Cdx3":
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.14 Object.keys(O)
var toObject = __webpack_require__("sB3e");
var $keys = __webpack_require__("lktj");

__webpack_require__("uqUo")('keys', function () {
  return function keys(it) {
    return $keys(toObject(it));
  };
});


/***/ }),

/***/ "JScw":
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),

/***/ "K6ED":
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__("cnlX"), __esModule: true };

/***/ }),

/***/ "Kh4W":
/***/ (function(module, exports, __webpack_require__) {

exports.f = __webpack_require__("dSzd");


/***/ }),

/***/ "Kh5d":
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.9 Object.getPrototypeOf(O)
var toObject = __webpack_require__("sB3e");
var $getPrototypeOf = __webpack_require__("PzxK");

__webpack_require__("uqUo")('getPrototypeOf', function () {
  return function getPrototypeOf(it) {
    return $getPrototypeOf(toObject(it));
  };
});


/***/ }),

/***/ "LKZe":
/***/ (function(module, exports, __webpack_require__) {

var pIE = __webpack_require__("NpIQ");
var createDesc = __webpack_require__("X8DO");
var toIObject = __webpack_require__("TcQ7");
var toPrimitive = __webpack_require__("MmMw");
var has = __webpack_require__("D2L2");
var IE8_DOM_DEFINE = __webpack_require__("SfB7");
var gOPD = Object.getOwnPropertyDescriptor;

exports.f = __webpack_require__("+E39") ? gOPD : function getOwnPropertyDescriptor(O, P) {
  O = toIObject(O);
  P = toPrimitive(P, true);
  if (IE8_DOM_DEFINE) try {
    return gOPD(O, P);
  } catch (e) { /* empty */ }
  if (has(O, P)) return createDesc(!pIE.f.call(O, P), O[P]);
};


/***/ }),

/***/ "M85I":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* WEBPACK VAR INJECTION */(function(global, module) {/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_create__ = __webpack_require__("OvRC");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_create___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_create__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of__ = __webpack_require__("Zx67");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_own_property_descriptor__ = __webpack_require__("K6ED");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_own_property_descriptor___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_own_property_descriptor__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator__ = __webpack_require__("Zzip");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol__ = __webpack_require__("5QVw");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of__ = __webpack_require__("kiBT");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise__ = __webpack_require__("//Fk");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property__ = __webpack_require__("C4MV");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign__ = __webpack_require__("woOf");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9_babel_runtime_core_js_object_keys__ = __webpack_require__("fZjL");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9_babel_runtime_core_js_object_keys___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_9_babel_runtime_core_js_object_keys__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10_babel_runtime_core_js_json_stringify__ = __webpack_require__("mvHQ");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10_babel_runtime_core_js_json_stringify___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_10_babel_runtime_core_js_json_stringify__);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof__ = __webpack_require__("pFYg");
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default = __webpack_require__.n(__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof__);
var require;var require;(function(f){if((typeof exports==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(exports))==="object"&&typeof module!=="undefined"){module.exports=f();}else if(typeof define==="function"&&__webpack_require__("nErl")){define([],f);}else{var g;if(typeof window!=="undefined"){g=window;}else if(typeof global!=="undefined"){g=global;}else if(typeof self!=="undefined"){g=self;}else{g=this;}g.flvjs=f();}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return require(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f;}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e);},l,l.exports,e,t,n,r);}return n[o].exports;}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++){s(r[o]);}return s;}({1:[function(_dereq_,module,exports){(function(process,global){/*!
                 * @overview es6-promise - a tiny implementation of Promises/A+.
                 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
                 * @license   Licensed under MIT license
                 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
                 * @version   v4.2.5+7f2b526d
                 */(function(global,factory){(typeof exports==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(exports))==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):global.ES6Promise=factory();})(this,function(){'use strict';function objectOrFunction(x){var type=typeof x==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(x);return x!==null&&(type==='object'||type==='function');}function isFunction(x){return typeof x==='function';}var _isArray=void 0;if(Array.isArray){_isArray=Array.isArray;}else{_isArray=function _isArray(x){return Object.prototype.toString.call(x)==='[object Array]';};}var isArray=_isArray;var len=0;var vertxNext=void 0;var customSchedulerFn=void 0;var asap=function asap(callback,arg){queue[len]=callback;queue[len+1]=arg;len+=2;if(len===2){// If len is 2, that means that we need to schedule an async flush.
// If additional callbacks are queued before the queue is flushed, they
// will be processed by this flush that we are scheduling.
if(customSchedulerFn){customSchedulerFn(flush);}else{scheduleFlush();}}};function setScheduler(scheduleFn){customSchedulerFn=scheduleFn;}function setAsap(asapFn){asap=asapFn;}var browserWindow=typeof window!=='undefined'?window:undefined;var browserGlobal=browserWindow||{};var BrowserMutationObserver=browserGlobal.MutationObserver||browserGlobal.WebKitMutationObserver;var isNode=typeof self==='undefined'&&typeof process!=='undefined'&&{}.toString.call(process)==='[object process]';// test for web worker but not in IE10
var isWorker=typeof Uint8ClampedArray!=='undefined'&&typeof importScripts!=='undefined'&&typeof MessageChannel!=='undefined';// node
function useNextTick(){// node version 0.10.x displays a deprecation warning when nextTick is used recursively
// see https://github.com/cujojs/when/issues/410 for details
return function(){return process.nextTick(flush);};}// vertx
function useVertxTimer(){if(typeof vertxNext!=='undefined'){return function(){vertxNext(flush);};}return useSetTimeout();}function useMutationObserver(){var iterations=0;var observer=new BrowserMutationObserver(flush);var node=document.createTextNode('');observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2;};}// web worker
function useMessageChannel(){var channel=new MessageChannel();channel.port1.onmessage=flush;return function(){return channel.port2.postMessage(0);};}function useSetTimeout(){// Store setTimeout reference so es6-promise will be unaffected by
// other code modifying setTimeout (like sinon.useFakeTimers())
var globalSetTimeout=setTimeout;return function(){return globalSetTimeout(flush,1);};}var queue=new Array(1000);function flush(){for(var i=0;i<len;i+=2){var callback=queue[i];var arg=queue[i+1];callback(arg);queue[i]=undefined;queue[i+1]=undefined;}len=0;}function attemptVertx(){try{var vertx=Function('return this')().require('vertx');vertxNext=vertx.runOnLoop||vertx.runOnContext;return useVertxTimer();}catch(e){return useSetTimeout();}}var scheduleFlush=void 0;// Decide what async method to use to triggering processing of queued callbacks:
if(isNode){scheduleFlush=useNextTick();}else if(BrowserMutationObserver){scheduleFlush=useMutationObserver();}else if(isWorker){scheduleFlush=useMessageChannel();}else if(browserWindow===undefined&&typeof _dereq_==='function'){scheduleFlush=attemptVertx();}else{scheduleFlush=useSetTimeout();}function then(onFulfillment,onRejection){var parent=this;var child=new this.constructor(noop);if(child[PROMISE_ID]===undefined){makePromise(child);}var _state=parent._state;if(_state){var callback=arguments[_state-1];asap(function(){return invokeCallback(_state,child,callback,parent._result);});}else{subscribe(parent,child,onFulfillment,onRejection);}return child;}/**
                      `Promise.resolve` returns a promise that will become resolved with the
                      passed `value`. It is shorthand for the following:
                    
                      ```javascript
                      let promise = new Promise(function(resolve, reject){
                        resolve(1);
                      });
                    
                      promise.then(function(value){
                        // value === 1
                      });
                      ```
                    
                      Instead of writing the above, your code now simply becomes the following:
                    
                      ```javascript
                      let promise = Promise.resolve(1);
                    
                      promise.then(function(value){
                        // value === 1
                      });
                      ```
                    
                      @method resolve
                      @static
                      @param {Any} value value that the returned promise will be resolved with
                      Useful for tooling.
                      @return {Promise} a promise that will become fulfilled with the given
                      `value`
                    */function resolve$1(object){/*jshint validthis:true */var Constructor=this;if(object&&(typeof object==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(object))==='object'&&object.constructor===Constructor){return object;}var promise=new Constructor(noop);resolve(promise,object);return promise;}var PROMISE_ID=Math.random().toString(36).substring(2);function noop(){}var PENDING=void 0;var FULFILLED=1;var REJECTED=2;var TRY_CATCH_ERROR={error:null};function selfFulfillment(){return new TypeError("You cannot resolve a promise with itself");}function cannotReturnOwn(){return new TypeError('A promises callback cannot return that same promise.');}function getThen(promise){try{return promise.then;}catch(error){TRY_CATCH_ERROR.error=error;return TRY_CATCH_ERROR;}}function tryThen(then$$1,value,fulfillmentHandler,rejectionHandler){try{then$$1.call(value,fulfillmentHandler,rejectionHandler);}catch(e){return e;}}function handleForeignThenable(promise,thenable,then$$1){asap(function(promise){var sealed=false;var error=tryThen(then$$1,thenable,function(value){if(sealed){return;}sealed=true;if(thenable!==value){resolve(promise,value);}else{fulfill(promise,value);}},function(reason){if(sealed){return;}sealed=true;reject(promise,reason);},'Settle: '+(promise._label||' unknown promise'));if(!sealed&&error){sealed=true;reject(promise,error);}},promise);}function handleOwnThenable(promise,thenable){if(thenable._state===FULFILLED){fulfill(promise,thenable._result);}else if(thenable._state===REJECTED){reject(promise,thenable._result);}else{subscribe(thenable,undefined,function(value){return resolve(promise,value);},function(reason){return reject(promise,reason);});}}function handleMaybeThenable(promise,maybeThenable,then$$1){if(maybeThenable.constructor===promise.constructor&&then$$1===then&&maybeThenable.constructor.resolve===resolve$1){handleOwnThenable(promise,maybeThenable);}else{if(then$$1===TRY_CATCH_ERROR){reject(promise,TRY_CATCH_ERROR.error);TRY_CATCH_ERROR.error=null;}else if(then$$1===undefined){fulfill(promise,maybeThenable);}else if(isFunction(then$$1)){handleForeignThenable(promise,maybeThenable,then$$1);}else{fulfill(promise,maybeThenable);}}}function resolve(promise,value){if(promise===value){reject(promise,selfFulfillment());}else if(objectOrFunction(value)){handleMaybeThenable(promise,value,getThen(value));}else{fulfill(promise,value);}}function publishRejection(promise){if(promise._onerror){promise._onerror(promise._result);}publish(promise);}function fulfill(promise,value){if(promise._state!==PENDING){return;}promise._result=value;promise._state=FULFILLED;if(promise._subscribers.length!==0){asap(publish,promise);}}function reject(promise,reason){if(promise._state!==PENDING){return;}promise._state=REJECTED;promise._result=reason;asap(publishRejection,promise);}function subscribe(parent,child,onFulfillment,onRejection){var _subscribers=parent._subscribers;var length=_subscribers.length;parent._onerror=null;_subscribers[length]=child;_subscribers[length+FULFILLED]=onFulfillment;_subscribers[length+REJECTED]=onRejection;if(length===0&&parent._state){asap(publish,parent);}}function publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return;}var child=void 0,callback=void 0,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){invokeCallback(settled,child,callback,detail);}else{callback(detail);}}promise._subscribers.length=0;}function tryCatch(callback,detail){try{return callback(detail);}catch(e){TRY_CATCH_ERROR.error=e;return TRY_CATCH_ERROR;}}function invokeCallback(settled,promise,callback,detail){var hasCallback=isFunction(callback),value=void 0,error=void 0,succeeded=void 0,failed=void 0;if(hasCallback){value=tryCatch(callback,detail);if(value===TRY_CATCH_ERROR){failed=true;error=value.error;value.error=null;}else{succeeded=true;}if(promise===value){reject(promise,cannotReturnOwn());return;}}else{value=detail;succeeded=true;}if(promise._state!==PENDING){// noop
}else if(hasCallback&&succeeded){resolve(promise,value);}else if(failed){reject(promise,error);}else if(settled===FULFILLED){fulfill(promise,value);}else if(settled===REJECTED){reject(promise,value);}}function initializePromise(promise,resolver){try{resolver(function resolvePromise(value){resolve(promise,value);},function rejectPromise(reason){reject(promise,reason);});}catch(e){reject(promise,e);}}var id=0;function nextId(){return id++;}function makePromise(promise){promise[PROMISE_ID]=id++;promise._state=undefined;promise._result=undefined;promise._subscribers=[];}function validationError(){return new Error('Array Methods must be provided an Array');}var Enumerator=function(){function Enumerator(Constructor,input){this._instanceConstructor=Constructor;this.promise=new Constructor(noop);if(!this.promise[PROMISE_ID]){makePromise(this.promise);}if(isArray(input)){this.length=input.length;this._remaining=input.length;this._result=new Array(this.length);if(this.length===0){fulfill(this.promise,this._result);}else{this.length=this.length||0;this._enumerate(input);if(this._remaining===0){fulfill(this.promise,this._result);}}}else{reject(this.promise,validationError());}}Enumerator.prototype._enumerate=function _enumerate(input){for(var i=0;this._state===PENDING&&i<input.length;i++){this._eachEntry(input[i],i);}};Enumerator.prototype._eachEntry=function _eachEntry(entry,i){var c=this._instanceConstructor;var resolve$$1=c.resolve;if(resolve$$1===resolve$1){var _then=getThen(entry);if(_then===then&&entry._state!==PENDING){this._settledAt(entry._state,i,entry._result);}else if(typeof _then!=='function'){this._remaining--;this._result[i]=entry;}else if(c===Promise$1){var promise=new c(noop);handleMaybeThenable(promise,entry,_then);this._willSettleAt(promise,i);}else{this._willSettleAt(new c(function(resolve$$1){return resolve$$1(entry);}),i);}}else{this._willSettleAt(resolve$$1(entry),i);}};Enumerator.prototype._settledAt=function _settledAt(state,i,value){var promise=this.promise;if(promise._state===PENDING){this._remaining--;if(state===REJECTED){reject(promise,value);}else{this._result[i]=value;}}if(this._remaining===0){fulfill(promise,this._result);}};Enumerator.prototype._willSettleAt=function _willSettleAt(promise,i){var enumerator=this;subscribe(promise,undefined,function(value){return enumerator._settledAt(FULFILLED,i,value);},function(reason){return enumerator._settledAt(REJECTED,i,reason);});};return Enumerator;}();/**
                      `Promise.all` accepts an array of promises, and returns a new promise which
                      is fulfilled with an array of fulfillment values for the passed promises, or
                      rejected with the reason of the first passed promise to be rejected. It casts all
                      elements of the passed iterable to promises as it runs this algorithm.
                    
                      Example:
                    
                      ```javascript
                      let promise1 = resolve(1);
                      let promise2 = resolve(2);
                      let promise3 = resolve(3);
                      let promises = [ promise1, promise2, promise3 ];
                    
                      Promise.all(promises).then(function(array){
                        // The array here would be [ 1, 2, 3 ];
                      });
                      ```
                    
                      If any of the `promises` given to `all` are rejected, the first promise
                      that is rejected will be given as an argument to the returned promises's
                      rejection handler. For example:
                    
                      Example:
                    
                      ```javascript
                      let promise1 = resolve(1);
                      let promise2 = reject(new Error("2"));
                      let promise3 = reject(new Error("3"));
                      let promises = [ promise1, promise2, promise3 ];
                    
                      Promise.all(promises).then(function(array){
                        // Code here never runs because there are rejected promises!
                      }, function(error) {
                        // error.message === "2"
                      });
                      ```
                    
                      @method all
                      @static
                      @param {Array} entries array of promises
                      @param {String} label optional string for labeling the promise.
                      Useful for tooling.
                      @return {Promise} promise that is fulfilled when all `promises` have been
                      fulfilled, or rejected if any of them become rejected.
                      @static
                    */function all(entries){return new Enumerator(this,entries).promise;}/**
                      `Promise.race` returns a new promise which is settled in the same way as the
                      first passed promise to settle.
                    
                      Example:
                    
                      ```javascript
                      let promise1 = new Promise(function(resolve, reject){
                        setTimeout(function(){
                          resolve('promise 1');
                        }, 200);
                      });
                    
                      let promise2 = new Promise(function(resolve, reject){
                        setTimeout(function(){
                          resolve('promise 2');
                        }, 100);
                      });
                    
                      Promise.race([promise1, promise2]).then(function(result){
                        // result === 'promise 2' because it was resolved before promise1
                        // was resolved.
                      });
                      ```
                    
                      `Promise.race` is deterministic in that only the state of the first
                      settled promise matters. For example, even if other promises given to the
                      `promises` array argument are resolved, but the first settled promise has
                      become rejected before the other promises became fulfilled, the returned
                      promise will become rejected:
                    
                      ```javascript
                      let promise1 = new Promise(function(resolve, reject){
                        setTimeout(function(){
                          resolve('promise 1');
                        }, 200);
                      });
                    
                      let promise2 = new Promise(function(resolve, reject){
                        setTimeout(function(){
                          reject(new Error('promise 2'));
                        }, 100);
                      });
                    
                      Promise.race([promise1, promise2]).then(function(result){
                        // Code here never runs
                      }, function(reason){
                        // reason.message === 'promise 2' because promise 2 became rejected before
                        // promise 1 became fulfilled
                      });
                      ```
                    
                      An example real-world use case is implementing timeouts:
                    
                      ```javascript
                      Promise.race([ajax('foo.json'), timeout(5000)])
                      ```
                    
                      @method race
                      @static
                      @param {Array} promises array of promises to observe
                      Useful for tooling.
                      @return {Promise} a promise which settles in the same way as the first passed
                      promise to settle.
                    */function race(entries){/*jshint validthis:true */var Constructor=this;if(!isArray(entries)){return new Constructor(function(_,reject){return reject(new TypeError('You must pass an array to race.'));});}else{return new Constructor(function(resolve,reject){var length=entries.length;for(var i=0;i<length;i++){Constructor.resolve(entries[i]).then(resolve,reject);}});}}/**
                      `Promise.reject` returns a promise rejected with the passed `reason`.
                      It is shorthand for the following:
                    
                      ```javascript
                      let promise = new Promise(function(resolve, reject){
                        reject(new Error('WHOOPS'));
                      });
                    
                      promise.then(function(value){
                        // Code here doesn't run because the promise is rejected!
                      }, function(reason){
                        // reason.message === 'WHOOPS'
                      });
                      ```
                    
                      Instead of writing the above, your code now simply becomes the following:
                    
                      ```javascript
                      let promise = Promise.reject(new Error('WHOOPS'));
                    
                      promise.then(function(value){
                        // Code here doesn't run because the promise is rejected!
                      }, function(reason){
                        // reason.message === 'WHOOPS'
                      });
                      ```
                    
                      @method reject
                      @static
                      @param {Any} reason value that the returned promise will be rejected with.
                      Useful for tooling.
                      @return {Promise} a promise rejected with the given `reason`.
                    */function reject$1(reason){/*jshint validthis:true */var Constructor=this;var promise=new Constructor(noop);reject(promise,reason);return promise;}function needsResolver(){throw new TypeError('You must pass a resolver function as the first argument to the promise constructor');}function needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");}/**
                      Promise objects represent the eventual result of an asynchronous operation. The
                      primary way of interacting with a promise is through its `then` method, which
                      registers callbacks to receive either a promise's eventual value or the reason
                      why the promise cannot be fulfilled.
                    
                      Terminology
                      -----------
                    
                      - `promise` is an object or function with a `then` method whose behavior conforms to this specification.
                      - `thenable` is an object or function that defines a `then` method.
                      - `value` is any legal JavaScript value (including undefined, a thenable, or a promise).
                      - `exception` is a value that is thrown using the throw statement.
                      - `reason` is a value that indicates why a promise was rejected.
                      - `settled` the final resting state of a promise, fulfilled or rejected.
                    
                      A promise can be in one of three states: pending, fulfilled, or rejected.
                    
                      Promises that are fulfilled have a fulfillment value and are in the fulfilled
                      state.  Promises that are rejected have a rejection reason and are in the
                      rejected state.  A fulfillment value is never a thenable.
                    
                      Promises can also be said to *resolve* a value.  If this value is also a
                      promise, then the original promise's settled state will match the value's
                      settled state.  So a promise that *resolves* a promise that rejects will
                      itself reject, and a promise that *resolves* a promise that fulfills will
                      itself fulfill.
                    
                    
                      Basic Usage:
                      ------------
                    
                      ```js
                      let promise = new Promise(function(resolve, reject) {
                        // on success
                        resolve(value);
                    
                        // on failure
                        reject(reason);
                      });
                    
                      promise.then(function(value) {
                        // on fulfillment
                      }, function(reason) {
                        // on rejection
                      });
                      ```
                    
                      Advanced Usage:
                      ---------------
                    
                      Promises shine when abstracting away asynchronous interactions such as
                      `XMLHttpRequest`s.
                    
                      ```js
                      function getJSON(url) {
                        return new Promise(function(resolve, reject){
                          let xhr = new XMLHttpRequest();
                    
                          xhr.open('GET', url);
                          xhr.onreadystatechange = handler;
                          xhr.responseType = 'json';
                          xhr.setRequestHeader('Accept', 'application/json');
                          xhr.send();
                    
                          function handler() {
                            if (this.readyState === this.DONE) {
                              if (this.status === 200) {
                                resolve(this.response);
                              } else {
                                reject(new Error('getJSON: `' + url + '` failed with status: [' + this.status + ']'));
                              }
                            }
                          };
                        });
                      }
                    
                      getJSON('/posts.json').then(function(json) {
                        // on fulfillment
                      }, function(reason) {
                        // on rejection
                      });
                      ```
                    
                      Unlike callbacks, promises are great composable primitives.
                    
                      ```js
                      Promise.all([
                        getJSON('/posts'),
                        getJSON('/comments')
                      ]).then(function(values){
                        values[0] // => postsJSON
                        values[1] // => commentsJSON
                    
                        return values;
                      });
                      ```
                    
                      @class Promise
                      @param {Function} resolver
                      Useful for tooling.
                      @constructor
                    */var Promise$1=function(){function Promise(resolver){this[PROMISE_ID]=nextId();this._result=this._state=undefined;this._subscribers=[];if(noop!==resolver){typeof resolver!=='function'&&needsResolver();this instanceof Promise?initializePromise(this,resolver):needsNew();}}/**
                        The primary way of interacting with a promise is through its `then` method,
                        which registers callbacks to receive either a promise's eventual value or the
                        reason why the promise cannot be fulfilled.
                         ```js
                        findUser().then(function(user){
                          // user is available
                        }, function(reason){
                          // user is unavailable, and you are given the reason why
                        });
                        ```
                         Chaining
                        --------
                         The return value of `then` is itself a promise.  This second, 'downstream'
                        promise is resolved with the return value of the first promise's fulfillment
                        or rejection handler, or rejected if the handler throws an exception.
                         ```js
                        findUser().then(function (user) {
                          return user.name;
                        }, function (reason) {
                          return 'default name';
                        }).then(function (userName) {
                          // If `findUser` fulfilled, `userName` will be the user's name, otherwise it
                          // will be `'default name'`
                        });
                         findUser().then(function (user) {
                          throw new Error('Found user, but still unhappy');
                        }, function (reason) {
                          throw new Error('`findUser` rejected and we're unhappy');
                        }).then(function (value) {
                          // never reached
                        }, function (reason) {
                          // if `findUser` fulfilled, `reason` will be 'Found user, but still unhappy'.
                          // If `findUser` rejected, `reason` will be '`findUser` rejected and we're unhappy'.
                        });
                        ```
                        If the downstream promise does not specify a rejection handler, rejection reasons will be propagated further downstream.
                         ```js
                        findUser().then(function (user) {
                          throw new PedagogicalException('Upstream error');
                        }).then(function (value) {
                          // never reached
                        }).then(function (value) {
                          // never reached
                        }, function (reason) {
                          // The `PedgagocialException` is propagated all the way down to here
                        });
                        ```
                         Assimilation
                        ------------
                         Sometimes the value you want to propagate to a downstream promise can only be
                        retrieved asynchronously. This can be achieved by returning a promise in the
                        fulfillment or rejection handler. The downstream promise will then be pending
                        until the returned promise is settled. This is called *assimilation*.
                         ```js
                        findUser().then(function (user) {
                          return findCommentsByAuthor(user);
                        }).then(function (comments) {
                          // The user's comments are now available
                        });
                        ```
                         If the assimliated promise rejects, then the downstream promise will also reject.
                         ```js
                        findUser().then(function (user) {
                          return findCommentsByAuthor(user);
                        }).then(function (comments) {
                          // If `findCommentsByAuthor` fulfills, we'll have the value here
                        }, function (reason) {
                          // If `findCommentsByAuthor` rejects, we'll have the reason here
                        });
                        ```
                         Simple Example
                        --------------
                         Synchronous Example
                         ```javascript
                        let result;
                         try {
                          result = findResult();
                          // success
                        } catch(reason) {
                          // failure
                        }
                        ```
                         Errback Example
                         ```js
                        findResult(function(result, err){
                          if (err) {
                            // failure
                          } else {
                            // success
                          }
                        });
                        ```
                         Promise Example;
                         ```javascript
                        findResult().then(function(result){
                          // success
                        }, function(reason){
                          // failure
                        });
                        ```
                         Advanced Example
                        --------------
                         Synchronous Example
                         ```javascript
                        let author, books;
                         try {
                          author = findAuthor();
                          books  = findBooksByAuthor(author);
                          // success
                        } catch(reason) {
                          // failure
                        }
                        ```
                         Errback Example
                         ```js
                         function foundBooks(books) {
                         }
                         function failure(reason) {
                         }
                         findAuthor(function(author, err){
                          if (err) {
                            failure(err);
                            // failure
                          } else {
                            try {
                              findBoooksByAuthor(author, function(books, err) {
                                if (err) {
                                  failure(err);
                                } else {
                                  try {
                                    foundBooks(books);
                                  } catch(reason) {
                                    failure(reason);
                                  }
                                }
                              });
                            } catch(error) {
                              failure(err);
                            }
                            // success
                          }
                        });
                        ```
                         Promise Example;
                         ```javascript
                        findAuthor().
                          then(findBooksByAuthor).
                          then(function(books){
                            // found books
                        }).catch(function(reason){
                          // something went wrong
                        });
                        ```
                         @method then
                        @param {Function} onFulfilled
                        @param {Function} onRejected
                        Useful for tooling.
                        @return {Promise}
                        *//**
                        `catch` is simply sugar for `then(undefined, onRejection)` which makes it the same
                        as the catch block of a try/catch statement.
                        ```js
                        function findAuthor(){
                        throw new Error('couldn't find that author');
                        }
                        // synchronous
                        try {
                        findAuthor();
                        } catch(reason) {
                        // something went wrong
                        }
                        // async with promises
                        findAuthor().catch(function(reason){
                        // something went wrong
                        });
                        ```
                        @method catch
                        @param {Function} onRejection
                        Useful for tooling.
                        @return {Promise}
                        */Promise.prototype.catch=function _catch(onRejection){return this.then(null,onRejection);};/**
                          `finally` will be invoked regardless of the promise's fate just as native
                          try/catch/finally behaves
                        
                          Synchronous example:
                        
                          ```js
                          findAuthor() {
                            if (Math.random() > 0.5) {
                              throw new Error();
                            }
                            return new Author();
                          }
                        
                          try {
                            return findAuthor(); // succeed or fail
                          } catch(error) {
                            return findOtherAuther();
                          } finally {
                            // always runs
                            // doesn't affect the return value
                          }
                          ```
                        
                          Asynchronous example:
                        
                          ```js
                          findAuthor().catch(function(reason){
                            return findOtherAuther();
                          }).finally(function(){
                            // author was either found, or not
                          });
                          ```
                        
                          @method finally
                          @param {Function} callback
                          @return {Promise}
                        */Promise.prototype.finally=function _finally(callback){var promise=this;var constructor=promise.constructor;if(isFunction(callback)){return promise.then(function(value){return constructor.resolve(callback()).then(function(){return value;});},function(reason){return constructor.resolve(callback()).then(function(){throw reason;});});}return promise.then(callback,callback);};return Promise;}();Promise$1.prototype.then=then;Promise$1.all=all;Promise$1.race=race;Promise$1.resolve=resolve$1;Promise$1.reject=reject$1;Promise$1._setScheduler=setScheduler;Promise$1._setAsap=setAsap;Promise$1._asap=asap;/*global self*/function polyfill(){var local=void 0;if(typeof global!=='undefined'){local=global;}else if(typeof self!=='undefined'){local=self;}else{try{local=Function('return this')();}catch(e){throw new Error('polyfill failed because global object is unavailable in this environment');}}var P=local.Promise;if(P){var promiseToString=null;try{promiseToString=Object.prototype.toString.call(P.resolve());}catch(e){// silently ignored
}if(promiseToString==='[object Promise]'&&!P.cast){return;}}local.Promise=Promise$1;}// Strange compat..
Promise$1.polyfill=polyfill;Promise$1.Promise=Promise$1;return Promise$1;});}).call(this,_dereq_('_process'),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{});},{"_process":3}],2:[function(_dereq_,module,exports){// Copyright Joyent, Inc. and other Node contributors.
//
// Permission is hereby granted, free of charge, to any person obtaining a
// copy of this software and associated documentation files (the
// "Software"), to deal in the Software without restriction, including
// without limitation the rights to use, copy, modify, merge, publish,
// distribute, sublicense, and/or sell copies of the Software, and to permit
// persons to whom the Software is furnished to do so, subject to the
// following conditions:
//
// The above copyright notice and this permission notice shall be included
// in all copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
// USE OR OTHER DEALINGS IN THE SOFTWARE.
function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined;}module.exports=EventEmitter;// Backwards-compat with node 0.10.x
EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;// By default EventEmitters will print a warning if more than 10 listeners are
// added to it. This is a useful default which helps finding memory leaks.
EventEmitter.defaultMaxListeners=10;// Obviously not all Emitters should be limited to 10. This function allows
// that to be increased. Set to zero for unlimited.
EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError('n must be a positive number');this._maxListeners=n;return this;};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};// If there is no 'error' event listener then throw.
if(type==='error'){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er;// Unhandled 'error' event
}else{// At least give some kind of context to the user
var err=new Error('Uncaught, unspecified "error" event. ('+er+')');err.context=er;throw err;}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){// fast cases
case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;// slower
default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args);}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++){listeners[i].apply(this,args);}}return true;};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError('listener must be a function');if(!this._events)this._events={};// To avoid recursion in the case that type === "newListener"! Before
// adding it to the listeners, first emit "newListener".
if(this._events.newListener)this.emit('newListener',type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])// Optimize the case of one listener. Don't need the extra array object.
this._events[type]=listener;else if(isObject(this._events[type]))// If we've already got an array, just append.
this._events[type].push(listener);else// Adding the second element, need to change to array.
this._events[type]=[this._events[type],listener];// Check for listener leak
if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners;}else{m=EventEmitter.defaultMaxListeners;}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error('(node) warning: possible EventEmitter memory '+'leak detected. %d listeners added. '+'Use emitter.setMaxListeners() to increase limit.',this._events[type].length);if(typeof console.trace==='function'){// not supported in IE 10
console.trace();}}}return this;};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError('listener must be a function');var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments);}}g.listener=listener;this.on(type,g);return this;};// emits a 'removeListener' event iff the listener was removed
EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError('listener must be a function');if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit('removeListener',type,listener);}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break;}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type];}else{list.splice(position,1);}if(this._events.removeListener)this.emit('removeListener',type,listener);}return this;};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;// not listening for removeListener, no need to emit
if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this;}// emit removeListener for all listeners on all events
if(arguments.length===0){for(key in this._events){if(key==='removeListener')continue;this.removeAllListeners(key);}this.removeAllListeners('removeListener');this._events={};return this;}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners);}else if(listeners){// LIFO order
while(listeners.length){this.removeListener(type,listeners[listeners.length-1]);}}delete this._events[type];return this;};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret;};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length;}return 0;};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type);};function isFunction(arg){return typeof arg==='function';}function isNumber(arg){return typeof arg==='number';}function isObject(arg){return(typeof arg==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(arg))==='object'&&arg!==null;}function isUndefined(arg){return arg===void 0;}},{}],3:[function(_dereq_,module,exports){// shim for using process in browser
var process=module.exports={};// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.
var cachedSetTimeout;var cachedClearTimeout;function defaultSetTimout(){throw new Error('setTimeout has not been defined');}function defaultClearTimeout(){throw new Error('clearTimeout has not been defined');}(function(){try{if(typeof setTimeout==='function'){cachedSetTimeout=setTimeout;}else{cachedSetTimeout=defaultSetTimout;}}catch(e){cachedSetTimeout=defaultSetTimout;}try{if(typeof clearTimeout==='function'){cachedClearTimeout=clearTimeout;}else{cachedClearTimeout=defaultClearTimeout;}}catch(e){cachedClearTimeout=defaultClearTimeout;}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){//normal enviroments in sane situations
return setTimeout(fun,0);}// if setTimeout wasn't available but was latter defined
if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0);}try{// when when somebody has screwed with setTimeout but no I.E. maddness
return cachedSetTimeout(fun,0);}catch(e){try{// When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
return cachedSetTimeout.call(null,fun,0);}catch(e){// same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
return cachedSetTimeout.call(this,fun,0);}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){//normal enviroments in sane situations
return clearTimeout(marker);}// if clearTimeout wasn't available but was latter defined
if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker);}try{// when when somebody has screwed with setTimeout but no I.E. maddness
return cachedClearTimeout(marker);}catch(e){try{// When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
return cachedClearTimeout.call(null,marker);}catch(e){// same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
// Some versions of I.E. have different rules for clearTimeout vs setTimeout
return cachedClearTimeout.call(this,marker);}}}var queue=[];var draining=false;var currentQueue;var queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return;}draining=false;if(currentQueue.length){queue=currentQueue.concat(queue);}else{queueIndex=-1;}if(queue.length){drainQueue();}}function drainQueue(){if(draining){return;}var timeout=runTimeout(cleanUpNextTick);draining=true;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run();}}queueIndex=-1;len=queue.length;}currentQueue=null;draining=false;runClearTimeout(timeout);}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i];}}queue.push(new Item(fun,args));if(queue.length===1&&!draining){runTimeout(drainQueue);}};// v8 likes predictible objects
function Item(fun,array){this.fun=fun;this.array=array;}Item.prototype.run=function(){this.fun.apply(null,this.array);};process.title='browser';process.browser=true;process.env={};process.argv=[];process.version='';// empty string to avoid regexp issues
process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(name){return[];};process.binding=function(name){throw new Error('process.binding is not supported');};process.cwd=function(){return'/';};process.chdir=function(dir){throw new Error('process.chdir is not supported');};process.umask=function(){return 0;};},{}],4:[function(_dereq_,module,exports){var bundleFn=arguments[3];var sources=arguments[4];var cache=arguments[5];var stringify=__WEBPACK_IMPORTED_MODULE_10_babel_runtime_core_js_json_stringify___default.a;module.exports=function(fn,options){var wkey;var cacheKeys=__WEBPACK_IMPORTED_MODULE_9_babel_runtime_core_js_object_keys___default()(cache);for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];var exp=cache[key].exports;// Using babel as a transpiler to use esmodule, the export will always
// be an object with the default export as a property of it. To ensure
// the existing api and babel esmodule exports are both supported we
// check for both
if(exp===fn||exp&&exp.default===fn){wkey=key;break;}}if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var wcache={};for(var i=0,l=cacheKeys.length;i<l;i++){var key=cacheKeys[i];wcache[key]=key;}sources[wkey]=['function(require,module,exports){'+fn+'(self); }',wcache];}var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var scache={};scache[wkey]=wkey;sources[skey]=['function(require,module,exports){'+// try to call default if defined to also support babel esmodule exports
'var f = require('+stringify(wkey)+');'+'(f.default ? f.default : f)(self);'+'}',scache];var workerSources={};resolveSources(skey);function resolveSources(key){workerSources[key]=true;for(var depPath in sources[key][1]){var depKey=sources[key][1][depPath];if(!workerSources[depKey]){resolveSources(depKey);}}}var src='('+bundleFn+')({'+__WEBPACK_IMPORTED_MODULE_9_babel_runtime_core_js_object_keys___default()(workerSources).map(function(key){return stringify(key)+':['+sources[key][0]+','+stringify(sources[key][1])+']';}).join(',')+'},{},['+stringify(skey)+'])';var URL=window.URL||window.webkitURL||window.mozURL||window.msURL;var blob=new Blob([src],{type:'text/javascript'});if(options&&options.bare){return blob;}var workerUrl=URL.createObjectURL(blob);var worker=new Worker(workerUrl);worker.objectURL=workerUrl;return worker;};},{}],5:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.createDefaultConfig=createDefaultConfig;/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var defaultConfig=exports.defaultConfig={enableWorker:false,enableStashBuffer:true,stashInitialSize:undefined,isLive:false,lazyLoad:true,lazyLoadMaxDuration:3*60,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:true,// autoCleanupSourceBuffer: default as false, leave unspecified
autoCleanupMaxBackwardDuration:3*60,autoCleanupMinBackwardDuration:2*60,statisticsInfoReportInterval:600,fixAudioTimestampGap:true,accurateSeek:false,seekType:'range',// [range, param, custom]
seekParamStart:'bstart',seekParamEnd:'bend',rangeLoadZeroStart:false,customSeekHandler:undefined,reuseRedirectedURL:false,// referrerPolicy: leave as unspecified
headers:undefined,customLoader:undefined};function createDefaultConfig(){return __WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},defaultConfig);}},{}],6:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _ioController=_dereq_('../io/io-controller.js');var _ioController2=_interopRequireDefault(_ioController);var _config=_dereq_('../config.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var Features=function(){function Features(){_classCallCheck(this,Features);}_createClass(Features,null,[{key:'supportMSEH264Playback',value:function supportMSEH264Playback(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"');}},{key:'supportNetworkStreamIO',value:function supportNetworkStreamIO(){var ioctl=new _ioController2.default({},(0,_config.createDefaultConfig)());var loaderType=ioctl.loaderType;ioctl.destroy();return loaderType=='fetch-stream-loader'||loaderType=='xhr-moz-chunked-loader';}},{key:'getNetworkLoaderTypeName',value:function getNetworkLoaderTypeName(){var ioctl=new _ioController2.default({},(0,_config.createDefaultConfig)());var loaderType=ioctl.loaderType;ioctl.destroy();return loaderType;}},{key:'supportNativeMediaPlayback',value:function supportNativeMediaPlayback(mimeType){if(Features.videoElement==undefined){Features.videoElement=window.document.createElement('video');}var canPlay=Features.videoElement.canPlayType(mimeType);return canPlay==='probably'||canPlay=='maybe';}},{key:'getFeatureList',value:function getFeatureList(){var features={mseFlvPlayback:false,mseLiveFlvPlayback:false,networkStreamIO:false,networkLoaderName:'',nativeMP4H264Playback:false,nativeWebmVP8Playback:false,nativeWebmVP9Playback:false};features.mseFlvPlayback=Features.supportMSEH264Playback();features.networkStreamIO=Features.supportNetworkStreamIO();features.networkLoaderName=Features.getNetworkLoaderTypeName();features.mseLiveFlvPlayback=features.mseFlvPlayback&&features.networkStreamIO;features.nativeMP4H264Playback=Features.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"');features.nativeWebmVP8Playback=Features.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"');features.nativeWebmVP9Playback=Features.supportNativeMediaPlayback('video/webm; codecs="vp9"');return features;}}]);return Features;}();exports.default=Features;},{"../config.js":5,"../io/io-controller.js":23}],7:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var MediaInfo=function(){function MediaInfo(){_classCallCheck(this,MediaInfo);this.mimeType=null;this.duration=null;this.hasAudio=null;this.hasVideo=null;this.audioCodec=null;this.videoCodec=null;this.audioDataRate=null;this.videoDataRate=null;this.audioSampleRate=null;this.audioChannelCount=null;this.width=null;this.height=null;this.fps=null;this.profile=null;this.level=null;this.refFrames=null;this.chromaFormat=null;this.sarNum=null;this.sarDen=null;this.metadata=null;this.segments=null;// MediaInfo[]
this.segmentCount=null;this.hasKeyframesIndex=null;this.keyframesIndex=null;}_createClass(MediaInfo,[{key:"isComplete",value:function isComplete(){var audioInfoComplete=this.hasAudio===false||this.hasAudio===true&&this.audioCodec!=null&&this.audioSampleRate!=null&&this.audioChannelCount!=null;var videoInfoComplete=this.hasVideo===false||this.hasVideo===true&&this.videoCodec!=null&&this.width!=null&&this.height!=null&&this.fps!=null&&this.profile!=null&&this.level!=null&&this.refFrames!=null&&this.chromaFormat!=null&&this.sarNum!=null&&this.sarDen!=null;// keyframesIndex may not be present
return this.mimeType!=null&&this.duration!=null&&this.metadata!=null&&this.hasKeyframesIndex!=null&&audioInfoComplete&&videoInfoComplete;}},{key:"isSeekable",value:function isSeekable(){return this.hasKeyframesIndex===true;}},{key:"getNearestKeyframe",value:function getNearestKeyframe(milliseconds){if(this.keyframesIndex==null){return null;}var table=this.keyframesIndex;var keyframeIdx=this._search(table.times,milliseconds);return{index:keyframeIdx,milliseconds:table.times[keyframeIdx],fileposition:table.filepositions[keyframeIdx]};}},{key:"_search",value:function _search(list,value){var idx=0;var last=list.length-1;var mid=0;var lbound=0;var ubound=last;if(value<list[0]){idx=0;lbound=ubound+1;// skip search
}while(lbound<=ubound){mid=lbound+Math.floor((ubound-lbound)/2);if(mid===last||value>=list[mid]&&value<list[mid+1]){idx=mid;break;}else if(list[mid]<value){lbound=mid+1;}else{ubound=mid-1;}}return idx;}}]);return MediaInfo;}();exports.default=MediaInfo;},{}],8:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */// Represents an media sample (audio / video)
var SampleInfo=exports.SampleInfo=function SampleInfo(dts,pts,duration,originalDts,isSync){_classCallCheck(this,SampleInfo);this.dts=dts;this.pts=pts;this.duration=duration;this.originalDts=originalDts;this.isSyncPoint=isSync;this.fileposition=null;};// Media Segment concept is defined in Media Source Extensions spec.
// Particularly in ISO BMFF format, an Media Segment contains a moof box followed by a mdat box.
var MediaSegmentInfo=exports.MediaSegmentInfo=function(){function MediaSegmentInfo(){_classCallCheck(this,MediaSegmentInfo);this.beginDts=0;this.endDts=0;this.beginPts=0;this.endPts=0;this.originalBeginDts=0;this.originalEndDts=0;this.syncPoints=[];// SampleInfo[n], for video IDR frames only
this.firstSample=null;// SampleInfo
this.lastSample=null;// SampleInfo
}_createClass(MediaSegmentInfo,[{key:"appendSyncPoint",value:function appendSyncPoint(sampleInfo){// also called Random Access Point
sampleInfo.isSyncPoint=true;this.syncPoints.push(sampleInfo);}}]);return MediaSegmentInfo;}();// Ordered list for recording video IDR frames, sorted by originalDts
var IDRSampleList=exports.IDRSampleList=function(){function IDRSampleList(){_classCallCheck(this,IDRSampleList);this._list=[];}_createClass(IDRSampleList,[{key:"clear",value:function clear(){this._list=[];}},{key:"appendArray",value:function appendArray(syncPoints){var list=this._list;if(syncPoints.length===0){return;}if(list.length>0&&syncPoints[0].originalDts<list[list.length-1].originalDts){this.clear();}Array.prototype.push.apply(list,syncPoints);}},{key:"getLastSyncPointBeforeDts",value:function getLastSyncPointBeforeDts(dts){if(this._list.length==0){return null;}var list=this._list;var idx=0;var last=list.length-1;var mid=0;var lbound=0;var ubound=last;if(dts<list[0].dts){idx=0;lbound=ubound+1;}while(lbound<=ubound){mid=lbound+Math.floor((ubound-lbound)/2);if(mid===last||dts>=list[mid].dts&&dts<list[mid+1].dts){idx=mid;break;}else if(list[mid].dts<dts){lbound=mid+1;}else{ubound=mid-1;}}return this._list[idx];}}]);return IDRSampleList;}();// Data structure for recording information of media segments in single track.
var MediaSegmentInfoList=exports.MediaSegmentInfoList=function(){function MediaSegmentInfoList(type){_classCallCheck(this,MediaSegmentInfoList);this._type=type;this._list=[];this._lastAppendLocation=-1;// cached last insert location
}_createClass(MediaSegmentInfoList,[{key:"isEmpty",value:function isEmpty(){return this._list.length===0;}},{key:"clear",value:function clear(){this._list=[];this._lastAppendLocation=-1;}},{key:"_searchNearestSegmentBefore",value:function _searchNearestSegmentBefore(originalBeginDts){var list=this._list;if(list.length===0){return-2;}var last=list.length-1;var mid=0;var lbound=0;var ubound=last;var idx=0;if(originalBeginDts<list[0].originalBeginDts){idx=-1;return idx;}while(lbound<=ubound){mid=lbound+Math.floor((ubound-lbound)/2);if(mid===last||originalBeginDts>list[mid].lastSample.originalDts&&originalBeginDts<list[mid+1].originalBeginDts){idx=mid;break;}else if(list[mid].originalBeginDts<originalBeginDts){lbound=mid+1;}else{ubound=mid-1;}}return idx;}},{key:"_searchNearestSegmentAfter",value:function _searchNearestSegmentAfter(originalBeginDts){return this._searchNearestSegmentBefore(originalBeginDts)+1;}},{key:"append",value:function append(mediaSegmentInfo){var list=this._list;var msi=mediaSegmentInfo;var lastAppendIdx=this._lastAppendLocation;var insertIdx=0;if(lastAppendIdx!==-1&&lastAppendIdx<list.length&&msi.originalBeginDts>=list[lastAppendIdx].lastSample.originalDts&&(lastAppendIdx===list.length-1||lastAppendIdx<list.length-1&&msi.originalBeginDts<list[lastAppendIdx+1].originalBeginDts)){insertIdx=lastAppendIdx+1;// use cached location idx
}else{if(list.length>0){insertIdx=this._searchNearestSegmentBefore(msi.originalBeginDts)+1;}}this._lastAppendLocation=insertIdx;this._list.splice(insertIdx,0,msi);}},{key:"getLastSegmentBefore",value:function getLastSegmentBefore(originalBeginDts){var idx=this._searchNearestSegmentBefore(originalBeginDts);if(idx>=0){return this._list[idx];}else{// -1
return null;}}},{key:"getLastSampleBefore",value:function getLastSampleBefore(originalBeginDts){var segment=this.getLastSegmentBefore(originalBeginDts);if(segment!=null){return segment.lastSample;}else{return null;}}},{key:"getLastSyncPointBefore",value:function getLastSyncPointBefore(originalBeginDts){var segmentIdx=this._searchNearestSegmentBefore(originalBeginDts);var syncPoints=this._list[segmentIdx].syncPoints;while(syncPoints.length===0&&segmentIdx>0){segmentIdx--;syncPoints=this._list[segmentIdx].syncPoints;}if(syncPoints.length>0){return syncPoints[syncPoints.length-1];}else{return null;}}},{key:"type",get:function get(){return this._type;}},{key:"length",get:function get(){return this._list.length;}}]);return MediaSegmentInfoList;}();},{}],9:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _events=_dereq_('events');var _events2=_interopRequireDefault(_events);var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _browser=_dereq_('../utils/browser.js');var _browser2=_interopRequireDefault(_browser);var _mseEvents=_dereq_('./mse-events.js');var _mseEvents2=_interopRequireDefault(_mseEvents);var _mediaSegmentInfo=_dereq_('./media-segment-info.js');var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}// Media Source Extensions controller
var MSEController=function(){function MSEController(config){_classCallCheck(this,MSEController);this.TAG='MSEController';this._config=config;this._emitter=new _events2.default();if(this._config.isLive&&this._config.autoCleanupSourceBuffer==undefined){// For live stream, do auto cleanup by default
this._config.autoCleanupSourceBuffer=true;}this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)};this._mediaSource=null;this._mediaSourceObjectURL=null;this._mediaElement=null;this._isBufferFull=false;this._hasPendingEos=false;this._requireSetMediaDuration=false;this._pendingMediaDuration=0;this._pendingSourceBufferInit=[];this._mimeTypes={video:null,audio:null};this._sourceBuffers={video:null,audio:null};this._lastInitSegments={video:null,audio:null};this._pendingSegments={video:[],audio:[]};this._pendingRemoveRanges={video:[],audio:[]};this._idrList=new _mediaSegmentInfo.IDRSampleList();}_createClass(MSEController,[{key:'destroy',value:function destroy(){if(this._mediaElement||this._mediaSource){this.detachMediaElement();}this.e=null;this._emitter.removeAllListeners();this._emitter=null;}},{key:'on',value:function on(event,listener){this._emitter.addListener(event,listener);}},{key:'off',value:function off(event,listener){this._emitter.removeListener(event,listener);}},{key:'attachMediaElement',value:function attachMediaElement(mediaElement){if(this._mediaSource){throw new _exception.IllegalStateException('MediaSource has been attached to an HTMLMediaElement!');}var ms=this._mediaSource=new window.MediaSource();ms.addEventListener('sourceopen',this.e.onSourceOpen);ms.addEventListener('sourceended',this.e.onSourceEnded);ms.addEventListener('sourceclose',this.e.onSourceClose);this._mediaElement=mediaElement;this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource);mediaElement.src=this._mediaSourceObjectURL;}},{key:'detachMediaElement',value:function detachMediaElement(){if(this._mediaSource){var ms=this._mediaSource;for(var type in this._sourceBuffers){// pending segments should be discard
var ps=this._pendingSegments[type];ps.splice(0,ps.length);this._pendingSegments[type]=null;this._pendingRemoveRanges[type]=null;this._lastInitSegments[type]=null;// remove all sourcebuffers
var sb=this._sourceBuffers[type];if(sb){if(ms.readyState!=='closed'){// ms edge can throw an error: Unexpected call to method or property access
try{ms.removeSourceBuffer(sb);}catch(error){_logger2.default.e(this.TAG,error.message);}sb.removeEventListener('error',this.e.onSourceBufferError);sb.removeEventListener('updateend',this.e.onSourceBufferUpdateEnd);}this._mimeTypes[type]=null;this._sourceBuffers[type]=null;}}if(ms.readyState==='open'){try{ms.endOfStream();}catch(error){_logger2.default.e(this.TAG,error.message);}}ms.removeEventListener('sourceopen',this.e.onSourceOpen);ms.removeEventListener('sourceended',this.e.onSourceEnded);ms.removeEventListener('sourceclose',this.e.onSourceClose);this._pendingSourceBufferInit=[];this._isBufferFull=false;this._idrList.clear();this._mediaSource=null;}if(this._mediaElement){this._mediaElement.src='';this._mediaElement.removeAttribute('src');this._mediaElement=null;}if(this._mediaSourceObjectURL){window.URL.revokeObjectURL(this._mediaSourceObjectURL);this._mediaSourceObjectURL=null;}}},{key:'appendInitSegment',value:function appendInitSegment(initSegment,deferred){if(!this._mediaSource||this._mediaSource.readyState!=='open'){// sourcebuffer creation requires mediaSource.readyState === 'open'
// so we defer the sourcebuffer creation, until sourceopen event triggered
this._pendingSourceBufferInit.push(initSegment);// make sure that this InitSegment is in the front of pending segments queue
this._pendingSegments[initSegment.type].push(initSegment);return;}var is=initSegment;var mimeType=''+is.container;if(is.codec&&is.codec.length>0){mimeType+=';codecs='+is.codec;}var firstInitSegment=false;_logger2.default.v(this.TAG,'Received Initialization Segment, mimeType: '+mimeType);this._lastInitSegments[is.type]=is;if(mimeType!==this._mimeTypes[is.type]){if(!this._mimeTypes[is.type]){// empty, first chance create sourcebuffer
firstInitSegment=true;try{var sb=this._sourceBuffers[is.type]=this._mediaSource.addSourceBuffer(mimeType);sb.addEventListener('error',this.e.onSourceBufferError);sb.addEventListener('updateend',this.e.onSourceBufferUpdateEnd);}catch(error){_logger2.default.e(this.TAG,error.message);this._emitter.emit(_mseEvents2.default.ERROR,{code:error.code,msg:error.message});return;}}else{_logger2.default.v(this.TAG,'Notice: '+is.type+' mimeType changed, origin: '+this._mimeTypes[is.type]+', target: '+mimeType);}this._mimeTypes[is.type]=mimeType;}if(!deferred){// deferred means this InitSegment has been pushed to pendingSegments queue
this._pendingSegments[is.type].push(is);}if(!firstInitSegment){// append immediately only if init segment in subsequence
if(this._sourceBuffers[is.type]&&!this._sourceBuffers[is.type].updating){this._doAppendSegments();}}if(_browser2.default.safari&&is.container==='audio/mpeg'&&is.mediaDuration>0){// 'audio/mpeg' track under Safari may cause MediaElement's duration to be NaN
// Manually correct MediaSource.duration to make progress bar seekable, and report right duration
this._requireSetMediaDuration=true;this._pendingMediaDuration=is.mediaDuration/1000;// in seconds
this._updateMediaSourceDuration();}}},{key:'appendMediaSegment',value:function appendMediaSegment(mediaSegment){var ms=mediaSegment;this._pendingSegments[ms.type].push(ms);if(this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()){this._doCleanupSourceBuffer();}var sb=this._sourceBuffers[ms.type];if(sb&&!sb.updating&&!this._hasPendingRemoveRanges()){this._doAppendSegments();}}},{key:'seek',value:function seek(seconds){// remove all appended buffers
for(var type in this._sourceBuffers){if(!this._sourceBuffers[type]){continue;}// abort current buffer append algorithm
var sb=this._sourceBuffers[type];if(this._mediaSource.readyState==='open'){try{// If range removal algorithm is running, InvalidStateError will be throwed
// Ignore it.
sb.abort();}catch(error){_logger2.default.e(this.TAG,error.message);}}// IDRList should be clear
this._idrList.clear();// pending segments should be discard
var ps=this._pendingSegments[type];ps.splice(0,ps.length);if(this._mediaSource.readyState==='closed'){// Parent MediaSource object has been detached from HTMLMediaElement
continue;}// record ranges to be remove from SourceBuffer
for(var i=0;i<sb.buffered.length;i++){var start=sb.buffered.start(i);var end=sb.buffered.end(i);this._pendingRemoveRanges[type].push({start:start,end:end});}// if sb is not updating, let's remove ranges now!
if(!sb.updating){this._doRemoveRanges();}// Safari 10 may get InvalidStateError in the later appendBuffer() after SourceBuffer.remove() call
// Internal parser's state may be invalid at this time. Re-append last InitSegment to workaround.
// Related issue: https://bugs.webkit.org/show_bug.cgi?id=159230
if(_browser2.default.safari){var lastInitSegment=this._lastInitSegments[type];if(lastInitSegment){this._pendingSegments[type].push(lastInitSegment);if(!sb.updating){this._doAppendSegments();}}}}}},{key:'endOfStream',value:function endOfStream(){var ms=this._mediaSource;var sb=this._sourceBuffers;if(!ms||ms.readyState!=='open'){if(ms&&ms.readyState==='closed'&&this._hasPendingSegments()){// If MediaSource hasn't turned into open state, and there're pending segments
// Mark pending endOfStream, defer call until all pending segments appended complete
this._hasPendingEos=true;}return;}if(sb.video&&sb.video.updating||sb.audio&&sb.audio.updating){// If any sourcebuffer is updating, defer endOfStream operation
// See _onSourceBufferUpdateEnd()
this._hasPendingEos=true;}else{this._hasPendingEos=false;// Notify media data loading complete
// This is helpful for correcting total duration to match last media segment
// Otherwise MediaElement's ended event may not be triggered
ms.endOfStream();}}},{key:'getNearestKeyframe',value:function getNearestKeyframe(dts){return this._idrList.getLastSyncPointBeforeDts(dts);}},{key:'_needCleanupSourceBuffer',value:function _needCleanupSourceBuffer(){if(!this._config.autoCleanupSourceBuffer){return false;}var currentTime=this._mediaElement.currentTime;for(var type in this._sourceBuffers){var sb=this._sourceBuffers[type];if(sb){var buffered=sb.buffered;if(buffered.length>=1){if(currentTime-buffered.start(0)>=this._config.autoCleanupMaxBackwardDuration){return true;}}}}return false;}},{key:'_doCleanupSourceBuffer',value:function _doCleanupSourceBuffer(){var currentTime=this._mediaElement.currentTime;for(var type in this._sourceBuffers){var sb=this._sourceBuffers[type];if(sb){var buffered=sb.buffered;var doRemove=false;for(var i=0;i<buffered.length;i++){var start=buffered.start(i);var end=buffered.end(i);if(start<=currentTime&&currentTime<end+3){// padding 3 seconds
if(currentTime-start>=this._config.autoCleanupMaxBackwardDuration){doRemove=true;var removeEnd=currentTime-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[type].push({start:start,end:removeEnd});}}else if(end<currentTime){doRemove=true;this._pendingRemoveRanges[type].push({start:start,end:end});}}if(doRemove&&!sb.updating){this._doRemoveRanges();}}}}},{key:'_updateMediaSourceDuration',value:function _updateMediaSourceDuration(){var sb=this._sourceBuffers;if(this._mediaElement.readyState===0||this._mediaSource.readyState!=='open'){return;}if(sb.video&&sb.video.updating||sb.audio&&sb.audio.updating){return;}var current=this._mediaSource.duration;var target=this._pendingMediaDuration;if(target>0&&(isNaN(current)||target>current)){_logger2.default.v(this.TAG,'Update MediaSource duration from '+current+' to '+target);this._mediaSource.duration=target;}this._requireSetMediaDuration=false;this._pendingMediaDuration=0;}},{key:'_doRemoveRanges',value:function _doRemoveRanges(){for(var type in this._pendingRemoveRanges){if(!this._sourceBuffers[type]||this._sourceBuffers[type].updating){continue;}var sb=this._sourceBuffers[type];var ranges=this._pendingRemoveRanges[type];while(ranges.length&&!sb.updating){var range=ranges.shift();sb.remove(range.start,range.end);}}}},{key:'_doAppendSegments',value:function _doAppendSegments(){var pendingSegments=this._pendingSegments;for(var type in pendingSegments){if(!this._sourceBuffers[type]||this._sourceBuffers[type].updating){continue;}if(pendingSegments[type].length>0){var segment=pendingSegments[type].shift();if(segment.timestampOffset){// For MPEG audio stream in MSE, if unbuffered-seeking occurred
// We need explicitly set timestampOffset to the desired point in timeline for mpeg SourceBuffer.
var currentOffset=this._sourceBuffers[type].timestampOffset;var targetOffset=segment.timestampOffset/1000;// in seconds
var delta=Math.abs(currentOffset-targetOffset);if(delta>0.1){// If time delta > 100ms
_logger2.default.v(this.TAG,'Update MPEG audio timestampOffset from '+currentOffset+' to '+targetOffset);this._sourceBuffers[type].timestampOffset=targetOffset;}delete segment.timestampOffset;}if(!segment.data||segment.data.byteLength===0){// Ignore empty buffer
continue;}try{this._sourceBuffers[type].appendBuffer(segment.data);this._isBufferFull=false;if(type==='video'&&segment.hasOwnProperty('info')){this._idrList.appendArray(segment.info.syncPoints);}}catch(error){this._pendingSegments[type].unshift(segment);if(error.code===22){// QuotaExceededError
/* Notice that FireFox may not throw QuotaExceededError if SourceBuffer is full
                                         * Currently we can only do lazy-load to avoid SourceBuffer become scattered.
                                         * SourceBuffer eviction policy may be changed in future version of FireFox.
                                         *
                                         * Related issues:
                                         * https://bugzilla.mozilla.org/show_bug.cgi?id=1279885
                                         * https://bugzilla.mozilla.org/show_bug.cgi?id=1280023
                                         */// report buffer full, abort network IO
if(!this._isBufferFull){this._emitter.emit(_mseEvents2.default.BUFFER_FULL);}this._isBufferFull=true;}else{_logger2.default.e(this.TAG,error.message);this._emitter.emit(_mseEvents2.default.ERROR,{code:error.code,msg:error.message});}}}}}},{key:'_onSourceOpen',value:function _onSourceOpen(){_logger2.default.v(this.TAG,'MediaSource onSourceOpen');this._mediaSource.removeEventListener('sourceopen',this.e.onSourceOpen);// deferred sourcebuffer creation / initialization
if(this._pendingSourceBufferInit.length>0){var pendings=this._pendingSourceBufferInit;while(pendings.length){var segment=pendings.shift();this.appendInitSegment(segment,true);}}// there may be some pending media segments, append them
if(this._hasPendingSegments()){this._doAppendSegments();}this._emitter.emit(_mseEvents2.default.SOURCE_OPEN);}},{key:'_onSourceEnded',value:function _onSourceEnded(){// fired on endOfStream
_logger2.default.v(this.TAG,'MediaSource onSourceEnded');}},{key:'_onSourceClose',value:function _onSourceClose(){// fired on detaching from media element
_logger2.default.v(this.TAG,'MediaSource onSourceClose');if(this._mediaSource&&this.e!=null){this._mediaSource.removeEventListener('sourceopen',this.e.onSourceOpen);this._mediaSource.removeEventListener('sourceended',this.e.onSourceEnded);this._mediaSource.removeEventListener('sourceclose',this.e.onSourceClose);}}},{key:'_hasPendingSegments',value:function _hasPendingSegments(){var ps=this._pendingSegments;return ps.video.length>0||ps.audio.length>0;}},{key:'_hasPendingRemoveRanges',value:function _hasPendingRemoveRanges(){var prr=this._pendingRemoveRanges;return prr.video.length>0||prr.audio.length>0;}},{key:'_onSourceBufferUpdateEnd',value:function _onSourceBufferUpdateEnd(){if(this._requireSetMediaDuration){this._updateMediaSourceDuration();}else if(this._hasPendingRemoveRanges()){this._doRemoveRanges();}else if(this._hasPendingSegments()){this._doAppendSegments();}else if(this._hasPendingEos){this.endOfStream();}this._emitter.emit(_mseEvents2.default.UPDATE_END);}},{key:'_onSourceBufferError',value:function _onSourceBufferError(e){_logger2.default.e(this.TAG,'SourceBuffer Error: '+e);// this error might not always be fatal, just ignore it
}}]);return MSEController;}();exports.default=MSEController;},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./media-segment-info.js":8,"./mse-events.js":10,"events":2}],10:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var MSEEvents={ERROR:'error',SOURCE_OPEN:'source_open',UPDATE_END:'update_end',BUFFER_FULL:'buffer_full'};exports.default=MSEEvents;},{}],11:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _events=_dereq_('events');var _events2=_interopRequireDefault(_events);var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _loggingControl=_dereq_('../utils/logging-control.js');var _loggingControl2=_interopRequireDefault(_loggingControl);var _transmuxingController=_dereq_('./transmuxing-controller.js');var _transmuxingController2=_interopRequireDefault(_transmuxingController);var _transmuxingEvents=_dereq_('./transmuxing-events.js');var _transmuxingEvents2=_interopRequireDefault(_transmuxingEvents);var _transmuxingWorker=_dereq_('./transmuxing-worker.js');var _transmuxingWorker2=_interopRequireDefault(_transmuxingWorker);var _mediaInfo=_dereq_('./media-info.js');var _mediaInfo2=_interopRequireDefault(_mediaInfo);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var Transmuxer=function(){function Transmuxer(mediaDataSource,config){_classCallCheck(this,Transmuxer);this.TAG='Transmuxer';this._emitter=new _events2.default();if(config.enableWorker&&typeof Worker!=='undefined'){try{var work=_dereq_('webworkify');this._worker=work(_transmuxingWorker2.default);this._workerDestroying=false;this._worker.addEventListener('message',this._onWorkerMessage.bind(this));this._worker.postMessage({cmd:'init',param:[mediaDataSource,config]});this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)};_loggingControl2.default.registerListener(this.e.onLoggingConfigChanged);this._worker.postMessage({cmd:'logging_config',param:_loggingControl2.default.getConfig()});}catch(error){_logger2.default.e(this.TAG,'Error while initialize transmuxing worker, fallback to inline transmuxing');this._worker=null;this._controller=new _transmuxingController2.default(mediaDataSource,config);}}else{this._controller=new _transmuxingController2.default(mediaDataSource,config);}if(this._controller){var ctl=this._controller;ctl.on(_transmuxingEvents2.default.IO_ERROR,this._onIOError.bind(this));ctl.on(_transmuxingEvents2.default.DEMUX_ERROR,this._onDemuxError.bind(this));ctl.on(_transmuxingEvents2.default.INIT_SEGMENT,this._onInitSegment.bind(this));ctl.on(_transmuxingEvents2.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this));ctl.on(_transmuxingEvents2.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this));ctl.on(_transmuxingEvents2.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this));ctl.on(_transmuxingEvents2.default.MEDIA_INFO,this._onMediaInfo.bind(this));ctl.on(_transmuxingEvents2.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this));ctl.on(_transmuxingEvents2.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this));ctl.on(_transmuxingEvents2.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this));ctl.on(_transmuxingEvents2.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this));}}_createClass(Transmuxer,[{key:'destroy',value:function destroy(){if(this._worker){if(!this._workerDestroying){this._workerDestroying=true;this._worker.postMessage({cmd:'destroy'});_loggingControl2.default.removeListener(this.e.onLoggingConfigChanged);this.e=null;}}else{this._controller.destroy();this._controller=null;}this._emitter.removeAllListeners();this._emitter=null;}},{key:'on',value:function on(event,listener){this._emitter.addListener(event,listener);}},{key:'off',value:function off(event,listener){this._emitter.removeListener(event,listener);}},{key:'hasWorker',value:function hasWorker(){return this._worker!=null;}},{key:'open',value:function open(){if(this._worker){this._worker.postMessage({cmd:'start'});}else{this._controller.start();}}},{key:'close',value:function close(){if(this._worker){this._worker.postMessage({cmd:'stop'});}else{this._controller.stop();}}},{key:'seek',value:function seek(milliseconds){if(this._worker){this._worker.postMessage({cmd:'seek',param:milliseconds});}else{this._controller.seek(milliseconds);}}},{key:'pause',value:function pause(){if(this._worker){this._worker.postMessage({cmd:'pause'});}else{this._controller.pause();}}},{key:'resume',value:function resume(){if(this._worker){this._worker.postMessage({cmd:'resume'});}else{this._controller.resume();}}},{key:'_onInitSegment',value:function _onInitSegment(type,initSegment){var _this=this;// do async invoke
__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this._emitter.emit(_transmuxingEvents2.default.INIT_SEGMENT,type,initSegment);});}},{key:'_onMediaSegment',value:function _onMediaSegment(type,mediaSegment){var _this2=this;__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this2._emitter.emit(_transmuxingEvents2.default.MEDIA_SEGMENT,type,mediaSegment);});}},{key:'_onLoadingComplete',value:function _onLoadingComplete(){var _this3=this;__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this3._emitter.emit(_transmuxingEvents2.default.LOADING_COMPLETE);});}},{key:'_onRecoveredEarlyEof',value:function _onRecoveredEarlyEof(){var _this4=this;__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this4._emitter.emit(_transmuxingEvents2.default.RECOVERED_EARLY_EOF);});}},{key:'_onMediaInfo',value:function _onMediaInfo(mediaInfo){var _this5=this;__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this5._emitter.emit(_transmuxingEvents2.default.MEDIA_INFO,mediaInfo);});}},{key:'_onMetaDataArrived',value:function _onMetaDataArrived(metadata){var _this6=this;__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this6._emitter.emit(_transmuxingEvents2.default.METADATA_ARRIVED,metadata);});}},{key:'_onScriptDataArrived',value:function _onScriptDataArrived(data){var _this7=this;__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this7._emitter.emit(_transmuxingEvents2.default.SCRIPTDATA_ARRIVED,data);});}},{key:'_onStatisticsInfo',value:function _onStatisticsInfo(statisticsInfo){var _this8=this;__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this8._emitter.emit(_transmuxingEvents2.default.STATISTICS_INFO,statisticsInfo);});}},{key:'_onIOError',value:function _onIOError(type,info){var _this9=this;__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this9._emitter.emit(_transmuxingEvents2.default.IO_ERROR,type,info);});}},{key:'_onDemuxError',value:function _onDemuxError(type,info){var _this10=this;__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this10._emitter.emit(_transmuxingEvents2.default.DEMUX_ERROR,type,info);});}},{key:'_onRecommendSeekpoint',value:function _onRecommendSeekpoint(milliseconds){var _this11=this;__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this11._emitter.emit(_transmuxingEvents2.default.RECOMMEND_SEEKPOINT,milliseconds);});}},{key:'_onLoggingConfigChanged',value:function _onLoggingConfigChanged(config){if(this._worker){this._worker.postMessage({cmd:'logging_config',param:config});}}},{key:'_onWorkerMessage',value:function _onWorkerMessage(e){var message=e.data;var data=message.data;if(message.msg==='destroyed'||this._workerDestroying){this._workerDestroying=false;this._worker.terminate();this._worker=null;return;}switch(message.msg){case _transmuxingEvents2.default.INIT_SEGMENT:case _transmuxingEvents2.default.MEDIA_SEGMENT:this._emitter.emit(message.msg,data.type,data.data);break;case _transmuxingEvents2.default.LOADING_COMPLETE:case _transmuxingEvents2.default.RECOVERED_EARLY_EOF:this._emitter.emit(message.msg);break;case _transmuxingEvents2.default.MEDIA_INFO:__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default()(data,_mediaInfo2.default.prototype);this._emitter.emit(message.msg,data);break;case _transmuxingEvents2.default.METADATA_ARRIVED:case _transmuxingEvents2.default.SCRIPTDATA_ARRIVED:case _transmuxingEvents2.default.STATISTICS_INFO:this._emitter.emit(message.msg,data);break;case _transmuxingEvents2.default.IO_ERROR:case _transmuxingEvents2.default.DEMUX_ERROR:this._emitter.emit(message.msg,data.type,data.info);break;case _transmuxingEvents2.default.RECOMMEND_SEEKPOINT:this._emitter.emit(message.msg,data);break;case'logcat_callback':_logger2.default.emitter.emit('log',data.type,data.logcat);break;default:break;}}}]);return Transmuxer;}();exports.default=Transmuxer;},{"../utils/logger.js":41,"../utils/logging-control.js":42,"./media-info.js":7,"./transmuxing-controller.js":12,"./transmuxing-events.js":13,"./transmuxing-worker.js":14,"events":2,"webworkify":4}],12:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _events=_dereq_('events');var _events2=_interopRequireDefault(_events);var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _browser=_dereq_('../utils/browser.js');var _browser2=_interopRequireDefault(_browser);var _mediaInfo=_dereq_('./media-info.js');var _mediaInfo2=_interopRequireDefault(_mediaInfo);var _flvDemuxer=_dereq_('../demux/flv-demuxer.js');var _flvDemuxer2=_interopRequireDefault(_flvDemuxer);var _mp4Remuxer=_dereq_('../remux/mp4-remuxer.js');var _mp4Remuxer2=_interopRequireDefault(_mp4Remuxer);var _demuxErrors=_dereq_('../demux/demux-errors.js');var _demuxErrors2=_interopRequireDefault(_demuxErrors);var _ioController=_dereq_('../io/io-controller.js');var _ioController2=_interopRequireDefault(_ioController);var _transmuxingEvents=_dereq_('./transmuxing-events.js');var _transmuxingEvents2=_interopRequireDefault(_transmuxingEvents);var _loader=_dereq_('../io/loader.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}// Transmuxing (IO, Demuxing, Remuxing) controller, with multipart support
var TransmuxingController=function(){function TransmuxingController(mediaDataSource,config){_classCallCheck(this,TransmuxingController);this.TAG='TransmuxingController';this._emitter=new _events2.default();this._config=config;// treat single part media as multipart media, which has only one segment
if(!mediaDataSource.segments){mediaDataSource.segments=[{duration:mediaDataSource.duration,filesize:mediaDataSource.filesize,url:mediaDataSource.url}];}// fill in default IO params if not exists
if(typeof mediaDataSource.cors!=='boolean'){mediaDataSource.cors=true;}if(typeof mediaDataSource.withCredentials!=='boolean'){mediaDataSource.withCredentials=false;}this._mediaDataSource=mediaDataSource;this._currentSegmentIndex=0;var totalDuration=0;this._mediaDataSource.segments.forEach(function(segment){// timestampBase for each segment, and calculate total duration
segment.timestampBase=totalDuration;totalDuration+=segment.duration;// params needed by IOController
segment.cors=mediaDataSource.cors;segment.withCredentials=mediaDataSource.withCredentials;// referrer policy control, if exist
if(config.referrerPolicy){segment.referrerPolicy=config.referrerPolicy;}});if(!isNaN(totalDuration)&&this._mediaDataSource.duration!==totalDuration){this._mediaDataSource.duration=totalDuration;}this._mediaInfo=null;this._demuxer=null;this._remuxer=null;this._ioctl=null;this._pendingSeekTime=null;this._pendingResolveSeekPoint=null;this._statisticsReporter=null;}_createClass(TransmuxingController,[{key:'destroy',value:function destroy(){this._mediaInfo=null;this._mediaDataSource=null;if(this._statisticsReporter){this._disableStatisticsReporter();}if(this._ioctl){this._ioctl.destroy();this._ioctl=null;}if(this._demuxer){this._demuxer.destroy();this._demuxer=null;}if(this._remuxer){this._remuxer.destroy();this._remuxer=null;}this._emitter.removeAllListeners();this._emitter=null;}},{key:'on',value:function on(event,listener){this._emitter.addListener(event,listener);}},{key:'off',value:function off(event,listener){this._emitter.removeListener(event,listener);}},{key:'start',value:function start(){this._loadSegment(0);this._enableStatisticsReporter();}},{key:'_loadSegment',value:function _loadSegment(segmentIndex,optionalFrom){this._currentSegmentIndex=segmentIndex;var dataSource=this._mediaDataSource.segments[segmentIndex];var ioctl=this._ioctl=new _ioController2.default(dataSource,this._config,segmentIndex);ioctl.onError=this._onIOException.bind(this);ioctl.onSeeked=this._onIOSeeked.bind(this);ioctl.onComplete=this._onIOComplete.bind(this);ioctl.onRedirect=this._onIORedirect.bind(this);ioctl.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this);if(optionalFrom){this._demuxer.bindDataSource(this._ioctl);}else{ioctl.onDataArrival=this._onInitChunkArrival.bind(this);}ioctl.open(optionalFrom);}},{key:'stop',value:function stop(){this._internalAbort();this._disableStatisticsReporter();}},{key:'_internalAbort',value:function _internalAbort(){if(this._ioctl){this._ioctl.destroy();this._ioctl=null;}}},{key:'pause',value:function pause(){// take a rest
if(this._ioctl&&this._ioctl.isWorking()){this._ioctl.pause();this._disableStatisticsReporter();}}},{key:'resume',value:function resume(){if(this._ioctl&&this._ioctl.isPaused()){this._ioctl.resume();this._enableStatisticsReporter();}}},{key:'seek',value:function seek(milliseconds){if(this._mediaInfo==null||!this._mediaInfo.isSeekable()){return;}var targetSegmentIndex=this._searchSegmentIndexContains(milliseconds);if(targetSegmentIndex===this._currentSegmentIndex){// intra-segment seeking
var segmentInfo=this._mediaInfo.segments[targetSegmentIndex];if(segmentInfo==undefined){// current segment loading started, but mediainfo hasn't received yet
// wait for the metadata loaded, then seek to expected position
this._pendingSeekTime=milliseconds;}else{var keyframe=segmentInfo.getNearestKeyframe(milliseconds);this._remuxer.seek(keyframe.milliseconds);this._ioctl.seek(keyframe.fileposition);// Will be resolved in _onRemuxerMediaSegmentArrival()
this._pendingResolveSeekPoint=keyframe.milliseconds;}}else{// cross-segment seeking
var targetSegmentInfo=this._mediaInfo.segments[targetSegmentIndex];if(targetSegmentInfo==undefined){// target segment hasn't been loaded. We need metadata then seek to expected time
this._pendingSeekTime=milliseconds;this._internalAbort();this._remuxer.seek();this._remuxer.insertDiscontinuity();this._loadSegment(targetSegmentIndex);// Here we wait for the metadata loaded, then seek to expected position
}else{// We have target segment's metadata, direct seek to target position
var _keyframe=targetSegmentInfo.getNearestKeyframe(milliseconds);this._internalAbort();this._remuxer.seek(milliseconds);this._remuxer.insertDiscontinuity();this._demuxer.resetMediaInfo();this._demuxer.timestampBase=this._mediaDataSource.segments[targetSegmentIndex].timestampBase;this._loadSegment(targetSegmentIndex,_keyframe.fileposition);this._pendingResolveSeekPoint=_keyframe.milliseconds;this._reportSegmentMediaInfo(targetSegmentIndex);}}this._enableStatisticsReporter();}},{key:'_searchSegmentIndexContains',value:function _searchSegmentIndexContains(milliseconds){var segments=this._mediaDataSource.segments;var idx=segments.length-1;for(var i=0;i<segments.length;i++){if(milliseconds<segments[i].timestampBase){idx=i-1;break;}}return idx;}},{key:'_onInitChunkArrival',value:function _onInitChunkArrival(data,byteStart){var _this=this;var probeData=null;var consumed=0;if(byteStart>0){// IOController seeked immediately after opened, byteStart > 0 callback may received
this._demuxer.bindDataSource(this._ioctl);this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase;consumed=this._demuxer.parseChunks(data,byteStart);}else if((probeData=_flvDemuxer2.default.probe(data)).match){// Always create new FLVDemuxer
this._demuxer=new _flvDemuxer2.default(probeData,this._config);if(!this._remuxer){this._remuxer=new _mp4Remuxer2.default(this._config);}var mds=this._mediaDataSource;if(mds.duration!=undefined&&!isNaN(mds.duration)){this._demuxer.overridedDuration=mds.duration;}if(typeof mds.hasAudio==='boolean'){this._demuxer.overridedHasAudio=mds.hasAudio;}if(typeof mds.hasVideo==='boolean'){this._demuxer.overridedHasVideo=mds.hasVideo;}this._demuxer.timestampBase=mds.segments[this._currentSegmentIndex].timestampBase;this._demuxer.onError=this._onDemuxException.bind(this);this._demuxer.onMediaInfo=this._onMediaInfo.bind(this);this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this);this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this);this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl));this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this);this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this);consumed=this._demuxer.parseChunks(data,byteStart);}else{probeData=null;_logger2.default.e(this.TAG,'Non-FLV, Unsupported media type!');__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this._internalAbort();});this._emitter.emit(_transmuxingEvents2.default.DEMUX_ERROR,_demuxErrors2.default.FORMAT_UNSUPPORTED,'Non-FLV, Unsupported media type');consumed=0;}return consumed;}},{key:'_onMediaInfo',value:function _onMediaInfo(mediaInfo){var _this2=this;if(this._mediaInfo==null){// Store first segment's mediainfo as global mediaInfo
this._mediaInfo=__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},mediaInfo);this._mediaInfo.keyframesIndex=null;this._mediaInfo.segments=[];this._mediaInfo.segmentCount=this._mediaDataSource.segments.length;__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default()(this._mediaInfo,_mediaInfo2.default.prototype);}var segmentInfo=__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},mediaInfo);__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default()(segmentInfo,_mediaInfo2.default.prototype);this._mediaInfo.segments[this._currentSegmentIndex]=segmentInfo;// notify mediaInfo update
this._reportSegmentMediaInfo(this._currentSegmentIndex);if(this._pendingSeekTime!=null){__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){var target=_this2._pendingSeekTime;_this2._pendingSeekTime=null;_this2.seek(target);});}}},{key:'_onMetaDataArrived',value:function _onMetaDataArrived(metadata){this._emitter.emit(_transmuxingEvents2.default.METADATA_ARRIVED,metadata);}},{key:'_onScriptDataArrived',value:function _onScriptDataArrived(data){this._emitter.emit(_transmuxingEvents2.default.SCRIPTDATA_ARRIVED,data);}},{key:'_onIOSeeked',value:function _onIOSeeked(){this._remuxer.insertDiscontinuity();}},{key:'_onIOComplete',value:function _onIOComplete(extraData){var segmentIndex=extraData;var nextSegmentIndex=segmentIndex+1;if(nextSegmentIndex<this._mediaDataSource.segments.length){this._internalAbort();this._remuxer.flushStashedSamples();this._loadSegment(nextSegmentIndex);}else{this._remuxer.flushStashedSamples();this._emitter.emit(_transmuxingEvents2.default.LOADING_COMPLETE);this._disableStatisticsReporter();}}},{key:'_onIORedirect',value:function _onIORedirect(redirectedURL){var segmentIndex=this._ioctl.extraData;this._mediaDataSource.segments[segmentIndex].redirectedURL=redirectedURL;}},{key:'_onIORecoveredEarlyEof',value:function _onIORecoveredEarlyEof(){this._emitter.emit(_transmuxingEvents2.default.RECOVERED_EARLY_EOF);}},{key:'_onIOException',value:function _onIOException(type,info){_logger2.default.e(this.TAG,'IOException: type = '+type+', code = '+info.code+', msg = '+info.msg);this._emitter.emit(_transmuxingEvents2.default.IO_ERROR,type,info);this._disableStatisticsReporter();}},{key:'_onDemuxException',value:function _onDemuxException(type,info){_logger2.default.e(this.TAG,'DemuxException: type = '+type+', info = '+info);this._emitter.emit(_transmuxingEvents2.default.DEMUX_ERROR,type,info);}},{key:'_onRemuxerInitSegmentArrival',value:function _onRemuxerInitSegmentArrival(type,initSegment){this._emitter.emit(_transmuxingEvents2.default.INIT_SEGMENT,type,initSegment);}},{key:'_onRemuxerMediaSegmentArrival',value:function _onRemuxerMediaSegmentArrival(type,mediaSegment){if(this._pendingSeekTime!=null){// Media segments after new-segment cross-seeking should be dropped.
return;}this._emitter.emit(_transmuxingEvents2.default.MEDIA_SEGMENT,type,mediaSegment);// Resolve pending seekPoint
if(this._pendingResolveSeekPoint!=null&&type==='video'){var syncPoints=mediaSegment.info.syncPoints;var seekpoint=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null;// Safari: Pass PTS for recommend_seekpoint
if(_browser2.default.safari&&syncPoints.length>0&&syncPoints[0].originalDts===seekpoint){seekpoint=syncPoints[0].pts;}// else: use original DTS (keyframe.milliseconds)
this._emitter.emit(_transmuxingEvents2.default.RECOMMEND_SEEKPOINT,seekpoint);}}},{key:'_enableStatisticsReporter',value:function _enableStatisticsReporter(){if(this._statisticsReporter==null){this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval);}}},{key:'_disableStatisticsReporter',value:function _disableStatisticsReporter(){if(this._statisticsReporter){self.clearInterval(this._statisticsReporter);this._statisticsReporter=null;}}},{key:'_reportSegmentMediaInfo',value:function _reportSegmentMediaInfo(segmentIndex){var segmentInfo=this._mediaInfo.segments[segmentIndex];var exportInfo=__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},segmentInfo);exportInfo.duration=this._mediaInfo.duration;exportInfo.segmentCount=this._mediaInfo.segmentCount;delete exportInfo.segments;delete exportInfo.keyframesIndex;this._emitter.emit(_transmuxingEvents2.default.MEDIA_INFO,exportInfo);}},{key:'_reportStatisticsInfo',value:function _reportStatisticsInfo(){var info={};info.url=this._ioctl.currentURL;info.hasRedirect=this._ioctl.hasRedirect;if(info.hasRedirect){info.redirectedURL=this._ioctl.currentRedirectedURL;}info.speed=this._ioctl.currentSpeed;info.loaderType=this._ioctl.loaderType;info.currentSegmentIndex=this._currentSegmentIndex;info.totalSegmentCount=this._mediaDataSource.segments.length;this._emitter.emit(_transmuxingEvents2.default.STATISTICS_INFO,info);}}]);return TransmuxingController;}();exports.default=TransmuxingController;},{"../demux/demux-errors.js":16,"../demux/flv-demuxer.js":18,"../io/io-controller.js":23,"../io/loader.js":24,"../remux/mp4-remuxer.js":38,"../utils/browser.js":39,"../utils/logger.js":41,"./media-info.js":7,"./transmuxing-events.js":13,"events":2}],13:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var TransmuxingEvents={IO_ERROR:'io_error',DEMUX_ERROR:'demux_error',INIT_SEGMENT:'init_segment',MEDIA_SEGMENT:'media_segment',LOADING_COMPLETE:'loading_complete',RECOVERED_EARLY_EOF:'recovered_early_eof',MEDIA_INFO:'media_info',METADATA_ARRIVED:'metadata_arrived',SCRIPTDATA_ARRIVED:'scriptdata_arrived',STATISTICS_INFO:'statistics_info',RECOMMEND_SEEKPOINT:'recommend_seekpoint'};exports.default=TransmuxingEvents;},{}],14:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _loggingControl=_dereq_('../utils/logging-control.js');var _loggingControl2=_interopRequireDefault(_loggingControl);var _polyfill=_dereq_('../utils/polyfill.js');var _polyfill2=_interopRequireDefault(_polyfill);var _transmuxingController=_dereq_('./transmuxing-controller.js');var _transmuxingController2=_interopRequireDefault(_transmuxingController);var _transmuxingEvents=_dereq_('./transmuxing-events.js');var _transmuxingEvents2=_interopRequireDefault(_transmuxingEvents);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}/* post message to worker:
               data: {
                   cmd: string
                   param: any
               }
            
               receive message from worker:
               data: {
                   msg: string,
                   data: any
               }
             */var TransmuxingWorker=function TransmuxingWorker(self){var TAG='TransmuxingWorker';var controller=null;var logcatListener=onLogcatCallback.bind(this);_polyfill2.default.install();self.addEventListener('message',function(e){switch(e.data.cmd){case'init':controller=new _transmuxingController2.default(e.data.param[0],e.data.param[1]);controller.on(_transmuxingEvents2.default.IO_ERROR,onIOError.bind(this));controller.on(_transmuxingEvents2.default.DEMUX_ERROR,onDemuxError.bind(this));controller.on(_transmuxingEvents2.default.INIT_SEGMENT,onInitSegment.bind(this));controller.on(_transmuxingEvents2.default.MEDIA_SEGMENT,onMediaSegment.bind(this));controller.on(_transmuxingEvents2.default.LOADING_COMPLETE,onLoadingComplete.bind(this));controller.on(_transmuxingEvents2.default.RECOVERED_EARLY_EOF,onRecoveredEarlyEof.bind(this));controller.on(_transmuxingEvents2.default.MEDIA_INFO,onMediaInfo.bind(this));controller.on(_transmuxingEvents2.default.METADATA_ARRIVED,onMetaDataArrived.bind(this));controller.on(_transmuxingEvents2.default.SCRIPTDATA_ARRIVED,onScriptDataArrived.bind(this));controller.on(_transmuxingEvents2.default.STATISTICS_INFO,onStatisticsInfo.bind(this));controller.on(_transmuxingEvents2.default.RECOMMEND_SEEKPOINT,onRecommendSeekpoint.bind(this));break;case'destroy':if(controller){controller.destroy();controller=null;}self.postMessage({msg:'destroyed'});break;case'start':controller.start();break;case'stop':controller.stop();break;case'seek':controller.seek(e.data.param);break;case'pause':controller.pause();break;case'resume':controller.resume();break;case'logging_config':{var config=e.data.param;_loggingControl2.default.applyConfig(config);if(config.enableCallback===true){_loggingControl2.default.addLogListener(logcatListener);}else{_loggingControl2.default.removeLogListener(logcatListener);}break;}}});function onInitSegment(type,initSegment){var obj={msg:_transmuxingEvents2.default.INIT_SEGMENT,data:{type:type,data:initSegment}};self.postMessage(obj,[initSegment.data]);// data: ArrayBuffer
}function onMediaSegment(type,mediaSegment){var obj={msg:_transmuxingEvents2.default.MEDIA_SEGMENT,data:{type:type,data:mediaSegment}};self.postMessage(obj,[mediaSegment.data]);// data: ArrayBuffer
}function onLoadingComplete(){var obj={msg:_transmuxingEvents2.default.LOADING_COMPLETE};self.postMessage(obj);}function onRecoveredEarlyEof(){var obj={msg:_transmuxingEvents2.default.RECOVERED_EARLY_EOF};self.postMessage(obj);}function onMediaInfo(mediaInfo){var obj={msg:_transmuxingEvents2.default.MEDIA_INFO,data:mediaInfo};self.postMessage(obj);}function onMetaDataArrived(metadata){var obj={msg:_transmuxingEvents2.default.METADATA_ARRIVED,data:metadata};self.postMessage(obj);}function onScriptDataArrived(data){var obj={msg:_transmuxingEvents2.default.SCRIPTDATA_ARRIVED,data:data};self.postMessage(obj);}function onStatisticsInfo(statInfo){var obj={msg:_transmuxingEvents2.default.STATISTICS_INFO,data:statInfo};self.postMessage(obj);}function onIOError(type,info){self.postMessage({msg:_transmuxingEvents2.default.IO_ERROR,data:{type:type,info:info}});}function onDemuxError(type,info){self.postMessage({msg:_transmuxingEvents2.default.DEMUX_ERROR,data:{type:type,info:info}});}function onRecommendSeekpoint(milliseconds){self.postMessage({msg:_transmuxingEvents2.default.RECOMMEND_SEEKPOINT,data:milliseconds});}function onLogcatCallback(type,str){self.postMessage({msg:'logcat_callback',data:{type:type,logcat:str}});}};/*
    * Copyright (C) 2016 Bilibili. All Rights Reserved.
    *
    * @author zheng qian <xqq@xqq.im>
    *
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    *     http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    */exports.default=TransmuxingWorker;},{"../utils/logger.js":41,"../utils/logging-control.js":42,"../utils/polyfill.js":43,"./transmuxing-controller.js":12,"./transmuxing-events.js":13}],15:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _utf8Conv=_dereq_('../utils/utf8-conv.js');var _utf8Conv2=_interopRequireDefault(_utf8Conv);var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var le=function(){var buf=new ArrayBuffer(2);new DataView(buf).setInt16(0,256,true);// little-endian write
return new Int16Array(buf)[0]===256;// platform-spec read, if equal then LE
}();var AMF=function(){function AMF(){_classCallCheck(this,AMF);}_createClass(AMF,null,[{key:'parseScriptData',value:function parseScriptData(arrayBuffer,dataOffset,dataSize){var data={};try{var name=AMF.parseValue(arrayBuffer,dataOffset,dataSize);var value=AMF.parseValue(arrayBuffer,dataOffset+name.size,dataSize-name.size);data[name.data]=value.data;}catch(e){_logger2.default.e('AMF',e.toString());}return data;}},{key:'parseObject',value:function parseObject(arrayBuffer,dataOffset,dataSize){if(dataSize<3){throw new _exception.IllegalStateException('Data not enough when parse ScriptDataObject');}var name=AMF.parseString(arrayBuffer,dataOffset,dataSize);var value=AMF.parseValue(arrayBuffer,dataOffset+name.size,dataSize-name.size);var isObjectEnd=value.objectEnd;return{data:{name:name.data,value:value.data},size:name.size+value.size,objectEnd:isObjectEnd};}},{key:'parseVariable',value:function parseVariable(arrayBuffer,dataOffset,dataSize){return AMF.parseObject(arrayBuffer,dataOffset,dataSize);}},{key:'parseString',value:function parseString(arrayBuffer,dataOffset,dataSize){if(dataSize<2){throw new _exception.IllegalStateException('Data not enough when parse String');}var v=new DataView(arrayBuffer,dataOffset,dataSize);var length=v.getUint16(0,!le);var str=void 0;if(length>0){str=(0,_utf8Conv2.default)(new Uint8Array(arrayBuffer,dataOffset+2,length));}else{str='';}return{data:str,size:2+length};}},{key:'parseLongString',value:function parseLongString(arrayBuffer,dataOffset,dataSize){if(dataSize<4){throw new _exception.IllegalStateException('Data not enough when parse LongString');}var v=new DataView(arrayBuffer,dataOffset,dataSize);var length=v.getUint32(0,!le);var str=void 0;if(length>0){str=(0,_utf8Conv2.default)(new Uint8Array(arrayBuffer,dataOffset+4,length));}else{str='';}return{data:str,size:4+length};}},{key:'parseDate',value:function parseDate(arrayBuffer,dataOffset,dataSize){if(dataSize<10){throw new _exception.IllegalStateException('Data size invalid when parse Date');}var v=new DataView(arrayBuffer,dataOffset,dataSize);var timestamp=v.getFloat64(0,!le);var localTimeOffset=v.getInt16(8,!le);timestamp+=localTimeOffset*60*1000;// get UTC time
return{data:new Date(timestamp),size:8+2};}},{key:'parseValue',value:function parseValue(arrayBuffer,dataOffset,dataSize){if(dataSize<1){throw new _exception.IllegalStateException('Data not enough when parse Value');}var v=new DataView(arrayBuffer,dataOffset,dataSize);var offset=1;var type=v.getUint8(0);var value=void 0;var objectEnd=false;try{switch(type){case 0:// Number(Double) type
value=v.getFloat64(1,!le);offset+=8;break;case 1:{// Boolean type
var b=v.getUint8(1);value=b?true:false;offset+=1;break;}case 2:{// String type
var amfstr=AMF.parseString(arrayBuffer,dataOffset+1,dataSize-1);value=amfstr.data;offset+=amfstr.size;break;}case 3:{// Object(s) type
value={};var terminal=0;// workaround for malformed Objects which has missing ScriptDataObjectEnd
if((v.getUint32(dataSize-4,!le)&0x00FFFFFF)===9){terminal=3;}while(offset<dataSize-4){// 4 === type(UI8) + ScriptDataObjectEnd(UI24)
var amfobj=AMF.parseObject(arrayBuffer,dataOffset+offset,dataSize-offset-terminal);if(amfobj.objectEnd)break;value[amfobj.data.name]=amfobj.data.value;offset+=amfobj.size;}if(offset<=dataSize-3){var marker=v.getUint32(offset-1,!le)&0x00FFFFFF;if(marker===9){offset+=3;}}break;}case 8:{// ECMA array type (Mixed array)
value={};offset+=4;// ECMAArrayLength(UI32)
var _terminal=0;// workaround for malformed MixedArrays which has missing ScriptDataObjectEnd
if((v.getUint32(dataSize-4,!le)&0x00FFFFFF)===9){_terminal=3;}while(offset<dataSize-8){// 8 === type(UI8) + ECMAArrayLength(UI32) + ScriptDataVariableEnd(UI24)
var amfvar=AMF.parseVariable(arrayBuffer,dataOffset+offset,dataSize-offset-_terminal);if(amfvar.objectEnd)break;value[amfvar.data.name]=amfvar.data.value;offset+=amfvar.size;}if(offset<=dataSize-3){var _marker=v.getUint32(offset-1,!le)&0x00FFFFFF;if(_marker===9){offset+=3;}}break;}case 9:// ScriptDataObjectEnd
value=undefined;offset=1;objectEnd=true;break;case 10:{// Strict array type
// ScriptDataValue[n]. NOTE: according to video_file_format_spec_v10_1.pdf
value=[];var strictArrayLength=v.getUint32(1,!le);offset+=4;for(var i=0;i<strictArrayLength;i++){var val=AMF.parseValue(arrayBuffer,dataOffset+offset,dataSize-offset);value.push(val.data);offset+=val.size;}break;}case 11:{// Date type
var date=AMF.parseDate(arrayBuffer,dataOffset+1,dataSize-1);value=date.data;offset+=date.size;break;}case 12:{// Long string type
var amfLongStr=AMF.parseString(arrayBuffer,dataOffset+1,dataSize-1);value=amfLongStr.data;offset+=amfLongStr.size;break;}default:// ignore and skip
offset=dataSize;_logger2.default.w('AMF','Unsupported AMF value type '+type);}}catch(e){_logger2.default.e('AMF',e.toString());}return{data:value,size:offset,objectEnd:objectEnd};}}]);return AMF;}();exports.default=AMF;},{"../utils/exception.js":40,"../utils/logger.js":41,"../utils/utf8-conv.js":44}],16:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var DemuxErrors={OK:'OK',FORMAT_ERROR:'FormatError',FORMAT_UNSUPPORTED:'FormatUnsupported',CODEC_UNSUPPORTED:'CodecUnsupported'};exports.default=DemuxErrors;},{}],17:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _exception=_dereq_('../utils/exception.js');function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}// Exponential-Golomb buffer decoder
var ExpGolomb=function(){function ExpGolomb(uint8array){_classCallCheck(this,ExpGolomb);this.TAG='ExpGolomb';this._buffer=uint8array;this._buffer_index=0;this._total_bytes=uint8array.byteLength;this._total_bits=uint8array.byteLength*8;this._current_word=0;this._current_word_bits_left=0;}_createClass(ExpGolomb,[{key:'destroy',value:function destroy(){this._buffer=null;}},{key:'_fillCurrentWord',value:function _fillCurrentWord(){var buffer_bytes_left=this._total_bytes-this._buffer_index;if(buffer_bytes_left<=0)throw new _exception.IllegalStateException('ExpGolomb: _fillCurrentWord() but no bytes available');var bytes_read=Math.min(4,buffer_bytes_left);var word=new Uint8Array(4);word.set(this._buffer.subarray(this._buffer_index,this._buffer_index+bytes_read));this._current_word=new DataView(word.buffer).getUint32(0,false);this._buffer_index+=bytes_read;this._current_word_bits_left=bytes_read*8;}},{key:'readBits',value:function readBits(bits){if(bits>32)throw new _exception.InvalidArgumentException('ExpGolomb: readBits() bits exceeded max 32bits!');if(bits<=this._current_word_bits_left){var _result=this._current_word>>>32-bits;this._current_word<<=bits;this._current_word_bits_left-=bits;return _result;}var result=this._current_word_bits_left?this._current_word:0;result=result>>>32-this._current_word_bits_left;var bits_need_left=bits-this._current_word_bits_left;this._fillCurrentWord();var bits_read_next=Math.min(bits_need_left,this._current_word_bits_left);var result2=this._current_word>>>32-bits_read_next;this._current_word<<=bits_read_next;this._current_word_bits_left-=bits_read_next;result=result<<bits_read_next|result2;return result;}},{key:'readBool',value:function readBool(){return this.readBits(1)===1;}},{key:'readByte',value:function readByte(){return this.readBits(8);}},{key:'_skipLeadingZero',value:function _skipLeadingZero(){var zero_count=void 0;for(zero_count=0;zero_count<this._current_word_bits_left;zero_count++){if(0!==(this._current_word&0x80000000>>>zero_count)){this._current_word<<=zero_count;this._current_word_bits_left-=zero_count;return zero_count;}}this._fillCurrentWord();return zero_count+this._skipLeadingZero();}},{key:'readUEG',value:function readUEG(){// unsigned exponential golomb
var leading_zeros=this._skipLeadingZero();return this.readBits(leading_zeros+1)-1;}},{key:'readSEG',value:function readSEG(){// signed exponential golomb
var value=this.readUEG();if(value&0x01){return value+1>>>1;}else{return-1*(value>>>1);}}}]);return ExpGolomb;}();exports.default=ExpGolomb;},{"../utils/exception.js":40}],18:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator___default.a)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);}:function(obj){return obj&&typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&obj.constructor===__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a&&obj!==__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a.prototype?"symbol":typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _amfParser=_dereq_('./amf-parser.js');var _amfParser2=_interopRequireDefault(_amfParser);var _spsParser=_dereq_('./sps-parser.js');var _spsParser2=_interopRequireDefault(_spsParser);var _demuxErrors=_dereq_('./demux-errors.js');var _demuxErrors2=_interopRequireDefault(_demuxErrors);var _mediaInfo=_dereq_('../core/media-info.js');var _mediaInfo2=_interopRequireDefault(_mediaInfo);var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function Swap16(src){return src>>>8&0xFF|(src&0xFF)<<8;}function Swap32(src){return(src&0xFF000000)>>>24|(src&0x00FF0000)>>>8|(src&0x0000FF00)<<8|(src&0x000000FF)<<24;}function ReadBig32(array,index){return array[index]<<24|array[index+1]<<16|array[index+2]<<8|array[index+3];}var FLVDemuxer=function(){function FLVDemuxer(probeData,config){_classCallCheck(this,FLVDemuxer);this.TAG='FLVDemuxer';this._config=config;this._onError=null;this._onMediaInfo=null;this._onMetaDataArrived=null;this._onScriptDataArrived=null;this._onTrackMetadata=null;this._onDataAvailable=null;this._dataOffset=probeData.dataOffset;this._firstParse=true;this._dispatch=false;this._hasAudio=probeData.hasAudioTrack;this._hasVideo=probeData.hasVideoTrack;this._hasAudioFlagOverrided=false;this._hasVideoFlagOverrided=false;this._audioInitialMetadataDispatched=false;this._videoInitialMetadataDispatched=false;this._mediaInfo=new _mediaInfo2.default();this._mediaInfo.hasAudio=this._hasAudio;this._mediaInfo.hasVideo=this._hasVideo;this._metadata=null;this._audioMetadata=null;this._videoMetadata=null;this._naluLengthSize=4;this._timestampBase=0;// int32, in milliseconds
this._timescale=1000;this._duration=0;// int32, in milliseconds
this._durationOverrided=false;this._referenceFrameRate={fixed:true,fps:23.976,fps_num:23976,fps_den:1000};this._flvSoundRateTable=[5500,11025,22050,44100,48000];this._mpegSamplingRates=[96000,88200,64000,48000,44100,32000,24000,22050,16000,12000,11025,8000,7350];this._mpegAudioV10SampleRateTable=[44100,48000,32000,0];this._mpegAudioV20SampleRateTable=[22050,24000,16000,0];this._mpegAudioV25SampleRateTable=[11025,12000,8000,0];this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1];this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1];this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1];this._videoTrack={type:'video',id:1,sequenceNumber:0,samples:[],length:0};this._audioTrack={type:'audio',id:2,sequenceNumber:0,samples:[],length:0};this._littleEndian=function(){var buf=new ArrayBuffer(2);new DataView(buf).setInt16(0,256,true);// little-endian write
return new Int16Array(buf)[0]===256;// platform-spec read, if equal then LE
}();}_createClass(FLVDemuxer,[{key:'destroy',value:function destroy(){this._mediaInfo=null;this._metadata=null;this._audioMetadata=null;this._videoMetadata=null;this._videoTrack=null;this._audioTrack=null;this._onError=null;this._onMediaInfo=null;this._onMetaDataArrived=null;this._onScriptDataArrived=null;this._onTrackMetadata=null;this._onDataAvailable=null;}},{key:'bindDataSource',value:function bindDataSource(loader){loader.onDataArrival=this.parseChunks.bind(this);return this;}// prototype: function(type: string, metadata: any): void
},{key:'resetMediaInfo',value:function resetMediaInfo(){this._mediaInfo=new _mediaInfo2.default();}},{key:'_isInitialMetadataDispatched',value:function _isInitialMetadataDispatched(){if(this._hasAudio&&this._hasVideo){// both audio & video
return this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched;}if(this._hasAudio&&!this._hasVideo){// audio only
return this._audioInitialMetadataDispatched;}if(!this._hasAudio&&this._hasVideo){// video only
return this._videoInitialMetadataDispatched;}return false;}// function parseChunks(chunk: ArrayBuffer, byteStart: number): number;
},{key:'parseChunks',value:function parseChunks(chunk,byteStart){if(!this._onError||!this._onMediaInfo||!this._onTrackMetadata||!this._onDataAvailable){throw new _exception.IllegalStateException('Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified');}var offset=0;var le=this._littleEndian;if(byteStart===0){// buffer with FLV header
if(chunk.byteLength>13){var probeData=FLVDemuxer.probe(chunk);offset=probeData.dataOffset;}else{return 0;}}if(this._firstParse){// handle PreviousTagSize0 before Tag1
this._firstParse=false;if(byteStart+offset!==this._dataOffset){_logger2.default.w(this.TAG,'First time parsing but chunk byteStart invalid!');}var v=new DataView(chunk,offset);var prevTagSize0=v.getUint32(0,!le);if(prevTagSize0!==0){_logger2.default.w(this.TAG,'PrevTagSize0 !== 0 !!!');}offset+=4;}while(offset<chunk.byteLength){this._dispatch=true;var _v=new DataView(chunk,offset);if(offset+11+4>chunk.byteLength){// data not enough for parsing an flv tag
break;}var tagType=_v.getUint8(0);var dataSize=_v.getUint32(0,!le)&0x00FFFFFF;if(offset+11+dataSize+4>chunk.byteLength){// data not enough for parsing actual data body
break;}if(tagType!==8&&tagType!==9&&tagType!==18){_logger2.default.w(this.TAG,'Unsupported tag type '+tagType+', skipped');// consume the whole tag (skip it)
offset+=11+dataSize+4;continue;}var ts2=_v.getUint8(4);var ts1=_v.getUint8(5);var ts0=_v.getUint8(6);var ts3=_v.getUint8(7);var timestamp=ts0|ts1<<8|ts2<<16|ts3<<24;var streamId=_v.getUint32(7,!le)&0x00FFFFFF;if(streamId!==0){_logger2.default.w(this.TAG,'Meet tag which has StreamID != 0!');}var dataOffset=offset+11;switch(tagType){case 8:// Audio
this._parseAudioData(chunk,dataOffset,dataSize,timestamp);break;case 9:// Video
this._parseVideoData(chunk,dataOffset,dataSize,timestamp,byteStart+offset);break;case 18:// ScriptDataObject
this._parseScriptData(chunk,dataOffset,dataSize);break;}var prevTagSize=_v.getUint32(11+dataSize,!le);if(prevTagSize!==11+dataSize){_logger2.default.w(this.TAG,'Invalid PrevTagSize '+prevTagSize);}offset+=11+dataSize+4;// tagBody + dataSize + prevTagSize
}// dispatch parsed frames to consumer (typically, the remuxer)
if(this._isInitialMetadataDispatched()){if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack);}}return offset;// consumed bytes, just equals latest offset index
}},{key:'_parseScriptData',value:function _parseScriptData(arrayBuffer,dataOffset,dataSize){var scriptData=_amfParser2.default.parseScriptData(arrayBuffer,dataOffset,dataSize);if(scriptData.hasOwnProperty('onMetaData')){if(scriptData.onMetaData==null||_typeof(scriptData.onMetaData)!=='object'){_logger2.default.w(this.TAG,'Invalid onMetaData structure!');return;}if(this._metadata){_logger2.default.w(this.TAG,'Found another onMetaData tag!');}this._metadata=scriptData;var onMetaData=this._metadata.onMetaData;if(this._onMetaDataArrived){this._onMetaDataArrived(__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},onMetaData));}if(typeof onMetaData.hasAudio==='boolean'){// hasAudio
if(this._hasAudioFlagOverrided===false){this._hasAudio=onMetaData.hasAudio;this._mediaInfo.hasAudio=this._hasAudio;}}if(typeof onMetaData.hasVideo==='boolean'){// hasVideo
if(this._hasVideoFlagOverrided===false){this._hasVideo=onMetaData.hasVideo;this._mediaInfo.hasVideo=this._hasVideo;}}if(typeof onMetaData.audiodatarate==='number'){// audiodatarate
this._mediaInfo.audioDataRate=onMetaData.audiodatarate;}if(typeof onMetaData.videodatarate==='number'){// videodatarate
this._mediaInfo.videoDataRate=onMetaData.videodatarate;}if(typeof onMetaData.width==='number'){// width
this._mediaInfo.width=onMetaData.width;}if(typeof onMetaData.height==='number'){// height
this._mediaInfo.height=onMetaData.height;}if(typeof onMetaData.duration==='number'){// duration
if(!this._durationOverrided){var duration=Math.floor(onMetaData.duration*this._timescale);this._duration=duration;this._mediaInfo.duration=duration;}}else{this._mediaInfo.duration=0;}if(typeof onMetaData.framerate==='number'){// framerate
var fps_num=Math.floor(onMetaData.framerate*1000);if(fps_num>0){var fps=fps_num/1000;this._referenceFrameRate.fixed=true;this._referenceFrameRate.fps=fps;this._referenceFrameRate.fps_num=fps_num;this._referenceFrameRate.fps_den=1000;this._mediaInfo.fps=fps;}}if(_typeof(onMetaData.keyframes)==='object'){// keyframes
this._mediaInfo.hasKeyframesIndex=true;var keyframes=onMetaData.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(keyframes);onMetaData.keyframes=null;// keyframes has been extracted, remove it
}else{this._mediaInfo.hasKeyframesIndex=false;}this._dispatch=false;this._mediaInfo.metadata=onMetaData;_logger2.default.v(this.TAG,'Parsed onMetaData');if(this._mediaInfo.isComplete()){this._onMediaInfo(this._mediaInfo);}}if(__WEBPACK_IMPORTED_MODULE_9_babel_runtime_core_js_object_keys___default()(scriptData).length>0){if(this._onScriptDataArrived){this._onScriptDataArrived(__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},scriptData));}}}},{key:'_parseKeyframesIndex',value:function _parseKeyframesIndex(keyframes){var times=[];var filepositions=[];// ignore first keyframe which is actually AVC Sequence Header (AVCDecoderConfigurationRecord)
for(var i=1;i<keyframes.times.length;i++){var time=this._timestampBase+Math.floor(keyframes.times[i]*1000);times.push(time);filepositions.push(keyframes.filepositions[i]);}return{times:times,filepositions:filepositions};}},{key:'_parseAudioData',value:function _parseAudioData(arrayBuffer,dataOffset,dataSize,tagTimestamp){if(dataSize<=1){_logger2.default.w(this.TAG,'Flv: Invalid audio packet, missing SoundData payload!');return;}if(this._hasAudioFlagOverrided===true&&this._hasAudio===false){// If hasAudio: false indicated explicitly in MediaDataSource,
// Ignore all the audio packets
return;}var le=this._littleEndian;var v=new DataView(arrayBuffer,dataOffset,dataSize);var soundSpec=v.getUint8(0);var soundFormat=soundSpec>>>4;if(soundFormat!==2&&soundFormat!==10){// MP3 or AAC
this._onError(_demuxErrors2.default.CODEC_UNSUPPORTED,'Flv: Unsupported audio codec idx: '+soundFormat);return;}var soundRate=0;var soundRateIndex=(soundSpec&12)>>>2;if(soundRateIndex>=0&&soundRateIndex<=4){soundRate=this._flvSoundRateTable[soundRateIndex];}else{this._onError(_demuxErrors2.default.FORMAT_ERROR,'Flv: Invalid audio sample rate idx: '+soundRateIndex);return;}var soundSize=(soundSpec&2)>>>1;// unused
var soundType=soundSpec&1;var meta=this._audioMetadata;var track=this._audioTrack;if(!meta){if(this._hasAudio===false&&this._hasAudioFlagOverrided===false){this._hasAudio=true;this._mediaInfo.hasAudio=true;}// initial metadata
meta=this._audioMetadata={};meta.type='audio';meta.id=track.id;meta.timescale=this._timescale;meta.duration=this._duration;meta.audioSampleRate=soundRate;meta.channelCount=soundType===0?1:2;}if(soundFormat===10){// AAC
var aacData=this._parseAACAudioData(arrayBuffer,dataOffset+1,dataSize-1);if(aacData==undefined){return;}if(aacData.packetType===0){// AAC sequence header (AudioSpecificConfig)
if(meta.config){_logger2.default.w(this.TAG,'Found another AudioSpecificConfig!');}var misc=aacData.data;meta.audioSampleRate=misc.samplingRate;meta.channelCount=misc.channelCount;meta.codec=misc.codec;meta.originalCodec=misc.originalCodec;meta.config=misc.config;// The decode result of an aac sample is 1024 PCM samples
meta.refSampleDuration=1024/meta.audioSampleRate*meta.timescale;_logger2.default.v(this.TAG,'Parsed AudioSpecificConfig');if(this._isInitialMetadataDispatched()){// Non-initial metadata, force dispatch (or flush) parsed frames to remuxer
if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack);}}else{this._audioInitialMetadataDispatched=true;}// then notify new metadata
this._dispatch=false;this._onTrackMetadata('audio',meta);var mi=this._mediaInfo;mi.audioCodec=meta.originalCodec;mi.audioSampleRate=meta.audioSampleRate;mi.audioChannelCount=meta.channelCount;if(mi.hasVideo){if(mi.videoCodec!=null){mi.mimeType='video/x-flv; codecs="'+mi.videoCodec+','+mi.audioCodec+'"';}}else{mi.mimeType='video/x-flv; codecs="'+mi.audioCodec+'"';}if(mi.isComplete()){this._onMediaInfo(mi);}}else if(aacData.packetType===1){// AAC raw frame data
var dts=this._timestampBase+tagTimestamp;var aacSample={unit:aacData.data,length:aacData.data.byteLength,dts:dts,pts:dts};track.samples.push(aacSample);track.length+=aacData.data.length;}else{_logger2.default.e(this.TAG,'Flv: Unsupported AAC data type '+aacData.packetType);}}else if(soundFormat===2){// MP3
if(!meta.codec){// We need metadata for mp3 audio track, extract info from frame header
var _misc=this._parseMP3AudioData(arrayBuffer,dataOffset+1,dataSize-1,true);if(_misc==undefined){return;}meta.audioSampleRate=_misc.samplingRate;meta.channelCount=_misc.channelCount;meta.codec=_misc.codec;meta.originalCodec=_misc.originalCodec;// The decode result of an mp3 sample is 1152 PCM samples
meta.refSampleDuration=1152/meta.audioSampleRate*meta.timescale;_logger2.default.v(this.TAG,'Parsed MPEG Audio Frame Header');this._audioInitialMetadataDispatched=true;this._onTrackMetadata('audio',meta);var _mi=this._mediaInfo;_mi.audioCodec=meta.codec;_mi.audioSampleRate=meta.audioSampleRate;_mi.audioChannelCount=meta.channelCount;_mi.audioDataRate=_misc.bitRate;if(_mi.hasVideo){if(_mi.videoCodec!=null){_mi.mimeType='video/x-flv; codecs="'+_mi.videoCodec+','+_mi.audioCodec+'"';}}else{_mi.mimeType='video/x-flv; codecs="'+_mi.audioCodec+'"';}if(_mi.isComplete()){this._onMediaInfo(_mi);}}// This packet is always a valid audio packet, extract it
var data=this._parseMP3AudioData(arrayBuffer,dataOffset+1,dataSize-1,false);if(data==undefined){return;}var _dts=this._timestampBase+tagTimestamp;var mp3Sample={unit:data,length:data.byteLength,dts:_dts,pts:_dts};track.samples.push(mp3Sample);track.length+=data.length;}}},{key:'_parseAACAudioData',value:function _parseAACAudioData(arrayBuffer,dataOffset,dataSize){if(dataSize<=1){_logger2.default.w(this.TAG,'Flv: Invalid AAC packet, missing AACPacketType or/and Data!');return;}var result={};var array=new Uint8Array(arrayBuffer,dataOffset,dataSize);result.packetType=array[0];if(array[0]===0){result.data=this._parseAACAudioSpecificConfig(arrayBuffer,dataOffset+1,dataSize-1);}else{result.data=array.subarray(1);}return result;}},{key:'_parseAACAudioSpecificConfig',value:function _parseAACAudioSpecificConfig(arrayBuffer,dataOffset,dataSize){var array=new Uint8Array(arrayBuffer,dataOffset,dataSize);var config=null;/* Audio Object Type:
                           0: Null
                           1: AAC Main
                           2: AAC LC
                           3: AAC SSR (Scalable Sample Rate)
                           4: AAC LTP (Long Term Prediction)
                           5: HE-AAC / SBR (Spectral Band Replication)
                           6: AAC Scalable
                        */var audioObjectType=0;var originalAudioObjectType=0;var audioExtensionObjectType=null;var samplingIndex=0;var extensionSamplingIndex=null;// 5 bits
audioObjectType=originalAudioObjectType=array[0]>>>3;// 4 bits
samplingIndex=(array[0]&0x07)<<1|array[1]>>>7;if(samplingIndex<0||samplingIndex>=this._mpegSamplingRates.length){this._onError(_demuxErrors2.default.FORMAT_ERROR,'Flv: AAC invalid sampling frequency index!');return;}var samplingFrequence=this._mpegSamplingRates[samplingIndex];// 4 bits
var channelConfig=(array[1]&0x78)>>>3;if(channelConfig<0||channelConfig>=8){this._onError(_demuxErrors2.default.FORMAT_ERROR,'Flv: AAC invalid channel configuration');return;}if(audioObjectType===5){// HE-AAC?
// 4 bits
extensionSamplingIndex=(array[1]&0x07)<<1|array[2]>>>7;// 5 bits
audioExtensionObjectType=(array[2]&0x7C)>>>2;}// workarounds for various browsers
var userAgent=self.navigator.userAgent.toLowerCase();if(userAgent.indexOf('firefox')!==-1){// firefox: use SBR (HE-AAC) if freq less than 24kHz
if(samplingIndex>=6){audioObjectType=5;config=new Array(4);extensionSamplingIndex=samplingIndex-3;}else{// use LC-AAC
audioObjectType=2;config=new Array(2);extensionSamplingIndex=samplingIndex;}}else if(userAgent.indexOf('android')!==-1){// android: always use LC-AAC
audioObjectType=2;config=new Array(2);extensionSamplingIndex=samplingIndex;}else{// for other browsers, e.g. chrome...
// Always use HE-AAC to make it easier to switch aac codec profile
audioObjectType=5;extensionSamplingIndex=samplingIndex;config=new Array(4);if(samplingIndex>=6){extensionSamplingIndex=samplingIndex-3;}else if(channelConfig===1){// Mono channel
audioObjectType=2;config=new Array(2);extensionSamplingIndex=samplingIndex;}}config[0]=audioObjectType<<3;config[0]|=(samplingIndex&0x0F)>>>1;config[1]=(samplingIndex&0x0F)<<7;config[1]|=(channelConfig&0x0F)<<3;if(audioObjectType===5){config[1]|=(extensionSamplingIndex&0x0F)>>>1;config[2]=(extensionSamplingIndex&0x01)<<7;// extended audio object type: force to 2 (LC-AAC)
config[2]|=2<<2;config[3]=0;}return{config:config,samplingRate:samplingFrequence,channelCount:channelConfig,codec:'mp4a.40.'+audioObjectType,originalCodec:'mp4a.40.'+originalAudioObjectType};}},{key:'_parseMP3AudioData',value:function _parseMP3AudioData(arrayBuffer,dataOffset,dataSize,requestHeader){if(dataSize<4){_logger2.default.w(this.TAG,'Flv: Invalid MP3 packet, header missing!');return;}var le=this._littleEndian;var array=new Uint8Array(arrayBuffer,dataOffset,dataSize);var result=null;if(requestHeader){if(array[0]!==0xFF){return;}var ver=array[1]>>>3&0x03;var layer=(array[1]&0x06)>>1;var bitrate_index=(array[2]&0xF0)>>>4;var sampling_freq_index=(array[2]&0x0C)>>>2;var channel_mode=array[3]>>>6&0x03;var channel_count=channel_mode!==3?2:1;var sample_rate=0;var bit_rate=0;var object_type=34;// Layer-3, listed in MPEG-4 Audio Object Types
var codec='mp3';switch(ver){case 0:// MPEG 2.5
sample_rate=this._mpegAudioV25SampleRateTable[sampling_freq_index];break;case 2:// MPEG 2
sample_rate=this._mpegAudioV20SampleRateTable[sampling_freq_index];break;case 3:// MPEG 1
sample_rate=this._mpegAudioV10SampleRateTable[sampling_freq_index];break;}switch(layer){case 1:// Layer 3
object_type=34;if(bitrate_index<this._mpegAudioL3BitRateTable.length){bit_rate=this._mpegAudioL3BitRateTable[bitrate_index];}break;case 2:// Layer 2
object_type=33;if(bitrate_index<this._mpegAudioL2BitRateTable.length){bit_rate=this._mpegAudioL2BitRateTable[bitrate_index];}break;case 3:// Layer 1
object_type=32;if(bitrate_index<this._mpegAudioL1BitRateTable.length){bit_rate=this._mpegAudioL1BitRateTable[bitrate_index];}break;}result={bitRate:bit_rate,samplingRate:sample_rate,channelCount:channel_count,codec:codec,originalCodec:codec};}else{result=array;}return result;}},{key:'_parseVideoData',value:function _parseVideoData(arrayBuffer,dataOffset,dataSize,tagTimestamp,tagPosition){if(dataSize<=1){_logger2.default.w(this.TAG,'Flv: Invalid video packet, missing VideoData payload!');return;}if(this._hasVideoFlagOverrided===true&&this._hasVideo===false){// If hasVideo: false indicated explicitly in MediaDataSource,
// Ignore all the video packets
return;}var spec=new Uint8Array(arrayBuffer,dataOffset,dataSize)[0];var frameType=(spec&240)>>>4;var codecId=spec&15;if(codecId!==7){this._onError(_demuxErrors2.default.CODEC_UNSUPPORTED,'Flv: Unsupported codec in video frame: '+codecId);return;}this._parseAVCVideoPacket(arrayBuffer,dataOffset+1,dataSize-1,tagTimestamp,tagPosition,frameType);}},{key:'_parseAVCVideoPacket',value:function _parseAVCVideoPacket(arrayBuffer,dataOffset,dataSize,tagTimestamp,tagPosition,frameType){if(dataSize<4){_logger2.default.w(this.TAG,'Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime');return;}var le=this._littleEndian;var v=new DataView(arrayBuffer,dataOffset,dataSize);var packetType=v.getUint8(0);var cts_unsigned=v.getUint32(0,!le)&0x00FFFFFF;var cts=cts_unsigned<<8>>8;// convert to 24-bit signed int
if(packetType===0){// AVCDecoderConfigurationRecord
this._parseAVCDecoderConfigurationRecord(arrayBuffer,dataOffset+4,dataSize-4);}else if(packetType===1){// One or more Nalus
this._parseAVCVideoData(arrayBuffer,dataOffset+4,dataSize-4,tagTimestamp,tagPosition,frameType,cts);}else if(packetType===2){// empty, AVC end of sequence
}else{this._onError(_demuxErrors2.default.FORMAT_ERROR,'Flv: Invalid video packet type '+packetType);return;}}},{key:'_parseAVCDecoderConfigurationRecord',value:function _parseAVCDecoderConfigurationRecord(arrayBuffer,dataOffset,dataSize){if(dataSize<7){_logger2.default.w(this.TAG,'Flv: Invalid AVCDecoderConfigurationRecord, lack of data!');return;}var meta=this._videoMetadata;var track=this._videoTrack;var le=this._littleEndian;var v=new DataView(arrayBuffer,dataOffset,dataSize);if(!meta){if(this._hasVideo===false&&this._hasVideoFlagOverrided===false){this._hasVideo=true;this._mediaInfo.hasVideo=true;}meta=this._videoMetadata={};meta.type='video';meta.id=track.id;meta.timescale=this._timescale;meta.duration=this._duration;}else{if(typeof meta.avcc!=='undefined'){_logger2.default.w(this.TAG,'Found another AVCDecoderConfigurationRecord!');}}var version=v.getUint8(0);// configurationVersion
var avcProfile=v.getUint8(1);// avcProfileIndication
var profileCompatibility=v.getUint8(2);// profile_compatibility
var avcLevel=v.getUint8(3);// AVCLevelIndication
if(version!==1||avcProfile===0){this._onError(_demuxErrors2.default.FORMAT_ERROR,'Flv: Invalid AVCDecoderConfigurationRecord');return;}this._naluLengthSize=(v.getUint8(4)&3)+1;// lengthSizeMinusOne
if(this._naluLengthSize!==3&&this._naluLengthSize!==4){// holy shit!!!
this._onError(_demuxErrors2.default.FORMAT_ERROR,'Flv: Strange NaluLengthSizeMinusOne: '+(this._naluLengthSize-1));return;}var spsCount=v.getUint8(5)&31;// numOfSequenceParameterSets
if(spsCount===0){this._onError(_demuxErrors2.default.FORMAT_ERROR,'Flv: Invalid AVCDecoderConfigurationRecord: No SPS');return;}else if(spsCount>1){_logger2.default.w(this.TAG,'Flv: Strange AVCDecoderConfigurationRecord: SPS Count = '+spsCount);}var offset=6;for(var i=0;i<spsCount;i++){var len=v.getUint16(offset,!le);// sequenceParameterSetLength
offset+=2;if(len===0){continue;}// Notice: Nalu without startcode header (00 00 00 01)
var sps=new Uint8Array(arrayBuffer,dataOffset+offset,len);offset+=len;var config=_spsParser2.default.parseSPS(sps);if(i!==0){// ignore other sps's config
continue;}meta.codecWidth=config.codec_size.width;meta.codecHeight=config.codec_size.height;meta.presentWidth=config.present_size.width;meta.presentHeight=config.present_size.height;meta.profile=config.profile_string;meta.level=config.level_string;meta.bitDepth=config.bit_depth;meta.chromaFormat=config.chroma_format;meta.sarRatio=config.sar_ratio;meta.frameRate=config.frame_rate;if(config.frame_rate.fixed===false||config.frame_rate.fps_num===0||config.frame_rate.fps_den===0){meta.frameRate=this._referenceFrameRate;}var fps_den=meta.frameRate.fps_den;var fps_num=meta.frameRate.fps_num;meta.refSampleDuration=meta.timescale*(fps_den/fps_num);var codecArray=sps.subarray(1,4);var codecString='avc1.';for(var j=0;j<3;j++){var h=codecArray[j].toString(16);if(h.length<2){h='0'+h;}codecString+=h;}meta.codec=codecString;var mi=this._mediaInfo;mi.width=meta.codecWidth;mi.height=meta.codecHeight;mi.fps=meta.frameRate.fps;mi.profile=meta.profile;mi.level=meta.level;mi.refFrames=config.ref_frames;mi.chromaFormat=config.chroma_format_string;mi.sarNum=meta.sarRatio.width;mi.sarDen=meta.sarRatio.height;mi.videoCodec=codecString;if(mi.hasAudio){if(mi.audioCodec!=null){mi.mimeType='video/x-flv; codecs="'+mi.videoCodec+','+mi.audioCodec+'"';}}else{mi.mimeType='video/x-flv; codecs="'+mi.videoCodec+'"';}if(mi.isComplete()){this._onMediaInfo(mi);}}var ppsCount=v.getUint8(offset);// numOfPictureParameterSets
if(ppsCount===0){this._onError(_demuxErrors2.default.FORMAT_ERROR,'Flv: Invalid AVCDecoderConfigurationRecord: No PPS');return;}else if(ppsCount>1){_logger2.default.w(this.TAG,'Flv: Strange AVCDecoderConfigurationRecord: PPS Count = '+ppsCount);}offset++;for(var _i=0;_i<ppsCount;_i++){var _len=v.getUint16(offset,!le);// pictureParameterSetLength
offset+=2;if(_len===0){continue;}// pps is useless for extracting video information
offset+=_len;}meta.avcc=new Uint8Array(dataSize);meta.avcc.set(new Uint8Array(arrayBuffer,dataOffset,dataSize),0);_logger2.default.v(this.TAG,'Parsed AVCDecoderConfigurationRecord');if(this._isInitialMetadataDispatched()){// flush parsed frames
if(this._dispatch&&(this._audioTrack.length||this._videoTrack.length)){this._onDataAvailable(this._audioTrack,this._videoTrack);}}else{this._videoInitialMetadataDispatched=true;}// notify new metadata
this._dispatch=false;this._onTrackMetadata('video',meta);}},{key:'_parseAVCVideoData',value:function _parseAVCVideoData(arrayBuffer,dataOffset,dataSize,tagTimestamp,tagPosition,frameType,cts){var le=this._littleEndian;var v=new DataView(arrayBuffer,dataOffset,dataSize);var units=[],length=0;var offset=0;var lengthSize=this._naluLengthSize;var dts=this._timestampBase+tagTimestamp;var keyframe=frameType===1;// from FLV Frame Type constants
while(offset<dataSize){if(offset+4>=dataSize){_logger2.default.w(this.TAG,'Malformed Nalu near timestamp '+dts+', offset = '+offset+', dataSize = '+dataSize);break;// data not enough for next Nalu
}// Nalu with length-header (AVC1)
var naluSize=v.getUint32(offset,!le);// Big-Endian read
if(lengthSize===3){naluSize>>>=8;}if(naluSize>dataSize-lengthSize){_logger2.default.w(this.TAG,'Malformed Nalus near timestamp '+dts+', NaluSize > DataSize!');return;}var unitType=v.getUint8(offset+lengthSize)&0x1F;if(unitType===5){// IDR
keyframe=true;}var data=new Uint8Array(arrayBuffer,dataOffset+offset,lengthSize+naluSize);var unit={type:unitType,data:data};units.push(unit);length+=data.byteLength;offset+=lengthSize+naluSize;}if(units.length){var track=this._videoTrack;var avcSample={units:units,length:length,isKeyframe:keyframe,dts:dts,cts:cts,pts:dts+cts};if(keyframe){avcSample.fileposition=tagPosition;}track.samples.push(avcSample);track.length+=length;}}},{key:'onTrackMetadata',get:function get(){return this._onTrackMetadata;},set:function set(callback){this._onTrackMetadata=callback;}// prototype: function(mediaInfo: MediaInfo): void
},{key:'onMediaInfo',get:function get(){return this._onMediaInfo;},set:function set(callback){this._onMediaInfo=callback;}},{key:'onMetaDataArrived',get:function get(){return this._onMetaDataArrived;},set:function set(callback){this._onMetaDataArrived=callback;}},{key:'onScriptDataArrived',get:function get(){return this._onScriptDataArrived;},set:function set(callback){this._onScriptDataArrived=callback;}// prototype: function(type: number, info: string): void
},{key:'onError',get:function get(){return this._onError;},set:function set(callback){this._onError=callback;}// prototype: function(videoTrack: any, audioTrack: any): void
},{key:'onDataAvailable',get:function get(){return this._onDataAvailable;},set:function set(callback){this._onDataAvailable=callback;}// timestamp base for output samples, must be in milliseconds
},{key:'timestampBase',get:function get(){return this._timestampBase;},set:function set(base){this._timestampBase=base;}},{key:'overridedDuration',get:function get(){return this._duration;}// Force-override media duration. Must be in milliseconds, int32
,set:function set(duration){this._durationOverrided=true;this._duration=duration;this._mediaInfo.duration=duration;}// Force-override audio track present flag, boolean
},{key:'overridedHasAudio',set:function set(hasAudio){this._hasAudioFlagOverrided=true;this._hasAudio=hasAudio;this._mediaInfo.hasAudio=hasAudio;}// Force-override video track present flag, boolean
},{key:'overridedHasVideo',set:function set(hasVideo){this._hasVideoFlagOverrided=true;this._hasVideo=hasVideo;this._mediaInfo.hasVideo=hasVideo;}}],[{key:'probe',value:function probe(buffer){var data=new Uint8Array(buffer);var mismatch={match:false};if(data[0]!==0x46||data[1]!==0x4C||data[2]!==0x56||data[3]!==0x01){return mismatch;}var hasAudio=(data[4]&4)>>>2!==0;var hasVideo=(data[4]&1)!==0;var offset=ReadBig32(data,5);if(offset<9){return mismatch;}return{match:true,consumed:offset,dataOffset:offset,hasAudioTrack:hasAudio,hasVideoTrack:hasVideo};}}]);return FLVDemuxer;}();exports.default=FLVDemuxer;},{"../core/media-info.js":7,"../utils/exception.js":40,"../utils/logger.js":41,"./amf-parser.js":15,"./demux-errors.js":16,"./sps-parser.js":19}],19:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _expGolomb=_dereq_('./exp-golomb.js');var _expGolomb2=_interopRequireDefault(_expGolomb);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var SPSParser=function(){function SPSParser(){_classCallCheck(this,SPSParser);}_createClass(SPSParser,null,[{key:'_ebsp2rbsp',value:function _ebsp2rbsp(uint8array){var src=uint8array;var src_length=src.byteLength;var dst=new Uint8Array(src_length);var dst_idx=0;for(var i=0;i<src_length;i++){if(i>=2){// Unescape: Skip 0x03 after 00 00
if(src[i]===0x03&&src[i-1]===0x00&&src[i-2]===0x00){continue;}}dst[dst_idx]=src[i];dst_idx++;}return new Uint8Array(dst.buffer,0,dst_idx);}},{key:'parseSPS',value:function parseSPS(uint8array){var rbsp=SPSParser._ebsp2rbsp(uint8array);var gb=new _expGolomb2.default(rbsp);gb.readByte();var profile_idc=gb.readByte();// profile_idc
gb.readByte();// constraint_set_flags[5] + reserved_zero[3]
var level_idc=gb.readByte();// level_idc
gb.readUEG();// seq_parameter_set_id
var profile_string=SPSParser.getProfileString(profile_idc);var level_string=SPSParser.getLevelString(level_idc);var chroma_format_idc=1;var chroma_format=420;var chroma_format_table=[0,420,422,444];var bit_depth=8;if(profile_idc===100||profile_idc===110||profile_idc===122||profile_idc===244||profile_idc===44||profile_idc===83||profile_idc===86||profile_idc===118||profile_idc===128||profile_idc===138||profile_idc===144){chroma_format_idc=gb.readUEG();if(chroma_format_idc===3){gb.readBits(1);// separate_colour_plane_flag
}if(chroma_format_idc<=3){chroma_format=chroma_format_table[chroma_format_idc];}bit_depth=gb.readUEG()+8;// bit_depth_luma_minus8
gb.readUEG();// bit_depth_chroma_minus8
gb.readBits(1);// qpprime_y_zero_transform_bypass_flag
if(gb.readBool()){// seq_scaling_matrix_present_flag
var scaling_list_count=chroma_format_idc!==3?8:12;for(var i=0;i<scaling_list_count;i++){if(gb.readBool()){// seq_scaling_list_present_flag
if(i<6){SPSParser._skipScalingList(gb,16);}else{SPSParser._skipScalingList(gb,64);}}}}}gb.readUEG();// log2_max_frame_num_minus4
var pic_order_cnt_type=gb.readUEG();if(pic_order_cnt_type===0){gb.readUEG();// log2_max_pic_order_cnt_lsb_minus_4
}else if(pic_order_cnt_type===1){gb.readBits(1);// delta_pic_order_always_zero_flag
gb.readSEG();// offset_for_non_ref_pic
gb.readSEG();// offset_for_top_to_bottom_field
var num_ref_frames_in_pic_order_cnt_cycle=gb.readUEG();for(var _i=0;_i<num_ref_frames_in_pic_order_cnt_cycle;_i++){gb.readSEG();// offset_for_ref_frame
}}var ref_frames=gb.readUEG();// max_num_ref_frames
gb.readBits(1);// gaps_in_frame_num_value_allowed_flag
var pic_width_in_mbs_minus1=gb.readUEG();var pic_height_in_map_units_minus1=gb.readUEG();var frame_mbs_only_flag=gb.readBits(1);if(frame_mbs_only_flag===0){gb.readBits(1);// mb_adaptive_frame_field_flag
}gb.readBits(1);// direct_8x8_inference_flag
var frame_crop_left_offset=0;var frame_crop_right_offset=0;var frame_crop_top_offset=0;var frame_crop_bottom_offset=0;var frame_cropping_flag=gb.readBool();if(frame_cropping_flag){frame_crop_left_offset=gb.readUEG();frame_crop_right_offset=gb.readUEG();frame_crop_top_offset=gb.readUEG();frame_crop_bottom_offset=gb.readUEG();}var sar_width=1,sar_height=1;var fps=0,fps_fixed=true,fps_num=0,fps_den=0;var vui_parameters_present_flag=gb.readBool();if(vui_parameters_present_flag){if(gb.readBool()){// aspect_ratio_info_present_flag
var aspect_ratio_idc=gb.readByte();var sar_w_table=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2];var sar_h_table=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];if(aspect_ratio_idc>0&&aspect_ratio_idc<16){sar_width=sar_w_table[aspect_ratio_idc-1];sar_height=sar_h_table[aspect_ratio_idc-1];}else if(aspect_ratio_idc===255){sar_width=gb.readByte()<<8|gb.readByte();sar_height=gb.readByte()<<8|gb.readByte();}}if(gb.readBool()){// overscan_info_present_flag
gb.readBool();// overscan_appropriate_flag
}if(gb.readBool()){// video_signal_type_present_flag
gb.readBits(4);// video_format & video_full_range_flag
if(gb.readBool()){// colour_description_present_flag
gb.readBits(24);// colour_primaries & transfer_characteristics & matrix_coefficients
}}if(gb.readBool()){// chroma_loc_info_present_flag
gb.readUEG();// chroma_sample_loc_type_top_field
gb.readUEG();// chroma_sample_loc_type_bottom_field
}if(gb.readBool()){// timing_info_present_flag
var num_units_in_tick=gb.readBits(32);var time_scale=gb.readBits(32);fps_fixed=gb.readBool();// fixed_frame_rate_flag
fps_num=time_scale;fps_den=num_units_in_tick*2;fps=fps_num/fps_den;}}var sarScale=1;if(sar_width!==1||sar_height!==1){sarScale=sar_width/sar_height;}var crop_unit_x=0,crop_unit_y=0;if(chroma_format_idc===0){crop_unit_x=1;crop_unit_y=2-frame_mbs_only_flag;}else{var sub_wc=chroma_format_idc===3?1:2;var sub_hc=chroma_format_idc===1?2:1;crop_unit_x=sub_wc;crop_unit_y=sub_hc*(2-frame_mbs_only_flag);}var codec_width=(pic_width_in_mbs_minus1+1)*16;var codec_height=(2-frame_mbs_only_flag)*((pic_height_in_map_units_minus1+1)*16);codec_width-=(frame_crop_left_offset+frame_crop_right_offset)*crop_unit_x;codec_height-=(frame_crop_top_offset+frame_crop_bottom_offset)*crop_unit_y;var present_width=Math.ceil(codec_width*sarScale);gb.destroy();gb=null;return{profile_string:profile_string,// baseline, high, high10, ...
level_string:level_string,// 3, 3.1, 4, 4.1, 5, 5.1, ...
bit_depth:bit_depth,// 8bit, 10bit, ...
ref_frames:ref_frames,chroma_format:chroma_format,// 4:2:0, 4:2:2, ...
chroma_format_string:SPSParser.getChromaFormatString(chroma_format),frame_rate:{fixed:fps_fixed,fps:fps,fps_den:fps_den,fps_num:fps_num},sar_ratio:{width:sar_width,height:sar_height},codec_size:{width:codec_width,height:codec_height},present_size:{width:present_width,height:codec_height}};}},{key:'_skipScalingList',value:function _skipScalingList(gb,count){var last_scale=8,next_scale=8;var delta_scale=0;for(var i=0;i<count;i++){if(next_scale!==0){delta_scale=gb.readSEG();next_scale=(last_scale+delta_scale+256)%256;}last_scale=next_scale===0?last_scale:next_scale;}}},{key:'getProfileString',value:function getProfileString(profile_idc){switch(profile_idc){case 66:return'Baseline';case 77:return'Main';case 88:return'Extended';case 100:return'High';case 110:return'High10';case 122:return'High422';case 244:return'High444';default:return'Unknown';}}},{key:'getLevelString',value:function getLevelString(level_idc){return(level_idc/10).toFixed(1);}},{key:'getChromaFormatString',value:function getChromaFormatString(chroma){switch(chroma){case 420:return'4:2:0';case 422:return'4:2:2';case 444:return'4:4:4';default:return'Unknown';}}}]);return SPSParser;}();exports.default=SPSParser;},{"./exp-golomb.js":17}],20:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator___default.a)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);}:function(obj){return obj&&typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&obj.constructor===__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a&&obj!==__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a.prototype?"symbol":typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);};/*
                                                                                                                                                                                                                                                                               * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                               *
                                                                                                                                                                                                                                                                               * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                               *
                                                                                                                                                                                                                                                                               * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                               * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                               * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                               *
                                                                                                                                                                                                                                                                               *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                               *
                                                                                                                                                                                                                                                                               * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                               * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                               * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                               * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                               * limitations under the License.
                                                                                                                                                                                                                                                                               */var _polyfill=_dereq_('./utils/polyfill.js');var _polyfill2=_interopRequireDefault(_polyfill);var _features=_dereq_('./core/features.js');var _features2=_interopRequireDefault(_features);var _loader=_dereq_('./io/loader.js');var _flvPlayer=_dereq_('./player/flv-player.js');var _flvPlayer2=_interopRequireDefault(_flvPlayer);var _nativePlayer=_dereq_('./player/native-player.js');var _nativePlayer2=_interopRequireDefault(_nativePlayer);var _playerEvents=_dereq_('./player/player-events.js');var _playerEvents2=_interopRequireDefault(_playerEvents);var _playerErrors=_dereq_('./player/player-errors.js');var _loggingControl=_dereq_('./utils/logging-control.js');var _loggingControl2=_interopRequireDefault(_loggingControl);var _exception=_dereq_('./utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}// here are all the interfaces
// install polyfills
_polyfill2.default.install();// factory method
function createPlayer(mediaDataSource,optionalConfig){var mds=mediaDataSource;if(mds==null||(typeof mds==='undefined'?'undefined':_typeof(mds))!=='object'){throw new _exception.InvalidArgumentException('MediaDataSource must be an javascript object!');}if(!mds.hasOwnProperty('type')){throw new _exception.InvalidArgumentException('MediaDataSource must has type field to indicate video file type!');}switch(mds.type){case'flv':return new _flvPlayer2.default(mds,optionalConfig);default:return new _nativePlayer2.default(mds,optionalConfig);}}// feature detection
function isSupported(){return _features2.default.supportMSEH264Playback();}function getFeatureList(){return _features2.default.getFeatureList();}// interfaces
var flvjs={};flvjs.createPlayer=createPlayer;flvjs.isSupported=isSupported;flvjs.getFeatureList=getFeatureList;flvjs.BaseLoader=_loader.BaseLoader;flvjs.LoaderStatus=_loader.LoaderStatus;flvjs.LoaderErrors=_loader.LoaderErrors;flvjs.Events=_playerEvents2.default;flvjs.ErrorTypes=_playerErrors.ErrorTypes;flvjs.ErrorDetails=_playerErrors.ErrorDetails;flvjs.FlvPlayer=_flvPlayer2.default;flvjs.NativePlayer=_nativePlayer2.default;flvjs.LoggingControl=_loggingControl2.default;Object.defineProperty(flvjs,'version',{enumerable:true,get:function get(){// replaced by browserify-versionify transform
return'1.5.0';}});exports.default=flvjs;},{"./core/features.js":6,"./io/loader.js":24,"./player/flv-player.js":32,"./player/native-player.js":33,"./player/player-errors.js":34,"./player/player-events.js":35,"./utils/exception.js":40,"./utils/logging-control.js":42,"./utils/polyfill.js":43}],21:[function(_dereq_,module,exports){'use strict';// entry/index file
// make it compatible with browserify's umd wrapper
module.exports=_dereq_('./flv.js').default;},{"./flv.js":20}],22:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator___default.a)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);}:function(obj){return obj&&typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&obj.constructor===__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a&&obj!==__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a.prototype?"symbol":typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);};var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_own_property_descriptor___default()(object,property);if(desc===undefined){var parent=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _browser=_dereq_('../utils/browser.js');var _browser2=_interopRequireDefault(_browser);var _loader=_dereq_('./loader.js');var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&((typeof call==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(call))==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(superClass)));}subClass.prototype=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_create___default()(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default.a?__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default()(subClass,superClass):subClass.__proto__=superClass;}/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *//* fetch + stream IO loader. Currently working on chrome 43+.
             * fetch provides a better alternative http API to XMLHttpRequest
             *
             * fetch spec   https://fetch.spec.whatwg.org/
             * stream spec  https://streams.spec.whatwg.org/
             */var FetchStreamLoader=function(_BaseLoader){_inherits(FetchStreamLoader,_BaseLoader);_createClass(FetchStreamLoader,null,[{key:'isSupported',value:function isSupported(){try{// fetch + stream is broken on Microsoft Edge. Disable before build 15048.
// see https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/8196907/
// Fixed in Jan 10, 2017. Build 15048+ removed from blacklist.
var isWorkWellEdge=_browser2.default.msedge&&_browser2.default.version.minor>=15048;var browserNotBlacklisted=_browser2.default.msedge?isWorkWellEdge:true;return self.fetch&&self.ReadableStream&&browserNotBlacklisted;}catch(e){return false;}}}]);function FetchStreamLoader(seekHandler,config){_classCallCheck(this,FetchStreamLoader);var _this=_possibleConstructorReturn(this,(FetchStreamLoader.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(FetchStreamLoader)).call(this,'fetch-stream-loader'));_this.TAG='FetchStreamLoader';_this._seekHandler=seekHandler;_this._config=config;_this._needStash=true;_this._requestAbort=false;_this._contentLength=null;_this._receivedLength=0;return _this;}_createClass(FetchStreamLoader,[{key:'destroy',value:function destroy(){if(this.isWorking()){this.abort();}_get(FetchStreamLoader.prototype.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(FetchStreamLoader.prototype),'destroy',this).call(this);}},{key:'open',value:function open(dataSource,range){var _this2=this;this._dataSource=dataSource;this._range=range;var sourceURL=dataSource.url;if(this._config.reuseRedirectedURL&&dataSource.redirectedURL!=undefined){sourceURL=dataSource.redirectedURL;}var seekConfig=this._seekHandler.getConfig(sourceURL,range);var headers=new self.Headers();if(_typeof(seekConfig.headers)==='object'){var configHeaders=seekConfig.headers;for(var key in configHeaders){if(configHeaders.hasOwnProperty(key)){headers.append(key,configHeaders[key]);}}}var params={method:'GET',headers:headers,mode:'cors',cache:'default',// The default policy of Fetch API in the whatwg standard
// Safari incorrectly indicates 'no-referrer' as default policy, fuck it
referrerPolicy:'no-referrer-when-downgrade'};// add additional headers
if(_typeof(this._config.headers)==='object'){for(var _key in this._config.headers){headers.append(_key,this._config.headers[_key]);}}// cors is enabled by default
if(dataSource.cors===false){// no-cors means 'disregard cors policy', which can only be used in ServiceWorker
params.mode='same-origin';}// withCredentials is disabled by default
if(dataSource.withCredentials){params.credentials='include';}// referrerPolicy from config
if(dataSource.referrerPolicy){params.referrerPolicy=dataSource.referrerPolicy;}this._status=_loader.LoaderStatus.kConnecting;self.fetch(seekConfig.url,params).then(function(res){if(_this2._requestAbort){_this2._requestAbort=false;_this2._status=_loader.LoaderStatus.kIdle;return;}if(res.ok&&res.status>=200&&res.status<=299){if(res.url!==seekConfig.url){if(_this2._onURLRedirect){var redirectedURL=_this2._seekHandler.removeURLParameters(res.url);_this2._onURLRedirect(redirectedURL);}}var lengthHeader=res.headers.get('Content-Length');if(lengthHeader!=null){_this2._contentLength=parseInt(lengthHeader);if(_this2._contentLength!==0){if(_this2._onContentLengthKnown){_this2._onContentLengthKnown(_this2._contentLength);}}}return _this2._pump.call(_this2,res.body.getReader());}else{_this2._status=_loader.LoaderStatus.kError;if(_this2._onError){_this2._onError(_loader.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:res.status,msg:res.statusText});}else{throw new _exception.RuntimeException('FetchStreamLoader: Http code invalid, '+res.status+' '+res.statusText);}}}).catch(function(e){_this2._status=_loader.LoaderStatus.kError;if(_this2._onError){_this2._onError(_loader.LoaderErrors.EXCEPTION,{code:-1,msg:e.message});}else{throw e;}});}},{key:'abort',value:function abort(){this._requestAbort=true;}},{key:'_pump',value:function _pump(reader){var _this3=this;// ReadableStreamReader
return reader.read().then(function(result){if(result.done){// First check received length
if(_this3._contentLength!==null&&_this3._receivedLength<_this3._contentLength){// Report Early-EOF
_this3._status=_loader.LoaderStatus.kError;var type=_loader.LoaderErrors.EARLY_EOF;var info={code:-1,msg:'Fetch stream meet Early-EOF'};if(_this3._onError){_this3._onError(type,info);}else{throw new _exception.RuntimeException(info.msg);}}else{// OK. Download complete
_this3._status=_loader.LoaderStatus.kComplete;if(_this3._onComplete){_this3._onComplete(_this3._range.from,_this3._range.from+_this3._receivedLength-1);}}}else{if(_this3._requestAbort===true){_this3._requestAbort=false;_this3._status=_loader.LoaderStatus.kComplete;return reader.cancel();}_this3._status=_loader.LoaderStatus.kBuffering;var chunk=result.value.buffer;var byteStart=_this3._range.from+_this3._receivedLength;_this3._receivedLength+=chunk.byteLength;if(_this3._onDataArrival){_this3._onDataArrival(chunk,byteStart,_this3._receivedLength);}_this3._pump(reader);}}).catch(function(e){if(e.code===11&&_browser2.default.msedge){// InvalidStateError on Microsoft Edge
// Workaround: Edge may throw InvalidStateError after ReadableStreamReader.cancel() call
// Ignore the unknown exception.
// Related issue: https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/11265202/
return;}_this3._status=_loader.LoaderStatus.kError;var type=0;var info=null;if((e.code===19||e.message==='network error')&&(// NETWORK_ERR
_this3._contentLength===null||_this3._contentLength!==null&&_this3._receivedLength<_this3._contentLength)){type=_loader.LoaderErrors.EARLY_EOF;info={code:e.code,msg:'Fetch stream meet Early-EOF'};}else{type=_loader.LoaderErrors.EXCEPTION;info={code:e.code,msg:e.message};}if(_this3._onError){_this3._onError(type,info);}else{throw new _exception.RuntimeException(info.msg);}});}}]);return FetchStreamLoader;}(_loader.BaseLoader);exports.default=FetchStreamLoader;},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],23:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _speedSampler=_dereq_('./speed-sampler.js');var _speedSampler2=_interopRequireDefault(_speedSampler);var _loader=_dereq_('./loader.js');var _fetchStreamLoader=_dereq_('./fetch-stream-loader.js');var _fetchStreamLoader2=_interopRequireDefault(_fetchStreamLoader);var _xhrMozChunkedLoader=_dereq_('./xhr-moz-chunked-loader.js');var _xhrMozChunkedLoader2=_interopRequireDefault(_xhrMozChunkedLoader);var _xhrMsstreamLoader=_dereq_('./xhr-msstream-loader.js');var _xhrMsstreamLoader2=_interopRequireDefault(_xhrMsstreamLoader);var _xhrRangeLoader=_dereq_('./xhr-range-loader.js');var _xhrRangeLoader2=_interopRequireDefault(_xhrRangeLoader);var _websocketLoader=_dereq_('./websocket-loader.js');var _websocketLoader2=_interopRequireDefault(_websocketLoader);var _rangeSeekHandler=_dereq_('./range-seek-handler.js');var _rangeSeekHandler2=_interopRequireDefault(_rangeSeekHandler);var _paramSeekHandler=_dereq_('./param-seek-handler.js');var _paramSeekHandler2=_interopRequireDefault(_paramSeekHandler);var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/**
             * DataSource: {
             *     url: string,
             *     filesize: number,
             *     cors: boolean,
             *     withCredentials: boolean
             * }
             * 
             */// Manage IO Loaders
var IOController=function(){function IOController(dataSource,config,extraData){_classCallCheck(this,IOController);this.TAG='IOController';this._config=config;this._extraData=extraData;this._stashInitialSize=1024*384;// default initial size: 384KB
if(config.stashInitialSize!=undefined&&config.stashInitialSize>0){// apply from config
this._stashInitialSize=config.stashInitialSize;}this._stashUsed=0;this._stashSize=this._stashInitialSize;this._bufferSize=1024*1024*3;// initial size: 3MB
this._stashBuffer=new ArrayBuffer(this._bufferSize);this._stashByteStart=0;this._enableStash=true;if(config.enableStashBuffer===false){this._enableStash=false;}this._loader=null;this._loaderClass=null;this._seekHandler=null;this._dataSource=dataSource;this._isWebSocketURL=/wss?:\/\/(.+?)/.test(dataSource.url);this._refTotalLength=dataSource.filesize?dataSource.filesize:null;this._totalLength=this._refTotalLength;this._fullRequestFlag=false;this._currentRange=null;this._redirectedURL=null;this._speedNormalized=0;this._speedSampler=new _speedSampler2.default();this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096];this._isEarlyEofReconnecting=false;this._paused=false;this._resumeFrom=0;this._onDataArrival=null;this._onSeeked=null;this._onError=null;this._onComplete=null;this._onRedirect=null;this._onRecoveredEarlyEof=null;this._selectSeekHandler();this._selectLoader();this._createLoader();}_createClass(IOController,[{key:'destroy',value:function destroy(){if(this._loader.isWorking()){this._loader.abort();}this._loader.destroy();this._loader=null;this._loaderClass=null;this._dataSource=null;this._stashBuffer=null;this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0;this._currentRange=null;this._speedSampler=null;this._isEarlyEofReconnecting=false;this._onDataArrival=null;this._onSeeked=null;this._onError=null;this._onComplete=null;this._onRedirect=null;this._onRecoveredEarlyEof=null;this._extraData=null;}},{key:'isWorking',value:function isWorking(){return this._loader&&this._loader.isWorking()&&!this._paused;}},{key:'isPaused',value:function isPaused(){return this._paused;}},{key:'_selectSeekHandler',value:function _selectSeekHandler(){var config=this._config;if(config.seekType==='range'){this._seekHandler=new _rangeSeekHandler2.default(this._config.rangeLoadZeroStart);}else if(config.seekType==='param'){var paramStart=config.seekParamStart||'bstart';var paramEnd=config.seekParamEnd||'bend';this._seekHandler=new _paramSeekHandler2.default(paramStart,paramEnd);}else if(config.seekType==='custom'){if(typeof config.customSeekHandler!=='function'){throw new _exception.InvalidArgumentException('Custom seekType specified in config but invalid customSeekHandler!');}this._seekHandler=new config.customSeekHandler();}else{throw new _exception.InvalidArgumentException('Invalid seekType in config: '+config.seekType);}}},{key:'_selectLoader',value:function _selectLoader(){if(this._config.customLoader!=null){this._loaderClass=this._config.customLoader;}else if(this._isWebSocketURL){this._loaderClass=_websocketLoader2.default;}else if(_fetchStreamLoader2.default.isSupported()){this._loaderClass=_fetchStreamLoader2.default;}else if(_xhrMozChunkedLoader2.default.isSupported()){this._loaderClass=_xhrMozChunkedLoader2.default;}else if(_xhrRangeLoader2.default.isSupported()){this._loaderClass=_xhrRangeLoader2.default;}else{throw new _exception.RuntimeException('Your browser doesn\'t support xhr with arraybuffer responseType!');}}},{key:'_createLoader',value:function _createLoader(){this._loader=new this._loaderClass(this._seekHandler,this._config);if(this._loader.needStashBuffer===false){this._enableStash=false;}this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this);this._loader.onURLRedirect=this._onURLRedirect.bind(this);this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this);this._loader.onComplete=this._onLoaderComplete.bind(this);this._loader.onError=this._onLoaderError.bind(this);}},{key:'open',value:function open(optionalFrom){this._currentRange={from:0,to:-1};if(optionalFrom){this._currentRange.from=optionalFrom;}this._speedSampler.reset();if(!optionalFrom){this._fullRequestFlag=true;}this._loader.open(this._dataSource,__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},this._currentRange));}},{key:'abort',value:function abort(){this._loader.abort();if(this._paused){this._paused=false;this._resumeFrom=0;}}},{key:'pause',value:function pause(){if(this.isWorking()){this._loader.abort();if(this._stashUsed!==0){this._resumeFrom=this._stashByteStart;this._currentRange.to=this._stashByteStart-1;}else{this._resumeFrom=this._currentRange.to+1;}this._stashUsed=0;this._stashByteStart=0;this._paused=true;}}},{key:'resume',value:function resume(){if(this._paused){this._paused=false;var bytes=this._resumeFrom;this._resumeFrom=0;this._internalSeek(bytes,true);}}},{key:'seek',value:function seek(bytes){this._paused=false;this._stashUsed=0;this._stashByteStart=0;this._internalSeek(bytes,true);}/**
                     * When seeking request is from media seeking, unconsumed stash data should be dropped
                     * However, stash data shouldn't be dropped if seeking requested from http reconnection
                     *
                     * @dropUnconsumed: Ignore and discard all unconsumed data in stash buffer
                     */},{key:'_internalSeek',value:function _internalSeek(bytes,dropUnconsumed){if(this._loader.isWorking()){this._loader.abort();}// dispatch & flush stash buffer before seek
this._flushStashBuffer(dropUnconsumed);this._loader.destroy();this._loader=null;var requestRange={from:bytes,to:-1};this._currentRange={from:requestRange.from,to:-1};this._speedSampler.reset();this._stashSize=this._stashInitialSize;this._createLoader();this._loader.open(this._dataSource,requestRange);if(this._onSeeked){this._onSeeked();}}},{key:'updateUrl',value:function updateUrl(url){if(!url||typeof url!=='string'||url.length===0){throw new _exception.InvalidArgumentException('Url must be a non-empty string!');}this._dataSource.url=url;// TODO: replace with new url
}},{key:'_expandBuffer',value:function _expandBuffer(expectedBytes){var bufferNewSize=this._stashSize;while(bufferNewSize+1024*1024*1<expectedBytes){bufferNewSize*=2;}bufferNewSize+=1024*1024*1;// bufferSize = stashSize + 1MB
if(bufferNewSize===this._bufferSize){return;}var newBuffer=new ArrayBuffer(bufferNewSize);if(this._stashUsed>0){// copy existing data into new buffer
var stashOldArray=new Uint8Array(this._stashBuffer,0,this._stashUsed);var stashNewArray=new Uint8Array(newBuffer,0,bufferNewSize);stashNewArray.set(stashOldArray,0);}this._stashBuffer=newBuffer;this._bufferSize=bufferNewSize;}},{key:'_normalizeSpeed',value:function _normalizeSpeed(input){var list=this._speedNormalizeList;var last=list.length-1;var mid=0;var lbound=0;var ubound=last;if(input<list[0]){return list[0];}// binary search
while(lbound<=ubound){mid=lbound+Math.floor((ubound-lbound)/2);if(mid===last||input>=list[mid]&&input<list[mid+1]){return list[mid];}else if(list[mid]<input){lbound=mid+1;}else{ubound=mid-1;}}}},{key:'_adjustStashSize',value:function _adjustStashSize(normalized){var stashSizeKB=0;if(this._config.isLive){// live stream: always use single normalized speed for size of stashSizeKB
stashSizeKB=normalized;}else{if(normalized<512){stashSizeKB=normalized;}else if(normalized>=512&&normalized<=1024){stashSizeKB=Math.floor(normalized*1.5);}else{stashSizeKB=normalized*2;}}if(stashSizeKB>8192){stashSizeKB=8192;}var bufferSize=stashSizeKB*1024+1024*1024*1;// stashSize + 1MB
if(this._bufferSize<bufferSize){this._expandBuffer(bufferSize);}this._stashSize=stashSizeKB*1024;}},{key:'_dispatchChunks',value:function _dispatchChunks(chunks,byteStart){this._currentRange.to=byteStart+chunks.byteLength-1;return this._onDataArrival(chunks,byteStart);}},{key:'_onURLRedirect',value:function _onURLRedirect(redirectedURL){this._redirectedURL=redirectedURL;if(this._onRedirect){this._onRedirect(redirectedURL);}}},{key:'_onContentLengthKnown',value:function _onContentLengthKnown(contentLength){if(contentLength&&this._fullRequestFlag){this._totalLength=contentLength;this._fullRequestFlag=false;}}},{key:'_onLoaderChunkArrival',value:function _onLoaderChunkArrival(chunk,byteStart,receivedLength){if(!this._onDataArrival){throw new _exception.IllegalStateException('IOController: No existing consumer (onDataArrival) callback!');}if(this._paused){return;}if(this._isEarlyEofReconnecting){// Auto-reconnect for EarlyEof succeed, notify to upper-layer by callback
this._isEarlyEofReconnecting=false;if(this._onRecoveredEarlyEof){this._onRecoveredEarlyEof();}}this._speedSampler.addBytes(chunk.byteLength);// adjust stash buffer size according to network speed dynamically
var KBps=this._speedSampler.lastSecondKBps;if(KBps!==0){var normalized=this._normalizeSpeed(KBps);if(this._speedNormalized!==normalized){this._speedNormalized=normalized;this._adjustStashSize(normalized);}}if(!this._enableStash){// disable stash
if(this._stashUsed===0){// dispatch chunk directly to consumer;
// check ret value (consumed bytes) and stash unconsumed to stashBuffer
var consumed=this._dispatchChunks(chunk,byteStart);if(consumed<chunk.byteLength){// unconsumed data remain.
var remain=chunk.byteLength-consumed;if(remain>this._bufferSize){this._expandBuffer(remain);}var stashArray=new Uint8Array(this._stashBuffer,0,this._bufferSize);stashArray.set(new Uint8Array(chunk,consumed),0);this._stashUsed+=remain;this._stashByteStart=byteStart+consumed;}}else{// else: Merge chunk into stashBuffer, and dispatch stashBuffer to consumer.
if(this._stashUsed+chunk.byteLength>this._bufferSize){this._expandBuffer(this._stashUsed+chunk.byteLength);}var _stashArray=new Uint8Array(this._stashBuffer,0,this._bufferSize);_stashArray.set(new Uint8Array(chunk),this._stashUsed);this._stashUsed+=chunk.byteLength;var _consumed=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(_consumed<this._stashUsed&&_consumed>0){// unconsumed data remain
var remainArray=new Uint8Array(this._stashBuffer,_consumed);_stashArray.set(remainArray,0);}this._stashUsed-=_consumed;this._stashByteStart+=_consumed;}}else{// enable stash
if(this._stashUsed===0&&this._stashByteStart===0){// seeked? or init chunk?
// This is the first chunk after seek action
this._stashByteStart=byteStart;}if(this._stashUsed+chunk.byteLength<=this._stashSize){// just stash
var _stashArray2=new Uint8Array(this._stashBuffer,0,this._stashSize);_stashArray2.set(new Uint8Array(chunk),this._stashUsed);this._stashUsed+=chunk.byteLength;}else{// stashUsed + chunkSize > stashSize, size limit exceeded
var _stashArray3=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){// There're stash datas in buffer
// dispatch the whole stashBuffer, and stash remain data
// then append chunk to stashBuffer (stash)
var buffer=this._stashBuffer.slice(0,this._stashUsed);var _consumed2=this._dispatchChunks(buffer,this._stashByteStart);if(_consumed2<buffer.byteLength){if(_consumed2>0){var _remainArray=new Uint8Array(buffer,_consumed2);_stashArray3.set(_remainArray,0);this._stashUsed=_remainArray.byteLength;this._stashByteStart+=_consumed2;}}else{this._stashUsed=0;this._stashByteStart+=_consumed2;}if(this._stashUsed+chunk.byteLength>this._bufferSize){this._expandBuffer(this._stashUsed+chunk.byteLength);_stashArray3=new Uint8Array(this._stashBuffer,0,this._bufferSize);}_stashArray3.set(new Uint8Array(chunk),this._stashUsed);this._stashUsed+=chunk.byteLength;}else{// stash buffer empty, but chunkSize > stashSize (oh, holy shit)
// dispatch chunk directly and stash remain data
var _consumed3=this._dispatchChunks(chunk,byteStart);if(_consumed3<chunk.byteLength){var _remain=chunk.byteLength-_consumed3;if(_remain>this._bufferSize){this._expandBuffer(_remain);_stashArray3=new Uint8Array(this._stashBuffer,0,this._bufferSize);}_stashArray3.set(new Uint8Array(chunk,_consumed3),0);this._stashUsed+=_remain;this._stashByteStart=byteStart+_consumed3;}}}}}},{key:'_flushStashBuffer',value:function _flushStashBuffer(dropUnconsumed){if(this._stashUsed>0){var buffer=this._stashBuffer.slice(0,this._stashUsed);var consumed=this._dispatchChunks(buffer,this._stashByteStart);var remain=buffer.byteLength-consumed;if(consumed<buffer.byteLength){if(dropUnconsumed){_logger2.default.w(this.TAG,remain+' bytes unconsumed data remain when flush buffer, dropped');}else{if(consumed>0){var stashArray=new Uint8Array(this._stashBuffer,0,this._bufferSize);var remainArray=new Uint8Array(buffer,consumed);stashArray.set(remainArray,0);this._stashUsed=remainArray.byteLength;this._stashByteStart+=consumed;}return 0;}}this._stashUsed=0;this._stashByteStart=0;return remain;}return 0;}},{key:'_onLoaderComplete',value:function _onLoaderComplete(from,to){// Force-flush stash buffer, and drop unconsumed data
this._flushStashBuffer(true);if(this._onComplete){this._onComplete(this._extraData);}}},{key:'_onLoaderError',value:function _onLoaderError(type,data){_logger2.default.e(this.TAG,'Loader error, code = '+data.code+', msg = '+data.msg);this._flushStashBuffer(false);if(this._isEarlyEofReconnecting){// Auto-reconnect for EarlyEof failed, throw UnrecoverableEarlyEof error to upper-layer
this._isEarlyEofReconnecting=false;type=_loader.LoaderErrors.UNRECOVERABLE_EARLY_EOF;}switch(type){case _loader.LoaderErrors.EARLY_EOF:{if(!this._config.isLive){// Do internal http reconnect if not live stream
if(this._totalLength){var nextFrom=this._currentRange.to+1;if(nextFrom<this._totalLength){_logger2.default.w(this.TAG,'Connection lost, trying reconnect...');this._isEarlyEofReconnecting=true;this._internalSeek(nextFrom,false);}return;}// else: We don't know totalLength, throw UnrecoverableEarlyEof
}// live stream: throw UnrecoverableEarlyEof error to upper-layer
type=_loader.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break;}case _loader.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case _loader.LoaderErrors.CONNECTING_TIMEOUT:case _loader.LoaderErrors.HTTP_STATUS_CODE_INVALID:case _loader.LoaderErrors.EXCEPTION:break;}if(this._onError){this._onError(type,data);}else{throw new _exception.RuntimeException('IOException: '+data.msg);}}},{key:'status',get:function get(){return this._loader.status;}},{key:'extraData',get:function get(){return this._extraData;},set:function set(data){this._extraData=data;}// prototype: function onDataArrival(chunks: ArrayBuffer, byteStart: number): number
},{key:'onDataArrival',get:function get(){return this._onDataArrival;},set:function set(callback){this._onDataArrival=callback;}},{key:'onSeeked',get:function get(){return this._onSeeked;},set:function set(callback){this._onSeeked=callback;}// prototype: function onError(type: number, info: {code: number, msg: string}): void
},{key:'onError',get:function get(){return this._onError;},set:function set(callback){this._onError=callback;}},{key:'onComplete',get:function get(){return this._onComplete;},set:function set(callback){this._onComplete=callback;}},{key:'onRedirect',get:function get(){return this._onRedirect;},set:function set(callback){this._onRedirect=callback;}},{key:'onRecoveredEarlyEof',get:function get(){return this._onRecoveredEarlyEof;},set:function set(callback){this._onRecoveredEarlyEof=callback;}},{key:'currentURL',get:function get(){return this._dataSource.url;}},{key:'hasRedirect',get:function get(){return this._redirectedURL!=null||this._dataSource.redirectedURL!=undefined;}},{key:'currentRedirectedURL',get:function get(){return this._redirectedURL||this._dataSource.redirectedURL;}// in KB/s
},{key:'currentSpeed',get:function get(){if(this._loaderClass===_xhrRangeLoader2.default){// SpeedSampler is inaccuracy if loader is RangeLoader
return this._loader.currentSpeed;}return this._speedSampler.lastSecondKBps;}},{key:'loaderType',get:function get(){return this._loader.type;}}]);return IOController;}();exports.default=IOController;},{"../utils/exception.js":40,"../utils/logger.js":41,"./fetch-stream-loader.js":22,"./loader.js":24,"./param-seek-handler.js":25,"./range-seek-handler.js":26,"./speed-sampler.js":27,"./websocket-loader.js":28,"./xhr-moz-chunked-loader.js":29,"./xhr-msstream-loader.js":30,"./xhr-range-loader.js":31}],24:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.BaseLoader=exports.LoaderErrors=exports.LoaderStatus=undefined;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _exception=_dereq_('../utils/exception.js');function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var LoaderStatus=exports.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};var LoaderErrors=exports.LoaderErrors={OK:'OK',EXCEPTION:'Exception',HTTP_STATUS_CODE_INVALID:'HttpStatusCodeInvalid',CONNECTING_TIMEOUT:'ConnectingTimeout',EARLY_EOF:'EarlyEof',UNRECOVERABLE_EARLY_EOF:'UnrecoverableEarlyEof'};/* Loader has callbacks which have following prototypes:
             *     function onContentLengthKnown(contentLength: number): void
             *     function onURLRedirect(url: string): void
             *     function onDataArrival(chunk: ArrayBuffer, byteStart: number, receivedLength: number): void
             *     function onError(errorType: number, errorInfo: {code: number, msg: string}): void
             *     function onComplete(rangeFrom: number, rangeTo: number): void
             */var BaseLoader=exports.BaseLoader=function(){function BaseLoader(typeName){_classCallCheck(this,BaseLoader);this._type=typeName||'undefined';this._status=LoaderStatus.kIdle;this._needStash=false;// callbacks
this._onContentLengthKnown=null;this._onURLRedirect=null;this._onDataArrival=null;this._onError=null;this._onComplete=null;}_createClass(BaseLoader,[{key:'destroy',value:function destroy(){this._status=LoaderStatus.kIdle;this._onContentLengthKnown=null;this._onURLRedirect=null;this._onDataArrival=null;this._onError=null;this._onComplete=null;}},{key:'isWorking',value:function isWorking(){return this._status===LoaderStatus.kConnecting||this._status===LoaderStatus.kBuffering;}},{key:'open',// pure virtual
value:function open(dataSource,range){throw new _exception.NotImplementedException('Unimplemented abstract function!');}},{key:'abort',value:function abort(){throw new _exception.NotImplementedException('Unimplemented abstract function!');}},{key:'type',get:function get(){return this._type;}},{key:'status',get:function get(){return this._status;}},{key:'needStashBuffer',get:function get(){return this._needStash;}},{key:'onContentLengthKnown',get:function get(){return this._onContentLengthKnown;},set:function set(callback){this._onContentLengthKnown=callback;}},{key:'onURLRedirect',get:function get(){return this._onURLRedirect;},set:function set(callback){this._onURLRedirect=callback;}},{key:'onDataArrival',get:function get(){return this._onDataArrival;},set:function set(callback){this._onDataArrival=callback;}},{key:'onError',get:function get(){return this._onError;},set:function set(callback){this._onError=callback;}},{key:'onComplete',get:function get(){return this._onComplete;},set:function set(callback){this._onComplete=callback;}}]);return BaseLoader;}();},{"../utils/exception.js":40}],25:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var ParamSeekHandler=function(){function ParamSeekHandler(paramStart,paramEnd){_classCallCheck(this,ParamSeekHandler);this._startName=paramStart;this._endName=paramEnd;}_createClass(ParamSeekHandler,[{key:'getConfig',value:function getConfig(baseUrl,range){var url=baseUrl;if(range.from!==0||range.to!==-1){var needAnd=true;if(url.indexOf('?')===-1){url+='?';needAnd=false;}if(needAnd){url+='&';}url+=this._startName+'='+range.from.toString();if(range.to!==-1){url+='&'+this._endName+'='+range.to.toString();}}return{url:url,headers:{}};}},{key:'removeURLParameters',value:function removeURLParameters(seekedURL){var baseURL=seekedURL.split('?')[0];var params=undefined;var queryIndex=seekedURL.indexOf('?');if(queryIndex!==-1){params=seekedURL.substring(queryIndex+1);}var resultParams='';if(params!=undefined&&params.length>0){var pairs=params.split('&');for(var i=0;i<pairs.length;i++){var pair=pairs[i].split('=');var requireAnd=i>0;if(pair[0]!==this._startName&&pair[0]!==this._endName){if(requireAnd){resultParams+='&';}resultParams+=pairs[i];}}}return resultParams.length===0?baseURL:baseURL+'?'+resultParams;}}]);return ParamSeekHandler;}();exports.default=ParamSeekHandler;},{}],26:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var RangeSeekHandler=function(){function RangeSeekHandler(zeroStart){_classCallCheck(this,RangeSeekHandler);this._zeroStart=zeroStart||false;}_createClass(RangeSeekHandler,[{key:'getConfig',value:function getConfig(url,range){var headers={};if(range.from!==0||range.to!==-1){var param=void 0;if(range.to!==-1){param='bytes='+range.from.toString()+'-'+range.to.toString();}else{param='bytes='+range.from.toString()+'-';}headers['Range']=param;}else if(this._zeroStart){headers['Range']='bytes=0-';}return{url:url,headers:headers};}},{key:'removeURLParameters',value:function removeURLParameters(seekedURL){return seekedURL;}}]);return RangeSeekHandler;}();exports.default=RangeSeekHandler;},{}],27:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */// Utility class to calculate realtime network I/O speed
var SpeedSampler=function(){function SpeedSampler(){_classCallCheck(this,SpeedSampler);// milliseconds
this._firstCheckpoint=0;this._lastCheckpoint=0;this._intervalBytes=0;this._totalBytes=0;this._lastSecondBytes=0;// compatibility detection
if(self.performance&&self.performance.now){this._now=self.performance.now.bind(self.performance);}else{this._now=Date.now;}}_createClass(SpeedSampler,[{key:"reset",value:function reset(){this._firstCheckpoint=this._lastCheckpoint=0;this._totalBytes=this._intervalBytes=0;this._lastSecondBytes=0;}},{key:"addBytes",value:function addBytes(bytes){if(this._firstCheckpoint===0){this._firstCheckpoint=this._now();this._lastCheckpoint=this._firstCheckpoint;this._intervalBytes+=bytes;this._totalBytes+=bytes;}else if(this._now()-this._lastCheckpoint<1000){this._intervalBytes+=bytes;this._totalBytes+=bytes;}else{// duration >= 1000
this._lastSecondBytes=this._intervalBytes;this._intervalBytes=bytes;this._totalBytes+=bytes;this._lastCheckpoint=this._now();}}},{key:"currentKBps",get:function get(){this.addBytes(0);var durationSeconds=(this._now()-this._lastCheckpoint)/1000;if(durationSeconds==0)durationSeconds=1;return this._intervalBytes/durationSeconds/1024;}},{key:"lastSecondKBps",get:function get(){this.addBytes(0);if(this._lastSecondBytes!==0){return this._lastSecondBytes/1024;}else{// lastSecondBytes === 0
if(this._now()-this._lastCheckpoint>=500){// if time interval since last checkpoint has exceeded 500ms
// the speed is nearly accurate
return this.currentKBps;}else{// We don't know
return 0;}}}},{key:"averageKBps",get:function get(){var durationSeconds=(this._now()-this._firstCheckpoint)/1000;return this._totalBytes/durationSeconds/1024;}}]);return SpeedSampler;}();exports.default=SpeedSampler;},{}],28:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_own_property_descriptor___default()(object,property);if(desc===undefined){var parent=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _loader=_dereq_('./loader.js');var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&((typeof call==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(call))==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(superClass)));}subClass.prototype=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_create___default()(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default.a?__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default()(subClass,superClass):subClass.__proto__=superClass;}/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */// For FLV over WebSocket live stream
var WebSocketLoader=function(_BaseLoader){_inherits(WebSocketLoader,_BaseLoader);_createClass(WebSocketLoader,null,[{key:'isSupported',value:function isSupported(){try{return typeof self.WebSocket!=='undefined';}catch(e){return false;}}}]);function WebSocketLoader(){_classCallCheck(this,WebSocketLoader);var _this=_possibleConstructorReturn(this,(WebSocketLoader.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(WebSocketLoader)).call(this,'websocket-loader'));_this.TAG='WebSocketLoader';_this._needStash=true;_this._ws=null;_this._requestAbort=false;_this._receivedLength=0;return _this;}_createClass(WebSocketLoader,[{key:'destroy',value:function destroy(){if(this._ws){this.abort();}_get(WebSocketLoader.prototype.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(WebSocketLoader.prototype),'destroy',this).call(this);}},{key:'open',value:function open(dataSource){try{var ws=this._ws=new self.WebSocket(dataSource.url);ws.binaryType='arraybuffer';ws.onopen=this._onWebSocketOpen.bind(this);ws.onclose=this._onWebSocketClose.bind(this);ws.onmessage=this._onWebSocketMessage.bind(this);ws.onerror=this._onWebSocketError.bind(this);this._status=_loader.LoaderStatus.kConnecting;}catch(e){this._status=_loader.LoaderStatus.kError;var info={code:e.code,msg:e.message};if(this._onError){this._onError(_loader.LoaderErrors.EXCEPTION,info);}else{throw new _exception.RuntimeException(info.msg);}}}},{key:'abort',value:function abort(){var ws=this._ws;if(ws&&(ws.readyState===0||ws.readyState===1)){// CONNECTING || OPEN
this._requestAbort=true;ws.close();}this._ws=null;this._status=_loader.LoaderStatus.kComplete;}},{key:'_onWebSocketOpen',value:function _onWebSocketOpen(e){this._status=_loader.LoaderStatus.kBuffering;}},{key:'_onWebSocketClose',value:function _onWebSocketClose(e){if(this._requestAbort===true){this._requestAbort=false;return;}this._status=_loader.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(0,this._receivedLength-1);}}},{key:'_onWebSocketMessage',value:function _onWebSocketMessage(e){var _this2=this;if(e.data instanceof ArrayBuffer){this._dispatchArrayBuffer(e.data);}else if(e.data instanceof Blob){var reader=new FileReader();reader.onload=function(){_this2._dispatchArrayBuffer(reader.result);};reader.readAsArrayBuffer(e.data);}else{this._status=_loader.LoaderStatus.kError;var info={code:-1,msg:'Unsupported WebSocket message type: '+e.data.constructor.name};if(this._onError){this._onError(_loader.LoaderErrors.EXCEPTION,info);}else{throw new _exception.RuntimeException(info.msg);}}}},{key:'_dispatchArrayBuffer',value:function _dispatchArrayBuffer(arraybuffer){var chunk=arraybuffer;var byteStart=this._receivedLength;this._receivedLength+=chunk.byteLength;if(this._onDataArrival){this._onDataArrival(chunk,byteStart,this._receivedLength);}}},{key:'_onWebSocketError',value:function _onWebSocketError(e){this._status=_loader.LoaderStatus.kError;var info={code:e.code,msg:e.message};if(this._onError){this._onError(_loader.LoaderErrors.EXCEPTION,info);}else{throw new _exception.RuntimeException(info.msg);}}}]);return WebSocketLoader;}(_loader.BaseLoader);exports.default=WebSocketLoader;},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],29:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator___default.a)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);}:function(obj){return obj&&typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&obj.constructor===__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a&&obj!==__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a.prototype?"symbol":typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);};var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_own_property_descriptor___default()(object,property);if(desc===undefined){var parent=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _loader=_dereq_('./loader.js');var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&((typeof call==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(call))==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(superClass)));}subClass.prototype=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_create___default()(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default.a?__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default()(subClass,superClass):subClass.__proto__=superClass;}/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */// For FireFox browser which supports `xhr.responseType = 'moz-chunked-arraybuffer'`
var MozChunkedLoader=function(_BaseLoader){_inherits(MozChunkedLoader,_BaseLoader);_createClass(MozChunkedLoader,null,[{key:'isSupported',value:function isSupported(){try{var xhr=new XMLHttpRequest();// Firefox 37- requires .open() to be called before setting responseType
xhr.open('GET','https://example.com',true);xhr.responseType='moz-chunked-arraybuffer';return xhr.responseType==='moz-chunked-arraybuffer';}catch(e){_logger2.default.w('MozChunkedLoader',e.message);return false;}}}]);function MozChunkedLoader(seekHandler,config){_classCallCheck(this,MozChunkedLoader);var _this=_possibleConstructorReturn(this,(MozChunkedLoader.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(MozChunkedLoader)).call(this,'xhr-moz-chunked-loader'));_this.TAG='MozChunkedLoader';_this._seekHandler=seekHandler;_this._config=config;_this._needStash=true;_this._xhr=null;_this._requestAbort=false;_this._contentLength=null;_this._receivedLength=0;return _this;}_createClass(MozChunkedLoader,[{key:'destroy',value:function destroy(){if(this.isWorking()){this.abort();}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onloadend=null;this._xhr.onerror=null;this._xhr=null;}_get(MozChunkedLoader.prototype.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(MozChunkedLoader.prototype),'destroy',this).call(this);}},{key:'open',value:function open(dataSource,range){this._dataSource=dataSource;this._range=range;var sourceURL=dataSource.url;if(this._config.reuseRedirectedURL&&dataSource.redirectedURL!=undefined){sourceURL=dataSource.redirectedURL;}var seekConfig=this._seekHandler.getConfig(sourceURL,range);this._requestURL=seekConfig.url;var xhr=this._xhr=new XMLHttpRequest();xhr.open('GET',seekConfig.url,true);xhr.responseType='moz-chunked-arraybuffer';xhr.onreadystatechange=this._onReadyStateChange.bind(this);xhr.onprogress=this._onProgress.bind(this);xhr.onloadend=this._onLoadEnd.bind(this);xhr.onerror=this._onXhrError.bind(this);// cors is auto detected and enabled by xhr
// withCredentials is disabled by default
if(dataSource.withCredentials){xhr.withCredentials=true;}if(_typeof(seekConfig.headers)==='object'){var headers=seekConfig.headers;for(var key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key]);}}}// add additional headers
if(_typeof(this._config.headers)==='object'){var _headers=this._config.headers;for(var _key in _headers){if(_headers.hasOwnProperty(_key)){xhr.setRequestHeader(_key,_headers[_key]);}}}this._status=_loader.LoaderStatus.kConnecting;xhr.send();}},{key:'abort',value:function abort(){this._requestAbort=true;if(this._xhr){this._xhr.abort();}this._status=_loader.LoaderStatus.kComplete;}},{key:'_onReadyStateChange',value:function _onReadyStateChange(e){var xhr=e.target;if(xhr.readyState===2){// HEADERS_RECEIVED
if(xhr.responseURL!=undefined&&xhr.responseURL!==this._requestURL){if(this._onURLRedirect){var redirectedURL=this._seekHandler.removeURLParameters(xhr.responseURL);this._onURLRedirect(redirectedURL);}}if(xhr.status!==0&&(xhr.status<200||xhr.status>299)){this._status=_loader.LoaderStatus.kError;if(this._onError){this._onError(_loader.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:xhr.status,msg:xhr.statusText});}else{throw new _exception.RuntimeException('MozChunkedLoader: Http code invalid, '+xhr.status+' '+xhr.statusText);}}else{this._status=_loader.LoaderStatus.kBuffering;}}}},{key:'_onProgress',value:function _onProgress(e){if(this._status===_loader.LoaderStatus.kError){// Ignore error response
return;}if(this._contentLength===null){if(e.total!==null&&e.total!==0){this._contentLength=e.total;if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength);}}}var chunk=e.target.response;var byteStart=this._range.from+this._receivedLength;this._receivedLength+=chunk.byteLength;if(this._onDataArrival){this._onDataArrival(chunk,byteStart,this._receivedLength);}}},{key:'_onLoadEnd',value:function _onLoadEnd(e){if(this._requestAbort===true){this._requestAbort=false;return;}else if(this._status===_loader.LoaderStatus.kError){return;}this._status=_loader.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._range.from,this._range.from+this._receivedLength-1);}}},{key:'_onXhrError',value:function _onXhrError(e){this._status=_loader.LoaderStatus.kError;var type=0;var info=null;if(this._contentLength&&e.loaded<this._contentLength){type=_loader.LoaderErrors.EARLY_EOF;info={code:-1,msg:'Moz-Chunked stream meet Early-Eof'};}else{type=_loader.LoaderErrors.EXCEPTION;info={code:-1,msg:e.constructor.name+' '+e.type};}if(this._onError){this._onError(type,info);}else{throw new _exception.RuntimeException(info.msg);}}}]);return MozChunkedLoader;}(_loader.BaseLoader);exports.default=MozChunkedLoader;},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],30:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator___default.a)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);}:function(obj){return obj&&typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&obj.constructor===__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a&&obj!==__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a.prototype?"symbol":typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);};var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_own_property_descriptor___default()(object,property);if(desc===undefined){var parent=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _loader=_dereq_('./loader.js');var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&((typeof call==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(call))==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(superClass)));}subClass.prototype=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_create___default()(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default.a?__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default()(subClass,superClass):subClass.__proto__=superClass;}/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *//* Notice: ms-stream may cause IE/Edge browser crash if seek too frequently!!!
             * The browser may crash in wininet.dll. Disable for now.
             *
             * For IE11/Edge browser by microsoft which supports `xhr.responseType = 'ms-stream'`
             * Notice that ms-stream API sucks. The buffer is always expanding along with downloading.
             *
             * We need to abort the xhr if buffer size exceeded limit size (e.g. 16 MiB), then do reconnect.
             * in order to release previous ArrayBuffer to avoid memory leak
             *
             * Otherwise, the ArrayBuffer will increase to a terrible size that equals final file size.
             */var MSStreamLoader=function(_BaseLoader){_inherits(MSStreamLoader,_BaseLoader);_createClass(MSStreamLoader,null,[{key:'isSupported',value:function isSupported(){try{if(typeof self.MSStream==='undefined'||typeof self.MSStreamReader==='undefined'){return false;}var xhr=new XMLHttpRequest();xhr.open('GET','https://example.com',true);xhr.responseType='ms-stream';return xhr.responseType==='ms-stream';}catch(e){_logger2.default.w('MSStreamLoader',e.message);return false;}}}]);function MSStreamLoader(seekHandler,config){_classCallCheck(this,MSStreamLoader);var _this=_possibleConstructorReturn(this,(MSStreamLoader.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(MSStreamLoader)).call(this,'xhr-msstream-loader'));_this.TAG='MSStreamLoader';_this._seekHandler=seekHandler;_this._config=config;_this._needStash=true;_this._xhr=null;_this._reader=null;// MSStreamReader
_this._totalRange=null;_this._currentRange=null;_this._currentRequestURL=null;_this._currentRedirectedURL=null;_this._contentLength=null;_this._receivedLength=0;_this._bufferLimit=16*1024*1024;// 16MB
_this._lastTimeBufferSize=0;_this._isReconnecting=false;return _this;}_createClass(MSStreamLoader,[{key:'destroy',value:function destroy(){if(this.isWorking()){this.abort();}if(this._reader){this._reader.onprogress=null;this._reader.onload=null;this._reader.onerror=null;this._reader=null;}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr=null;}_get(MSStreamLoader.prototype.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(MSStreamLoader.prototype),'destroy',this).call(this);}},{key:'open',value:function open(dataSource,range){this._internalOpen(dataSource,range,false);}},{key:'_internalOpen',value:function _internalOpen(dataSource,range,isSubrange){this._dataSource=dataSource;if(!isSubrange){this._totalRange=range;}else{this._currentRange=range;}var sourceURL=dataSource.url;if(this._config.reuseRedirectedURL){if(this._currentRedirectedURL!=undefined){sourceURL=this._currentRedirectedURL;}else if(dataSource.redirectedURL!=undefined){sourceURL=dataSource.redirectedURL;}}var seekConfig=this._seekHandler.getConfig(sourceURL,range);this._currentRequestURL=seekConfig.url;var reader=this._reader=new self.MSStreamReader();reader.onprogress=this._msrOnProgress.bind(this);reader.onload=this._msrOnLoad.bind(this);reader.onerror=this._msrOnError.bind(this);var xhr=this._xhr=new XMLHttpRequest();xhr.open('GET',seekConfig.url,true);xhr.responseType='ms-stream';xhr.onreadystatechange=this._xhrOnReadyStateChange.bind(this);xhr.onerror=this._xhrOnError.bind(this);if(dataSource.withCredentials){xhr.withCredentials=true;}if(_typeof(seekConfig.headers)==='object'){var headers=seekConfig.headers;for(var key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key]);}}}// add additional headers
if(_typeof(this._config.headers)==='object'){var _headers=this._config.headers;for(var _key in _headers){if(_headers.hasOwnProperty(_key)){xhr.setRequestHeader(_key,_headers[_key]);}}}if(this._isReconnecting){this._isReconnecting=false;}else{this._status=_loader.LoaderStatus.kConnecting;}xhr.send();}},{key:'abort',value:function abort(){this._internalAbort();this._status=_loader.LoaderStatus.kComplete;}},{key:'_internalAbort',value:function _internalAbort(){if(this._reader){if(this._reader.readyState===1){// LOADING
this._reader.abort();}this._reader.onprogress=null;this._reader.onload=null;this._reader.onerror=null;this._reader=null;}if(this._xhr){this._xhr.abort();this._xhr.onreadystatechange=null;this._xhr=null;}}},{key:'_xhrOnReadyStateChange',value:function _xhrOnReadyStateChange(e){var xhr=e.target;if(xhr.readyState===2){// HEADERS_RECEIVED
if(xhr.status>=200&&xhr.status<=299){this._status=_loader.LoaderStatus.kBuffering;if(xhr.responseURL!=undefined){var redirectedURL=this._seekHandler.removeURLParameters(xhr.responseURL);if(xhr.responseURL!==this._currentRequestURL&&redirectedURL!==this._currentRedirectedURL){this._currentRedirectedURL=redirectedURL;if(this._onURLRedirect){this._onURLRedirect(redirectedURL);}}}var lengthHeader=xhr.getResponseHeader('Content-Length');if(lengthHeader!=null&&this._contentLength==null){var length=parseInt(lengthHeader);if(length>0){this._contentLength=length;if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength);}}}}else{this._status=_loader.LoaderStatus.kError;if(this._onError){this._onError(_loader.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:xhr.status,msg:xhr.statusText});}else{throw new _exception.RuntimeException('MSStreamLoader: Http code invalid, '+xhr.status+' '+xhr.statusText);}}}else if(xhr.readyState===3){// LOADING
if(xhr.status>=200&&xhr.status<=299){this._status=_loader.LoaderStatus.kBuffering;var msstream=xhr.response;this._reader.readAsArrayBuffer(msstream);}}}},{key:'_xhrOnError',value:function _xhrOnError(e){this._status=_loader.LoaderStatus.kError;var type=_loader.LoaderErrors.EXCEPTION;var info={code:-1,msg:e.constructor.name+' '+e.type};if(this._onError){this._onError(type,info);}else{throw new _exception.RuntimeException(info.msg);}}},{key:'_msrOnProgress',value:function _msrOnProgress(e){var reader=e.target;var bigbuffer=reader.result;if(bigbuffer==null){// result may be null, workaround for buggy M$
this._doReconnectIfNeeded();return;}var slice=bigbuffer.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=bigbuffer.byteLength;var byteStart=this._totalRange.from+this._receivedLength;this._receivedLength+=slice.byteLength;if(this._onDataArrival){this._onDataArrival(slice,byteStart,this._receivedLength);}if(bigbuffer.byteLength>=this._bufferLimit){_logger2.default.v(this.TAG,'MSStream buffer exceeded max size near '+(byteStart+slice.byteLength)+', reconnecting...');this._doReconnectIfNeeded();}}},{key:'_doReconnectIfNeeded',value:function _doReconnectIfNeeded(){if(this._contentLength==null||this._receivedLength<this._contentLength){this._isReconnecting=true;this._lastTimeBufferSize=0;this._internalAbort();var range={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,range,true);}}},{key:'_msrOnLoad',value:function _msrOnLoad(e){// actually it is onComplete event
this._status=_loader.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1);}}},{key:'_msrOnError',value:function _msrOnError(e){this._status=_loader.LoaderStatus.kError;var type=0;var info=null;if(this._contentLength&&this._receivedLength<this._contentLength){type=_loader.LoaderErrors.EARLY_EOF;info={code:-1,msg:'MSStream meet Early-Eof'};}else{type=_loader.LoaderErrors.EARLY_EOF;info={code:-1,msg:e.constructor.name+' '+e.type};}if(this._onError){this._onError(type,info);}else{throw new _exception.RuntimeException(info.msg);}}}]);return MSStreamLoader;}(_loader.BaseLoader);exports.default=MSStreamLoader;},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],31:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator___default.a)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);}:function(obj){return obj&&typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&obj.constructor===__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a&&obj!==__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a.prototype?"symbol":typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);};var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=__WEBPACK_IMPORTED_MODULE_2_babel_runtime_core_js_object_get_own_property_descriptor___default()(object,property);if(desc===undefined){var parent=__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(object);if(parent===null){return undefined;}else{return get(parent,property,receiver);}}else if("value"in desc){return desc.value;}else{var getter=desc.get;if(getter===undefined){return undefined;}return getter.call(receiver);}};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _speedSampler=_dereq_('./speed-sampler.js');var _speedSampler2=_interopRequireDefault(_speedSampler);var _loader=_dereq_('./loader.js');var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&((typeof call==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(call))==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(superClass)));}subClass.prototype=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_create___default()(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default.a?__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default()(subClass,superClass):subClass.__proto__=superClass;}/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                */// Universal IO Loader, implemented by adding Range header in xhr's request header
var RangeLoader=function(_BaseLoader){_inherits(RangeLoader,_BaseLoader);_createClass(RangeLoader,null,[{key:'isSupported',value:function isSupported(){try{var xhr=new XMLHttpRequest();xhr.open('GET','https://example.com',true);xhr.responseType='arraybuffer';return xhr.responseType==='arraybuffer';}catch(e){_logger2.default.w('RangeLoader',e.message);return false;}}}]);function RangeLoader(seekHandler,config){_classCallCheck(this,RangeLoader);var _this=_possibleConstructorReturn(this,(RangeLoader.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(RangeLoader)).call(this,'xhr-range-loader'));_this.TAG='RangeLoader';_this._seekHandler=seekHandler;_this._config=config;_this._needStash=false;_this._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192];_this._currentChunkSizeKB=384;_this._currentSpeedNormalized=0;_this._zeroSpeedChunkCount=0;_this._xhr=null;_this._speedSampler=new _speedSampler2.default();_this._requestAbort=false;_this._waitForTotalLength=false;_this._totalLengthReceived=false;_this._currentRequestURL=null;_this._currentRedirectedURL=null;_this._currentRequestRange=null;_this._totalLength=null;// size of the entire file
_this._contentLength=null;// Content-Length of entire request range
_this._receivedLength=0;// total received bytes
_this._lastTimeLoaded=0;// received bytes of current request sub-range
return _this;}_createClass(RangeLoader,[{key:'destroy',value:function destroy(){if(this.isWorking()){this.abort();}if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onload=null;this._xhr.onerror=null;this._xhr=null;}_get(RangeLoader.prototype.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(RangeLoader.prototype),'destroy',this).call(this);}},{key:'open',value:function open(dataSource,range){this._dataSource=dataSource;this._range=range;this._status=_loader.LoaderStatus.kConnecting;var useRefTotalLength=false;if(this._dataSource.filesize!=undefined&&this._dataSource.filesize!==0){useRefTotalLength=true;this._totalLength=this._dataSource.filesize;}if(!this._totalLengthReceived&&!useRefTotalLength){// We need total filesize
this._waitForTotalLength=true;this._internalOpen(this._dataSource,{from:0,to:-1});}else{// We have filesize, start loading
this._openSubRange();}}},{key:'_openSubRange',value:function _openSubRange(){var chunkSize=this._currentChunkSizeKB*1024;var from=this._range.from+this._receivedLength;var to=from+chunkSize;if(this._contentLength!=null){if(to-this._range.from>=this._contentLength){to=this._range.from+this._contentLength-1;}}this._currentRequestRange={from:from,to:to};this._internalOpen(this._dataSource,this._currentRequestRange);}},{key:'_internalOpen',value:function _internalOpen(dataSource,range){this._lastTimeLoaded=0;var sourceURL=dataSource.url;if(this._config.reuseRedirectedURL){if(this._currentRedirectedURL!=undefined){sourceURL=this._currentRedirectedURL;}else if(dataSource.redirectedURL!=undefined){sourceURL=dataSource.redirectedURL;}}var seekConfig=this._seekHandler.getConfig(sourceURL,range);this._currentRequestURL=seekConfig.url;var xhr=this._xhr=new XMLHttpRequest();xhr.open('GET',seekConfig.url,true);xhr.responseType='arraybuffer';xhr.onreadystatechange=this._onReadyStateChange.bind(this);xhr.onprogress=this._onProgress.bind(this);xhr.onload=this._onLoad.bind(this);xhr.onerror=this._onXhrError.bind(this);if(dataSource.withCredentials){xhr.withCredentials=true;}if(_typeof(seekConfig.headers)==='object'){var headers=seekConfig.headers;for(var key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key]);}}}// add additional headers
if(_typeof(this._config.headers)==='object'){var _headers=this._config.headers;for(var _key in _headers){if(_headers.hasOwnProperty(_key)){xhr.setRequestHeader(_key,_headers[_key]);}}}xhr.send();}},{key:'abort',value:function abort(){this._requestAbort=true;this._internalAbort();this._status=_loader.LoaderStatus.kComplete;}},{key:'_internalAbort',value:function _internalAbort(){if(this._xhr){this._xhr.onreadystatechange=null;this._xhr.onprogress=null;this._xhr.onload=null;this._xhr.onerror=null;this._xhr.abort();this._xhr=null;}}},{key:'_onReadyStateChange',value:function _onReadyStateChange(e){var xhr=e.target;if(xhr.readyState===2){// HEADERS_RECEIVED
if(xhr.responseURL!=undefined){// if the browser support this property
var redirectedURL=this._seekHandler.removeURLParameters(xhr.responseURL);if(xhr.responseURL!==this._currentRequestURL&&redirectedURL!==this._currentRedirectedURL){this._currentRedirectedURL=redirectedURL;if(this._onURLRedirect){this._onURLRedirect(redirectedURL);}}}if(xhr.status>=200&&xhr.status<=299){if(this._waitForTotalLength){return;}this._status=_loader.LoaderStatus.kBuffering;}else{this._status=_loader.LoaderStatus.kError;if(this._onError){this._onError(_loader.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:xhr.status,msg:xhr.statusText});}else{throw new _exception.RuntimeException('RangeLoader: Http code invalid, '+xhr.status+' '+xhr.statusText);}}}}},{key:'_onProgress',value:function _onProgress(e){if(this._status===_loader.LoaderStatus.kError){// Ignore error response
return;}if(this._contentLength===null){var openNextRange=false;if(this._waitForTotalLength){this._waitForTotalLength=false;this._totalLengthReceived=true;openNextRange=true;var total=e.total;this._internalAbort();if(total!=null&total!==0){this._totalLength=total;}}// calculate currrent request range's contentLength
if(this._range.to===-1){this._contentLength=this._totalLength-this._range.from;}else{// to !== -1
this._contentLength=this._range.to-this._range.from+1;}if(openNextRange){this._openSubRange();return;}if(this._onContentLengthKnown){this._onContentLengthKnown(this._contentLength);}}var delta=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded;this._speedSampler.addBytes(delta);}},{key:'_normalizeSpeed',value:function _normalizeSpeed(input){var list=this._chunkSizeKBList;var last=list.length-1;var mid=0;var lbound=0;var ubound=last;if(input<list[0]){return list[0];}while(lbound<=ubound){mid=lbound+Math.floor((ubound-lbound)/2);if(mid===last||input>=list[mid]&&input<list[mid+1]){return list[mid];}else if(list[mid]<input){lbound=mid+1;}else{ubound=mid-1;}}}},{key:'_onLoad',value:function _onLoad(e){if(this._status===_loader.LoaderStatus.kError){// Ignore error response
return;}if(this._waitForTotalLength){this._waitForTotalLength=false;return;}this._lastTimeLoaded=0;var KBps=this._speedSampler.lastSecondKBps;if(KBps===0){this._zeroSpeedChunkCount++;if(this._zeroSpeedChunkCount>=3){// Try get currentKBps after 3 chunks
KBps=this._speedSampler.currentKBps;}}if(KBps!==0){var normalized=this._normalizeSpeed(KBps);if(this._currentSpeedNormalized!==normalized){this._currentSpeedNormalized=normalized;this._currentChunkSizeKB=normalized;}}var chunk=e.target.response;var byteStart=this._range.from+this._receivedLength;this._receivedLength+=chunk.byteLength;var reportComplete=false;if(this._contentLength!=null&&this._receivedLength<this._contentLength){// continue load next chunk
this._openSubRange();}else{reportComplete=true;}// dispatch received chunk
if(this._onDataArrival){this._onDataArrival(chunk,byteStart,this._receivedLength);}if(reportComplete){this._status=_loader.LoaderStatus.kComplete;if(this._onComplete){this._onComplete(this._range.from,this._range.from+this._receivedLength-1);}}}},{key:'_onXhrError',value:function _onXhrError(e){this._status=_loader.LoaderStatus.kError;var type=0;var info=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength){type=_loader.LoaderErrors.EARLY_EOF;info={code:-1,msg:'RangeLoader meet Early-Eof'};}else{type=_loader.LoaderErrors.EXCEPTION;info={code:-1,msg:e.constructor.name+' '+e.type};}if(this._onError){this._onError(type,info);}else{throw new _exception.RuntimeException(info.msg);}}},{key:'currentSpeed',get:function get(){return this._speedSampler.lastSecondKBps;}}]);return RangeLoader;}(_loader.BaseLoader);exports.default=RangeLoader;},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24,"./speed-sampler.js":27}],32:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator___default.a)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);}:function(obj){return obj&&typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&obj.constructor===__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a&&obj!==__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a.prototype?"symbol":typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _events=_dereq_('events');var _events2=_interopRequireDefault(_events);var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _browser=_dereq_('../utils/browser.js');var _browser2=_interopRequireDefault(_browser);var _playerEvents=_dereq_('./player-events.js');var _playerEvents2=_interopRequireDefault(_playerEvents);var _transmuxer=_dereq_('../core/transmuxer.js');var _transmuxer2=_interopRequireDefault(_transmuxer);var _transmuxingEvents=_dereq_('../core/transmuxing-events.js');var _transmuxingEvents2=_interopRequireDefault(_transmuxingEvents);var _mseController=_dereq_('../core/mse-controller.js');var _mseController2=_interopRequireDefault(_mseController);var _mseEvents=_dereq_('../core/mse-events.js');var _mseEvents2=_interopRequireDefault(_mseEvents);var _playerErrors=_dereq_('./player-errors.js');var _config=_dereq_('../config.js');var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var FlvPlayer=function(){function FlvPlayer(mediaDataSource,config){_classCallCheck(this,FlvPlayer);this.TAG='FlvPlayer';this._type='FlvPlayer';this._emitter=new _events2.default();this._config=(0,_config.createDefaultConfig)();if((typeof config==='undefined'?'undefined':_typeof(config))==='object'){__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()(this._config,config);}if(mediaDataSource.type.toLowerCase()!=='flv'){throw new _exception.InvalidArgumentException('FlvPlayer requires an flv MediaDataSource input!');}if(mediaDataSource.isLive===true){this._config.isLive=true;}this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)};if(self.performance&&self.performance.now){this._now=self.performance.now.bind(self.performance);}else{this._now=Date.now;}this._pendingSeekTime=null;// in seconds
this._requestSetTime=false;this._seekpointRecord=null;this._progressChecker=null;this._mediaDataSource=mediaDataSource;this._mediaElement=null;this._msectl=null;this._transmuxer=null;this._mseSourceOpened=false;this._hasPendingLoad=false;this._receivedCanPlay=false;this._mediaInfo=null;this._statisticsInfo=null;var chromeNeedIDRFix=_browser2.default.chrome&&(_browser2.default.version.major<50||_browser2.default.version.major===50&&_browser2.default.version.build<2661);this._alwaysSeekKeyframe=chromeNeedIDRFix||_browser2.default.msedge||_browser2.default.msie?true:false;if(this._alwaysSeekKeyframe){this._config.accurateSeek=false;}}_createClass(FlvPlayer,[{key:'destroy',value:function destroy(){if(this._progressChecker!=null){window.clearInterval(this._progressChecker);this._progressChecker=null;}if(this._transmuxer){this.unload();}if(this._mediaElement){this.detachMediaElement();}this.e=null;this._mediaDataSource=null;this._emitter.removeAllListeners();this._emitter=null;}},{key:'on',value:function on(event,listener){var _this=this;if(event===_playerEvents2.default.MEDIA_INFO){if(this._mediaInfo!=null){__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this._emitter.emit(_playerEvents2.default.MEDIA_INFO,_this.mediaInfo);});}}else if(event===_playerEvents2.default.STATISTICS_INFO){if(this._statisticsInfo!=null){__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this._emitter.emit(_playerEvents2.default.STATISTICS_INFO,_this.statisticsInfo);});}}this._emitter.addListener(event,listener);}},{key:'off',value:function off(event,listener){this._emitter.removeListener(event,listener);}},{key:'attachMediaElement',value:function attachMediaElement(mediaElement){var _this2=this;this._mediaElement=mediaElement;mediaElement.addEventListener('loadedmetadata',this.e.onvLoadedMetadata);mediaElement.addEventListener('seeking',this.e.onvSeeking);mediaElement.addEventListener('canplay',this.e.onvCanPlay);mediaElement.addEventListener('stalled',this.e.onvStalled);mediaElement.addEventListener('progress',this.e.onvProgress);this._msectl=new _mseController2.default(this._config);this._msectl.on(_mseEvents2.default.UPDATE_END,this._onmseUpdateEnd.bind(this));this._msectl.on(_mseEvents2.default.BUFFER_FULL,this._onmseBufferFull.bind(this));this._msectl.on(_mseEvents2.default.SOURCE_OPEN,function(){_this2._mseSourceOpened=true;if(_this2._hasPendingLoad){_this2._hasPendingLoad=false;_this2.load();}});this._msectl.on(_mseEvents2.default.ERROR,function(info){_this2._emitter.emit(_playerEvents2.default.ERROR,_playerErrors.ErrorTypes.MEDIA_ERROR,_playerErrors.ErrorDetails.MEDIA_MSE_ERROR,info);});this._msectl.attachMediaElement(mediaElement);if(this._pendingSeekTime!=null){try{mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null;}catch(e){// IE11 may throw InvalidStateError if readyState === 0
// We can defer set currentTime operation after loadedmetadata
}}}},{key:'detachMediaElement',value:function detachMediaElement(){if(this._mediaElement){this._msectl.detachMediaElement();this._mediaElement.removeEventListener('loadedmetadata',this.e.onvLoadedMetadata);this._mediaElement.removeEventListener('seeking',this.e.onvSeeking);this._mediaElement.removeEventListener('canplay',this.e.onvCanPlay);this._mediaElement.removeEventListener('stalled',this.e.onvStalled);this._mediaElement.removeEventListener('progress',this.e.onvProgress);this._mediaElement=null;}if(this._msectl){this._msectl.destroy();this._msectl=null;}}},{key:'load',value:function load(){var _this3=this;if(!this._mediaElement){throw new _exception.IllegalStateException('HTMLMediaElement must be attached before load()!');}if(this._transmuxer){throw new _exception.IllegalStateException('FlvPlayer.load() has been called, please call unload() first!');}if(this._hasPendingLoad){return;}if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===false){this._hasPendingLoad=true;return;}if(this._mediaElement.readyState>0){this._requestSetTime=true;// IE11 may throw InvalidStateError if readyState === 0
this._mediaElement.currentTime=0;}this._transmuxer=new _transmuxer2.default(this._mediaDataSource,this._config);this._transmuxer.on(_transmuxingEvents2.default.INIT_SEGMENT,function(type,is){_this3._msectl.appendInitSegment(is);});this._transmuxer.on(_transmuxingEvents2.default.MEDIA_SEGMENT,function(type,ms){_this3._msectl.appendMediaSegment(ms);// lazyLoad check
if(_this3._config.lazyLoad&&!_this3._config.isLive){var currentTime=_this3._mediaElement.currentTime;if(ms.info.endDts>=(currentTime+_this3._config.lazyLoadMaxDuration)*1000){if(_this3._progressChecker==null){_logger2.default.v(_this3.TAG,'Maximum buffering duration exceeded, suspend transmuxing task');_this3._suspendTransmuxer();}}}});this._transmuxer.on(_transmuxingEvents2.default.LOADING_COMPLETE,function(){_this3._msectl.endOfStream();_this3._emitter.emit(_playerEvents2.default.LOADING_COMPLETE);});this._transmuxer.on(_transmuxingEvents2.default.RECOVERED_EARLY_EOF,function(){_this3._emitter.emit(_playerEvents2.default.RECOVERED_EARLY_EOF);});this._transmuxer.on(_transmuxingEvents2.default.IO_ERROR,function(detail,info){_this3._emitter.emit(_playerEvents2.default.ERROR,_playerErrors.ErrorTypes.NETWORK_ERROR,detail,info);});this._transmuxer.on(_transmuxingEvents2.default.DEMUX_ERROR,function(detail,info){_this3._emitter.emit(_playerEvents2.default.ERROR,_playerErrors.ErrorTypes.MEDIA_ERROR,detail,{code:-1,msg:info});});this._transmuxer.on(_transmuxingEvents2.default.MEDIA_INFO,function(mediaInfo){_this3._mediaInfo=mediaInfo;_this3._emitter.emit(_playerEvents2.default.MEDIA_INFO,__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},mediaInfo));});this._transmuxer.on(_transmuxingEvents2.default.METADATA_ARRIVED,function(metadata){_this3._emitter.emit(_playerEvents2.default.METADATA_ARRIVED,metadata);});this._transmuxer.on(_transmuxingEvents2.default.SCRIPTDATA_ARRIVED,function(data){_this3._emitter.emit(_playerEvents2.default.SCRIPTDATA_ARRIVED,data);});this._transmuxer.on(_transmuxingEvents2.default.STATISTICS_INFO,function(statInfo){_this3._statisticsInfo=_this3._fillStatisticsInfo(statInfo);_this3._emitter.emit(_playerEvents2.default.STATISTICS_INFO,__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},_this3._statisticsInfo));});this._transmuxer.on(_transmuxingEvents2.default.RECOMMEND_SEEKPOINT,function(milliseconds){if(_this3._mediaElement&&!_this3._config.accurateSeek){_this3._requestSetTime=true;_this3._mediaElement.currentTime=milliseconds/1000;}});this._transmuxer.open();}},{key:'unload',value:function unload(){if(this._mediaElement){this._mediaElement.pause();}if(this._msectl){this._msectl.seek(0);}if(this._transmuxer){this._transmuxer.close();this._transmuxer.destroy();this._transmuxer=null;}}},{key:'play',value:function play(){return this._mediaElement.play();}},{key:'pause',value:function pause(){this._mediaElement.pause();}},{key:'_fillStatisticsInfo',value:function _fillStatisticsInfo(statInfo){statInfo.playerType=this._type;if(!(this._mediaElement instanceof HTMLVideoElement)){return statInfo;}var hasQualityInfo=true;var decoded=0;var dropped=0;if(this._mediaElement.getVideoPlaybackQuality){var quality=this._mediaElement.getVideoPlaybackQuality();decoded=quality.totalVideoFrames;dropped=quality.droppedVideoFrames;}else if(this._mediaElement.webkitDecodedFrameCount!=undefined){decoded=this._mediaElement.webkitDecodedFrameCount;dropped=this._mediaElement.webkitDroppedFrameCount;}else{hasQualityInfo=false;}if(hasQualityInfo){statInfo.decodedFrames=decoded;statInfo.droppedFrames=dropped;}return statInfo;}},{key:'_onmseUpdateEnd',value:function _onmseUpdateEnd(){if(!this._config.lazyLoad||this._config.isLive){return;}var buffered=this._mediaElement.buffered;var currentTime=this._mediaElement.currentTime;var currentRangeStart=0;var currentRangeEnd=0;for(var i=0;i<buffered.length;i++){var start=buffered.start(i);var end=buffered.end(i);if(start<=currentTime&&currentTime<end){currentRangeStart=start;currentRangeEnd=end;break;}}if(currentRangeEnd>=currentTime+this._config.lazyLoadMaxDuration&&this._progressChecker==null){_logger2.default.v(this.TAG,'Maximum buffering duration exceeded, suspend transmuxing task');this._suspendTransmuxer();}}},{key:'_onmseBufferFull',value:function _onmseBufferFull(){_logger2.default.v(this.TAG,'MSE SourceBuffer is full, suspend transmuxing task');if(this._progressChecker==null){this._suspendTransmuxer();}}},{key:'_suspendTransmuxer',value:function _suspendTransmuxer(){if(this._transmuxer){this._transmuxer.pause();if(this._progressChecker==null){this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1000);}}}},{key:'_checkProgressAndResume',value:function _checkProgressAndResume(){var currentTime=this._mediaElement.currentTime;var buffered=this._mediaElement.buffered;var needResume=false;for(var i=0;i<buffered.length;i++){var from=buffered.start(i);var to=buffered.end(i);if(currentTime>=from&&currentTime<to){if(currentTime>=to-this._config.lazyLoadRecoverDuration){needResume=true;}break;}}if(needResume){window.clearInterval(this._progressChecker);this._progressChecker=null;if(needResume){_logger2.default.v(this.TAG,'Continue loading from paused position');this._transmuxer.resume();}}}},{key:'_isTimepointBuffered',value:function _isTimepointBuffered(seconds){var buffered=this._mediaElement.buffered;for(var i=0;i<buffered.length;i++){var from=buffered.start(i);var to=buffered.end(i);if(seconds>=from&&seconds<to){return true;}}return false;}},{key:'_internalSeek',value:function _internalSeek(seconds){var directSeek=this._isTimepointBuffered(seconds);var directSeekBegin=false;var directSeekBeginTime=0;if(seconds<1.0&&this._mediaElement.buffered.length>0){var videoBeginTime=this._mediaElement.buffered.start(0);if(videoBeginTime<1.0&&seconds<videoBeginTime||_browser2.default.safari){directSeekBegin=true;// also workaround for Safari: Seek to 0 may cause video stuck, use 0.1 to avoid
directSeekBeginTime=_browser2.default.safari?0.1:videoBeginTime;}}if(directSeekBegin){// seek to video begin, set currentTime directly if beginPTS buffered
this._requestSetTime=true;this._mediaElement.currentTime=directSeekBeginTime;}else if(directSeek){// buffered position
if(!this._alwaysSeekKeyframe){this._requestSetTime=true;this._mediaElement.currentTime=seconds;}else{var idr=this._msectl.getNearestKeyframe(Math.floor(seconds*1000));this._requestSetTime=true;if(idr!=null){this._mediaElement.currentTime=idr.dts/1000;}else{this._mediaElement.currentTime=seconds;}}if(this._progressChecker!=null){this._checkProgressAndResume();}}else{if(this._progressChecker!=null){window.clearInterval(this._progressChecker);this._progressChecker=null;}this._msectl.seek(seconds);this._transmuxer.seek(Math.floor(seconds*1000));// in milliseconds
// no need to set mediaElement.currentTime if non-accurateSeek,
// just wait for the recommend_seekpoint callback
if(this._config.accurateSeek){this._requestSetTime=true;this._mediaElement.currentTime=seconds;}}}},{key:'_checkAndApplyUnbufferedSeekpoint',value:function _checkAndApplyUnbufferedSeekpoint(){if(this._seekpointRecord){if(this._seekpointRecord.recordTime<=this._now()-100){var target=this._mediaElement.currentTime;this._seekpointRecord=null;if(!this._isTimepointBuffered(target)){if(this._progressChecker!=null){window.clearTimeout(this._progressChecker);this._progressChecker=null;}// .currentTime is consists with .buffered timestamp
// Chrome/Edge use DTS, while FireFox/Safari use PTS
this._msectl.seek(target);this._transmuxer.seek(Math.floor(target*1000));// set currentTime if accurateSeek, or wait for recommend_seekpoint callback
if(this._config.accurateSeek){this._requestSetTime=true;this._mediaElement.currentTime=target;}}}else{window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50);}}}},{key:'_checkAndResumeStuckPlayback',value:function _checkAndResumeStuckPlayback(stalled){var media=this._mediaElement;if(stalled||!this._receivedCanPlay||media.readyState<2){// HAVE_CURRENT_DATA
var buffered=media.buffered;if(buffered.length>0&&media.currentTime<buffered.start(0)){_logger2.default.w(this.TAG,'Playback seems stuck at '+media.currentTime+', seek to '+buffered.start(0));this._requestSetTime=true;this._mediaElement.currentTime=buffered.start(0);this._mediaElement.removeEventListener('progress',this.e.onvProgress);}}else{// Playback didn't stuck, remove progress event listener
this._mediaElement.removeEventListener('progress',this.e.onvProgress);}}},{key:'_onvLoadedMetadata',value:function _onvLoadedMetadata(e){if(this._pendingSeekTime!=null){this._mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null;}}},{key:'_onvSeeking',value:function _onvSeeking(e){// handle seeking request from browser's progress bar
var target=this._mediaElement.currentTime;var buffered=this._mediaElement.buffered;if(this._requestSetTime){this._requestSetTime=false;return;}if(target<1.0&&buffered.length>0){// seek to video begin, set currentTime directly if beginPTS buffered
var videoBeginTime=buffered.start(0);if(videoBeginTime<1.0&&target<videoBeginTime||_browser2.default.safari){this._requestSetTime=true;// also workaround for Safari: Seek to 0 may cause video stuck, use 0.1 to avoid
this._mediaElement.currentTime=_browser2.default.safari?0.1:videoBeginTime;return;}}if(this._isTimepointBuffered(target)){if(this._alwaysSeekKeyframe){var idr=this._msectl.getNearestKeyframe(Math.floor(target*1000));if(idr!=null){this._requestSetTime=true;this._mediaElement.currentTime=idr.dts/1000;}}if(this._progressChecker!=null){this._checkProgressAndResume();}return;}this._seekpointRecord={seekPoint:target,recordTime:this._now()};window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50);}},{key:'_onvCanPlay',value:function _onvCanPlay(e){this._receivedCanPlay=true;this._mediaElement.removeEventListener('canplay',this.e.onvCanPlay);}},{key:'_onvStalled',value:function _onvStalled(e){this._checkAndResumeStuckPlayback(true);}},{key:'_onvProgress',value:function _onvProgress(e){this._checkAndResumeStuckPlayback();}},{key:'type',get:function get(){return this._type;}},{key:'buffered',get:function get(){return this._mediaElement.buffered;}},{key:'duration',get:function get(){return this._mediaElement.duration;}},{key:'volume',get:function get(){return this._mediaElement.volume;},set:function set(value){this._mediaElement.volume=value;}},{key:'muted',get:function get(){return this._mediaElement.muted;},set:function set(muted){this._mediaElement.muted=muted;}},{key:'currentTime',get:function get(){if(this._mediaElement){return this._mediaElement.currentTime;}return 0;},set:function set(seconds){if(this._mediaElement){this._internalSeek(seconds);}else{this._pendingSeekTime=seconds;}}},{key:'mediaInfo',get:function get(){return __WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},this._mediaInfo);}},{key:'statisticsInfo',get:function get(){if(this._statisticsInfo==null){this._statisticsInfo={};}this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo);return __WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()({},this._statisticsInfo);}}]);return FlvPlayer;}();exports.default=FlvPlayer;},{"../config.js":5,"../core/mse-controller.js":9,"../core/mse-events.js":10,"../core/transmuxer.js":11,"../core/transmuxing-events.js":13,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./player-errors.js":34,"./player-events.js":35,"events":2}],33:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(__WEBPACK_IMPORTED_MODULE_3_babel_runtime_core_js_symbol_iterator___default.a)==="symbol"?function(obj){return typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);}:function(obj){return obj&&typeof __WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a==="function"&&obj.constructor===__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a&&obj!==__WEBPACK_IMPORTED_MODULE_4_babel_runtime_core_js_symbol___default.a.prototype?"symbol":typeof obj==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(obj);};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _events=_dereq_('events');var _events2=_interopRequireDefault(_events);var _playerEvents=_dereq_('./player-events.js');var _playerEvents2=_interopRequireDefault(_playerEvents);var _config=_dereq_('../config.js');var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}// Player wrapper for browser's native player (HTMLVideoElement) without MediaSource src. 
var NativePlayer=function(){function NativePlayer(mediaDataSource,config){_classCallCheck(this,NativePlayer);this.TAG='NativePlayer';this._type='NativePlayer';this._emitter=new _events2.default();this._config=(0,_config.createDefaultConfig)();if((typeof config==='undefined'?'undefined':_typeof(config))==='object'){__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()(this._config,config);}if(mediaDataSource.type.toLowerCase()==='flv'){throw new _exception.InvalidArgumentException('NativePlayer does\'t support flv MediaDataSource input!');}if(mediaDataSource.hasOwnProperty('segments')){throw new _exception.InvalidArgumentException('NativePlayer('+mediaDataSource.type+') doesn\'t support multipart playback!');}this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)};this._pendingSeekTime=null;this._statisticsReporter=null;this._mediaDataSource=mediaDataSource;this._mediaElement=null;}_createClass(NativePlayer,[{key:'destroy',value:function destroy(){if(this._mediaElement){this.unload();this.detachMediaElement();}this.e=null;this._mediaDataSource=null;this._emitter.removeAllListeners();this._emitter=null;}},{key:'on',value:function on(event,listener){var _this=this;if(event===_playerEvents2.default.MEDIA_INFO){if(this._mediaElement!=null&&this._mediaElement.readyState!==0){// HAVE_NOTHING
__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this._emitter.emit(_playerEvents2.default.MEDIA_INFO,_this.mediaInfo);});}}else if(event===_playerEvents2.default.STATISTICS_INFO){if(this._mediaElement!=null&&this._mediaElement.readyState!==0){__WEBPACK_IMPORTED_MODULE_6_babel_runtime_core_js_promise___default.a.resolve().then(function(){_this._emitter.emit(_playerEvents2.default.STATISTICS_INFO,_this.statisticsInfo);});}}this._emitter.addListener(event,listener);}},{key:'off',value:function off(event,listener){this._emitter.removeListener(event,listener);}},{key:'attachMediaElement',value:function attachMediaElement(mediaElement){this._mediaElement=mediaElement;mediaElement.addEventListener('loadedmetadata',this.e.onvLoadedMetadata);if(this._pendingSeekTime!=null){try{mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null;}catch(e){// IE11 may throw InvalidStateError if readyState === 0
// Defer set currentTime operation after loadedmetadata
}}}},{key:'detachMediaElement',value:function detachMediaElement(){if(this._mediaElement){this._mediaElement.src='';this._mediaElement.removeAttribute('src');this._mediaElement.removeEventListener('loadedmetadata',this.e.onvLoadedMetadata);this._mediaElement=null;}if(this._statisticsReporter!=null){window.clearInterval(this._statisticsReporter);this._statisticsReporter=null;}}},{key:'load',value:function load(){if(!this._mediaElement){throw new _exception.IllegalStateException('HTMLMediaElement must be attached before load()!');}this._mediaElement.src=this._mediaDataSource.url;if(this._mediaElement.readyState>0){this._mediaElement.currentTime=0;}this._mediaElement.preload='auto';this._mediaElement.load();this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval);}},{key:'unload',value:function unload(){if(this._mediaElement){this._mediaElement.src='';this._mediaElement.removeAttribute('src');}if(this._statisticsReporter!=null){window.clearInterval(this._statisticsReporter);this._statisticsReporter=null;}}},{key:'play',value:function play(){return this._mediaElement.play();}},{key:'pause',value:function pause(){this._mediaElement.pause();}},{key:'_onvLoadedMetadata',value:function _onvLoadedMetadata(e){if(this._pendingSeekTime!=null){this._mediaElement.currentTime=this._pendingSeekTime;this._pendingSeekTime=null;}this._emitter.emit(_playerEvents2.default.MEDIA_INFO,this.mediaInfo);}},{key:'_reportStatisticsInfo',value:function _reportStatisticsInfo(){this._emitter.emit(_playerEvents2.default.STATISTICS_INFO,this.statisticsInfo);}},{key:'type',get:function get(){return this._type;}},{key:'buffered',get:function get(){return this._mediaElement.buffered;}},{key:'duration',get:function get(){return this._mediaElement.duration;}},{key:'volume',get:function get(){return this._mediaElement.volume;},set:function set(value){this._mediaElement.volume=value;}},{key:'muted',get:function get(){return this._mediaElement.muted;},set:function set(muted){this._mediaElement.muted=muted;}},{key:'currentTime',get:function get(){if(this._mediaElement){return this._mediaElement.currentTime;}return 0;},set:function set(seconds){if(this._mediaElement){this._mediaElement.currentTime=seconds;}else{this._pendingSeekTime=seconds;}}},{key:'mediaInfo',get:function get(){var mediaPrefix=this._mediaElement instanceof HTMLAudioElement?'audio/':'video/';var info={mimeType:mediaPrefix+this._mediaDataSource.type};if(this._mediaElement){info.duration=Math.floor(this._mediaElement.duration*1000);if(this._mediaElement instanceof HTMLVideoElement){info.width=this._mediaElement.videoWidth;info.height=this._mediaElement.videoHeight;}}return info;}},{key:'statisticsInfo',get:function get(){var info={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement)){return info;}var hasQualityInfo=true;var decoded=0;var dropped=0;if(this._mediaElement.getVideoPlaybackQuality){var quality=this._mediaElement.getVideoPlaybackQuality();decoded=quality.totalVideoFrames;dropped=quality.droppedVideoFrames;}else if(this._mediaElement.webkitDecodedFrameCount!=undefined){decoded=this._mediaElement.webkitDecodedFrameCount;dropped=this._mediaElement.webkitDroppedFrameCount;}else{hasQualityInfo=false;}if(hasQualityInfo){info.decodedFrames=decoded;info.droppedFrames=dropped;}return info;}}]);return NativePlayer;}();exports.default=NativePlayer;},{"../config.js":5,"../utils/exception.js":40,"./player-events.js":35,"events":2}],34:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});exports.ErrorDetails=exports.ErrorTypes=undefined;var _loader=_dereq_('../io/loader.js');var _demuxErrors=_dereq_('../demux/demux-errors.js');var _demuxErrors2=_interopRequireDefault(_demuxErrors);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var ErrorTypes=exports.ErrorTypes={NETWORK_ERROR:'NetworkError',MEDIA_ERROR:'MediaError',OTHER_ERROR:'OtherError'};var ErrorDetails=exports.ErrorDetails={NETWORK_EXCEPTION:_loader.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:_loader.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:_loader.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:_loader.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:'MediaMSEError',MEDIA_FORMAT_ERROR:_demuxErrors2.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:_demuxErrors2.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:_demuxErrors2.default.CODEC_UNSUPPORTED};},{"../demux/demux-errors.js":16,"../io/loader.js":24}],35:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var PlayerEvents={ERROR:'error',LOADING_COMPLETE:'loading_complete',RECOVERED_EARLY_EOF:'recovered_early_eof',MEDIA_INFO:'media_info',METADATA_ARRIVED:'metadata_arrived',SCRIPTDATA_ARRIVED:'scriptdata_arrived',STATISTICS_INFO:'statistics_info'};exports.default=PlayerEvents;},{}],36:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * This file is modified from dailymotion's hls.js library (hls.js/src/helper/aac.js)
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var AAC=function(){function AAC(){_classCallCheck(this,AAC);}_createClass(AAC,null,[{key:'getSilentFrame',value:function getSilentFrame(codec,channelCount){if(codec==='mp4a.40.2'){// handle LC-AAC
if(channelCount===1){return new Uint8Array([0x00,0xc8,0x00,0x80,0x23,0x80]);}else if(channelCount===2){return new Uint8Array([0x21,0x00,0x49,0x90,0x02,0x19,0x00,0x23,0x80]);}else if(channelCount===3){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x8e]);}else if(channelCount===4){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x80,0x2c,0x80,0x08,0x02,0x38]);}else if(channelCount===5){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x82,0x30,0x04,0x99,0x00,0x21,0x90,0x02,0x38]);}else if(channelCount===6){return new Uint8Array([0x00,0xc8,0x00,0x80,0x20,0x84,0x01,0x26,0x40,0x08,0x64,0x00,0x82,0x30,0x04,0x99,0x00,0x21,0x90,0x02,0x00,0xb2,0x00,0x20,0x08,0xe0]);}}else{// handle HE-AAC (mp4a.40.5 / mp4a.40.29)
if(channelCount===1){// ffmpeg -y -f lavfi -i "aevalsrc=0:d=0.05" -c:a libfdk_aac -profile:a aac_he -b:a 4k output.aac && hexdump -v -e '16/1 "0x%x," "\n"' -v output.aac
return new Uint8Array([0x1,0x40,0x22,0x80,0xa3,0x4e,0xe6,0x80,0xba,0x8,0x0,0x0,0x0,0x1c,0x6,0xf1,0xc1,0xa,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5e]);}else if(channelCount===2){// ffmpeg -y -f lavfi -i "aevalsrc=0|0:d=0.05" -c:a libfdk_aac -profile:a aac_he_v2 -b:a 4k output.aac && hexdump -v -e '16/1 "0x%x," "\n"' -v output.aac
return new Uint8Array([0x1,0x40,0x22,0x80,0xa3,0x5e,0xe6,0x80,0xba,0x8,0x0,0x0,0x0,0x0,0x95,0x0,0x6,0xf1,0xa1,0xa,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5e]);}else if(channelCount===3){// ffmpeg -y -f lavfi -i "aevalsrc=0|0|0:d=0.05" -c:a libfdk_aac -profile:a aac_he_v2 -b:a 4k output.aac && hexdump -v -e '16/1 "0x%x," "\n"' -v output.aac
return new Uint8Array([0x1,0x40,0x22,0x80,0xa3,0x5e,0xe6,0x80,0xba,0x8,0x0,0x0,0x0,0x0,0x95,0x0,0x6,0xf1,0xa1,0xa,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5a,0x5e]);}}return null;}}]);return AAC;}();exports.default=AAC;},{}],37:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * This file is derived from dailymotion's hls.js library (hls.js/src/remux/mp4-generator.js)
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             *///  MP4 boxes generator for ISO BMFF (ISO Base Media File Format, defined in ISO/IEC 14496-12)
var MP4=function(){function MP4(){_classCallCheck(this,MP4);}_createClass(MP4,null,[{key:'init',value:function init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],'.mp3':[]};for(var name in MP4.types){if(MP4.types.hasOwnProperty(name)){MP4.types[name]=[name.charCodeAt(0),name.charCodeAt(1),name.charCodeAt(2),name.charCodeAt(3)];}}var constants=MP4.constants={};constants.FTYP=new Uint8Array([0x69,0x73,0x6F,0x6D,// major_brand: isom
0x0,0x0,0x0,0x1,// minor_version: 0x01
0x69,0x73,0x6F,0x6D,// isom
0x61,0x76,0x63,0x31// avc1
]);constants.STSD_PREFIX=new Uint8Array([0x00,0x00,0x00,0x00,// version(0) + flags
0x00,0x00,0x00,0x01// entry_count
]);constants.STTS=new Uint8Array([0x00,0x00,0x00,0x00,// version(0) + flags
0x00,0x00,0x00,0x00// entry_count
]);constants.STSC=constants.STCO=constants.STTS;constants.STSZ=new Uint8Array([0x00,0x00,0x00,0x00,// version(0) + flags
0x00,0x00,0x00,0x00,// sample_size
0x00,0x00,0x00,0x00// sample_count
]);constants.HDLR_VIDEO=new Uint8Array([0x00,0x00,0x00,0x00,// version(0) + flags
0x00,0x00,0x00,0x00,// pre_defined
0x76,0x69,0x64,0x65,// handler_type: 'vide'
0x00,0x00,0x00,0x00,// reserved: 3 * 4 bytes
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x56,0x69,0x64,0x65,0x6F,0x48,0x61,0x6E,0x64,0x6C,0x65,0x72,0x00// name: VideoHandler
]);constants.HDLR_AUDIO=new Uint8Array([0x00,0x00,0x00,0x00,// version(0) + flags
0x00,0x00,0x00,0x00,// pre_defined
0x73,0x6F,0x75,0x6E,// handler_type: 'soun'
0x00,0x00,0x00,0x00,// reserved: 3 * 4 bytes
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x53,0x6F,0x75,0x6E,0x64,0x48,0x61,0x6E,0x64,0x6C,0x65,0x72,0x00// name: SoundHandler
]);constants.DREF=new Uint8Array([0x00,0x00,0x00,0x00,// version(0) + flags
0x00,0x00,0x00,0x01,// entry_count
0x00,0x00,0x00,0x0C,// entry_size
0x75,0x72,0x6C,0x20,// type 'url '
0x00,0x00,0x00,0x01// version(0) + flags
]);// Sound media header
constants.SMHD=new Uint8Array([0x00,0x00,0x00,0x00,// version(0) + flags
0x00,0x00,0x00,0x00// balance(2) + reserved(2)
]);// video media header
constants.VMHD=new Uint8Array([0x00,0x00,0x00,0x01,// version(0) + flags
0x00,0x00,// graphicsmode: 2 bytes
0x00,0x00,0x00,0x00,// opcolor: 3 * 2 bytes
0x00,0x00]);}// Generate a box
},{key:'box',value:function box(type){var size=8;var result=null;var datas=Array.prototype.slice.call(arguments,1);var arrayCount=datas.length;for(var i=0;i<arrayCount;i++){size+=datas[i].byteLength;}result=new Uint8Array(size);result[0]=size>>>24&0xFF;// size
result[1]=size>>>16&0xFF;result[2]=size>>>8&0xFF;result[3]=size&0xFF;result.set(type,4);// type
var offset=8;for(var _i=0;_i<arrayCount;_i++){// data body
result.set(datas[_i],offset);offset+=datas[_i].byteLength;}return result;}// emit ftyp & moov
},{key:'generateInitSegment',value:function generateInitSegment(meta){var ftyp=MP4.box(MP4.types.ftyp,MP4.constants.FTYP);var moov=MP4.moov(meta);var result=new Uint8Array(ftyp.byteLength+moov.byteLength);result.set(ftyp,0);result.set(moov,ftyp.byteLength);return result;}// Movie metadata box
},{key:'moov',value:function moov(meta){var mvhd=MP4.mvhd(meta.timescale,meta.duration);var trak=MP4.trak(meta);var mvex=MP4.mvex(meta);return MP4.box(MP4.types.moov,mvhd,trak,mvex);}// Movie header box
},{key:'mvhd',value:function mvhd(timescale,duration){return MP4.box(MP4.types.mvhd,new Uint8Array([0x00,0x00,0x00,0x00,// version(0) + flags
0x00,0x00,0x00,0x00,// creation_time
0x00,0x00,0x00,0x00,// modification_time
timescale>>>24&0xFF,// timescale: 4 bytes
timescale>>>16&0xFF,timescale>>>8&0xFF,timescale&0xFF,duration>>>24&0xFF,// duration: 4 bytes
duration>>>16&0xFF,duration>>>8&0xFF,duration&0xFF,0x00,0x01,0x00,0x00,// Preferred rate: 1.0
0x01,0x00,0x00,0x00,// PreferredVolume(1.0, 2bytes) + reserved(2bytes)
0x00,0x00,0x00,0x00,// reserved: 4 + 4 bytes
0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,// ----begin composition matrix----
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,// ----end composition matrix----
0x00,0x00,0x00,0x00,// ----begin pre_defined 6 * 4 bytes----
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// ----end pre_defined 6 * 4 bytes----
0xFF,0xFF,0xFF,0xFF// next_track_ID
]));}// Track box
},{key:'trak',value:function trak(meta){return MP4.box(MP4.types.trak,MP4.tkhd(meta),MP4.mdia(meta));}// Track header box
},{key:'tkhd',value:function tkhd(meta){var trackId=meta.id,duration=meta.duration;var width=meta.presentWidth,height=meta.presentHeight;return MP4.box(MP4.types.tkhd,new Uint8Array([0x00,0x00,0x00,0x07,// version(0) + flags
0x00,0x00,0x00,0x00,// creation_time
0x00,0x00,0x00,0x00,// modification_time
trackId>>>24&0xFF,// track_ID: 4 bytes
trackId>>>16&0xFF,trackId>>>8&0xFF,trackId&0xFF,0x00,0x00,0x00,0x00,// reserved: 4 bytes
duration>>>24&0xFF,// duration: 4 bytes
duration>>>16&0xFF,duration>>>8&0xFF,duration&0xFF,0x00,0x00,0x00,0x00,// reserved: 2 * 4 bytes
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,// layer(2bytes) + alternate_group(2bytes)
0x00,0x00,0x00,0x00,// volume(2bytes) + reserved(2bytes)
0x00,0x01,0x00,0x00,// ----begin composition matrix----
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00,// ----end composition matrix----
width>>>8&0xFF,// width and height
width&0xFF,0x00,0x00,height>>>8&0xFF,height&0xFF,0x00,0x00]));}// Media Box
},{key:'mdia',value:function mdia(meta){return MP4.box(MP4.types.mdia,MP4.mdhd(meta),MP4.hdlr(meta),MP4.minf(meta));}// Media header box
},{key:'mdhd',value:function mdhd(meta){var timescale=meta.timescale;var duration=meta.duration;return MP4.box(MP4.types.mdhd,new Uint8Array([0x00,0x00,0x00,0x00,// version(0) + flags
0x00,0x00,0x00,0x00,// creation_time
0x00,0x00,0x00,0x00,// modification_time
timescale>>>24&0xFF,// timescale: 4 bytes
timescale>>>16&0xFF,timescale>>>8&0xFF,timescale&0xFF,duration>>>24&0xFF,// duration: 4 bytes
duration>>>16&0xFF,duration>>>8&0xFF,duration&0xFF,0x55,0xC4,// language: und (undetermined)
0x00,0x00// pre_defined = 0
]));}// Media handler reference box
},{key:'hdlr',value:function hdlr(meta){var data=null;if(meta.type==='audio'){data=MP4.constants.HDLR_AUDIO;}else{data=MP4.constants.HDLR_VIDEO;}return MP4.box(MP4.types.hdlr,data);}// Media infomation box
},{key:'minf',value:function minf(meta){var xmhd=null;if(meta.type==='audio'){xmhd=MP4.box(MP4.types.smhd,MP4.constants.SMHD);}else{xmhd=MP4.box(MP4.types.vmhd,MP4.constants.VMHD);}return MP4.box(MP4.types.minf,xmhd,MP4.dinf(),MP4.stbl(meta));}// Data infomation box
},{key:'dinf',value:function dinf(){var result=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,MP4.constants.DREF));return result;}// Sample table box
},{key:'stbl',value:function stbl(meta){var result=MP4.box(MP4.types.stbl,// type: stbl
MP4.stsd(meta),// Sample Description Table
MP4.box(MP4.types.stts,MP4.constants.STTS),// Time-To-Sample
MP4.box(MP4.types.stsc,MP4.constants.STSC),// Sample-To-Chunk
MP4.box(MP4.types.stsz,MP4.constants.STSZ),// Sample size
MP4.box(MP4.types.stco,MP4.constants.STCO// Chunk offset
));return result;}// Sample description box
},{key:'stsd',value:function stsd(meta){if(meta.type==='audio'){if(meta.codec==='mp3'){return MP4.box(MP4.types.stsd,MP4.constants.STSD_PREFIX,MP4.mp3(meta));}// else: aac -> mp4a
return MP4.box(MP4.types.stsd,MP4.constants.STSD_PREFIX,MP4.mp4a(meta));}else{return MP4.box(MP4.types.stsd,MP4.constants.STSD_PREFIX,MP4.avc1(meta));}}},{key:'mp3',value:function mp3(meta){var channelCount=meta.channelCount;var sampleRate=meta.audioSampleRate;var data=new Uint8Array([0x00,0x00,0x00,0x00,// reserved(4)
0x00,0x00,0x00,0x01,// reserved(2) + data_reference_index(2)
0x00,0x00,0x00,0x00,// reserved: 2 * 4 bytes
0x00,0x00,0x00,0x00,0x00,channelCount,// channelCount(2)
0x00,0x10,// sampleSize(2)
0x00,0x00,0x00,0x00,// reserved(4)
sampleRate>>>8&0xFF,// Audio sample rate
sampleRate&0xFF,0x00,0x00]);return MP4.box(MP4.types['.mp3'],data);}},{key:'mp4a',value:function mp4a(meta){var channelCount=meta.channelCount;var sampleRate=meta.audioSampleRate;var data=new Uint8Array([0x00,0x00,0x00,0x00,// reserved(4)
0x00,0x00,0x00,0x01,// reserved(2) + data_reference_index(2)
0x00,0x00,0x00,0x00,// reserved: 2 * 4 bytes
0x00,0x00,0x00,0x00,0x00,channelCount,// channelCount(2)
0x00,0x10,// sampleSize(2)
0x00,0x00,0x00,0x00,// reserved(4)
sampleRate>>>8&0xFF,// Audio sample rate
sampleRate&0xFF,0x00,0x00]);return MP4.box(MP4.types.mp4a,data,MP4.esds(meta));}},{key:'esds',value:function esds(meta){var config=meta.config||[];var configSize=config.length;var data=new Uint8Array([0x00,0x00,0x00,0x00,// version 0 + flags
0x03,// descriptor_type
0x17+configSize,// length3
0x00,0x01,// es_id
0x00,// stream_priority
0x04,// descriptor_type
0x0F+configSize,// length
0x40,// codec: mpeg4_audio
0x15,// stream_type: Audio
0x00,0x00,0x00,// buffer_size
0x00,0x00,0x00,0x00,// maxBitrate
0x00,0x00,0x00,0x00,// avgBitrate
0x05// descriptor_type
].concat([configSize]).concat(config).concat([0x06,0x01,0x02// GASpecificConfig
]));return MP4.box(MP4.types.esds,data);}},{key:'avc1',value:function avc1(meta){var avcc=meta.avcc;var width=meta.codecWidth,height=meta.codecHeight;var data=new Uint8Array([0x00,0x00,0x00,0x00,// reserved(4)
0x00,0x00,0x00,0x01,// reserved(2) + data_reference_index(2)
0x00,0x00,0x00,0x00,// pre_defined(2) + reserved(2)
0x00,0x00,0x00,0x00,// pre_defined: 3 * 4 bytes
0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,width>>>8&0xFF,// width: 2 bytes
width&0xFF,height>>>8&0xFF,// height: 2 bytes
height&0xFF,0x00,0x48,0x00,0x00,// horizresolution: 4 bytes
0x00,0x48,0x00,0x00,// vertresolution: 4 bytes
0x00,0x00,0x00,0x00,// reserved: 4 bytes
0x00,0x01,// frame_count
0x0A,// strlen
0x78,0x71,0x71,0x2F,// compressorname: 32 bytes
0x66,0x6C,0x76,0x2E,0x6A,0x73,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x18,// depth
0xFF,0xFF// pre_defined = -1
]);return MP4.box(MP4.types.avc1,data,MP4.box(MP4.types.avcC,avcc));}// Movie Extends box
},{key:'mvex',value:function mvex(meta){return MP4.box(MP4.types.mvex,MP4.trex(meta));}// Track Extends box
},{key:'trex',value:function trex(meta){var trackId=meta.id;var data=new Uint8Array([0x00,0x00,0x00,0x00,// version(0) + flags
trackId>>>24&0xFF,// track_ID
trackId>>>16&0xFF,trackId>>>8&0xFF,trackId&0xFF,0x00,0x00,0x00,0x01,// default_sample_description_index
0x00,0x00,0x00,0x00,// default_sample_duration
0x00,0x00,0x00,0x00,// default_sample_size
0x00,0x01,0x00,0x01// default_sample_flags
]);return MP4.box(MP4.types.trex,data);}// Movie fragment box
},{key:'moof',value:function moof(track,baseMediaDecodeTime){return MP4.box(MP4.types.moof,MP4.mfhd(track.sequenceNumber),MP4.traf(track,baseMediaDecodeTime));}},{key:'mfhd',value:function mfhd(sequenceNumber){var data=new Uint8Array([0x00,0x00,0x00,0x00,sequenceNumber>>>24&0xFF,// sequence_number: int32
sequenceNumber>>>16&0xFF,sequenceNumber>>>8&0xFF,sequenceNumber&0xFF]);return MP4.box(MP4.types.mfhd,data);}// Track fragment box
},{key:'traf',value:function traf(track,baseMediaDecodeTime){var trackId=track.id;// Track fragment header box
var tfhd=MP4.box(MP4.types.tfhd,new Uint8Array([0x00,0x00,0x00,0x00,// version(0) & flags
trackId>>>24&0xFF,// track_ID
trackId>>>16&0xFF,trackId>>>8&0xFF,trackId&0xFF]));// Track Fragment Decode Time
var tfdt=MP4.box(MP4.types.tfdt,new Uint8Array([0x00,0x00,0x00,0x00,// version(0) & flags
baseMediaDecodeTime>>>24&0xFF,// baseMediaDecodeTime: int32
baseMediaDecodeTime>>>16&0xFF,baseMediaDecodeTime>>>8&0xFF,baseMediaDecodeTime&0xFF]));var sdtp=MP4.sdtp(track);var trun=MP4.trun(track,sdtp.byteLength+16+16+8+16+8+8);return MP4.box(MP4.types.traf,tfhd,tfdt,trun,sdtp);}// Sample Dependency Type box
},{key:'sdtp',value:function sdtp(track){var samples=track.samples||[];var sampleCount=samples.length;var data=new Uint8Array(4+sampleCount);// 0~4 bytes: version(0) & flags
for(var i=0;i<sampleCount;i++){var flags=samples[i].flags;data[i+4]=flags.isLeading<<6|// is_leading: 2 (bit)
flags.dependsOn<<4// sample_depends_on
|flags.isDependedOn<<2// sample_is_depended_on
|flags.hasRedundancy;// sample_has_redundancy
}return MP4.box(MP4.types.sdtp,data);}// Track fragment run box
},{key:'trun',value:function trun(track,offset){var samples=track.samples||[];var sampleCount=samples.length;var dataSize=12+16*sampleCount;var data=new Uint8Array(dataSize);offset+=8+dataSize;data.set([0x00,0x00,0x0F,0x01,// version(0) & flags
sampleCount>>>24&0xFF,// sample_count
sampleCount>>>16&0xFF,sampleCount>>>8&0xFF,sampleCount&0xFF,offset>>>24&0xFF,// data_offset
offset>>>16&0xFF,offset>>>8&0xFF,offset&0xFF],0);for(var i=0;i<sampleCount;i++){var duration=samples[i].duration;var size=samples[i].size;var flags=samples[i].flags;var cts=samples[i].cts;data.set([duration>>>24&0xFF,// sample_duration
duration>>>16&0xFF,duration>>>8&0xFF,duration&0xFF,size>>>24&0xFF,// sample_size
size>>>16&0xFF,size>>>8&0xFF,size&0xFF,flags.isLeading<<2|flags.dependsOn,// sample_flags
flags.isDependedOn<<6|flags.hasRedundancy<<4|flags.isNonSync,0x00,0x00,// sample_degradation_priority
cts>>>24&0xFF,// sample_composition_time_offset
cts>>>16&0xFF,cts>>>8&0xFF,cts&0xFF],12+16*i);}return MP4.box(MP4.types.trun,data);}},{key:'mdat',value:function mdat(data){return MP4.box(MP4.types.mdat,data);}}]);return MP4;}();MP4.init();exports.default=MP4;},{}],38:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _logger=_dereq_('../utils/logger.js');var _logger2=_interopRequireDefault(_logger);var _mp4Generator=_dereq_('./mp4-generator.js');var _mp4Generator2=_interopRequireDefault(_mp4Generator);var _aacSilent=_dereq_('./aac-silent.js');var _aacSilent2=_interopRequireDefault(_aacSilent);var _browser=_dereq_('../utils/browser.js');var _browser2=_interopRequireDefault(_browser);var _mediaSegmentInfo=_dereq_('../core/media-segment-info.js');var _exception=_dereq_('../utils/exception.js');function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}// Fragmented mp4 remuxer
var MP4Remuxer=function(){function MP4Remuxer(config){_classCallCheck(this,MP4Remuxer);this.TAG='MP4Remuxer';this._config=config;this._isLive=config.isLive===true?true:false;this._dtsBase=-1;this._dtsBaseInited=false;this._audioDtsBase=Infinity;this._videoDtsBase=Infinity;this._audioNextDts=undefined;this._videoNextDts=undefined;this._audioStashedLastSample=null;this._videoStashedLastSample=null;this._audioMeta=null;this._videoMeta=null;this._audioSegmentInfoList=new _mediaSegmentInfo.MediaSegmentInfoList('audio');this._videoSegmentInfoList=new _mediaSegmentInfo.MediaSegmentInfoList('video');this._onInitSegment=null;this._onMediaSegment=null;// Workaround for chrome < 50: Always force first sample as a Random Access Point in media segment
// see https://bugs.chromium.org/p/chromium/issues/detail?id=229412
this._forceFirstIDR=_browser2.default.chrome&&(_browser2.default.version.major<50||_browser2.default.version.major===50&&_browser2.default.version.build<2661)?true:false;// Workaround for IE11/Edge: Fill silent aac frame after keyframe-seeking
// Make audio beginDts equals with video beginDts, in order to fix seek freeze
this._fillSilentAfterSeek=_browser2.default.msedge||_browser2.default.msie;// While only FireFox supports 'audio/mp4, codecs="mp3"', use 'audio/mpeg' for chrome, safari, ...
this._mp3UseMpegAudio=!_browser2.default.firefox;this._fillAudioTimestampGap=this._config.fixAudioTimestampGap;}_createClass(MP4Remuxer,[{key:'destroy',value:function destroy(){this._dtsBase=-1;this._dtsBaseInited=false;this._audioMeta=null;this._videoMeta=null;this._audioSegmentInfoList.clear();this._audioSegmentInfoList=null;this._videoSegmentInfoList.clear();this._videoSegmentInfoList=null;this._onInitSegment=null;this._onMediaSegment=null;}},{key:'bindDataSource',value:function bindDataSource(producer){producer.onDataAvailable=this.remux.bind(this);producer.onTrackMetadata=this._onTrackMetadataReceived.bind(this);return this;}/* prototype: function onInitSegment(type: string, initSegment: ArrayBuffer): void
                       InitSegment: {
                           type: string,
                           data: ArrayBuffer,
                           codec: string,
                           container: string
                       }
                    */},{key:'insertDiscontinuity',value:function insertDiscontinuity(){this._audioNextDts=this._videoNextDts=undefined;}},{key:'seek',value:function seek(originalDts){this._audioStashedLastSample=null;this._videoStashedLastSample=null;this._videoSegmentInfoList.clear();this._audioSegmentInfoList.clear();}},{key:'remux',value:function remux(audioTrack,videoTrack){if(!this._onMediaSegment){throw new _exception.IllegalStateException('MP4Remuxer: onMediaSegment callback must be specificed!');}if(!this._dtsBaseInited){this._calculateDtsBase(audioTrack,videoTrack);}this._remuxVideo(videoTrack);this._remuxAudio(audioTrack);}},{key:'_onTrackMetadataReceived',value:function _onTrackMetadataReceived(type,metadata){var metabox=null;var container='mp4';var codec=metadata.codec;if(type==='audio'){this._audioMeta=metadata;if(metadata.codec==='mp3'&&this._mp3UseMpegAudio){// 'audio/mpeg' for MP3 audio track
container='mpeg';codec='';metabox=new Uint8Array();}else{// 'audio/mp4, codecs="codec"'
metabox=_mp4Generator2.default.generateInitSegment(metadata);}}else if(type==='video'){this._videoMeta=metadata;metabox=_mp4Generator2.default.generateInitSegment(metadata);}else{return;}// dispatch metabox (Initialization Segment)
if(!this._onInitSegment){throw new _exception.IllegalStateException('MP4Remuxer: onInitSegment callback must be specified!');}this._onInitSegment(type,{type:type,data:metabox.buffer,codec:codec,container:type+'/'+container,mediaDuration:metadata.duration// in timescale 1000 (milliseconds)
});}},{key:'_calculateDtsBase',value:function _calculateDtsBase(audioTrack,videoTrack){if(this._dtsBaseInited){return;}if(audioTrack.samples&&audioTrack.samples.length){this._audioDtsBase=audioTrack.samples[0].dts;}if(videoTrack.samples&&videoTrack.samples.length){this._videoDtsBase=videoTrack.samples[0].dts;}this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase);this._dtsBaseInited=true;}},{key:'flushStashedSamples',value:function flushStashedSamples(){var videoSample=this._videoStashedLastSample;var audioSample=this._audioStashedLastSample;var videoTrack={type:'video',id:1,sequenceNumber:0,samples:[],length:0};if(videoSample!=null){videoTrack.samples.push(videoSample);videoTrack.length=videoSample.length;}var audioTrack={type:'audio',id:2,sequenceNumber:0,samples:[],length:0};if(audioSample!=null){audioTrack.samples.push(audioSample);audioTrack.length=audioSample.length;}this._videoStashedLastSample=null;this._audioStashedLastSample=null;this._remuxVideo(videoTrack,true);this._remuxAudio(audioTrack,true);}},{key:'_remuxAudio',value:function _remuxAudio(audioTrack,force){if(this._audioMeta==null){return;}var track=audioTrack;var samples=track.samples;var dtsCorrection=undefined;var firstDts=-1,lastDts=-1,lastPts=-1;var refSampleDuration=this._audioMeta.refSampleDuration;var mpegRawTrack=this._audioMeta.codec==='mp3'&&this._mp3UseMpegAudio;var firstSegmentAfterSeek=this._dtsBaseInited&&this._audioNextDts===undefined;var insertPrefixSilentFrame=false;if(!samples||samples.length===0){return;}if(samples.length===1&&!force){// If [sample count in current batch] === 1 && (force != true)
// Ignore and keep in demuxer's queue
return;}// else if (force === true) do remux
var offset=0;var mdatbox=null;var mdatBytes=0;// calculate initial mdat size
if(mpegRawTrack){// for raw mpeg buffer
offset=0;mdatBytes=track.length;}else{// for fmp4 mdat box
offset=8;// size + type
mdatBytes=8+track.length;}var lastSample=null;// Pop the lastSample and waiting for stash
if(samples.length>1){lastSample=samples.pop();mdatBytes-=lastSample.length;}// Insert [stashed lastSample in the previous batch] to the front
if(this._audioStashedLastSample!=null){var sample=this._audioStashedLastSample;this._audioStashedLastSample=null;samples.unshift(sample);mdatBytes+=sample.length;}// Stash the lastSample of current batch, waiting for next batch
if(lastSample!=null){this._audioStashedLastSample=lastSample;}var firstSampleOriginalDts=samples[0].dts-this._dtsBase;// calculate dtsCorrection
if(this._audioNextDts){dtsCorrection=firstSampleOriginalDts-this._audioNextDts;}else{// this._audioNextDts == undefined
if(this._audioSegmentInfoList.isEmpty()){dtsCorrection=0;if(this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()){if(this._audioMeta.originalCodec!=='mp3'){insertPrefixSilentFrame=true;}}}else{var _lastSample=this._audioSegmentInfoList.getLastSampleBefore(firstSampleOriginalDts);if(_lastSample!=null){var distance=firstSampleOriginalDts-(_lastSample.originalDts+_lastSample.duration);if(distance<=3){distance=0;}var expectedDts=_lastSample.dts+_lastSample.duration+distance;dtsCorrection=firstSampleOriginalDts-expectedDts;}else{// lastSample == null, cannot found
dtsCorrection=0;}}}if(insertPrefixSilentFrame){// align audio segment beginDts to match with current video segment's beginDts
var firstSampleDts=firstSampleOriginalDts-dtsCorrection;var videoSegment=this._videoSegmentInfoList.getLastSegmentBefore(firstSampleOriginalDts);if(videoSegment!=null&&videoSegment.beginDts<firstSampleDts){var silentUnit=_aacSilent2.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(silentUnit){var dts=videoSegment.beginDts;var silentFrameDuration=firstSampleDts-videoSegment.beginDts;_logger2.default.v(this.TAG,'InsertPrefixSilentAudio: dts: '+dts+', duration: '+silentFrameDuration);samples.unshift({unit:silentUnit,dts:dts,pts:dts});mdatBytes+=silentUnit.byteLength;}// silentUnit == null: Cannot generate, skip
}else{insertPrefixSilentFrame=false;}}var mp4Samples=[];// Correct dts for each sample, and calculate sample duration. Then output to mp4Samples
for(var i=0;i<samples.length;i++){var _sample=samples[i];var unit=_sample.unit;var originalDts=_sample.dts-this._dtsBase;var _dts=originalDts-dtsCorrection;if(firstDts===-1){firstDts=_dts;}var sampleDuration=0;if(i!==samples.length-1){var nextDts=samples[i+1].dts-this._dtsBase-dtsCorrection;sampleDuration=nextDts-_dts;}else{// the last sample
if(lastSample!=null){// use stashed sample's dts to calculate sample duration
var _nextDts=lastSample.dts-this._dtsBase-dtsCorrection;sampleDuration=_nextDts-_dts;}else if(mp4Samples.length>=1){// use second last sample duration
sampleDuration=mp4Samples[mp4Samples.length-1].duration;}else{// the only one sample, use reference sample duration
sampleDuration=Math.floor(refSampleDuration);}}var needFillSilentFrames=false;var silentFrames=null;// Silent frame generation, if large timestamp gap detected && config.fixAudioTimestampGap
if(sampleDuration>refSampleDuration*1.5&&this._audioMeta.codec!=='mp3'&&this._fillAudioTimestampGap&&!_browser2.default.safari){// We need to insert silent frames to fill timestamp gap
needFillSilentFrames=true;var delta=Math.abs(sampleDuration-refSampleDuration);var frameCount=Math.ceil(delta/refSampleDuration);var currentDts=_dts+refSampleDuration;// Notice: in float
_logger2.default.w(this.TAG,'Large audio timestamp gap detected, may cause AV sync to drift. '+'Silent frames will be generated to avoid unsync.\n'+('dts: '+(_dts+sampleDuration)+' ms, expected: '+(_dts+Math.round(refSampleDuration))+' ms, ')+('delta: '+Math.round(delta)+' ms, generate: '+frameCount+' frames'));var _silentUnit=_aacSilent2.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(_silentUnit==null){_logger2.default.w(this.TAG,'Unable to generate silent frame for '+(this._audioMeta.originalCodec+' with '+this._audioMeta.channelCount+' channels, repeat last frame'));// Repeat last frame
_silentUnit=unit;}silentFrames=[];for(var j=0;j<frameCount;j++){var intDts=Math.round(currentDts);// round to integer
if(silentFrames.length>0){// Set previous frame sample duration
var previousFrame=silentFrames[silentFrames.length-1];previousFrame.duration=intDts-previousFrame.dts;}var frame={dts:intDts,pts:intDts,cts:0,unit:_silentUnit,size:_silentUnit.byteLength,duration:0,// wait for next sample
originalDts:originalDts,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};silentFrames.push(frame);mdatBytes+=frame.size;currentDts+=refSampleDuration;}// last frame: align end time to next frame dts
var lastFrame=silentFrames[silentFrames.length-1];lastFrame.duration=_dts+sampleDuration-lastFrame.dts;// silentFrames.forEach((frame) => {
//     Log.w(this.TAG, `SilentAudio: dts: ${frame.dts}, duration: ${frame.duration}`);
// });
// Set correct sample duration for current frame
sampleDuration=Math.round(refSampleDuration);}mp4Samples.push({dts:_dts,pts:_dts,cts:0,unit:_sample.unit,size:_sample.unit.byteLength,duration:sampleDuration,originalDts:originalDts,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}});if(needFillSilentFrames){// Silent frames should be inserted after wrong-duration frame
mp4Samples.push.apply(mp4Samples,silentFrames);}}// allocate mdatbox
if(mpegRawTrack){// allocate for raw mpeg buffer
mdatbox=new Uint8Array(mdatBytes);}else{// allocate for fmp4 mdat box
mdatbox=new Uint8Array(mdatBytes);// size field
mdatbox[0]=mdatBytes>>>24&0xFF;mdatbox[1]=mdatBytes>>>16&0xFF;mdatbox[2]=mdatBytes>>>8&0xFF;mdatbox[3]=mdatBytes&0xFF;// type field (fourCC)
mdatbox.set(_mp4Generator2.default.types.mdat,4);}// Write samples into mdatbox
for(var _i=0;_i<mp4Samples.length;_i++){var _unit=mp4Samples[_i].unit;mdatbox.set(_unit,offset);offset+=_unit.byteLength;}var latest=mp4Samples[mp4Samples.length-1];lastDts=latest.dts+latest.duration;this._audioNextDts=lastDts;// fill media segment info & add to info list
var info=new _mediaSegmentInfo.MediaSegmentInfo();info.beginDts=firstDts;info.endDts=lastDts;info.beginPts=firstDts;info.endPts=lastDts;info.originalBeginDts=mp4Samples[0].originalDts;info.originalEndDts=latest.originalDts+latest.duration;info.firstSample=new _mediaSegmentInfo.SampleInfo(mp4Samples[0].dts,mp4Samples[0].pts,mp4Samples[0].duration,mp4Samples[0].originalDts,false);info.lastSample=new _mediaSegmentInfo.SampleInfo(latest.dts,latest.pts,latest.duration,latest.originalDts,false);if(!this._isLive){this._audioSegmentInfoList.append(info);}track.samples=mp4Samples;track.sequenceNumber++;var moofbox=null;if(mpegRawTrack){// Generate empty buffer, because useless for raw mpeg
moofbox=new Uint8Array();}else{// Generate moof for fmp4 segment
moofbox=_mp4Generator2.default.moof(track,firstDts);}track.samples=[];track.length=0;var segment={type:'audio',data:this._mergeBoxes(moofbox,mdatbox).buffer,sampleCount:mp4Samples.length,info:info};if(mpegRawTrack&&firstSegmentAfterSeek){// For MPEG audio stream in MSE, if seeking occurred, before appending new buffer
// We need explicitly set timestampOffset to the desired point in timeline for mpeg SourceBuffer.
segment.timestampOffset=firstDts;}this._onMediaSegment('audio',segment);}},{key:'_remuxVideo',value:function _remuxVideo(videoTrack,force){if(this._videoMeta==null){return;}var track=videoTrack;var samples=track.samples;var dtsCorrection=undefined;var firstDts=-1,lastDts=-1;var firstPts=-1,lastPts=-1;if(!samples||samples.length===0){return;}if(samples.length===1&&!force){// If [sample count in current batch] === 1 && (force != true)
// Ignore and keep in demuxer's queue
return;}// else if (force === true) do remux
var offset=8;var mdatbox=null;var mdatBytes=8+videoTrack.length;var lastSample=null;// Pop the lastSample and waiting for stash
if(samples.length>1){lastSample=samples.pop();mdatBytes-=lastSample.length;}// Insert [stashed lastSample in the previous batch] to the front
if(this._videoStashedLastSample!=null){var sample=this._videoStashedLastSample;this._videoStashedLastSample=null;samples.unshift(sample);mdatBytes+=sample.length;}// Stash the lastSample of current batch, waiting for next batch
if(lastSample!=null){this._videoStashedLastSample=lastSample;}var firstSampleOriginalDts=samples[0].dts-this._dtsBase;// calculate dtsCorrection
if(this._videoNextDts){dtsCorrection=firstSampleOriginalDts-this._videoNextDts;}else{// this._videoNextDts == undefined
if(this._videoSegmentInfoList.isEmpty()){dtsCorrection=0;}else{var _lastSample2=this._videoSegmentInfoList.getLastSampleBefore(firstSampleOriginalDts);if(_lastSample2!=null){var distance=firstSampleOriginalDts-(_lastSample2.originalDts+_lastSample2.duration);if(distance<=3){distance=0;}var expectedDts=_lastSample2.dts+_lastSample2.duration+distance;dtsCorrection=firstSampleOriginalDts-expectedDts;}else{// lastSample == null, cannot found
dtsCorrection=0;}}}var info=new _mediaSegmentInfo.MediaSegmentInfo();var mp4Samples=[];// Correct dts for each sample, and calculate sample duration. Then output to mp4Samples
for(var i=0;i<samples.length;i++){var _sample2=samples[i];var originalDts=_sample2.dts-this._dtsBase;var isKeyframe=_sample2.isKeyframe;var dts=originalDts-dtsCorrection;var cts=_sample2.cts;var pts=dts+cts;if(firstDts===-1){firstDts=dts;firstPts=pts;}var sampleDuration=0;if(i!==samples.length-1){var nextDts=samples[i+1].dts-this._dtsBase-dtsCorrection;sampleDuration=nextDts-dts;}else{// the last sample
if(lastSample!=null){// use stashed sample's dts to calculate sample duration
var _nextDts2=lastSample.dts-this._dtsBase-dtsCorrection;sampleDuration=_nextDts2-dts;}else if(mp4Samples.length>=1){// use second last sample duration
sampleDuration=mp4Samples[mp4Samples.length-1].duration;}else{// the only one sample, use reference sample duration
sampleDuration=Math.floor(this._videoMeta.refSampleDuration);}}if(isKeyframe){var syncPoint=new _mediaSegmentInfo.SampleInfo(dts,pts,sampleDuration,_sample2.dts,true);syncPoint.fileposition=_sample2.fileposition;info.appendSyncPoint(syncPoint);}mp4Samples.push({dts:dts,pts:pts,cts:cts,units:_sample2.units,size:_sample2.length,isKeyframe:isKeyframe,duration:sampleDuration,originalDts:originalDts,flags:{isLeading:0,dependsOn:isKeyframe?2:1,isDependedOn:isKeyframe?1:0,hasRedundancy:0,isNonSync:isKeyframe?0:1}});}// allocate mdatbox
mdatbox=new Uint8Array(mdatBytes);mdatbox[0]=mdatBytes>>>24&0xFF;mdatbox[1]=mdatBytes>>>16&0xFF;mdatbox[2]=mdatBytes>>>8&0xFF;mdatbox[3]=mdatBytes&0xFF;mdatbox.set(_mp4Generator2.default.types.mdat,4);// Write samples into mdatbox
for(var _i2=0;_i2<mp4Samples.length;_i2++){var units=mp4Samples[_i2].units;while(units.length){var unit=units.shift();var data=unit.data;mdatbox.set(data,offset);offset+=data.byteLength;}}var latest=mp4Samples[mp4Samples.length-1];lastDts=latest.dts+latest.duration;lastPts=latest.pts+latest.duration;this._videoNextDts=lastDts;// fill media segment info & add to info list
info.beginDts=firstDts;info.endDts=lastDts;info.beginPts=firstPts;info.endPts=lastPts;info.originalBeginDts=mp4Samples[0].originalDts;info.originalEndDts=latest.originalDts+latest.duration;info.firstSample=new _mediaSegmentInfo.SampleInfo(mp4Samples[0].dts,mp4Samples[0].pts,mp4Samples[0].duration,mp4Samples[0].originalDts,mp4Samples[0].isKeyframe);info.lastSample=new _mediaSegmentInfo.SampleInfo(latest.dts,latest.pts,latest.duration,latest.originalDts,latest.isKeyframe);if(!this._isLive){this._videoSegmentInfoList.append(info);}track.samples=mp4Samples;track.sequenceNumber++;// workaround for chrome < 50: force first sample as a random access point
// see https://bugs.chromium.org/p/chromium/issues/detail?id=229412
if(this._forceFirstIDR){var flags=mp4Samples[0].flags;flags.dependsOn=2;flags.isNonSync=0;}var moofbox=_mp4Generator2.default.moof(track,firstDts);track.samples=[];track.length=0;this._onMediaSegment('video',{type:'video',data:this._mergeBoxes(moofbox,mdatbox).buffer,sampleCount:mp4Samples.length,info:info});}},{key:'_mergeBoxes',value:function _mergeBoxes(moof,mdat){var result=new Uint8Array(moof.byteLength+mdat.byteLength);result.set(moof,0);result.set(mdat,moof.byteLength);return result;}},{key:'onInitSegment',get:function get(){return this._onInitSegment;},set:function set(callback){this._onInitSegment=callback;}/* prototype: function onMediaSegment(type: string, mediaSegment: MediaSegment): void
                       MediaSegment: {
                           type: string,
                           data: ArrayBuffer,
                           sampleCount: int32
                           info: MediaSegmentInfo
                       }
                    */},{key:'onMediaSegment',get:function get(){return this._onMediaSegment;},set:function set(callback){this._onMediaSegment=callback;}}]);return MP4Remuxer;}();exports.default=MP4Remuxer;},{"../core/media-segment-info.js":8,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./aac-silent.js":36,"./mp4-generator.js":37}],39:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var Browser={};function detect(){// modified from jquery-browser-plugin
var ua=self.navigator.userAgent.toLowerCase();var match=/(edge)\/([\w.]+)/.exec(ua)||/(opr)[\/]([\w.]+)/.exec(ua)||/(chrome)[ \/]([\w.]+)/.exec(ua)||/(iemobile)[\/]([\w.]+)/.exec(ua)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(ua)||/(webkit)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||ua.indexOf('trident')>=0&&/(rv)(?::| )([\w.]+)/.exec(ua)||ua.indexOf('compatible')<0&&/(firefox)[ \/]([\w.]+)/.exec(ua)||[];var platform_match=/(ipad)/.exec(ua)||/(ipod)/.exec(ua)||/(windows phone)/.exec(ua)||/(iphone)/.exec(ua)||/(kindle)/.exec(ua)||/(android)/.exec(ua)||/(windows)/.exec(ua)||/(mac)/.exec(ua)||/(linux)/.exec(ua)||/(cros)/.exec(ua)||[];var matched={browser:match[5]||match[3]||match[1]||'',version:match[2]||match[4]||'0',majorVersion:match[4]||match[2]||'0',platform:platform_match[0]||''};var browser={};if(matched.browser){browser[matched.browser]=true;var versionArray=matched.majorVersion.split('.');browser.version={major:parseInt(matched.majorVersion,10),string:matched.version};if(versionArray.length>1){browser.version.minor=parseInt(versionArray[1],10);}if(versionArray.length>2){browser.version.build=parseInt(versionArray[2],10);}}if(matched.platform){browser[matched.platform]=true;}if(browser.chrome||browser.opr||browser.safari){browser.webkit=true;}// MSIE. IE11 has 'rv' identifer
if(browser.rv||browser.iemobile){if(browser.rv){delete browser.rv;}var msie='msie';matched.browser=msie;browser[msie]=true;}// Microsoft Edge
if(browser.edge){delete browser.edge;var msedge='msedge';matched.browser=msedge;browser[msedge]=true;}// Opera 15+
if(browser.opr){var opera='opera';matched.browser=opera;browser[opera]=true;}// Stock android browsers are marked as Safari
if(browser.safari&&browser.android){var android='android';matched.browser=android;browser[android]=true;}browser.name=matched.browser;browser.platform=matched.platform;for(var key in Browser){if(Browser.hasOwnProperty(key)){delete Browser[key];}}__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default()(Browser,browser);}detect();exports.default=Browser;},{}],40:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&((typeof call==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(call))==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":__WEBPACK_IMPORTED_MODULE_11_babel_runtime_helpers_typeof___default()(superClass)));}subClass.prototype=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_object_create___default()(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default.a?__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default()(subClass,superClass):subClass.__proto__=superClass;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var RuntimeException=exports.RuntimeException=function(){function RuntimeException(message){_classCallCheck(this,RuntimeException);this._message=message;}_createClass(RuntimeException,[{key:'toString',value:function toString(){return this.name+': '+this.message;}},{key:'name',get:function get(){return'RuntimeException';}},{key:'message',get:function get(){return this._message;}}]);return RuntimeException;}();var IllegalStateException=exports.IllegalStateException=function(_RuntimeException){_inherits(IllegalStateException,_RuntimeException);function IllegalStateException(message){_classCallCheck(this,IllegalStateException);return _possibleConstructorReturn(this,(IllegalStateException.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(IllegalStateException)).call(this,message));}_createClass(IllegalStateException,[{key:'name',get:function get(){return'IllegalStateException';}}]);return IllegalStateException;}(RuntimeException);var InvalidArgumentException=exports.InvalidArgumentException=function(_RuntimeException2){_inherits(InvalidArgumentException,_RuntimeException2);function InvalidArgumentException(message){_classCallCheck(this,InvalidArgumentException);return _possibleConstructorReturn(this,(InvalidArgumentException.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(InvalidArgumentException)).call(this,message));}_createClass(InvalidArgumentException,[{key:'name',get:function get(){return'InvalidArgumentException';}}]);return InvalidArgumentException;}(RuntimeException);var NotImplementedException=exports.NotImplementedException=function(_RuntimeException3){_inherits(NotImplementedException,_RuntimeException3);function NotImplementedException(message){_classCallCheck(this,NotImplementedException);return _possibleConstructorReturn(this,(NotImplementedException.__proto__||__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_object_get_prototype_of___default()(NotImplementedException)).call(this,message));}_createClass(NotImplementedException,[{key:'name',get:function get(){return'NotImplementedException';}}]);return NotImplementedException;}(RuntimeException);},{}],41:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _events=_dereq_('events');var _events2=_interopRequireDefault(_events);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var Log=function(){function Log(){_classCallCheck(this,Log);}_createClass(Log,null,[{key:'e',value:function e(tag,msg){if(!tag||Log.FORCE_GLOBAL_TAG)tag=Log.GLOBAL_TAG;var str='['+tag+'] > '+msg;if(Log.ENABLE_CALLBACK){Log.emitter.emit('log','error',str);}if(!Log.ENABLE_ERROR){return;}if(console.error){console.error(str);}else if(console.warn){console.warn(str);}else{console.log(str);}}},{key:'i',value:function i(tag,msg){if(!tag||Log.FORCE_GLOBAL_TAG)tag=Log.GLOBAL_TAG;var str='['+tag+'] > '+msg;if(Log.ENABLE_CALLBACK){Log.emitter.emit('log','info',str);}if(!Log.ENABLE_INFO){return;}if(console.info){console.info(str);}else{console.log(str);}}},{key:'w',value:function w(tag,msg){if(!tag||Log.FORCE_GLOBAL_TAG)tag=Log.GLOBAL_TAG;var str='['+tag+'] > '+msg;if(Log.ENABLE_CALLBACK){Log.emitter.emit('log','warn',str);}if(!Log.ENABLE_WARN){return;}if(console.warn){console.warn(str);}else{console.log(str);}}},{key:'d',value:function d(tag,msg){if(!tag||Log.FORCE_GLOBAL_TAG)tag=Log.GLOBAL_TAG;var str='['+tag+'] > '+msg;if(Log.ENABLE_CALLBACK){Log.emitter.emit('log','debug',str);}if(!Log.ENABLE_DEBUG){return;}if(console.debug){console.debug(str);}else{console.log(str);}}},{key:'v',value:function v(tag,msg){if(!tag||Log.FORCE_GLOBAL_TAG)tag=Log.GLOBAL_TAG;var str='['+tag+'] > '+msg;if(Log.ENABLE_CALLBACK){Log.emitter.emit('log','verbose',str);}if(!Log.ENABLE_VERBOSE){return;}console.log(str);}}]);return Log;}();Log.GLOBAL_TAG='flv.js';Log.FORCE_GLOBAL_TAG=false;Log.ENABLE_ERROR=true;Log.ENABLE_INFO=true;Log.ENABLE_WARN=true;Log.ENABLE_DEBUG=true;Log.ENABLE_VERBOSE=true;Log.ENABLE_CALLBACK=false;Log.emitter=new _events2.default();exports.default=Log;},{"events":2}],42:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();/*
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Copyright (C) 2016 Bilibili. All Rights Reserved.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * @author zheng qian <xqq@xqq.im>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Licensed under the Apache License, Version 2.0 (the "License");
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * you may not use this file except in compliance with the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * You may obtain a copy of the License at
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *     http://www.apache.org/licenses/LICENSE-2.0
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      *
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * Unless required by applicable law or agreed to in writing, software
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * distributed under the License is distributed on an "AS IS" BASIS,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * See the License for the specific language governing permissions and
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      * limitations under the License.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      */var _events=_dereq_('events');var _events2=_interopRequireDefault(_events);var _logger=_dereq_('./logger.js');var _logger2=_interopRequireDefault(_logger);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var LoggingControl=function(){function LoggingControl(){_classCallCheck(this,LoggingControl);}_createClass(LoggingControl,null,[{key:'getConfig',value:function getConfig(){return{globalTag:_logger2.default.GLOBAL_TAG,forceGlobalTag:_logger2.default.FORCE_GLOBAL_TAG,enableVerbose:_logger2.default.ENABLE_VERBOSE,enableDebug:_logger2.default.ENABLE_DEBUG,enableInfo:_logger2.default.ENABLE_INFO,enableWarn:_logger2.default.ENABLE_WARN,enableError:_logger2.default.ENABLE_ERROR,enableCallback:_logger2.default.ENABLE_CALLBACK};}},{key:'applyConfig',value:function applyConfig(config){_logger2.default.GLOBAL_TAG=config.globalTag;_logger2.default.FORCE_GLOBAL_TAG=config.forceGlobalTag;_logger2.default.ENABLE_VERBOSE=config.enableVerbose;_logger2.default.ENABLE_DEBUG=config.enableDebug;_logger2.default.ENABLE_INFO=config.enableInfo;_logger2.default.ENABLE_WARN=config.enableWarn;_logger2.default.ENABLE_ERROR=config.enableError;_logger2.default.ENABLE_CALLBACK=config.enableCallback;}},{key:'_notifyChange',value:function _notifyChange(){var emitter=LoggingControl.emitter;if(emitter.listenerCount('change')>0){var config=LoggingControl.getConfig();emitter.emit('change',config);}}},{key:'registerListener',value:function registerListener(listener){LoggingControl.emitter.addListener('change',listener);}},{key:'removeListener',value:function removeListener(listener){LoggingControl.emitter.removeListener('change',listener);}},{key:'addLogListener',value:function addLogListener(listener){_logger2.default.emitter.addListener('log',listener);if(_logger2.default.emitter.listenerCount('log')>0){_logger2.default.ENABLE_CALLBACK=true;LoggingControl._notifyChange();}}},{key:'removeLogListener',value:function removeLogListener(listener){_logger2.default.emitter.removeListener('log',listener);if(_logger2.default.emitter.listenerCount('log')===0){_logger2.default.ENABLE_CALLBACK=false;LoggingControl._notifyChange();}}},{key:'forceGlobalTag',get:function get(){return _logger2.default.FORCE_GLOBAL_TAG;},set:function set(enable){_logger2.default.FORCE_GLOBAL_TAG=enable;LoggingControl._notifyChange();}},{key:'globalTag',get:function get(){return _logger2.default.GLOBAL_TAG;},set:function set(tag){_logger2.default.GLOBAL_TAG=tag;LoggingControl._notifyChange();}},{key:'enableAll',get:function get(){return _logger2.default.ENABLE_VERBOSE&&_logger2.default.ENABLE_DEBUG&&_logger2.default.ENABLE_INFO&&_logger2.default.ENABLE_WARN&&_logger2.default.ENABLE_ERROR;},set:function set(enable){_logger2.default.ENABLE_VERBOSE=enable;_logger2.default.ENABLE_DEBUG=enable;_logger2.default.ENABLE_INFO=enable;_logger2.default.ENABLE_WARN=enable;_logger2.default.ENABLE_ERROR=enable;LoggingControl._notifyChange();}},{key:'enableDebug',get:function get(){return _logger2.default.ENABLE_DEBUG;},set:function set(enable){_logger2.default.ENABLE_DEBUG=enable;LoggingControl._notifyChange();}},{key:'enableVerbose',get:function get(){return _logger2.default.ENABLE_VERBOSE;},set:function set(enable){_logger2.default.ENABLE_VERBOSE=enable;LoggingControl._notifyChange();}},{key:'enableInfo',get:function get(){return _logger2.default.ENABLE_INFO;},set:function set(enable){_logger2.default.ENABLE_INFO=enable;LoggingControl._notifyChange();}},{key:'enableWarn',get:function get(){return _logger2.default.ENABLE_WARN;},set:function set(enable){_logger2.default.ENABLE_WARN=enable;LoggingControl._notifyChange();}},{key:'enableError',get:function get(){return _logger2.default.ENABLE_ERROR;},set:function set(enable){_logger2.default.ENABLE_ERROR=enable;LoggingControl._notifyChange();}}]);return LoggingControl;}();LoggingControl.emitter=new _events2.default();exports.default=LoggingControl;},{"./logger.js":41,"events":2}],43:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;__WEBPACK_IMPORTED_MODULE_7_babel_runtime_core_js_object_define_property___default()(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */var Polyfill=function(){function Polyfill(){_classCallCheck(this,Polyfill);}_createClass(Polyfill,null,[{key:'install',value:function install(){// ES6 Object.setPrototypeOf
Object.setPrototypeOf=__WEBPACK_IMPORTED_MODULE_5_babel_runtime_core_js_object_set_prototype_of___default.a||function(obj,proto){obj.__proto__=proto;return obj;};// ES6 Object.assign
Object.assign=__WEBPACK_IMPORTED_MODULE_8_babel_runtime_core_js_object_assign___default.a||function(target){if(target===undefined||target===null){throw new TypeError('Cannot convert undefined or null to object');}var output=Object(target);for(var i=1;i<arguments.length;i++){var source=arguments[i];if(source!==undefined&&source!==null){for(var key in source){if(source.hasOwnProperty(key)){output[key]=source[key];}}}}return output;};// ES6 Promise (missing support in IE11)
if(typeof self.Promise!=='function'){_dereq_('es6-promise').polyfill();}}}]);return Polyfill;}();Polyfill.install();exports.default=Polyfill;},{"es6-promise":1}],44:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,"__esModule",{value:true});/*
             * Copyright (C) 2016 Bilibili. All Rights Reserved.
             *
             * This file is derived from C++ project libWinTF8 (https://github.com/m13253/libWinTF8)
             * @author zheng qian <xqq@xqq.im>
             *
             * Licensed under the Apache License, Version 2.0 (the "License");
             * you may not use this file except in compliance with the License.
             * You may obtain a copy of the License at
             *
             *     http://www.apache.org/licenses/LICENSE-2.0
             *
             * Unless required by applicable law or agreed to in writing, software
             * distributed under the License is distributed on an "AS IS" BASIS,
             * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
             * See the License for the specific language governing permissions and
             * limitations under the License.
             */function checkContinuation(uint8array,start,checkLength){var array=uint8array;if(start+checkLength<array.length){while(checkLength--){if((array[++start]&0xC0)!==0x80)return false;}return true;}else{return false;}}function decodeUTF8(uint8array){var out=[];var input=uint8array;var i=0;var length=uint8array.length;while(i<length){if(input[i]<0x80){out.push(String.fromCharCode(input[i]));++i;continue;}else if(input[i]<0xC0){// fallthrough
}else if(input[i]<0xE0){if(checkContinuation(input,i,1)){var ucs4=(input[i]&0x1F)<<6|input[i+1]&0x3F;if(ucs4>=0x80){out.push(String.fromCharCode(ucs4&0xFFFF));i+=2;continue;}}}else if(input[i]<0xF0){if(checkContinuation(input,i,2)){var _ucs=(input[i]&0xF)<<12|(input[i+1]&0x3F)<<6|input[i+2]&0x3F;if(_ucs>=0x800&&(_ucs&0xF800)!==0xD800){out.push(String.fromCharCode(_ucs&0xFFFF));i+=3;continue;}}}else if(input[i]<0xF8){if(checkContinuation(input,i,3)){var _ucs2=(input[i]&0x7)<<18|(input[i+1]&0x3F)<<12|(input[i+2]&0x3F)<<6|input[i+3]&0x3F;if(_ucs2>0x10000&&_ucs2<0x110000){_ucs2-=0x10000;out.push(String.fromCharCode(_ucs2>>>10|0xD800));out.push(String.fromCharCode(_ucs2&0x3FF|0xDC00));i+=4;continue;}}}out.push(String.fromCharCode(0xFFFD));++i;}return out.join('');}exports.default=decodeUTF8;},{}]},{},[21])(21);});//# sourceMappingURL=flv.js.map
/* WEBPACK VAR INJECTION */}.call(__webpack_exports__, __webpack_require__("DuR2"), __webpack_require__("f1Eh")(module)))

/***/ }),

/***/ "MJLE":
/***/ (function(module, exports, __webpack_require__) {

/**
 * @fileoverview
 * - Using the 'QRCode for Javascript library'
 * - Fixed dataset of 'QRCode for Javascript library' for support full-spec.
 * - this library has no dependencies.
 *
 * @author davidshimjs
 * @see <a href="http://www.d-project.com/" target="_blank">http://www.d-project.com/</a>
 * @see <a href="http://jeromeetienne.github.com/jquery-qrcode/" target="_blank">http://jeromeetienne.github.com/jquery-qrcode/</a>
 */
var QRCode;

(function (root, factory) {

	/* CommonJS */
  if (true) module.exports = factory()

  /* AMD module */
  else if (typeof define == 'function' && define.amd) define(factory)

  /* Global */
  else root.QRCode = factory()

}(this, function () {	//---------------------------------------------------------------------
	// QRCode for JavaScript
	//
	// Copyright (c) 2009 Kazuhiko Arase
	//
	// URL: http://www.d-project.com/
	//
	// Licensed under the MIT license:
	//   http://www.opensource.org/licenses/mit-license.php
	//
	// The word "QR Code" is registered trademark of
	// DENSO WAVE INCORPORATED
	//   http://www.denso-wave.com/qrcode/faqpatent-e.html
	//
	//---------------------------------------------------------------------
	function QR8bitByte(data) {
		this.mode = QRMode.MODE_8BIT_BYTE;
		this.data = data;
		this.parsedData = [];

		// Added to support UTF-8 Characters
		for (var i = 0, l = this.data.length; i < l; i++) {
			var byteArray = [];
			var code = this.data.charCodeAt(i);

			if (code > 0x10000) {
				byteArray[0] = 0xF0 | ((code & 0x1C0000) >>> 18);
				byteArray[1] = 0x80 | ((code & 0x3F000) >>> 12);
				byteArray[2] = 0x80 | ((code & 0xFC0) >>> 6);
				byteArray[3] = 0x80 | (code & 0x3F);
			} else if (code > 0x800) {
				byteArray[0] = 0xE0 | ((code & 0xF000) >>> 12);
				byteArray[1] = 0x80 | ((code & 0xFC0) >>> 6);
				byteArray[2] = 0x80 | (code & 0x3F);
			} else if (code > 0x80) {
				byteArray[0] = 0xC0 | ((code & 0x7C0) >>> 6);
				byteArray[1] = 0x80 | (code & 0x3F);
			} else {
				byteArray[0] = code;
			}

			this.parsedData.push(byteArray);
		}

		this.parsedData = Array.prototype.concat.apply([], this.parsedData);

		if (this.parsedData.length != this.data.length) {
			this.parsedData.unshift(191);
			this.parsedData.unshift(187);
			this.parsedData.unshift(239);
		}
	}

	QR8bitByte.prototype = {
		getLength: function (buffer) {
			return this.parsedData.length;
		},
		write: function (buffer) {
			for (var i = 0, l = this.parsedData.length; i < l; i++) {
				buffer.put(this.parsedData[i], 8);
			}
		}
	};

	function QRCodeModel(typeNumber, errorCorrectLevel) {
		this.typeNumber = typeNumber;
		this.errorCorrectLevel = errorCorrectLevel;
		this.modules = null;
		this.moduleCount = 0;
		this.dataCache = null;
		this.dataList = [];
	}

	QRCodeModel.prototype={addData:function(data){var newData=new QR8bitByte(data);this.dataList.push(newData);this.dataCache=null;},isDark:function(row,col){if(row<0||this.moduleCount<=row||col<0||this.moduleCount<=col){throw new Error(row+","+col);}
	return this.modules[row][col];},getModuleCount:function(){return this.moduleCount;},make:function(){this.makeImpl(false,this.getBestMaskPattern());},makeImpl:function(test,maskPattern){this.moduleCount=this.typeNumber*4+17;this.modules=new Array(this.moduleCount);for(var row=0;row<this.moduleCount;row++){this.modules[row]=new Array(this.moduleCount);for(var col=0;col<this.moduleCount;col++){this.modules[row][col]=null;}}
	this.setupPositionProbePattern(0,0);this.setupPositionProbePattern(this.moduleCount-7,0);this.setupPositionProbePattern(0,this.moduleCount-7);this.setupPositionAdjustPattern();this.setupTimingPattern();this.setupTypeInfo(test,maskPattern);if(this.typeNumber>=7){this.setupTypeNumber(test);}
	if(this.dataCache==null){this.dataCache=QRCodeModel.createData(this.typeNumber,this.errorCorrectLevel,this.dataList);}
	this.mapData(this.dataCache,maskPattern);},setupPositionProbePattern:function(row,col){for(var r=-1;r<=7;r++){if(row+r<=-1||this.moduleCount<=row+r)continue;for(var c=-1;c<=7;c++){if(col+c<=-1||this.moduleCount<=col+c)continue;if((0<=r&&r<=6&&(c==0||c==6))||(0<=c&&c<=6&&(r==0||r==6))||(2<=r&&r<=4&&2<=c&&c<=4)){this.modules[row+r][col+c]=true;}else{this.modules[row+r][col+c]=false;}}}},getBestMaskPattern:function(){var minLostPoint=0;var pattern=0;for(var i=0;i<8;i++){this.makeImpl(true,i);var lostPoint=QRUtil.getLostPoint(this);if(i==0||minLostPoint>lostPoint){minLostPoint=lostPoint;pattern=i;}}
	return pattern;},createMovieClip:function(target_mc,instance_name,depth){var qr_mc=target_mc.createEmptyMovieClip(instance_name,depth);var cs=1;this.make();for(var row=0;row<this.modules.length;row++){var y=row*cs;for(var col=0;col<this.modules[row].length;col++){var x=col*cs;var dark=this.modules[row][col];if(dark){qr_mc.beginFill(0,100);qr_mc.moveTo(x,y);qr_mc.lineTo(x+cs,y);qr_mc.lineTo(x+cs,y+cs);qr_mc.lineTo(x,y+cs);qr_mc.endFill();}}}
	return qr_mc;},setupTimingPattern:function(){for(var r=8;r<this.moduleCount-8;r++){if(this.modules[r][6]!=null){continue;}
	this.modules[r][6]=(r%2==0);}
	for(var c=8;c<this.moduleCount-8;c++){if(this.modules[6][c]!=null){continue;}
	this.modules[6][c]=(c%2==0);}},setupPositionAdjustPattern:function(){var pos=QRUtil.getPatternPosition(this.typeNumber);for(var i=0;i<pos.length;i++){for(var j=0;j<pos.length;j++){var row=pos[i];var col=pos[j];if(this.modules[row][col]!=null){continue;}
	for(var r=-2;r<=2;r++){for(var c=-2;c<=2;c++){if(r==-2||r==2||c==-2||c==2||(r==0&&c==0)){this.modules[row+r][col+c]=true;}else{this.modules[row+r][col+c]=false;}}}}}},setupTypeNumber:function(test){var bits=QRUtil.getBCHTypeNumber(this.typeNumber);for(var i=0;i<18;i++){var mod=(!test&&((bits>>i)&1)==1);this.modules[Math.floor(i/3)][i%3+this.moduleCount-8-3]=mod;}
	for(var i=0;i<18;i++){var mod=(!test&&((bits>>i)&1)==1);this.modules[i%3+this.moduleCount-8-3][Math.floor(i/3)]=mod;}},setupTypeInfo:function(test,maskPattern){var data=(this.errorCorrectLevel<<3)|maskPattern;var bits=QRUtil.getBCHTypeInfo(data);for(var i=0;i<15;i++){var mod=(!test&&((bits>>i)&1)==1);if(i<6){this.modules[i][8]=mod;}else if(i<8){this.modules[i+1][8]=mod;}else{this.modules[this.moduleCount-15+i][8]=mod;}}
	for(var i=0;i<15;i++){var mod=(!test&&((bits>>i)&1)==1);if(i<8){this.modules[8][this.moduleCount-i-1]=mod;}else if(i<9){this.modules[8][15-i-1+1]=mod;}else{this.modules[8][15-i-1]=mod;}}
	this.modules[this.moduleCount-8][8]=(!test);},mapData:function(data,maskPattern){var inc=-1;var row=this.moduleCount-1;var bitIndex=7;var byteIndex=0;for(var col=this.moduleCount-1;col>0;col-=2){if(col==6)col--;while(true){for(var c=0;c<2;c++){if(this.modules[row][col-c]==null){var dark=false;if(byteIndex<data.length){dark=(((data[byteIndex]>>>bitIndex)&1)==1);}
	var mask=QRUtil.getMask(maskPattern,row,col-c);if(mask){dark=!dark;}
	this.modules[row][col-c]=dark;bitIndex--;if(bitIndex==-1){byteIndex++;bitIndex=7;}}}
	row+=inc;if(row<0||this.moduleCount<=row){row-=inc;inc=-inc;break;}}}}};QRCodeModel.PAD0=0xEC;QRCodeModel.PAD1=0x11;QRCodeModel.createData=function(typeNumber,errorCorrectLevel,dataList){var rsBlocks=QRRSBlock.getRSBlocks(typeNumber,errorCorrectLevel);var buffer=new QRBitBuffer();for(var i=0;i<dataList.length;i++){var data=dataList[i];buffer.put(data.mode,4);buffer.put(data.getLength(),QRUtil.getLengthInBits(data.mode,typeNumber));data.write(buffer);}
	var totalDataCount=0;for(var i=0;i<rsBlocks.length;i++){totalDataCount+=rsBlocks[i].dataCount;}
	if(buffer.getLengthInBits()>totalDataCount*8){throw new Error("code length overflow. ("
	+buffer.getLengthInBits()
	+">"
	+totalDataCount*8
	+")");}
	if(buffer.getLengthInBits()+4<=totalDataCount*8){buffer.put(0,4);}
	while(buffer.getLengthInBits()%8!=0){buffer.putBit(false);}
	while(true){if(buffer.getLengthInBits()>=totalDataCount*8){break;}
	buffer.put(QRCodeModel.PAD0,8);if(buffer.getLengthInBits()>=totalDataCount*8){break;}
	buffer.put(QRCodeModel.PAD1,8);}
	return QRCodeModel.createBytes(buffer,rsBlocks);};QRCodeModel.createBytes=function(buffer,rsBlocks){var offset=0;var maxDcCount=0;var maxEcCount=0;var dcdata=new Array(rsBlocks.length);var ecdata=new Array(rsBlocks.length);for(var r=0;r<rsBlocks.length;r++){var dcCount=rsBlocks[r].dataCount;var ecCount=rsBlocks[r].totalCount-dcCount;maxDcCount=Math.max(maxDcCount,dcCount);maxEcCount=Math.max(maxEcCount,ecCount);dcdata[r]=new Array(dcCount);for(var i=0;i<dcdata[r].length;i++){dcdata[r][i]=0xff&buffer.buffer[i+offset];}
	offset+=dcCount;var rsPoly=QRUtil.getErrorCorrectPolynomial(ecCount);var rawPoly=new QRPolynomial(dcdata[r],rsPoly.getLength()-1);var modPoly=rawPoly.mod(rsPoly);ecdata[r]=new Array(rsPoly.getLength()-1);for(var i=0;i<ecdata[r].length;i++){var modIndex=i+modPoly.getLength()-ecdata[r].length;ecdata[r][i]=(modIndex>=0)?modPoly.get(modIndex):0;}}
	var totalCodeCount=0;for(var i=0;i<rsBlocks.length;i++){totalCodeCount+=rsBlocks[i].totalCount;}
	var data=new Array(totalCodeCount);var index=0;for(var i=0;i<maxDcCount;i++){for(var r=0;r<rsBlocks.length;r++){if(i<dcdata[r].length){data[index++]=dcdata[r][i];}}}
	for(var i=0;i<maxEcCount;i++){for(var r=0;r<rsBlocks.length;r++){if(i<ecdata[r].length){data[index++]=ecdata[r][i];}}}
	return data;};var QRMode={MODE_NUMBER:1<<0,MODE_ALPHA_NUM:1<<1,MODE_8BIT_BYTE:1<<2,MODE_KANJI:1<<3};var QRErrorCorrectLevel={L:1,M:0,Q:3,H:2};var QRMaskPattern={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};var QRUtil={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:(1<<10)|(1<<8)|(1<<5)|(1<<4)|(1<<2)|(1<<1)|(1<<0),G18:(1<<12)|(1<<11)|(1<<10)|(1<<9)|(1<<8)|(1<<5)|(1<<2)|(1<<0),G15_MASK:(1<<14)|(1<<12)|(1<<10)|(1<<4)|(1<<1),getBCHTypeInfo:function(data){var d=data<<10;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)>=0){d^=(QRUtil.G15<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G15)));}
	return((data<<10)|d)^QRUtil.G15_MASK;},getBCHTypeNumber:function(data){var d=data<<12;while(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)>=0){d^=(QRUtil.G18<<(QRUtil.getBCHDigit(d)-QRUtil.getBCHDigit(QRUtil.G18)));}
	return(data<<12)|d;},getBCHDigit:function(data){var digit=0;while(data!=0){digit++;data>>>=1;}
	return digit;},getPatternPosition:function(typeNumber){return QRUtil.PATTERN_POSITION_TABLE[typeNumber-1];},getMask:function(maskPattern,i,j){switch(maskPattern){case QRMaskPattern.PATTERN000:return(i+j)%2==0;case QRMaskPattern.PATTERN001:return i%2==0;case QRMaskPattern.PATTERN010:return j%3==0;case QRMaskPattern.PATTERN011:return(i+j)%3==0;case QRMaskPattern.PATTERN100:return(Math.floor(i/2)+Math.floor(j/3))%2==0;case QRMaskPattern.PATTERN101:return(i*j)%2+(i*j)%3==0;case QRMaskPattern.PATTERN110:return((i*j)%2+(i*j)%3)%2==0;case QRMaskPattern.PATTERN111:return((i*j)%3+(i+j)%2)%2==0;default:throw new Error("bad maskPattern:"+maskPattern);}},getErrorCorrectPolynomial:function(errorCorrectLength){var a=new QRPolynomial([1],0);for(var i=0;i<errorCorrectLength;i++){a=a.multiply(new QRPolynomial([1,QRMath.gexp(i)],0));}
	return a;},getLengthInBits:function(mode,type){if(1<=type&&type<10){switch(mode){case QRMode.MODE_NUMBER:return 10;case QRMode.MODE_ALPHA_NUM:return 9;case QRMode.MODE_8BIT_BYTE:return 8;case QRMode.MODE_KANJI:return 8;default:throw new Error("mode:"+mode);}}else if(type<27){switch(mode){case QRMode.MODE_NUMBER:return 12;case QRMode.MODE_ALPHA_NUM:return 11;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 10;default:throw new Error("mode:"+mode);}}else if(type<41){switch(mode){case QRMode.MODE_NUMBER:return 14;case QRMode.MODE_ALPHA_NUM:return 13;case QRMode.MODE_8BIT_BYTE:return 16;case QRMode.MODE_KANJI:return 12;default:throw new Error("mode:"+mode);}}else{throw new Error("type:"+type);}},getLostPoint:function(qrCode){var moduleCount=qrCode.getModuleCount();var lostPoint=0;for(var row=0;row<moduleCount;row++){for(var col=0;col<moduleCount;col++){var sameCount=0;var dark=qrCode.isDark(row,col);for(var r=-1;r<=1;r++){if(row+r<0||moduleCount<=row+r){continue;}
	for(var c=-1;c<=1;c++){if(col+c<0||moduleCount<=col+c){continue;}
	if(r==0&&c==0){continue;}
	if(dark==qrCode.isDark(row+r,col+c)){sameCount++;}}}
	if(sameCount>5){lostPoint+=(3+sameCount-5);}}}
	for(var row=0;row<moduleCount-1;row++){for(var col=0;col<moduleCount-1;col++){var count=0;if(qrCode.isDark(row,col))count++;if(qrCode.isDark(row+1,col))count++;if(qrCode.isDark(row,col+1))count++;if(qrCode.isDark(row+1,col+1))count++;if(count==0||count==4){lostPoint+=3;}}}
	for(var row=0;row<moduleCount;row++){for(var col=0;col<moduleCount-6;col++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row,col+1)&&qrCode.isDark(row,col+2)&&qrCode.isDark(row,col+3)&&qrCode.isDark(row,col+4)&&!qrCode.isDark(row,col+5)&&qrCode.isDark(row,col+6)){lostPoint+=40;}}}
	for(var col=0;col<moduleCount;col++){for(var row=0;row<moduleCount-6;row++){if(qrCode.isDark(row,col)&&!qrCode.isDark(row+1,col)&&qrCode.isDark(row+2,col)&&qrCode.isDark(row+3,col)&&qrCode.isDark(row+4,col)&&!qrCode.isDark(row+5,col)&&qrCode.isDark(row+6,col)){lostPoint+=40;}}}
	var darkCount=0;for(var col=0;col<moduleCount;col++){for(var row=0;row<moduleCount;row++){if(qrCode.isDark(row,col)){darkCount++;}}}
	var ratio=Math.abs(100*darkCount/moduleCount/moduleCount-50)/5;lostPoint+=ratio*10;return lostPoint;}};var QRMath={glog:function(n){if(n<1){throw new Error("glog("+n+")");}
	return QRMath.LOG_TABLE[n];},gexp:function(n){while(n<0){n+=255;}
	while(n>=256){n-=255;}
	return QRMath.EXP_TABLE[n];},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)};for(var i=0;i<8;i++){QRMath.EXP_TABLE[i]=1<<i;}
	for(var i=8;i<256;i++){QRMath.EXP_TABLE[i]=QRMath.EXP_TABLE[i-4]^QRMath.EXP_TABLE[i-5]^QRMath.EXP_TABLE[i-6]^QRMath.EXP_TABLE[i-8];}
	for(var i=0;i<255;i++){QRMath.LOG_TABLE[QRMath.EXP_TABLE[i]]=i;}
	function QRPolynomial(num,shift){if(num.length==undefined){throw new Error(num.length+"/"+shift);}
	var offset=0;while(offset<num.length&&num[offset]==0){offset++;}
	this.num=new Array(num.length-offset+shift);for(var i=0;i<num.length-offset;i++){this.num[i]=num[i+offset];}}
	QRPolynomial.prototype={get:function(index){return this.num[index];},getLength:function(){return this.num.length;},multiply:function(e){var num=new Array(this.getLength()+e.getLength()-1);for(var i=0;i<this.getLength();i++){for(var j=0;j<e.getLength();j++){num[i+j]^=QRMath.gexp(QRMath.glog(this.get(i))+QRMath.glog(e.get(j)));}}
	return new QRPolynomial(num,0);},mod:function(e){if(this.getLength()-e.getLength()<0){return this;}
	var ratio=QRMath.glog(this.get(0))-QRMath.glog(e.get(0));var num=new Array(this.getLength());for(var i=0;i<this.getLength();i++){num[i]=this.get(i);}
	for(var i=0;i<e.getLength();i++){num[i]^=QRMath.gexp(QRMath.glog(e.get(i))+ratio);}
	return new QRPolynomial(num,0).mod(e);}};function QRRSBlock(totalCount,dataCount){this.totalCount=totalCount;this.dataCount=dataCount;}
	QRRSBlock.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];QRRSBlock.getRSBlocks=function(typeNumber,errorCorrectLevel){var rsBlock=QRRSBlock.getRsBlockTable(typeNumber,errorCorrectLevel);if(rsBlock==undefined){throw new Error("bad rs block @ typeNumber:"+typeNumber+"/errorCorrectLevel:"+errorCorrectLevel);}
	var length=rsBlock.length/3;var list=[];for(var i=0;i<length;i++){var count=rsBlock[i*3+0];var totalCount=rsBlock[i*3+1];var dataCount=rsBlock[i*3+2];for(var j=0;j<count;j++){list.push(new QRRSBlock(totalCount,dataCount));}}
	return list;};QRRSBlock.getRsBlockTable=function(typeNumber,errorCorrectLevel){switch(errorCorrectLevel){case QRErrorCorrectLevel.L:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+0];case QRErrorCorrectLevel.M:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+1];case QRErrorCorrectLevel.Q:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+2];case QRErrorCorrectLevel.H:return QRRSBlock.RS_BLOCK_TABLE[(typeNumber-1)*4+3];default:return undefined;}};function QRBitBuffer(){this.buffer=[];this.length=0;}
	QRBitBuffer.prototype={get:function(index){var bufIndex=Math.floor(index/8);return((this.buffer[bufIndex]>>>(7-index%8))&1)==1;},put:function(num,length){for(var i=0;i<length;i++){this.putBit(((num>>>(length-i-1))&1)==1);}},getLengthInBits:function(){return this.length;},putBit:function(bit){var bufIndex=Math.floor(this.length/8);if(this.buffer.length<=bufIndex){this.buffer.push(0);}
	if(bit){this.buffer[bufIndex]|=(0x80>>>(this.length%8));}
	this.length++;}};var QRCodeLimitLength=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]];

	function _isSupportCanvas() {
		return typeof CanvasRenderingContext2D != "undefined";
	}

	// android 2.x doesn't support Data-URI spec
	function _getAndroid() {
		var android = false;
		var sAgent = navigator.userAgent;

		if (/android/i.test(sAgent)) { // android
			android = true;
			var aMat = sAgent.toString().match(/android ([0-9]\.[0-9])/i);

			if (aMat && aMat[1]) {
				android = parseFloat(aMat[1]);
			}
		}

		return android;
	}

	var svgDrawer = (function() {

		var Drawing = function (el, htOption) {
			this._el = el;
			this._htOption = htOption;
		};

		Drawing.prototype.draw = function (oQRCode) {
			var _htOption = this._htOption;
			var _el = this._el;
			var nCount = oQRCode.getModuleCount();
			var nWidth = Math.floor(_htOption.width / nCount);
			var nHeight = Math.floor(_htOption.height / nCount);

			this.clear();

			function makeSVG(tag, attrs) {
				var el = document.createElementNS('http://www.w3.org/2000/svg', tag);
				for (var k in attrs)
					if (attrs.hasOwnProperty(k)) el.setAttribute(k, attrs[k]);
				return el;
			}

			var svg = makeSVG("svg" , {'viewBox': '0 0 ' + String(nCount) + " " + String(nCount), 'width': '100%', 'height': '100%', 'fill': _htOption.colorLight});
			svg.setAttributeNS("http://www.w3.org/2000/xmlns/", "xmlns:xlink", "http://www.w3.org/1999/xlink");
			_el.appendChild(svg);

			svg.appendChild(makeSVG("rect", {"fill": _htOption.colorLight, "width": "100%", "height": "100%"}));
			svg.appendChild(makeSVG("rect", {"fill": _htOption.colorDark, "width": "1", "height": "1", "id": "template"}));

			for (var row = 0; row < nCount; row++) {
				for (var col = 0; col < nCount; col++) {
					if (oQRCode.isDark(row, col)) {
						var child = makeSVG("use", {"x": String(col), "y": String(row)});
						child.setAttributeNS("http://www.w3.org/1999/xlink", "href", "#template")
						svg.appendChild(child);
					}
				}
			}
		};
		Drawing.prototype.clear = function () {
			while (this._el.hasChildNodes())
				this._el.removeChild(this._el.lastChild);
		};
		return Drawing;
	})();

	var useSVG = document.documentElement.tagName.toLowerCase() === "svg";

	// Drawing in DOM by using Table tag
	var Drawing = useSVG ? svgDrawer : !_isSupportCanvas() ? (function () {
		var Drawing = function (el, htOption) {
			this._el = el;
			this._htOption = htOption;
		};

		/**
		 * Draw the QRCode
		 *
		 * @param {QRCode} oQRCode
		 */
		Drawing.prototype.draw = function (oQRCode) {
            var _htOption = this._htOption;
            var _el = this._el;
			var nCount = oQRCode.getModuleCount();
			var nWidth = Math.floor(_htOption.width / nCount);
			var nHeight = Math.floor(_htOption.height / nCount);
			var aHTML = ['<table style="border:0;border-collapse:collapse;">'];

			for (var row = 0; row < nCount; row++) {
				aHTML.push('<tr>');

				for (var col = 0; col < nCount; col++) {
					aHTML.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:' + nWidth + 'px;height:' + nHeight + 'px;background-color:' + (oQRCode.isDark(row, col) ? _htOption.colorDark : _htOption.colorLight) + ';"></td>');
				}

				aHTML.push('</tr>');
			}

			aHTML.push('</table>');
			_el.innerHTML = aHTML.join('');

			// Fix the margin values as real size.
			var elTable = _el.childNodes[0];
			var nLeftMarginTable = (_htOption.width - elTable.offsetWidth) / 2;
			var nTopMarginTable = (_htOption.height - elTable.offsetHeight) / 2;

			if (nLeftMarginTable > 0 && nTopMarginTable > 0) {
				elTable.style.margin = nTopMarginTable + "px " + nLeftMarginTable + "px";
			}
		};

		/**
		 * Clear the QRCode
		 */
		Drawing.prototype.clear = function () {
			this._el.innerHTML = '';
		};

		return Drawing;
	})() : (function () { // Drawing in Canvas
		function _onMakeImage() {
			this._elImage.src = this._elCanvas.toDataURL("image/png");
			this._elImage.style.display = "block";
			this._elCanvas.style.display = "none";
		}

		// Android 2.1 bug workaround
		// http://code.google.com/p/android/issues/detail?id=5141
		if (this._android && this._android <= 2.1) {
	    	var factor = 1 / window.devicePixelRatio;
	        var drawImage = CanvasRenderingContext2D.prototype.drawImage;
	    	CanvasRenderingContext2D.prototype.drawImage = function (image, sx, sy, sw, sh, dx, dy, dw, dh) {
	    		if (("nodeName" in image) && /img/i.test(image.nodeName)) {
		        	for (var i = arguments.length - 1; i >= 1; i--) {
		            	arguments[i] = arguments[i] * factor;
		        	}
	    		} else if (typeof dw == "undefined") {
	    			arguments[1] *= factor;
	    			arguments[2] *= factor;
	    			arguments[3] *= factor;
	    			arguments[4] *= factor;
	    		}

	        	drawImage.apply(this, arguments);
	    	};
		}

		/**
		 * Check whether the user's browser supports Data URI or not
		 *
		 * @private
		 * @param {Function} fSuccess Occurs if it supports Data URI
		 * @param {Function} fFail Occurs if it doesn't support Data URI
		 */
		function _safeSetDataURI(fSuccess, fFail) {
            var self = this;
            self._fFail = fFail;
            self._fSuccess = fSuccess;

            // Check it just once
            if (self._bSupportDataURI === null) {
                var el = document.createElement("img");
                var fOnError = function() {
                    self._bSupportDataURI = false;

                    if (self._fFail) {
                        self._fFail.call(self);
                    }
                };
                var fOnSuccess = function() {
                    self._bSupportDataURI = true;

                    if (self._fSuccess) {
                        self._fSuccess.call(self);
                    }
                };

                el.onabort = fOnError;
                el.onerror = fOnError;
                el.onload = fOnSuccess;
                el.src = "data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg=="; // the Image contains 1px data.
                return;
            } else if (self._bSupportDataURI === true && self._fSuccess) {
                self._fSuccess.call(self);
            } else if (self._bSupportDataURI === false && self._fFail) {
                self._fFail.call(self);
            }
		};

		/**
		 * Drawing QRCode by using canvas
		 *
		 * @constructor
		 * @param {HTMLElement} el
		 * @param {Object} htOption QRCode Options
		 */
		var Drawing = function (el, htOption) {
    		this._bIsPainted = false;
    		this._android = _getAndroid();

			this._htOption = htOption;
			this._elCanvas = document.createElement("canvas");
			this._elCanvas.width = htOption.width;
			this._elCanvas.height = htOption.height;
			el.appendChild(this._elCanvas);
			this._el = el;
			this._oContext = this._elCanvas.getContext("2d");
			this._bIsPainted = false;
			this._elImage = document.createElement("img");
			this._elImage.alt = "Scan me!";
			this._elImage.style.display = "none";
			this._el.appendChild(this._elImage);
			this._bSupportDataURI = null;
		};

		/**
		 * Draw the QRCode
		 *
		 * @param {QRCode} oQRCode
		 */
		Drawing.prototype.draw = function (oQRCode) {
            var _elImage = this._elImage;
            var _oContext = this._oContext;
            var _htOption = this._htOption;

			var nCount = oQRCode.getModuleCount();
			var nWidth = _htOption.width / nCount;
			var nHeight = _htOption.height / nCount;
			var nRoundedWidth = Math.round(nWidth);
			var nRoundedHeight = Math.round(nHeight);

			_elImage.style.display = "none";
			this.clear();

			for (var row = 0; row < nCount; row++) {
				for (var col = 0; col < nCount; col++) {
					var bIsDark = oQRCode.isDark(row, col);
					var nLeft = col * nWidth;
					var nTop = row * nHeight;
					_oContext.strokeStyle = bIsDark ? _htOption.colorDark : _htOption.colorLight;
					_oContext.lineWidth = 1;
					_oContext.fillStyle = bIsDark ? _htOption.colorDark : _htOption.colorLight;
					_oContext.fillRect(nLeft, nTop, nWidth, nHeight);

					// 안티 앨리어싱 방지 처리
					_oContext.strokeRect(
						Math.floor(nLeft) + 0.5,
						Math.floor(nTop) + 0.5,
						nRoundedWidth,
						nRoundedHeight
					);

					_oContext.strokeRect(
						Math.ceil(nLeft) - 0.5,
						Math.ceil(nTop) - 0.5,
						nRoundedWidth,
						nRoundedHeight
					);
				}
			}

			this._bIsPainted = true;
		};

		/**
		 * Make the image from Canvas if the browser supports Data URI.
		 */
		Drawing.prototype.makeImage = function () {
			if (this._bIsPainted) {
				_safeSetDataURI.call(this, _onMakeImage);
			}
		};

		/**
		 * Return whether the QRCode is painted or not
		 *
		 * @return {Boolean}
		 */
		Drawing.prototype.isPainted = function () {
			return this._bIsPainted;
		};

		/**
		 * Clear the QRCode
		 */
		Drawing.prototype.clear = function () {
			this._oContext.clearRect(0, 0, this._elCanvas.width, this._elCanvas.height);
			this._bIsPainted = false;
		};

		/**
		 * @private
		 * @param {Number} nNumber
		 */
		Drawing.prototype.round = function (nNumber) {
			if (!nNumber) {
				return nNumber;
			}

			return Math.floor(nNumber * 1000) / 1000;
		};

		return Drawing;
	})();

	/**
	 * Get the type by string length
	 *
	 * @private
	 * @param {String} sText
	 * @param {Number} nCorrectLevel
	 * @return {Number} type
	 */
	function _getTypeNumber(sText, nCorrectLevel) {
		var nType = 1;
		var length = _getUTF8Length(sText);

		for (var i = 0, len = QRCodeLimitLength.length; i <= len; i++) {
			var nLimit = 0;

			switch (nCorrectLevel) {
				case QRErrorCorrectLevel.L :
					nLimit = QRCodeLimitLength[i][0];
					break;
				case QRErrorCorrectLevel.M :
					nLimit = QRCodeLimitLength[i][1];
					break;
				case QRErrorCorrectLevel.Q :
					nLimit = QRCodeLimitLength[i][2];
					break;
				case QRErrorCorrectLevel.H :
					nLimit = QRCodeLimitLength[i][3];
					break;
			}

			if (length <= nLimit) {
				break;
			} else {
				nType++;
			}
		}

		if (nType > QRCodeLimitLength.length) {
			throw new Error("Too long data");
		}

		return nType;
	}

	function _getUTF8Length(sText) {
		var replacedText = encodeURI(sText).toString().replace(/\%[0-9a-fA-F]{2}/g, 'a');
		return replacedText.length + (replacedText.length != sText ? 3 : 0);
	}

	/**
	 * @class QRCode
	 * @constructor
	 * @example
	 * new QRCode(document.getElementById("test"), "http://jindo.dev.naver.com/collie");
	 *
	 * @example
	 * var oQRCode = new QRCode("test", {
	 *    text : "http://naver.com",
	 *    width : 128,
	 *    height : 128
	 * });
	 *
	 * oQRCode.clear(); // Clear the QRCode.
	 * oQRCode.makeCode("http://map.naver.com"); // Re-create the QRCode.
	 *
	 * @param {HTMLElement|String} el target element or 'id' attribute of element.
	 * @param {Object|String} vOption
	 * @param {String} vOption.text QRCode link data
	 * @param {Number} [vOption.width=256]
	 * @param {Number} [vOption.height=256]
	 * @param {String} [vOption.colorDark="#000000"]
	 * @param {String} [vOption.colorLight="#ffffff"]
	 * @param {QRCode.CorrectLevel} [vOption.correctLevel=QRCode.CorrectLevel.H] [L|M|Q|H]
	 */
	QRCode = function (el, vOption) {
		this._htOption = {
			width : 256,
			height : 256,
			typeNumber : 4,
			colorDark : "#000000",
			colorLight : "#ffffff",
			correctLevel : QRErrorCorrectLevel.H
		};

		if (typeof vOption === 'string') {
			vOption	= {
				text : vOption
			};
		}

		// Overwrites options
		if (vOption) {
			for (var i in vOption) {
				this._htOption[i] = vOption[i];
			}
		}

		if (typeof el == "string") {
			el = document.getElementById(el);
		}

		if (this._htOption.useSVG) {
			Drawing = svgDrawer;
		}

		this._android = _getAndroid();
		this._el = el;
		this._oQRCode = null;
		this._oDrawing = new Drawing(this._el, this._htOption);

		if (this._htOption.text) {
			this.makeCode(this._htOption.text);
		}
	};

	/**
	 * Make the QRCode
	 *
	 * @param {String} sText link data
	 */
	QRCode.prototype.makeCode = function (sText) {
		this._oQRCode = new QRCodeModel(_getTypeNumber(sText, this._htOption.correctLevel), this._htOption.correctLevel);
		this._oQRCode.addData(sText);
		this._oQRCode.make();
		this._el.title = sText;
		this._oDrawing.draw(this._oQRCode);
		this.makeImage();
	};

	/**
	 * Make the Image from Canvas element
	 * - It occurs automatically
	 * - Android below 3 doesn't support Data-URI spec.
	 *
	 * @private
	 */
	QRCode.prototype.makeImage = function () {
		if (typeof this._oDrawing.makeImage == "function" && (!this._android || this._android >= 3)) {
			this._oDrawing.makeImage();
		}
	};

	/**
	 * Clear the QRCode
	 */
	QRCode.prototype.clear = function () {
		this._oDrawing.clear();
	};

	/**
	 * @name QRCode.CorrectLevel
	 */
	QRCode.CorrectLevel = QRErrorCorrectLevel;
	
	return QRCode;
	
}));


/***/ }),

/***/ "OYls":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("crlp")('asyncIterator');


/***/ }),

/***/ "OvRC":
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__("oM7Q"), __esModule: true };

/***/ }),

/***/ "OxAu":
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),

/***/ "QWe/":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("crlp")('observable');


/***/ }),

/***/ "Rrel":
/***/ (function(module, exports, __webpack_require__) {

// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window
var toIObject = __webpack_require__("TcQ7");
var gOPN = __webpack_require__("n0T6").f;
var toString = {}.toString;

var windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames
  ? Object.getOwnPropertyNames(window) : [];

var getWindowNames = function (it) {
  try {
    return gOPN(it);
  } catch (e) {
    return windowNames.slice();
  }
};

module.exports.f = function getOwnPropertyNames(it) {
  return windowNames && toString.call(it) == '[object Window]' ? getWindowNames(it) : gOPN(toIObject(it));
};


/***/ }),

/***/ "SldL":
/***/ (function(module, exports) {

/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

!(function(global) {
  "use strict";

  var Op = Object.prototype;
  var hasOwn = Op.hasOwnProperty;
  var undefined; // More compressible than void 0.
  var $Symbol = typeof Symbol === "function" ? Symbol : {};
  var iteratorSymbol = $Symbol.iterator || "@@iterator";
  var asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator";
  var toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag";

  var inModule = typeof module === "object";
  var runtime = global.regeneratorRuntime;
  if (runtime) {
    if (inModule) {
      // If regeneratorRuntime is defined globally and we're in a module,
      // make the exports object identical to regeneratorRuntime.
      module.exports = runtime;
    }
    // Don't bother evaluating the rest of this file if the runtime was
    // already defined globally.
    return;
  }

  // Define the runtime globally (as expected by generated code) as either
  // module.exports (if we're in a module) or a new, empty object.
  runtime = global.regeneratorRuntime = inModule ? module.exports : {};

  function wrap(innerFn, outerFn, self, tryLocsList) {
    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;
    var generator = Object.create(protoGenerator.prototype);
    var context = new Context(tryLocsList || []);

    // The ._invoke method unifies the implementations of the .next,
    // .throw, and .return methods.
    generator._invoke = makeInvokeMethod(innerFn, self, context);

    return generator;
  }
  runtime.wrap = wrap;

  // Try/catch helper to minimize deoptimizations. Returns a completion
  // record like context.tryEntries[i].completion. This interface could
  // have been (and was previously) designed to take a closure to be
  // invoked without arguments, but in all the cases we care about we
  // already have an existing method we want to call, so there's no need
  // to create a new function object. We can even get away with assuming
  // the method takes exactly one argument, since that happens to be true
  // in every case, so we don't have to touch the arguments object. The
  // only additional allocation required is the completion record, which
  // has a stable shape and so hopefully should be cheap to allocate.
  function tryCatch(fn, obj, arg) {
    try {
      return { type: "normal", arg: fn.call(obj, arg) };
    } catch (err) {
      return { type: "throw", arg: err };
    }
  }

  var GenStateSuspendedStart = "suspendedStart";
  var GenStateSuspendedYield = "suspendedYield";
  var GenStateExecuting = "executing";
  var GenStateCompleted = "completed";

  // Returning this object from the innerFn has the same effect as
  // breaking out of the dispatch switch statement.
  var ContinueSentinel = {};

  // Dummy constructor functions that we use as the .constructor and
  // .constructor.prototype properties for functions that return Generator
  // objects. For full spec compliance, you may wish to configure your
  // minifier not to mangle the names of these two functions.
  function Generator() {}
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}

  // This is a polyfill for %IteratorPrototype% for environments that
  // don't natively support it.
  var IteratorPrototype = {};
  IteratorPrototype[iteratorSymbol] = function () {
    return this;
  };

  var getProto = Object.getPrototypeOf;
  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));
  if (NativeIteratorPrototype &&
      NativeIteratorPrototype !== Op &&
      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {
    // This environment has a native %IteratorPrototype%; use it instead
    // of the polyfill.
    IteratorPrototype = NativeIteratorPrototype;
  }

  var Gp = GeneratorFunctionPrototype.prototype =
    Generator.prototype = Object.create(IteratorPrototype);
  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;
  GeneratorFunctionPrototype.constructor = GeneratorFunction;
  GeneratorFunctionPrototype[toStringTagSymbol] =
    GeneratorFunction.displayName = "GeneratorFunction";

  // Helper for defining the .next, .throw, and .return methods of the
  // Iterator interface in terms of a single ._invoke method.
  function defineIteratorMethods(prototype) {
    ["next", "throw", "return"].forEach(function(method) {
      prototype[method] = function(arg) {
        return this._invoke(method, arg);
      };
    });
  }

  runtime.isGeneratorFunction = function(genFun) {
    var ctor = typeof genFun === "function" && genFun.constructor;
    return ctor
      ? ctor === GeneratorFunction ||
        // For the native GeneratorFunction constructor, the best we can
        // do is to check its .name property.
        (ctor.displayName || ctor.name) === "GeneratorFunction"
      : false;
  };

  runtime.mark = function(genFun) {
    if (Object.setPrototypeOf) {
      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);
    } else {
      genFun.__proto__ = GeneratorFunctionPrototype;
      if (!(toStringTagSymbol in genFun)) {
        genFun[toStringTagSymbol] = "GeneratorFunction";
      }
    }
    genFun.prototype = Object.create(Gp);
    return genFun;
  };

  // Within the body of any async function, `await x` is transformed to
  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
  // `hasOwn.call(value, "__await")` to determine if the yielded value is
  // meant to be awaited.
  runtime.awrap = function(arg) {
    return { __await: arg };
  };

  function AsyncIterator(generator) {
    function invoke(method, arg, resolve, reject) {
      var record = tryCatch(generator[method], generator, arg);
      if (record.type === "throw") {
        reject(record.arg);
      } else {
        var result = record.arg;
        var value = result.value;
        if (value &&
            typeof value === "object" &&
            hasOwn.call(value, "__await")) {
          return Promise.resolve(value.__await).then(function(value) {
            invoke("next", value, resolve, reject);
          }, function(err) {
            invoke("throw", err, resolve, reject);
          });
        }

        return Promise.resolve(value).then(function(unwrapped) {
          // When a yielded Promise is resolved, its final value becomes
          // the .value of the Promise<{value,done}> result for the
          // current iteration. If the Promise is rejected, however, the
          // result for this iteration will be rejected with the same
          // reason. Note that rejections of yielded Promises are not
          // thrown back into the generator function, as is the case
          // when an awaited Promise is rejected. This difference in
          // behavior between yield and await is important, because it
          // allows the consumer to decide what to do with the yielded
          // rejection (swallow it and continue, manually .throw it back
          // into the generator, abandon iteration, whatever). With
          // await, by contrast, there is no opportunity to examine the
          // rejection reason outside the generator function, so the
          // only option is to throw it from the await expression, and
          // let the generator function handle the exception.
          result.value = unwrapped;
          resolve(result);
        }, reject);
      }
    }

    var previousPromise;

    function enqueue(method, arg) {
      function callInvokeWithMethodAndArg() {
        return new Promise(function(resolve, reject) {
          invoke(method, arg, resolve, reject);
        });
      }

      return previousPromise =
        // If enqueue has been called before, then we want to wait until
        // all previous Promises have been resolved before calling invoke,
        // so that results are always delivered in the correct order. If
        // enqueue has not been called before, then it is important to
        // call invoke immediately, without waiting on a callback to fire,
        // so that the async generator function has the opportunity to do
        // any necessary setup in a predictable way. This predictability
        // is why the Promise constructor synchronously invokes its
        // executor callback, and why async functions synchronously
        // execute code before the first await. Since we implement simple
        // async functions in terms of async generators, it is especially
        // important to get this right, even though it requires care.
        previousPromise ? previousPromise.then(
          callInvokeWithMethodAndArg,
          // Avoid propagating failures to Promises returned by later
          // invocations of the iterator.
          callInvokeWithMethodAndArg
        ) : callInvokeWithMethodAndArg();
    }

    // Define the unified helper method that is used to implement .next,
    // .throw, and .return (see defineIteratorMethods).
    this._invoke = enqueue;
  }

  defineIteratorMethods(AsyncIterator.prototype);
  AsyncIterator.prototype[asyncIteratorSymbol] = function () {
    return this;
  };
  runtime.AsyncIterator = AsyncIterator;

  // Note that simple async functions are implemented on top of
  // AsyncIterator objects; they just return a Promise for the value of
  // the final result produced by the iterator.
  runtime.async = function(innerFn, outerFn, self, tryLocsList) {
    var iter = new AsyncIterator(
      wrap(innerFn, outerFn, self, tryLocsList)
    );

    return runtime.isGeneratorFunction(outerFn)
      ? iter // If outerFn is a generator, return the full iterator.
      : iter.next().then(function(result) {
          return result.done ? result.value : iter.next();
        });
  };

  function makeInvokeMethod(innerFn, self, context) {
    var state = GenStateSuspendedStart;

    return function invoke(method, arg) {
      if (state === GenStateExecuting) {
        throw new Error("Generator is already running");
      }

      if (state === GenStateCompleted) {
        if (method === "throw") {
          throw arg;
        }

        // Be forgiving, per 25.3.3.3.3 of the spec:
        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
        return doneResult();
      }

      context.method = method;
      context.arg = arg;

      while (true) {
        var delegate = context.delegate;
        if (delegate) {
          var delegateResult = maybeInvokeDelegate(delegate, context);
          if (delegateResult) {
            if (delegateResult === ContinueSentinel) continue;
            return delegateResult;
          }
        }

        if (context.method === "next") {
          // Setting context._sent for legacy support of Babel's
          // function.sent implementation.
          context.sent = context._sent = context.arg;

        } else if (context.method === "throw") {
          if (state === GenStateSuspendedStart) {
            state = GenStateCompleted;
            throw context.arg;
          }

          context.dispatchException(context.arg);

        } else if (context.method === "return") {
          context.abrupt("return", context.arg);
        }

        state = GenStateExecuting;

        var record = tryCatch(innerFn, self, context);
        if (record.type === "normal") {
          // If an exception is thrown from innerFn, we leave state ===
          // GenStateExecuting and loop back for another invocation.
          state = context.done
            ? GenStateCompleted
            : GenStateSuspendedYield;

          if (record.arg === ContinueSentinel) {
            continue;
          }

          return {
            value: record.arg,
            done: context.done
          };

        } else if (record.type === "throw") {
          state = GenStateCompleted;
          // Dispatch the exception by looping back around to the
          // context.dispatchException(context.arg) call above.
          context.method = "throw";
          context.arg = record.arg;
        }
      }
    };
  }

  // Call delegate.iterator[context.method](context.arg) and handle the
  // result, either by returning a { value, done } result from the
  // delegate iterator, or by modifying context.method and context.arg,
  // setting context.delegate to null, and returning the ContinueSentinel.
  function maybeInvokeDelegate(delegate, context) {
    var method = delegate.iterator[context.method];
    if (method === undefined) {
      // A .throw or .return when the delegate iterator has no .throw
      // method always terminates the yield* loop.
      context.delegate = null;

      if (context.method === "throw") {
        if (delegate.iterator.return) {
          // If the delegate iterator has a return method, give it a
          // chance to clean up.
          context.method = "return";
          context.arg = undefined;
          maybeInvokeDelegate(delegate, context);

          if (context.method === "throw") {
            // If maybeInvokeDelegate(context) changed context.method from
            // "return" to "throw", let that override the TypeError below.
            return ContinueSentinel;
          }
        }

        context.method = "throw";
        context.arg = new TypeError(
          "The iterator does not provide a 'throw' method");
      }

      return ContinueSentinel;
    }

    var record = tryCatch(method, delegate.iterator, context.arg);

    if (record.type === "throw") {
      context.method = "throw";
      context.arg = record.arg;
      context.delegate = null;
      return ContinueSentinel;
    }

    var info = record.arg;

    if (! info) {
      context.method = "throw";
      context.arg = new TypeError("iterator result is not an object");
      context.delegate = null;
      return ContinueSentinel;
    }

    if (info.done) {
      // Assign the result of the finished delegate to the temporary
      // variable specified by delegate.resultName (see delegateYield).
      context[delegate.resultName] = info.value;

      // Resume execution at the desired location (see delegateYield).
      context.next = delegate.nextLoc;

      // If context.method was "throw" but the delegate handled the
      // exception, let the outer generator proceed normally. If
      // context.method was "next", forget context.arg since it has been
      // "consumed" by the delegate iterator. If context.method was
      // "return", allow the original .return call to continue in the
      // outer generator.
      if (context.method !== "return") {
        context.method = "next";
        context.arg = undefined;
      }

    } else {
      // Re-yield the result returned by the delegate method.
      return info;
    }

    // The delegate iterator is finished, so forget it and continue with
    // the outer generator.
    context.delegate = null;
    return ContinueSentinel;
  }

  // Define Generator.prototype.{next,throw,return} in terms of the
  // unified ._invoke helper method.
  defineIteratorMethods(Gp);

  Gp[toStringTagSymbol] = "Generator";

  // A Generator should always return itself as the iterator object when the
  // @@iterator function is called on it. Some browsers' implementations of the
  // iterator prototype chain incorrectly implement this, causing the Generator
  // object to not be returned from this call. This ensures that doesn't happen.
  // See https://github.com/facebook/regenerator/issues/274 for more details.
  Gp[iteratorSymbol] = function() {
    return this;
  };

  Gp.toString = function() {
    return "[object Generator]";
  };

  function pushTryEntry(locs) {
    var entry = { tryLoc: locs[0] };

    if (1 in locs) {
      entry.catchLoc = locs[1];
    }

    if (2 in locs) {
      entry.finallyLoc = locs[2];
      entry.afterLoc = locs[3];
    }

    this.tryEntries.push(entry);
  }

  function resetTryEntry(entry) {
    var record = entry.completion || {};
    record.type = "normal";
    delete record.arg;
    entry.completion = record;
  }

  function Context(tryLocsList) {
    // The root entry object (effectively a try statement without a catch
    // or a finally block) gives us a place to store values thrown from
    // locations where there is no enclosing try statement.
    this.tryEntries = [{ tryLoc: "root" }];
    tryLocsList.forEach(pushTryEntry, this);
    this.reset(true);
  }

  runtime.keys = function(object) {
    var keys = [];
    for (var key in object) {
      keys.push(key);
    }
    keys.reverse();

    // Rather than returning an object with a next method, we keep
    // things simple and return the next function itself.
    return function next() {
      while (keys.length) {
        var key = keys.pop();
        if (key in object) {
          next.value = key;
          next.done = false;
          return next;
        }
      }

      // To avoid creating an additional object, we just hang the .value
      // and .done properties off the next function object itself. This
      // also ensures that the minifier will not anonymize the function.
      next.done = true;
      return next;
    };
  };

  function values(iterable) {
    if (iterable) {
      var iteratorMethod = iterable[iteratorSymbol];
      if (iteratorMethod) {
        return iteratorMethod.call(iterable);
      }

      if (typeof iterable.next === "function") {
        return iterable;
      }

      if (!isNaN(iterable.length)) {
        var i = -1, next = function next() {
          while (++i < iterable.length) {
            if (hasOwn.call(iterable, i)) {
              next.value = iterable[i];
              next.done = false;
              return next;
            }
          }

          next.value = undefined;
          next.done = true;

          return next;
        };

        return next.next = next;
      }
    }

    // Return an iterator with no values.
    return { next: doneResult };
  }
  runtime.values = values;

  function doneResult() {
    return { value: undefined, done: true };
  }

  Context.prototype = {
    constructor: Context,

    reset: function(skipTempReset) {
      this.prev = 0;
      this.next = 0;
      // Resetting context._sent for legacy support of Babel's
      // function.sent implementation.
      this.sent = this._sent = undefined;
      this.done = false;
      this.delegate = null;

      this.method = "next";
      this.arg = undefined;

      this.tryEntries.forEach(resetTryEntry);

      if (!skipTempReset) {
        for (var name in this) {
          // Not sure about the optimal order of these conditions:
          if (name.charAt(0) === "t" &&
              hasOwn.call(this, name) &&
              !isNaN(+name.slice(1))) {
            this[name] = undefined;
          }
        }
      }
    },

    stop: function() {
      this.done = true;

      var rootEntry = this.tryEntries[0];
      var rootRecord = rootEntry.completion;
      if (rootRecord.type === "throw") {
        throw rootRecord.arg;
      }

      return this.rval;
    },

    dispatchException: function(exception) {
      if (this.done) {
        throw exception;
      }

      var context = this;
      function handle(loc, caught) {
        record.type = "throw";
        record.arg = exception;
        context.next = loc;

        if (caught) {
          // If the dispatched exception was caught by a catch block,
          // then let that catch block handle the exception normally.
          context.method = "next";
          context.arg = undefined;
        }

        return !! caught;
      }

      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        var record = entry.completion;

        if (entry.tryLoc === "root") {
          // Exception thrown outside of any try block that could handle
          // it, so set the completion value of the entire function to
          // throw the exception.
          return handle("end");
        }

        if (entry.tryLoc <= this.prev) {
          var hasCatch = hasOwn.call(entry, "catchLoc");
          var hasFinally = hasOwn.call(entry, "finallyLoc");

          if (hasCatch && hasFinally) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            } else if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else if (hasCatch) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            }

          } else if (hasFinally) {
            if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else {
            throw new Error("try statement without catch or finally");
          }
        }
      }
    },

    abrupt: function(type, arg) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc <= this.prev &&
            hasOwn.call(entry, "finallyLoc") &&
            this.prev < entry.finallyLoc) {
          var finallyEntry = entry;
          break;
        }
      }

      if (finallyEntry &&
          (type === "break" ||
           type === "continue") &&
          finallyEntry.tryLoc <= arg &&
          arg <= finallyEntry.finallyLoc) {
        // Ignore the finally entry if control is not jumping to a
        // location outside the try/catch block.
        finallyEntry = null;
      }

      var record = finallyEntry ? finallyEntry.completion : {};
      record.type = type;
      record.arg = arg;

      if (finallyEntry) {
        this.method = "next";
        this.next = finallyEntry.finallyLoc;
        return ContinueSentinel;
      }

      return this.complete(record);
    },

    complete: function(record, afterLoc) {
      if (record.type === "throw") {
        throw record.arg;
      }

      if (record.type === "break" ||
          record.type === "continue") {
        this.next = record.arg;
      } else if (record.type === "return") {
        this.rval = this.arg = record.arg;
        this.method = "return";
        this.next = "end";
      } else if (record.type === "normal" && afterLoc) {
        this.next = afterLoc;
      }

      return ContinueSentinel;
    },

    finish: function(finallyLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.finallyLoc === finallyLoc) {
          this.complete(entry.completion, entry.afterLoc);
          resetTryEntry(entry);
          return ContinueSentinel;
        }
      }
    },

    "catch": function(tryLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc === tryLoc) {
          var record = entry.completion;
          if (record.type === "throw") {
            var thrown = record.arg;
            resetTryEntry(entry);
          }
          return thrown;
        }
      }

      // The context.catch method must only be called with a location
      // argument that corresponds to a known catch block.
      throw new Error("illegal catch attempt");
    },

    delegateYield: function(iterable, resultName, nextLoc) {
      this.delegate = {
        iterator: values(iterable),
        resultName: resultName,
        nextLoc: nextLoc
      };

      if (this.method === "next") {
        // Deliberately forget the last sent value so that we don't
        // accidentally pass it on to the delegate.
        this.arg = undefined;
      }

      return ContinueSentinel;
    }
  };
})(
  // In sloppy mode, unbound `this` refers to the global object, fallback to
  // Function constructor if we're in global strict mode. That is sadly a form
  // of indirect eval which violates Content Security Policy.
  (function() { return this })() || Function("return this")()
);


/***/ }),

/***/ "TeQy":
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),

/***/ "TmV0":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("fZOM");
module.exports = __webpack_require__("FeBl").Object.values;


/***/ }),

/***/ "Xc4G":
/***/ (function(module, exports, __webpack_require__) {

// all enumerable object keys, includes symbols
var getKeys = __webpack_require__("lktj");
var gOPS = __webpack_require__("1kS7");
var pIE = __webpack_require__("NpIQ");
module.exports = function (it) {
  var result = getKeys(it);
  var getSymbols = gOPS.f;
  if (getSymbols) {
    var symbols = getSymbols(it);
    var isEnum = pIE.f;
    var i = 0;
    var key;
    while (symbols.length > i) if (isEnum.call(it, key = symbols[i++])) result.push(key);
  } return result;
};


/***/ }),

/***/ "Xxa5":
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__("jyFz");


/***/ }),

/***/ "ZaQb":
/***/ (function(module, exports, __webpack_require__) {

// Works with __proto__ only. Old v8 can't work with null proto objects.
/* eslint-disable no-proto */
var isObject = __webpack_require__("EqjI");
var anObject = __webpack_require__("77Pl");
var check = function (O, proto) {
  anObject(O);
  if (!isObject(proto) && proto !== null) throw TypeError(proto + ": can't set as prototype!");
};
module.exports = {
  set: Object.setPrototypeOf || ('__proto__' in {} ? // eslint-disable-line
    function (test, buggy, set) {
      try {
        set = __webpack_require__("+ZMJ")(Function.call, __webpack_require__("LKZe").f(Object.prototype, '__proto__').set, 2);
        set(test, []);
        buggy = !(test instanceof Array);
      } catch (e) { buggy = true; }
      return function setPrototypeOf(O, proto) {
        check(O, proto);
        if (buggy) O.__proto__ = proto;
        else set(O, proto);
        return O;
      };
    }({}, false) : undefined),
  check: check
};


/***/ }),

/***/ "Zx67":
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__("fS6E"), __esModule: true };

/***/ }),

/***/ "Zzip":
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__("/n6Q"), __esModule: true };

/***/ }),

/***/ "cnlX":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("iInB");
var $Object = __webpack_require__("FeBl").Object;
module.exports = function getOwnPropertyDescriptor(it, key) {
  return $Object.getOwnPropertyDescriptor(it, key);
};


/***/ }),

/***/ "crlp":
/***/ (function(module, exports, __webpack_require__) {

var global = __webpack_require__("7KvD");
var core = __webpack_require__("FeBl");
var LIBRARY = __webpack_require__("O4g8");
var wksExt = __webpack_require__("Kh4W");
var defineProperty = __webpack_require__("evD5").f;
module.exports = function (name) {
  var $Symbol = core.Symbol || (core.Symbol = LIBRARY ? {} : global.Symbol || {});
  if (name.charAt(0) != '_' && !(name in $Symbol)) defineProperty($Symbol, name, { value: wksExt.f(name) });
};


/***/ }),

/***/ "exGp":
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _promise = __webpack_require__("//Fk");

var _promise2 = _interopRequireDefault(_promise);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (fn) {
  return function () {
    var gen = fn.apply(this, arguments);
    return new _promise2.default(function (resolve, reject) {
      function step(key, arg) {
        try {
          var info = gen[key](arg);
          var value = info.value;
        } catch (error) {
          reject(error);
          return;
        }

        if (info.done) {
          resolve(value);
        } else {
          return _promise2.default.resolve(value).then(function (value) {
            step("next", value);
          }, function (err) {
            step("throw", err);
          });
        }
      }

      return step("next");
    });
  };
};

/***/ }),

/***/ "exh5":
/***/ (function(module, exports, __webpack_require__) {

// 19.1.3.19 Object.setPrototypeOf(O, proto)
var $export = __webpack_require__("kM2E");
$export($export.S, 'Object', { setPrototypeOf: __webpack_require__("ZaQb").set });


/***/ }),

/***/ "f1Eh":
/***/ (function(module, exports) {

module.exports = function(originalModule) {
	if(!originalModule.webpackPolyfill) {
		var module = Object.create(originalModule);
		// module.parent = undefined by default
		if(!module.children) module.children = [];
		Object.defineProperty(module, "loaded", {
			enumerable: true,
			get: function() {
				return module.l;
			}
		});
		Object.defineProperty(module, "id", {
			enumerable: true,
			get: function() {
				return module.i;
			}
		});
		Object.defineProperty(module, "exports", {
			enumerable: true,
		});
		module.webpackPolyfill = 1;
	}
	return module;
};


/***/ }),

/***/ "fS6E":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("Kh5d");
module.exports = __webpack_require__("FeBl").Object.getPrototypeOf;


/***/ }),

/***/ "fWfb":
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// ECMAScript 6 symbols shim
var global = __webpack_require__("7KvD");
var has = __webpack_require__("D2L2");
var DESCRIPTORS = __webpack_require__("+E39");
var $export = __webpack_require__("kM2E");
var redefine = __webpack_require__("880/");
var META = __webpack_require__("06OY").KEY;
var $fails = __webpack_require__("S82l");
var shared = __webpack_require__("e8AB");
var setToStringTag = __webpack_require__("e6n0");
var uid = __webpack_require__("3Eo+");
var wks = __webpack_require__("dSzd");
var wksExt = __webpack_require__("Kh4W");
var wksDefine = __webpack_require__("crlp");
var enumKeys = __webpack_require__("Xc4G");
var isArray = __webpack_require__("7UMu");
var anObject = __webpack_require__("77Pl");
var isObject = __webpack_require__("EqjI");
var toObject = __webpack_require__("sB3e");
var toIObject = __webpack_require__("TcQ7");
var toPrimitive = __webpack_require__("MmMw");
var createDesc = __webpack_require__("X8DO");
var _create = __webpack_require__("Yobk");
var gOPNExt = __webpack_require__("Rrel");
var $GOPD = __webpack_require__("LKZe");
var $GOPS = __webpack_require__("1kS7");
var $DP = __webpack_require__("evD5");
var $keys = __webpack_require__("lktj");
var gOPD = $GOPD.f;
var dP = $DP.f;
var gOPN = gOPNExt.f;
var $Symbol = global.Symbol;
var $JSON = global.JSON;
var _stringify = $JSON && $JSON.stringify;
var PROTOTYPE = 'prototype';
var HIDDEN = wks('_hidden');
var TO_PRIMITIVE = wks('toPrimitive');
var isEnum = {}.propertyIsEnumerable;
var SymbolRegistry = shared('symbol-registry');
var AllSymbols = shared('symbols');
var OPSymbols = shared('op-symbols');
var ObjectProto = Object[PROTOTYPE];
var USE_NATIVE = typeof $Symbol == 'function' && !!$GOPS.f;
var QObject = global.QObject;
// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173
var setter = !QObject || !QObject[PROTOTYPE] || !QObject[PROTOTYPE].findChild;

// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687
var setSymbolDesc = DESCRIPTORS && $fails(function () {
  return _create(dP({}, 'a', {
    get: function () { return dP(this, 'a', { value: 7 }).a; }
  })).a != 7;
}) ? function (it, key, D) {
  var protoDesc = gOPD(ObjectProto, key);
  if (protoDesc) delete ObjectProto[key];
  dP(it, key, D);
  if (protoDesc && it !== ObjectProto) dP(ObjectProto, key, protoDesc);
} : dP;

var wrap = function (tag) {
  var sym = AllSymbols[tag] = _create($Symbol[PROTOTYPE]);
  sym._k = tag;
  return sym;
};

var isSymbol = USE_NATIVE && typeof $Symbol.iterator == 'symbol' ? function (it) {
  return typeof it == 'symbol';
} : function (it) {
  return it instanceof $Symbol;
};

var $defineProperty = function defineProperty(it, key, D) {
  if (it === ObjectProto) $defineProperty(OPSymbols, key, D);
  anObject(it);
  key = toPrimitive(key, true);
  anObject(D);
  if (has(AllSymbols, key)) {
    if (!D.enumerable) {
      if (!has(it, HIDDEN)) dP(it, HIDDEN, createDesc(1, {}));
      it[HIDDEN][key] = true;
    } else {
      if (has(it, HIDDEN) && it[HIDDEN][key]) it[HIDDEN][key] = false;
      D = _create(D, { enumerable: createDesc(0, false) });
    } return setSymbolDesc(it, key, D);
  } return dP(it, key, D);
};
var $defineProperties = function defineProperties(it, P) {
  anObject(it);
  var keys = enumKeys(P = toIObject(P));
  var i = 0;
  var l = keys.length;
  var key;
  while (l > i) $defineProperty(it, key = keys[i++], P[key]);
  return it;
};
var $create = function create(it, P) {
  return P === undefined ? _create(it) : $defineProperties(_create(it), P);
};
var $propertyIsEnumerable = function propertyIsEnumerable(key) {
  var E = isEnum.call(this, key = toPrimitive(key, true));
  if (this === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return false;
  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key] ? E : true;
};
var $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key) {
  it = toIObject(it);
  key = toPrimitive(key, true);
  if (it === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return;
  var D = gOPD(it, key);
  if (D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key])) D.enumerable = true;
  return D;
};
var $getOwnPropertyNames = function getOwnPropertyNames(it) {
  var names = gOPN(toIObject(it));
  var result = [];
  var i = 0;
  var key;
  while (names.length > i) {
    if (!has(AllSymbols, key = names[i++]) && key != HIDDEN && key != META) result.push(key);
  } return result;
};
var $getOwnPropertySymbols = function getOwnPropertySymbols(it) {
  var IS_OP = it === ObjectProto;
  var names = gOPN(IS_OP ? OPSymbols : toIObject(it));
  var result = [];
  var i = 0;
  var key;
  while (names.length > i) {
    if (has(AllSymbols, key = names[i++]) && (IS_OP ? has(ObjectProto, key) : true)) result.push(AllSymbols[key]);
  } return result;
};

// 19.4.1.1 Symbol([description])
if (!USE_NATIVE) {
  $Symbol = function Symbol() {
    if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor!');
    var tag = uid(arguments.length > 0 ? arguments[0] : undefined);
    var $set = function (value) {
      if (this === ObjectProto) $set.call(OPSymbols, value);
      if (has(this, HIDDEN) && has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;
      setSymbolDesc(this, tag, createDesc(1, value));
    };
    if (DESCRIPTORS && setter) setSymbolDesc(ObjectProto, tag, { configurable: true, set: $set });
    return wrap(tag);
  };
  redefine($Symbol[PROTOTYPE], 'toString', function toString() {
    return this._k;
  });

  $GOPD.f = $getOwnPropertyDescriptor;
  $DP.f = $defineProperty;
  __webpack_require__("n0T6").f = gOPNExt.f = $getOwnPropertyNames;
  __webpack_require__("NpIQ").f = $propertyIsEnumerable;
  $GOPS.f = $getOwnPropertySymbols;

  if (DESCRIPTORS && !__webpack_require__("O4g8")) {
    redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);
  }

  wksExt.f = function (name) {
    return wrap(wks(name));
  };
}

$export($export.G + $export.W + $export.F * !USE_NATIVE, { Symbol: $Symbol });

for (var es6Symbols = (
  // 19.4.2.2, 19.4.2.3, 19.4.2.4, 19.4.2.6, 19.4.2.8, 19.4.2.9, 19.4.2.10, 19.4.2.11, 19.4.2.12, 19.4.2.13, 19.4.2.14
  'hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'
).split(','), j = 0; es6Symbols.length > j;)wks(es6Symbols[j++]);

for (var wellKnownSymbols = $keys(wks.store), k = 0; wellKnownSymbols.length > k;) wksDefine(wellKnownSymbols[k++]);

$export($export.S + $export.F * !USE_NATIVE, 'Symbol', {
  // 19.4.2.1 Symbol.for(key)
  'for': function (key) {
    return has(SymbolRegistry, key += '')
      ? SymbolRegistry[key]
      : SymbolRegistry[key] = $Symbol(key);
  },
  // 19.4.2.5 Symbol.keyFor(sym)
  keyFor: function keyFor(sym) {
    if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol!');
    for (var key in SymbolRegistry) if (SymbolRegistry[key] === sym) return key;
  },
  useSetter: function () { setter = true; },
  useSimple: function () { setter = false; }
});

$export($export.S + $export.F * !USE_NATIVE, 'Object', {
  // 19.1.2.2 Object.create(O [, Properties])
  create: $create,
  // 19.1.2.4 Object.defineProperty(O, P, Attributes)
  defineProperty: $defineProperty,
  // 19.1.2.3 Object.defineProperties(O, Properties)
  defineProperties: $defineProperties,
  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,
  // 19.1.2.7 Object.getOwnPropertyNames(O)
  getOwnPropertyNames: $getOwnPropertyNames,
  // 19.1.2.8 Object.getOwnPropertySymbols(O)
  getOwnPropertySymbols: $getOwnPropertySymbols
});

// Chrome 38 and 39 `Object.getOwnPropertySymbols` fails on primitives
// https://bugs.chromium.org/p/v8/issues/detail?id=3443
var FAILS_ON_PRIMITIVES = $fails(function () { $GOPS.f(1); });

$export($export.S + $export.F * FAILS_ON_PRIMITIVES, 'Object', {
  getOwnPropertySymbols: function getOwnPropertySymbols(it) {
    return $GOPS.f(toObject(it));
  }
});

// 24.3.2 JSON.stringify(value [, replacer [, space]])
$JSON && $export($export.S + $export.F * (!USE_NATIVE || $fails(function () {
  var S = $Symbol();
  // MS Edge converts symbol values to JSON as {}
  // WebKit converts symbol values to JSON as null
  // V8 throws on boxed symbols
  return _stringify([S]) != '[null]' || _stringify({ a: S }) != '{}' || _stringify(Object(S)) != '{}';
})), 'JSON', {
  stringify: function stringify(it) {
    var args = [it];
    var i = 1;
    var replacer, $replacer;
    while (arguments.length > i) args.push(arguments[i++]);
    $replacer = replacer = args[1];
    if (!isObject(replacer) && it === undefined || isSymbol(it)) return; // IE8 returns string on undefined
    if (!isArray(replacer)) replacer = function (key, value) {
      if (typeof $replacer == 'function') value = $replacer.call(this, key, value);
      if (!isSymbol(value)) return value;
    };
    args[1] = replacer;
    return _stringify.apply($JSON, args);
  }
});

// 19.4.3.4 Symbol.prototype[@@toPrimitive](hint)
$Symbol[PROTOTYPE][TO_PRIMITIVE] || __webpack_require__("hJx8")($Symbol[PROTOTYPE], TO_PRIMITIVE, $Symbol[PROTOTYPE].valueOf);
// 19.4.3.5 Symbol.prototype[@@toStringTag]
setToStringTag($Symbol, 'Symbol');
// 20.2.1.9 Math[@@toStringTag]
setToStringTag(Math, 'Math', true);
// 24.3.3 JSON[@@toStringTag]
setToStringTag(global.JSON, 'JSON', true);


/***/ }),

/***/ "fZOM":
/***/ (function(module, exports, __webpack_require__) {

// https://github.com/tc39/proposal-object-values-entries
var $export = __webpack_require__("kM2E");
var $values = __webpack_require__("mbce")(false);

$export($export.S, 'Object', {
  values: function values(it) {
    return $values(it);
  }
});


/***/ }),

/***/ "fZjL":
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__("jFbC"), __esModule: true };

/***/ }),

/***/ "g3Lu":
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });

// EXTERNAL MODULE: ./node_modules/babel-runtime/core-js/json/stringify.js
var stringify = __webpack_require__("mvHQ");
var stringify_default = /*#__PURE__*/__webpack_require__.n(stringify);

// EXTERNAL MODULE: ./node_modules/moment/moment.js
var moment = __webpack_require__("PJh5");
var moment_default = /*#__PURE__*/__webpack_require__.n(moment);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/component/header/newHeader/commonHeader.vue

//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//


/* harmony default export */ var commonHeader = ({
  data: function data() {
    return {
      currentIndex: this.$route.query.type || 0,
      // 暂时隐藏掉拍照核验模块
      // Tabs: [{ name: "签约核验" }, { name: "拍照核验" }, { name: "报备列表" }],
      Tabs: [{ name: "签约核验" }, { name: "报备列表" }],
      formData: {
        searchKeyWord: "",
        dateFromTo: []
      },
      selectNewData: [],
      pickerOptions: {
        shortcuts: [{
          text: "今天",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 0);
            picker.$emit("pick", [start, end]);
          }
        }, {
          text: "昨天",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 1);
            picker.$emit("pick", [start, end]);
          }
        }, {
          text: "3天前",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 2);
            picker.$emit("pick", [start, end]);
          }
        }, {
          text: "7天前",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 6);
            picker.$emit("pick", [start, end]);
          }
        }, {
          text: "14天前",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 13);
            picker.$emit("pick", [start, end]);
          }
        }, {
          text: "30天前",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 29);
            picker.$emit("pick", [start, end]);
          }
        }]
      }
    };
  },

  watch: {
    $route: function $route(to, from) {
      this.currentIndex = this.$route.query.type || 0;
      // 根据tab跳转更新顶部日期避免数据污染
      if (this.currentIndex == 0) {
        this.formData.searchKeyWord = this.$store.state.saveSearchKeyWord_signUp01;
        this.formData.dateFromTo = this.$store.state.saveSearchFromData_signUp;
      }
      if (this.currentIndex == 1) {
        this.formData.searchKeyWord = this.$store.state.saveSearchKeyWord_report01;
        this.formData.dateFromTo = this.$store.state.saveSearchFromData_report;
      }
    }
  },
  created: function created() {
    this.currentIndex = this.$route.query.type || 0;
    // 默认赋值日期实现记住当前回显选中日期
    if (this.currentIndex == 0) {
      this.formData.searchKeyWord = this.$store.state.saveSearchKeyWord_signUp;
      this.formData.dateFromTo = this.$store.state.saveSearchFromData_signUp;
    }
    if (this.currentIndex == 1) {
      this.formData.searchKeyWord = this.$store.state.saveSearchKeyWord_report;
      this.formData.dateFromTo = this.$store.state.saveSearchFromData_report;
    }

    // 默认显示前7天的数据
    // 当前时间
    var currentTime = moment_default()().format("YYYY-MM-DD 23:59:59");
    // 7天前
    var beforeTime = moment_default()().subtract(6, "days").format("YYYY-MM-DD 00:00:00");
    this.formData.dateFromTo = [beforeTime, currentTime];
    // 存储Vuex更新数据(接口自动获取vuex的值进行自动搜索)
    this.$store.commit("getSearchFromData_signUp", this.formData.dateFromTo);
    this.$store.commit("getSearchFromData_takePhotos", this.formData.dateFromTo);
    this.$store.commit("getSearchFromData_report", this.formData.dateFromTo);

    window.sessionStorage.setItem("signUpDate", stringify_default()(this.formData.dateFromTo));
    window.sessionStorage.setItem("takePhoneDate", stringify_default()(this.formData.dateFromTo));
    window.sessionStorage.setItem("reportDate", stringify_default()(this.formData.dateFromTo));
  },

  methods: {
    goHome: function goHome() {
      this.$router.push({ path: "/mainPage/homePage" });
      // 当返回或退出当前页的时候，自动清空vuex
      this.$store.commit('getSearchKeyWord_report', '');
      this.$store.commit('getSearchFromData_report', '');
      this.$store.commit('getSearchKeyWord_signUp01', '');
      this.$store.commit('getSearchFromData_signUp01', '');
    },
    goBack: function goBack() {
      // this.$router.go(-1);
      this.$router.push({ path: "/mainPage/windControl" });
      // 当返回或退出当前页的时候，自动清空vuex
      this.$store.commit('getSearchKeyWord_report', '');
      this.$store.commit('getSearchFromData_report', '');
      this.$store.commit('getSearchKeyWord_signUp01', '');
      this.$store.commit('getSearchFromData_signUp01', '');
    },
    getTab: function getTab(index) {
      this.currentIndex = index;
      this.$emit("getTab", index);
      this.$router.push({ path: "/fengkong/fengkong", query: { type: index } });
    },
    clearInput: function clearInput() {
      if (this.currentIndex == 0) {
        // 签约核验
        if (this.selectNewData) {
          this.$store.commit("getSearchKeyWord_signUp01", this.formData.searchKeyWord);
          this.$store.commit("getSearchFromData_signUp", [this.formData.dateFromTo[0], this.formData.dateFromTo[1]]);
        } else {
          console.log(this.formData.searchKeyWord);
          this.$store.commit("getSearchKeyWord_signUp01", this.formData.searchKeyWord);
          this.$store.commit("getSearchFromData_signUp", []);
        }
      }
      if (this.currentIndex == 1) {
        // 报备列表
        if (this.selectNewData) {
          this.$store.commit("getSearchKeyWord_report01", this.formData.searchKeyWord);
          this.$store.commit("getSearchFromData_report", [this.formData.dateFromTo[0], this.formData.dateFromTo[1]]);
        } else {
          console.log(this.formData.searchKeyWord);
          this.$store.commit("getSearchKeyWord_report01", this.formData.searchKeyWord);
          this.$store.commit("getSearchFromData_report", []);
        }
      }
    },
    getSearchKeyWord: function getSearchKeyWord() {
      if (this.currentIndex == 0) {
        // 签约核验
        if (this.selectNewData) {
          this.$store.commit("getSearchKeyWord_signUp01", this.formData.searchKeyWord);
          this.$store.commit("getSearchFromData_signUp", [this.formData.dateFromTo[0], this.formData.dateFromTo[1]]);
        } else {
          console.log(this.formData.searchKeyWord);
          this.$store.commit("getSearchKeyWord_signUp01", this.formData.searchKeyWord);
          this.$store.commit("getSearchFromData_signUp", []);
        }
      }
      if (this.currentIndex == 1) {
        // 签约核验
        if (this.selectNewData) {
          this.$store.commit("getSearchKeyWord_report01", this.formData.searchKeyWord);
          this.$store.commit("getSearchFromData_report", [this.formData.dateFromTo[0], this.formData.dateFromTo[1]]);
        } else {
          console.log(this.formData.searchKeyWord);
          this.$store.commit("getSearchKeyWord_report01", this.formData.searchKeyWord);
          this.$store.commit("getSearchFromData_report", []);
        }
      }
      // this.formData.dateFromTo = ''
    },
    getSelectData: function getSelectData(data) {
      console.log(data);
      this.selectNewData = data;
      if (data) {
        if (this.currentIndex == 0) {
          // 签约核验
          this.$store.commit("getSearchFromData_signUp", this.selectNewData);
        }
        if (this.currentIndex == 1) {
          // 报备列表
          this.$store.commit("getSearchFromData_report", this.selectNewData);
        }
      } else {}
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-b2851d62","hasScoped":true,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/component/header/newHeader/commonHeader.vue
var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"commonHeader"},[_c('div',{staticClass:"commonHeaderTab"},[_c('div',{staticStyle:{"display":"flex","flex":"1","align-items":"center"}},[_c('el-tooltip',{staticClass:"item",attrs:{"effect":"dark","content":"返回首页","placement":"bottom-start"}},[_c('span',{staticClass:"gohome",on:{"click":_vm.goHome}},[_c('i',{staticClass:"fa fa-home fa-fw sidebar"})])]),_vm._v(" "),_c('el-tooltip',{staticClass:"item",attrs:{"effect":"dark","content":"返回案场列表","placement":"bottom-start"}},[_c('span',{staticClass:"gohome",staticStyle:{"margin-left":"10px"},on:{"click":_vm.goBack}},[_c('i',{staticClass:"el-icon-arrow-left"})])]),_vm._v(" "),_vm._l((_vm.Tabs),function(item,index){return _c('a',{key:index,class:{ active: index == _vm.currentIndex },attrs:{"href":"javascript:;"},on:{"click":function($event){return _vm.getTab(index)}}},[_vm._v(_vm._s(item.name))])})],2),_vm._v(" "),(_vm.currentIndex!=0)?_c('div',{staticClass:"commonHeaderForm"},[_c('el-input',{staticStyle:{"width":"280px"},attrs:{"placeholder":_vm.currentIndex == 2?'请输入手机号':'请输入姓名',"size":"medium","clearable":""},on:{"change":_vm.clearInput},model:{value:(_vm.formData.searchKeyWord),callback:function ($$v) {_vm.$set(_vm.formData, "searchKeyWord", $$v)},expression:"formData.searchKeyWord"}},[_c('el-button',{attrs:{"slot":"append","icon":"el-icon-search"},on:{"click":_vm.getSearchKeyWord},slot:"append"})],1),_vm._v(" "),_c('el-date-picker',{staticStyle:{"width":"280px","margin-left":"15px"},attrs:{"size":"medium","type":"daterange","picker-options":_vm.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":['00:00:00', '23:59:59'],"align":"right"},on:{"change":_vm.getSelectData},model:{value:(_vm.formData.dateFromTo),callback:function ($$v) {_vm.$set(_vm.formData, "dateFromTo", $$v)},expression:"formData.dateFromTo"}})],1):_vm._e()])])}
var staticRenderFns = []
var esExports = { render: render, staticRenderFns: staticRenderFns }
/* harmony default export */ var newHeader_commonHeader = (esExports);
// CONCATENATED MODULE: ./src/component/header/newHeader/commonHeader.vue
function injectStyle (ssrContext) {
  __webpack_require__("ht6P")
}
var normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var __vue_template_functional__ = false
/* styles */
var __vue_styles__ = injectStyle
/* scopeId */
var __vue_scopeId__ = "data-v-b2851d62"
/* moduleIdentifier (server only) */
var __vue_module_identifier__ = null
var Component = normalizeComponent(
  commonHeader,
  newHeader_commonHeader,
  __vue_template_functional__,
  __vue_styles__,
  __vue_scopeId__,
  __vue_module_identifier__
)

/* harmony default export */ var header_newHeader_commonHeader = (Component.exports);

// EXTERNAL MODULE: ./node_modules/babel-runtime/core-js/object/values.js
var values = __webpack_require__("gRE1");
var values_default = /*#__PURE__*/__webpack_require__.n(values);

// EXTERNAL MODULE: ./node_modules/babel-runtime/core-js/object/keys.js
var keys = __webpack_require__("fZjL");
var keys_default = /*#__PURE__*/__webpack_require__.n(keys);

// EXTERNAL MODULE: ./src/request/api.js
var api = __webpack_require__("2CGT");

// EXTERNAL MODULE: external "Vue"
var external__Vue_ = __webpack_require__("lRwf");
var external__Vue__default = /*#__PURE__*/__webpack_require__.n(external__Vue_);

// CONCATENATED MODULE: ./src/assets/js/eventBus.js

/* harmony default export */ var eventBus = (new external__Vue__default.a());
// EXTERNAL MODULE: ./node_modules/qrcodejs2/qrcode.js
var qrcodejs2_qrcode = __webpack_require__("MJLE");
var qrcode_default = /*#__PURE__*/__webpack_require__.n(qrcodejs2_qrcode);

// EXTERNAL MODULE: ./src/lib/utils.js
var utils = __webpack_require__("n95b");

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/component/fengkong/signUpBasic.vue
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//




/* harmony default export */ var signUpBasic = ({
  filters: {
    changeState: function changeState(data) {
      switch (data) {
        case -1:
          {
            return "未判断";
            break;
          }
        case 0:
          {
            return "已核验";
            break;
          }
        case 1:
          {
            return "待核验";
            break;
          }
        case 2:
          {
            return "确认飞单";
            break;
          }
        case 3:
          {
            return "撤销飞单";
            break;
          }
        case 4:
          {
            return "审批中";
            break;
          }
        case 5:
          {
            return "无效";
            break;
          }
        default:
          {
            return "未知状态";
            break;
          }
      }
    }
  },
  props: {
    customerInfo: {
      type: [Array, Object],
      default: function _default() {
        return [];
      }
    },
    itemList: {
      type: [Function],
      default: function _default() {
        return false;
      }
    }
  },
  data: function data() {
    return {
      innerExamineList: false,
      innerVisible: false,
      // 数据渲染
      viewQueryListData: [],
      hasData: false,
      getSelectStateValue: "",
      getInputValue: "",
      showErrMsg: false,

      ruleForm: {
        writtenWords: "",
        fileName: ""
      },
      rules: {
        writtenWords: [{ required: true, message: "请输入文字说明", trigger: "blur" }]
      },
      // 权限控制按钮
      showRoleOptBtnState: false,

      showNoHostStatus: true,

      level: "",

      reportList: [], //报备列表
      //竞争带看公司
      companys: [],
      company: "", //选择渠道归属id
      companyName: "", //选择渠道归属name
      buttonShows: [] //操作按钮的显隐控制
    };
  },
  created: function created() {
    var _this = this;

    this.imgPath = JSON.parse(window.localStorage.getItem("param")).riskImagePathPrefix;
    this.fieldId = window.sessionStorage.getItem("fieldId");
    // console.log(this.imgPath + this.customerInfo.snapImageUrl);
    window.sessionStorage.setItem("snapImg", this.imgPath + this.customerInfo.snapImageUrl);
    // 权限控制
    var rootAdminInfo = JSON.parse(Object(utils["a" /* Decrypt */])(window.sessionStorage.getItem("rootAdminInfo")));
    var role = rootAdminInfo.role;
    this.level = rootAdminInfo.level;
    if (role == 0) {
      this.showRoleOptBtnState = false;
    } else {
      this.showRoleOptBtnState = true;
    }

    eventBus.$on("NoHostStatus", function (data) {
      console.log(data);
      if (data == 1 || data === 1) {
        _this.showNoHostStatus = false;
      } else {
        _this.showNoHostStatus = true;
      }
    });
  },
  mounted: function mounted() {
    eventBus.$on("tableDataList", function (_ref) {
      // console.log(name);

      var name = _ref.name;
    });
  },

  watch: {
    customerInfo: {
      handler: function handler(v, x) {
        // console.log(v,x)
        // console.log(v.firstVisitTime)

        this.changeButtonByStatus(v.status);

        //查询报备数据
        this.getReports();
      },

      immediate: true
    }
  },
  methods: {
    //导出详情
    print: function print() {
      var printStr = "<html><head><meta http-equiv='Content-Type' content='text/html; charset=utf-8'><link rel='stylesheet' href='./static/css/print.css' /></head><body >";
      var content = "<div class='header'><h1>所属案场：" + window.sessionStorage.getItem("fieldName") + "</h1></div>";
      var str = document.getElementById("page").innerHTML;
      content = content + str;
      printStr = printStr + content + "</body></html>";

      var pwin = window.open("Print.htm", "print");
      pwin.document.write(printStr);
      pwin.document.close();
      setTimeout(function () {
        pwin.print();
      }, 100);
    },

    // 查看审核说明列表
    viewQueryList: function viewQueryList() {
      var _this2 = this;

      this.viewQueryListData = [];
      this.$request.getViewQueryPicText({
        cid: this.customerInfo.id
      }).then(function (res) {
        // console.log(res);
        if (res.status == 200) {
          _this2.viewQueryListData = res.data.data;
          // console.log(res.data.data.length);
          if (res.data.data.length > 0) {
            _this2.hasData = true;
          } else {
            _this2.hasData = false;
          }
        }
      });
    },

    // 获取当前点击按钮的改变状态值
    getValue: function getValue(event) {
      this.getSelectStateValue = event.target.value;
      // console.log(this.getSelectStateValue);
      if (this.reportList.length > 1 && this.companyName == '') {
        this.$message({
          type: "warning",
          message: '请先选择渠道归属！',
          duration: 1000
        });
      } else {
        this.innerVisible = true;
      }
    },

    // 点击上传图片进行上传/二进制
    handleFileChange: function handleFileChange() {
      // console.log(this.$refs.fileName.files[0]);
      this.ruleForm.fileName = this.$refs.fileName.files[0];
      // 解决当前用户上传相同名称的图片，只执行一次上传的问题
      document.getElementById("fileExport").value = null;
    },


    //查询报备数据
    getReports: function getReports() {
      var _this3 = this;

      this.companys = [];
      this.companyName = '';
      this.$request.getMasterReports({
        id: this.customerInfo.id
      }).then(function (res) {
        if (res.data.code == "1000") {
          var list = res.data.data;
          _this3.reportList = list;
          console.log(list);
          _this3.reportList.forEach(function (item) {
            var obj = {};
            obj.value = item.id;
            obj.label = item.companyName;
            _this3.companys.push(obj);
            if (item.selected) {
              _this3.company = item.id;
              _this3.companyName = item.companyName;
            }
          });
        } else {
          _this3.$message({
            type: "error",
            message: res.data.msg,
            duration: 1000
          });
        }
      }).catch(function (err) {
        console.log(err);
        _this3.$message({
          type: "error",
          message: "报备列表获取失败，请稍后重试！",
          duration: 1000
        });
      });
    },


    //选择渠道归属
    chooseCompany: function chooseCompany(value) {
      var _this4 = this;

      console.log(value);
      this.$request.bindMasterReport({
        id: this.customerInfo.id,
        reportId: value
      }).then(function (res) {
        if (res.data.code == "1000") {
          _this4.$message({
            type: "success",
            message: "渠道归属选择成功",
            duration: 1000
          });
          _this4.getReports();
          _this4.$emit('changeReport');
        } else {
          _this4.$message({
            type: "error",
            message: res.data.msg,
            duration: 1000
          });
        }
      }).catch(function (err) {
        console.log(err);
        _this4.$message({
          type: "error",
          message: "渠道归属选择失败，请稍后重试！",
          duration: 1000
        });
      });
    },


    // 提交修改后的审核状态
    submitForm: function submitForm() {
      var _this5 = this;

      if (this.ruleForm.writtenWords) {
        // 点击顶部操作同步改变状态
        if (this.getSelectStateValue == "0") {
          this.customerInfo.status = Number(this.getSelectStateValue);
        } else {
          this.customerInfo.status = 4;
        }

        // console.log("================>", this.customerInfo.status);
        this.changeButtonByStatus(this.customerInfo.status);

        //先调update再上传凭证
        this.$request.getAlertOptionsBtn({
          id: this.customerInfo.id,
          status: this.getSelectStateValue
        }).then(function (res) {
          if (res.data.code == "1000") {
            _this5.formData = new FormData();
            _this5.formData.append("imageFile", _this5.ruleForm.fileName);
            _this5.formData.append("writtenWords", _this5.ruleForm.writtenWords);
            _this5.formData.append("cid", _this5.customerInfo.id);
            _this5.formData.append("applyVersion", res.data.data.applyVersion);
            _this5.$request.getAddPicText(_this5.formData).then(function (res1) {
              if (res1.status == 200) {
                // 清空表单数据
                _this5.ruleForm = {
                  writtenWords: "",
                  fileName: ""
                };
                // 关闭所有弹窗
                _this5.innerVisible = false;
                _this5.showUpdateState = false;
                _this5.$message({
                  type: "success",
                  message: _this5.getSelectStateValue == "0" ? "状态更新成功" : "已发送审批！",
                  duration: 1000
                });
                _this5.itemList();
              } else {
                _this5.$message({
                  type: "error",
                  message: res1.msg,
                  duration: 1000
                });
              }
            }).catch(function (err) {
              console.log("核验说明上传失败，", err);
            });
          } else {
            _this5.$message({
              type: "error",
              message: res.msg,
              duration: 1000
            });
          }
        }).catch(function (err) {
          console.log("状态更改接口失败，", err);
        });
      } else {
        this.$message({
          type: "error",
          message: "请输入文字说明",
          duration: 1000
        });
      }
    },
    emptyDialog: function emptyDialog() {
      this.ruleForm = {
        writtenWords: "",
        fileName: ""
      };
      this.innerVisible = false;
    },


    //根据状态改变按钮现隐
    changeButtonByStatus: function changeButtonByStatus(status) {
      switch (status) {
        case 0:
          this.buttonShows = [false, true, true, false, true, false, false, false];
          break;
        case 1:
          this.buttonShows = [true, false, true, false, true, false, false, true];
          break;
        case 2:
          this.buttonShows = [false, false, false, true, true, false, false, false];
          break;
        case 3:
          this.buttonShows = [false, false, true, false, true, false, false, false];
          break;
        case 4:
          this.buttonShows = [false, false, false, false, false, true, false, false];
          break;
        case 5:
          this.buttonShows = [false, false, false, false, false, false, true, false];
          break;
      }
    },


    //标记
    doMark: function doMark() {
      var _this6 = this;

      var param = {
        anchangId: this.customerInfo.anchangId,
        contractId: this.customerInfo.id,
        contractImgName: this.customerInfo.snapImageUrl
      };
      this.$request.doMarks(param).then(function (res) {
        // console.log(res);
        if (res.data.code == "1000") {
          _this6.$message({
            type: "success",
            message: "标记成功！",
            duration: 1000
          });
        } else {
          _this6.$message({
            type: "error",
            message: res.data.msg,
            duration: 1000
          });
        }
      });
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-1b57a88a","hasScoped":false,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/component/fengkong/signUpBasic.vue
var signUpBasic_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"dialogPerson"},[_vm._m(0),_vm._v(" "),_c('div',{staticStyle:{"padding":"0 15px"}},[_c('table',{attrs:{"width":"100%","cellspacing":"0","cellpadding":"6","border":"0"}},[_c('tr',[_c('td',{attrs:{"rowspan":Math.max(2+2*(_vm.reportList.length+1)+1,5),"width":"130"}},[_c('el-tooltip',{attrs:{"placement":"right-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('img',{staticStyle:{"width":"200px","margin":"-7px -7px -10px -7px"},attrs:{"src":_vm.imgPath + _vm.customerInfo.snapImageUrl,"draggable":"false"}})]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"100px","height":"125px"},attrs:{"src":_vm.imgPath + _vm.customerInfo.snapImageUrl,"draggable":"false"}})]),_vm._v(" "),(_vm.showNoHostStatus)?_c('div',{staticStyle:{"margin-top":"8px"}},[_c('b',[_vm._v("状态 :")]),_vm._v(" "),(_vm.customerInfo.status === -1)?_c('el-tag',{attrs:{"type":'info',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(_vm.customerInfo.status))+"\n            ")]):_vm._e(),_vm._v(" "),(_vm.customerInfo.status === 0)?_c('el-tag',{attrs:{"type":'success',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(_vm.customerInfo.status))+"\n            ")]):_vm._e(),_vm._v(" "),(_vm.customerInfo.status === 1)?_c('el-tag',{attrs:{"type":'warning',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(_vm.customerInfo.status))+"\n            ")]):_vm._e(),_vm._v(" "),(_vm.customerInfo.status === 2)?_c('el-tag',{attrs:{"type":'danger',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(_vm.customerInfo.status))+"\n            ")]):_vm._e(),_vm._v(" "),(_vm.customerInfo.status === 3)?_c('el-tag',{attrs:{"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(_vm.customerInfo.status))+"\n            ")]):_vm._e(),_vm._v(" "),(_vm.customerInfo.status === 4)?_c('el-tag',{attrs:{"type":'success',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(_vm.customerInfo.status))+"\n            ")]):_vm._e(),_vm._v(" "),(_vm.customerInfo.status === 5)?_c('el-tag',{attrs:{"type":'danger',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(_vm.customerInfo.status))+"\n            ")]):_vm._e(),_vm._v(" "),(_vm.customerInfo.riskTypeDesc!='--')?_c('p',{staticStyle:{"color":"red","font-weight":"bold"}},[_vm._v("签约风险提示："+_vm._s(_vm.customerInfo.riskTypeDesc))]):_vm._e()],1):_vm._e()],1),_vm._v(" "),_c('td',{attrs:{"width":"28%"}},[_vm._v("姓名 : "+_vm._s(_vm.customerInfo.cName || "暂无数据"))]),_vm._v(" "),_c('td',[_vm._v("证件号码 : "+_vm._s(_vm.customerInfo.idNum ? _vm.customerInfo.idNum + '('+_vm.customerInfo.cardType+')' : "暂无数据"))]),_vm._v(" "),_c('td',[_vm._v("\n          手机号码 : "+_vm._s(_vm.customerInfo.phoneNum || "暂无数据")+"\n        ")])]),_vm._v(" "),_c('tr',[_c('td',[_vm._v("首访时间 : "+_vm._s(_vm.customerInfo.firstVisitTime || "暂无数据"))]),_vm._v(" "),_c('td',[_vm._v("置业顾问 :")]),_vm._v(" "),(_vm.reportList.length > 1)?_c('td',{staticClass:"qudao"},[_vm._v("渠道归属 : "+_vm._s(_vm.companyName || "暂无数据"))]):_vm._e()]),_vm._v(" "),(_vm.reportList.length > 1)?_c('tr',[_vm._m(1)]):_vm._e(),_vm._v(" "),_vm._l((_vm.reportList),function(item,i){return (_vm.reportList.length > 0)?_c('div',{key:i,staticStyle:{"display":"contents"}},[_c('tr',{style:({'background-color':item.selected&&_vm.reportList.length>1?'aliceblue':''})},[_c('td',[_vm._v("经纪人"+_vm._s(_vm.reportList.length==1?'':i+1)+" : "+_vm._s(item.aName || "暂无数据"))]),_vm._v(" "),_c('td',[_vm._v("经纪公司"+_vm._s(_vm.reportList.length==1?'':i+1)+" : "+_vm._s(item.companyName || "暂无数据"))]),_vm._v(" "),_c('td',[_vm._v("报备时间"+_vm._s(_vm.reportList.length==1?'':i+1)+" : "+_vm._s(item.reportTime || "暂无数据"))])]),_vm._v(" "),(item.riskTypeDesc!=='--')?_c('tr',{style:({'background-color':item.selected&&_vm.reportList.length>1?'aliceblue':''})},[_c('td',{staticStyle:{"color":"#f00"},attrs:{"colspan":"3"}},[_c('span',[_vm._v("报备风险提示"+_vm._s(_vm.reportList.length==1?'':i+1)+" : "+_vm._s(item.riskTypeDesc))])])]):_vm._e()]):_vm._e()}),_vm._v(" "),(_vm.reportList.length == 0)?_c('tr',[_c('td',[_vm._v("经纪人 : 暂无数据")]),_vm._v(" "),_c('td',[_vm._v("经纪公司 : 暂无数据")]),_vm._v(" "),_c('td',[_vm._v("报备时间 : 暂无数据")])]):_vm._e(),_vm._v(" "),_c('tr'),_vm._v(" "),(_vm.showNoHostStatus)?_c('tr',[_c('td',{staticStyle:{"color":"#f00","font-weight":"bold"},attrs:{"colspan":"1"}},[_c('button',{staticClass:"btn btn01",on:{"click":function($event){_vm.viewQueryList(), (_vm.innerExamineList = true)}}},[_vm._v("\n            核验说明\n          ")]),_vm._v(" "),_c('button',{staticClass:"btn btn05",on:{"click":_vm.print}},[_vm._v("\n            导出详情\n          ")]),_vm._v(" "),(_vm.level == -1)?_c('button',{staticClass:"btn btn07",on:{"click":function($event){return _vm.doMark()}}},[_vm._v("\n            标记\n          ")]):_vm._e()]),_vm._v(" "),(_vm.showRoleOptBtnState)?_c('td',{staticClass:"caozuo",staticStyle:{"position":"relative"},attrs:{"colspan":"2"}},[_vm._m(2),_vm._v(" "),(_vm.buttonShows[0])?_c('button',{staticClass:"btn btn01",attrs:{"value":"0"},on:{"click":function($event){return _vm.getValue($event)}}},[_vm._v("\n            已核验\n          ")]):_vm._e(),_vm._v(" "),(_vm.buttonShows[1])?_c('button',{staticClass:"btn btn07",attrs:{"value":"1"},on:{"click":function($event){return _vm.getValue($event)}}},[_vm._v("\n            撤销核验\n          ")]):_vm._e(),_vm._v(" "),(_vm.buttonShows[2])?_c('button',{staticClass:"btn btn08",attrs:{"value":"2"},on:{"click":function($event){return _vm.getValue($event)}}},[_vm._v("\n            确认飞单\n          ")]):_vm._e(),_vm._v(" "),(_vm.buttonShows[3])?_c('button',{staticClass:"btn btn07",attrs:{"value":"3"},on:{"click":function($event){return _vm.getValue($event)}}},[_vm._v("\n            撤销飞单\n          ")]):_vm._e(),_vm._v(" "),(_vm.buttonShows[4])?_c('button',{staticClass:"btn btn08",attrs:{"value":"5"},on:{"click":function($event){return _vm.getValue($event)}}},[_vm._v("\n            无效\n          ")]):_vm._e(),_vm._v(" "),(_vm.buttonShows[5])?_c('span',[_vm._v("审批中，暂时无法操作")]):_vm._e(),_vm._v(" "),(_vm.buttonShows[6])?_c('span',[_c('svg',{staticClass:"icon",staticStyle:{"position":"absolute","top":"-4px"},attrs:{"t":"1615512320685","viewBox":"0 0 1536 1024","version":"1.1","xmlns":"http://www.w3.org/2000/svg","p-id":"3137","width":"128","height":"64"}},[_c('path',{attrs:{"d":"M440.438154 54.272l1015.296 271.990154c49.860923 13.390769 78.848 66.756923 64.787692 119.335384l-127.409231 475.490462c-14.099692 52.539077-65.929846 84.283077-115.790769 70.892308l-99.209846-26.545231a169.472 169.472 0 0 0-24.576-32.295385 658.116923 658.116923 0 0 0-22.409846-48.285538l163.209846 43.716923c15.399385 4.174769 31.428923-4.647385 37.376-19.968l1.181538-3.623385 127.448616-475.529846c4.332308-16.265846-3.702154-32.768-18.156308-38.596923l-3.465846-1.181538-958.739692-256.866462a148.834462 148.834462 0 0 0-16.541539-24.024615c-14.651077-16.541538-20.992-33.831385-23.000615-54.508308zM282.033231 11.776l96.886154 25.993846c11.815385 11.145846 22.882462 22.055385 32.649846 32.334769 17.447385 18.510769 30.562462 37.139692 40.526769 55.217231l-187.076923-50.136615c-15.399385-4.135385-31.389538 4.726154-37.376 20.007384l-1.181539 3.623385-127.40923 475.529846c-4.332308 16.265846 3.662769 32.768 18.116923 38.596923l3.465846 1.181539L1059.446154 865.634462c6.025846 21.267692 14.178462 46.867692 21.385846 73.688615l-977.132308-261.789539c-49.860923-13.390769-78.887385-66.796308-64.787692-119.335384L166.281846 82.707692C180.342154 30.168615 232.172308-1.575385 282.072615 11.815385zM1150.818462 371.2l38.124307 16.580923c-11.421538 24.339692-23.748923 48.443077-35.721846 71.168l118.705231 31.822769-10.515692 39.227077-23.748924-6.340923c-30.523077 70.104615-63.921231 125.243077-104.723692 166.203077 13.745231 41.826462 35.249231 78.414769 64.945231 106.417231-12.248615 5.513846-29.184 17.644308-38.990769 26.781538-27.175385-28.356923-46.631385-63.409231-60.376616-103.305846-35.209846 27.254154-75.854769 45.725538-123.628307 55.926154-2.796308-9.570462-13.469538-30.011077-20.204308-39.660308 52.657231-8.388923 95.625846-28.199385 131.820308-59.076923a545.949538 545.949538 0 0 1-11.972923-106.968615 449.378462 449.378462 0 0 1-31.901539 29.617231 238.670769 238.670769 0 0 0-18.471385-40.644923c4.883692-3.623385 9.294769-7.325538 13.39077-11.618462l-32.137846 8.546462c-2.087385-25.048615-14.926769-66.638769-28.475077-98.185847l35.446153-8.11323c14.178462 29.262769 27.529846 67.072 31.113847 92.002461 41.865846-41.117538 78.099692-103.345231 107.323077-170.377846zM962.284308 515.938462l38.203077 18.038153c-16.147692 27.490462-33.516308 52.184615-51.987693 73.649231 16.068923 33.201231 29.853538 65.772308 35.84 90.820923l-41.353846 17.329231c-4.804923-20.361846-13.863385-46.788923-26.348308-75.067077a330.121846 330.121846 0 0 1-120.123076 73.964308c-3.387077-9.216-13.627077-29.538462-21.031385-38.4 46.670769-13.430154 88.379077-39.463385 123.825231-74.948923a1323.52 1323.52 0 0 0-36.667077-69.513846l37.139692-14.532924c9.058462 15.635692 18.628923 32.886154 28.514462 50.688 12.091077-15.832615 23.473231-32.846769 33.988923-52.027076zM448.039385 214.724923l355.170461 95.153231-11.027692 41.078154-165.691077-44.386462c-9.334154 29.302154-18.786462 59.076923-31.113846 88.536616l198.144 53.090461-11.106462 41.550769-157.538461-42.220307-38.596923 144.265846c-4.529231 16.896-1.181538 20.755692 20.283077 26.505846l68.923076 18.432c20.558769 5.513846 26.427077-3.662769 45.292308-63.172923 7.522462 10.318769 24.772923 22.764308 35.879385 28.672-25.403077 72.940308-42.968615 89.284923-89.088 76.918154l-77.587693-20.795077c-51.160615-13.705846-60.731077-30.956308-48.128-77.981539l38.793847-144.699077-4.135385-1.102769c-42.180923 82.628923-110.198154 152.024615-238.276923 168.093539a143.911385 143.911385 0 0 0-19.219692-43.323077c114.136615-11.500308 175.616-67.426462 214.134153-136.388923L374.272 380.455385l11.145846-41.590154 166.596923 44.662154c12.8-29.341538 22.252308-59.116308 31.113846-88.536616l-146.116923-39.148307 11.027693-41.078154z m683.244307 280.418462c-6.459077 9.531077-12.209231 18.274462-18.116923 27.451077-2.284308 41.472 0.472615 82.313846 7.364923 120.398769 29.380923-34.737231 54.075077-77.508923 76.012308-130.363077z m-225.910154-71.75877l34.067693 20.873847c-28.593231 35.367385-66.717538 73.609846-98.264616 96.492307a211.062154 211.062154 0 0 0-22.134153-34.343384c29.814154-19.889231 62.621538-51.2 86.331076-83.02277z m82.116924-96.413538c8.388923 19.849846 16.068923 45.883077 17.959384 62.542769l-30.444308 4.056616 103.660308 27.766153-10.161231 37.927385-209.998769-56.32 10.161231-37.848615 94.011077 25.206153c-1.299692-17.014154-7.68-40.723692-14.336-59.628307z","fill":"#1195db","p-id":"3138"}})])]):_vm._e(),_vm._v(" "),(_vm.reportList.length > 1&&_vm.buttonShows[7])?_c('span',[_vm._v("     渠道归属：\n            "),_c('el-select',{attrs:{"placeholder":"请选择","size":"small"},on:{"change":_vm.chooseCompany},model:{value:(_vm.company),callback:function ($$v) {_vm.company=$$v},expression:"company"}},_vm._l((_vm.companys),function(item){return _c('el-option',{key:item.value,attrs:{"label":item.label,"value":item.value}})}),1)],1):_vm._e()]):_c('td',{staticClass:"caozuo",attrs:{"colspan":"2"}},[_vm._m(3)])]):_c('tr',[_c('td',[_vm._v(" ")]),_vm._v(" "),_c('td',[_vm._v(" ")]),_vm._v(" "),_c('td',[_vm._v(" ")])])],2)]),_vm._v(" "),_c('el-dialog',{attrs:{"width":"500","title":"核验说明","visible":_vm.innerExamineList,"center":"","append-to-body":""},on:{"update:visible":function($event){_vm.innerExamineList=$event}}},[_c('div',{staticStyle:{"padding":"10px","height":"auto","max-height":"500px","overflow":"auto"}},[_c('div',{staticClass:"innerExamineBox"},[_c('table',{attrs:{"border":"0","width":"100%"}},[_c('tr',[_c('th',{attrs:{"width":"40%"}},[_vm._v("核验说明")]),_vm._v(" "),_c('th',{attrs:{"width":"30%"}},[_vm._v("核验凭证")]),_vm._v(" "),_c('th',{attrs:{"width":"30%"}},[_vm._v("更新时间")])]),_vm._v(" "),(_vm.hasData)?_vm._l((_vm.viewQueryListData),function(item,index){return _c('tr',{key:index},[_c('td',{attrs:{"width":"40%"}},[_vm._v(_vm._s(item.writtenWords))]),_vm._v(" "),_c('td',{attrs:{"width":"30%"}},[(item.imageName)?_c('a',{attrs:{"target":"_blank","href":_vm.imgPath + item.imageName}},[_vm._v("点击查看")]):_c('p',[_vm._v("-")])]),_vm._v(" "),_c('td',{attrs:{"width":"30%"}},[_vm._v(_vm._s(item.createTime))])])}):_c('tr',[_c('td',{attrs:{"colspan":"3"}},[_vm._v("暂无核验说明数据")])])],2)])])]),_vm._v(" "),_c('el-dialog',{attrs:{"width":"500","title":"核验说明","visible":_vm.innerVisible,"before-close":_vm.emptyDialog,"append-to-body":"","center":"","close-on-click-modal":false},on:{"update:visible":function($event){_vm.innerVisible=$event}}},[_c('div',{staticStyle:{"padding":"10px"}},[_c('el-form',{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{"model":_vm.ruleForm,"rules":_vm.rules,"label-width":"80px"}},[_c('el-form-item',{attrs:{"label":"文字说明","prop":"writtenWords"}},[_c('el-input',{attrs:{"size":"small"},model:{value:(_vm.ruleForm.writtenWords),callback:function ($$v) {_vm.$set(_vm.ruleForm, "writtenWords", $$v)},expression:"ruleForm.writtenWords"}})],1),_vm._v(" "),_c('el-form-item',{staticStyle:{"padding-top":"5px"},attrs:{"label":"上传凭证"}},[_c('div',{staticClass:"uploadFile"},[_c('input',{ref:"fileName",attrs:{"type":"file","id":"fileExport"},on:{"change":_vm.handleFileChange}}),_vm._v("点击这里上传文件\n          ")]),_vm._v("\n          "+_vm._s(_vm.ruleForm.fileName.name)+"\n          "),(_vm.showUpdateState)?_c('span',{staticClass:"tips"},[_vm._v(_vm._s(_vm.showUploadCode)+"\n          ")]):_vm._e()]),_vm._v(" "),_c('el-form-item',[_c('el-button',{attrs:{"type":"primary"},on:{"click":function($event){return _vm.submitForm('ruleForm')}}},[_vm._v("确定")])],1)],1)],1)])],1)}
var signUpBasic_staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"header_detail_modal",staticStyle:{"margin-top":"0"}},[_c('h1',[_vm._v("客户详情")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('td',{attrs:{"colspan":"3"}},[_c('hr',{staticStyle:{"margin":"0","background-color":"#e4e7ed","height":"1px","border":"none"}})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',[_c('b',[_vm._v("操作 : ")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('span',[_c('b',[_vm._v("操作 : ")]),_vm._v("暂无权限操作")])}]
var signUpBasic_esExports = { render: signUpBasic_render, staticRenderFns: signUpBasic_staticRenderFns }
/* harmony default export */ var fengkong_signUpBasic = (signUpBasic_esExports);
// CONCATENATED MODULE: ./src/component/fengkong/signUpBasic.vue
var signUpBasic_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var signUpBasic___vue_template_functional__ = false
/* styles */
var signUpBasic___vue_styles__ = null
/* scopeId */
var signUpBasic___vue_scopeId__ = null
/* moduleIdentifier (server only) */
var signUpBasic___vue_module_identifier__ = null
var signUpBasic_Component = signUpBasic_normalizeComponent(
  signUpBasic,
  fengkong_signUpBasic,
  signUpBasic___vue_template_functional__,
  signUpBasic___vue_styles__,
  signUpBasic___vue_scopeId__,
  signUpBasic___vue_module_identifier__
)

/* harmony default export */ var component_fengkong_signUpBasic = (signUpBasic_Component.exports);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/component/fengkong/signTradeRecord.vue
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//


/* harmony default export */ var signTradeRecord = ({
  props: {
    customerInfo: {
      type: [Array, Object],
      default: function _default() {
        return [];
      }
    }
  },
  data: function data() {
    return {
      dealNodes: [],
      imgPath: "",
      imgPath1: "",
      version: "" //1-人脸，其余非人脸
    };
  },
  created: function created() {
    this.imgPath1 = JSON.parse(window.localStorage.getItem("param")).imagePathPrefix;
    console.log(this.imgPath1);
    this.imgPath = JSON.parse(window.localStorage.getItem("param")).riskImagePathPrefix;
    this.fieldId = window.sessionStorage.getItem("fieldId");
    this.version = window.sessionStorage.getItem("version");
  },

  watch: {
    customerInfo: {
      handler: function handler(v) {
        this.customerInfoData = v;
        console.log(this.customerInfoData);
        this.getDealNodes();
      },

      immediate: true
    }
  },
  methods: {
    getDealNodes: function getDealNodes() {
      var _this = this;

      this.$request.getDealTimeline({
        id: this.customerInfo.id
      }).then(function (res) {
        if (res.data.code == "1000") {
          _this.dealNodes = res.data.data;
          setTimeout(function () {
            for (var i = 0; i < _this.dealNodes.length; i++) {
              document.getElementById("descNode" + i).innerHTML = "";
              if (_this.dealNodes[i].nodeDesc) {
                document.getElementById("descNode" + i).innerHTML = _this.dealNodes[i].nodeDesc;
              }
            }
          }, 100);
        }
      }).catch(function (err) {
        console.log(err);
        _this.$message({
          type: "error",
          message: "成交记录获取失败，请稍后重试！",
          duration: 1000
        });
      });
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-787b96a6","hasScoped":true,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/component/fengkong/signTradeRecord.vue
var signTradeRecord_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"dialogPerson"},[_vm._m(0),_vm._v(" "),_c('div',{staticStyle:{"padding":"0 15px"}},[_c('div',{staticClass:"itemBox"},[(_vm.dealNodes.length>0)?_c('div',{staticClass:"itemBox_case"},_vm._l((_vm.dealNodes),function(item,i){return _c('div',{key:i,staticClass:"itemBox_item"},[_vm._m(1,true),_vm._v(" "),_c('ul',[_c('li',{staticClass:"itemDate1"},[_vm._v(_vm._s(item.nodeTimeStr.split(' ')[0]))]),_vm._v(" "),_c('li',{staticClass:"itemDate1",staticStyle:{"margin-bottom":"10px"}},[_vm._v(_vm._s(item.nodeTimeStr.split(' ')[1]))]),_vm._v(" "),(item.nodeName)?_c('li',{staticClass:"itemName",staticStyle:{"margin-top":"10px"}},[_vm._v(_vm._s(item.nodeName))]):_vm._e(),_vm._v(" "),_c('li',{staticClass:"itemDate1",attrs:{"id":'descNode'+i}}),_vm._v(" "),(item.nodeImage)?_c('li',{class:{faceImg:item.nodeName.indexOf('签约')>=0||_vm.version==1,elseImg:item.nodeName.indexOf('签约')<0&&_vm.version!=1},staticStyle:{"margin-top":"12px"}},[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('img',{staticStyle:{"width":"200px","margin":"-7px -7px -10px -7px"},attrs:{"src":(item.nodeName=='首次到访'?_vm.imgPath1:_vm.imgPath) + item.nodeImage,"draggable":"false"}})]),_vm._v(" "),_c('img',{staticClass:"imgpro",attrs:{"src":(item.nodeName=='首次到访'?_vm.imgPath1:_vm.imgPath) + item.nodeImage,"draggable":"false"}})])],1):_vm._e()])])}),0):_c('div',{staticClass:"itemBox_case"},[_c('p',[_vm._v("暂无成交记录")])])])])])}
var signTradeRecord_staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"header_detail_modal"},[_c('h1',[_vm._v("成交记录")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"itemLine"},[_c('div',{staticClass:"itemDot"})])}]
var signTradeRecord_esExports = { render: signTradeRecord_render, staticRenderFns: signTradeRecord_staticRenderFns }
/* harmony default export */ var fengkong_signTradeRecord = (signTradeRecord_esExports);
// CONCATENATED MODULE: ./src/component/fengkong/signTradeRecord.vue
function signTradeRecord_injectStyle (ssrContext) {
  __webpack_require__("TeQy")
}
var signTradeRecord_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var signTradeRecord___vue_template_functional__ = false
/* styles */
var signTradeRecord___vue_styles__ = signTradeRecord_injectStyle
/* scopeId */
var signTradeRecord___vue_scopeId__ = "data-v-787b96a6"
/* moduleIdentifier (server only) */
var signTradeRecord___vue_module_identifier__ = null
var signTradeRecord_Component = signTradeRecord_normalizeComponent(
  signTradeRecord,
  fengkong_signTradeRecord,
  signTradeRecord___vue_template_functional__,
  signTradeRecord___vue_styles__,
  signTradeRecord___vue_scopeId__,
  signTradeRecord___vue_module_identifier__
)

/* harmony default export */ var component_fengkong_signTradeRecord = (signTradeRecord_Component.exports);

// EXTERNAL MODULE: ./node_modules/babel-runtime/regenerator/index.js
var regenerator = __webpack_require__("Xxa5");
var regenerator_default = /*#__PURE__*/__webpack_require__.n(regenerator);

// EXTERNAL MODULE: ./node_modules/babel-runtime/helpers/asyncToGenerator.js
var asyncToGenerator = __webpack_require__("exGp");
var asyncToGenerator_default = /*#__PURE__*/__webpack_require__.n(asyncToGenerator);

// EXTERNAL MODULE: ./node_modules/flv.js/src/flv.js + 38 modules
var flv = __webpack_require__("9vWd");

// EXTERNAL MODULE: ./src/assets/js/flv.js
var js_flv = __webpack_require__("M85I");

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/component/fengkong/signViewVideo.vue
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//


/* harmony default export */ var signViewVideo = ({
  data: function data() {
    return {};
  },

  methods: {
    slowPlay: function slowPlay() {
      this.$emit("slowPlay");
    },
    fastPlay: function fastPlay() {
      this.$emit("fastPlay");
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-616960aa","hasScoped":false,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/component/fengkong/signViewVideo.vue
var signViewVideo_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('video',{staticClass:"video-js vjs-default-skin vjs-big-play-centered",staticStyle:{"width":"100%","height":"100%","object-fit":"fill"},attrs:{"id":"record-video","src":"videos/popin.mp4","controls":"","autoplay":"","muted":"","preload":"auto","data-setup":"{}"},domProps:{"muted":true}},[_c('source',{attrs:{"src":"rtmp://fk.aiseep.com:8031/live/comingL","type":"rtmp/flv"}})]),_vm._v(" "),_c('button',{staticClass:"btn btn01 back",attrs:{"type":"button"},on:{"click":_vm.slowPlay}},[_vm._v("后退20s")]),_vm._v(" "),_c('button',{staticClass:"btn btn01 speed",attrs:{"type":"button"},on:{"click":_vm.fastPlay}},[_vm._v("快进20s")])])}
var signViewVideo_staticRenderFns = []
var signViewVideo_esExports = { render: signViewVideo_render, staticRenderFns: signViewVideo_staticRenderFns }
/* harmony default export */ var fengkong_signViewVideo = (signViewVideo_esExports);
// CONCATENATED MODULE: ./src/component/fengkong/signViewVideo.vue
var signViewVideo_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var signViewVideo___vue_template_functional__ = false
/* styles */
var signViewVideo___vue_styles__ = null
/* scopeId */
var signViewVideo___vue_scopeId__ = null
/* moduleIdentifier (server only) */
var signViewVideo___vue_module_identifier__ = null
var signViewVideo_Component = signViewVideo_normalizeComponent(
  signViewVideo,
  fengkong_signViewVideo,
  signViewVideo___vue_template_functional__,
  signViewVideo___vue_styles__,
  signViewVideo___vue_scopeId__,
  signViewVideo___vue_module_identifier__
)

/* harmony default export */ var component_fengkong_signViewVideo = (signViewVideo_Component.exports);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/component/fengkong/signCustomerDetail.vue
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//





/* harmony default export */ var signCustomerDetail = ({
  props: {
    getCustomerInfoAllData: {
      type: [Array, Object],
      default: function _default() {
        return [];
      }
    },
    getCustomerHistoryAllData: {
      type: [Array, Object],
      default: function _default() {
        return [];
      }
    },
    historyNum: {
      type: [Number, String],
      default: function _default() {
        return "";
      }
    }
  },
  filters: {
    formatDate1: function formatDate1(value) {
      var format = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "YYYY-MM-DD";

      return moment_default()(value).format(format);
    },
    formatDate2: function formatDate2(value) {
      var format = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "HH:mm:ss";

      return moment_default()(value).format(format);
    },
    formatGender: function formatGender(data) {
      var gender = {
        1: "女",
        0: "男",
        "": "暂无数据"
      };
      return gender[data];
    },
    formatAge: function formatAge(data) {
      var age = {
        1: "<18岁",
        2: "19-30岁",
        3: "31-45岁",
        4: "46-55岁",
        5: ">56岁",
        "": "暂无数据"
      };
      return age[data];
    }
  },
  components: { signViewVideo: component_fengkong_signViewVideo },
  data: function data() {
    return {
      flvPlayer: null,
      innerVideo: false,
      getCurrentVideo: "",
      getCmdId: "",
      beforeSeconds: 10,
      afterSeconds: 10,
      getThisIndex: 0,
      verson: "",
      index1: "",
      deleteStatus: ""
    };
  },
  created: function created() {
    this.imgPath1 = JSON.parse(window.localStorage.getItem("param")).imagePathPrefix;
    this.fieldId = window.sessionStorage.getItem("fieldId");
    this.corId = window.sessionStorage.getItem("corId");

    this.verson = window.sessionStorage.getItem("version");
  },
  mounted: function mounted() {
    var _this2 = this;

    this.getCustomerHistoryAllData.forEach(function (v) {
      _this2.$set(v, "deleteStatus", false);
    });
  },

  methods: {
    openVideo: function openVideo(index) {
      console.log(index);
      this.index1 = index;
      this.viewVideo();
    },
    viewVideo: function viewVideo() {
      var _this3 = this;

      console.log(this.index1);
      console.log(this.beforeSeconds, this.afterSeconds);
      var data = {
        anchangId: this.fieldId,
        imageName: this.getCustomerHistoryAllData[this.index1].shotImages[0],
        createTime: moment_default()(this.getCustomerHistoryAllData[this.index1].firstTime).valueOf(),
        beforeSeconds: this.beforeSeconds,
        afterSeconds: this.afterSeconds
      };
      this.getThisIndex = this.index1;
      console.log(data);
      this.$request.getVideo(data).then(function (res) {
        console.log(res);
        console.log(res.data.data, "video");
        _this3.videoSrc = res.data.data.playUrl;
        _this3.getCurrentVideo = res.data.data.playUrl;
        _this3.getCmdId = res.data.data.cmdId;
        var count = 0;
        var flag = 0;
        var _this = _this3;
        if (_this3.getCmdId == -1) {
          if (_this3.flvPlayer) {
            _this3.flvPlayer.pause();
            _this3.flvPlayer.unload();
            _this3.flvPlayer.detachMediaElement();
            _this3.flvPlayer.destroy();
            _this3.flvPlayer = null;
          }
          _this3.flvPlayer = flv["a" /* default */].createPlayer({
            type: "flv",
            url: _this3.getCurrentVideo,
            hasAudio: false,
            config: {
              enableWorker: true,
              enableStashBuffer: false,
              stashInitialSize: 128
            }
          });
          var dom = _this3.$refs.v.$el.children[0];
          _this3.flvPlayer.attachMediaElement(dom);
          _this3.flvPlayer.load();
          _this3.flvPlayer.play();
        } else {
          var func = function func() {
            var _this4 = this;

            //定时任务
            count++;
            console.log(count);
            _this.$request.checkVideo({
              cmdId: _this.getCmdId
            }).then(function (response) {
              console.log(response);
              if (response.data.data.code == "3") {
                if (_this4.flvPlayer) {
                  _this.flvPlayer.pause();
                  _this.flvPlayer.unload();
                  _this.flvPlayer.detachMediaElement();
                  _this.flvPlayer.destroy();
                  _this.flvPlayer = null;
                }
                _this.flvPlayer = flv["a" /* default */].createPlayer({
                  type: "flv",
                  url: _this.getCurrentVideo,
                  hasAudio: false,
                  config: {
                    enableWorker: true,
                    enableStashBuffer: false,
                    stashInitialSize: 128
                  }
                });
                var _dom = _this.$refs.v.$el.children[0];
                _this.flvPlayer.attachMediaElement(_dom);
                _this.flvPlayer.load();
                _this.flvPlayer.play();
                flag = 1;
                clearInterval(_this.interval); //停止
              }
              if (count == 20 && flag == 0) {
                _this.$message({
                  type: "error",
                  message: "获取视频失败",
                  duration: 1000
                });
                clearInterval(_this.interval); //停止
              }
            }).catch(function (error) {
              _this.$message({
                type: "error",
                message: "获取视频失败",
                duration: 1000
              });
              console.log("error=", error);
              clearInterval(_this.interval); //停止
            });
          };

          _this.interval = setInterval(func, 1000); //轮询
        }
      });
    },
    handleClose: function handleClose(done) {
      this.beforeSeconds = 10;
      this.afterSeconds = 10;
      console.log(this.getCmdId);
      console.log(done);
      clearInterval(this.interval); //停止
      var param = void 0;
      // if (this.getCmdId == -1) {
      //   param = {
      //     anchangId: this.fieldId,
      //     url: this.getCurrentVideo,
      //     // 强哥说就算cmd为-1，停止播放也要传cmdId:-1
      //     cmdId: this.getCmdId
      //   };
      // } else {
      param = {
        anchangId: this.fieldId,
        url: this.getCurrentVideo,
        cmdId: this.getCmdId
      };
      // }
      this.$request.stopVideo(param).then(function (res) {});

      if (this.flvPlayer) {
        this.flvPlayer.pause();
        this.flvPlayer.unload();
        this.flvPlayer.detachMediaElement();
        this.flvPlayer.destroy();
        this.flvPlayer = null;
      }
      this.innerVideo = false;
    },

    // 后退
    slowPlay: function slowPlay() {
      this.beforeSeconds += -20;
      this.afterSeconds += 20;
      this.viewVideo();
    },

    // 快进
    fastPlay: function fastPlay() {
      this.beforeSeconds += 20;
      this.afterSeconds += -20;
      this.viewVideo();
    },

    // 删除历史到访记录
    deleteItem: function deleteItem(index) {
      var _this5 = this;

      var lastLastFirstTime = "";
      var nextFirstTime = "";

      if (index <= 1) {
        lastLastFirstTime = this.getCustomerHistoryAllData[index - 1].firstTime.substr(0, this.getCustomerHistoryAllData[index - 1].firstTime.length - 2);
      } else {
        lastLastFirstTime = this.getCustomerHistoryAllData[index - 2].firstTime.substr(0, this.getCustomerHistoryAllData[index - 2].firstTime.length - 2);
      }

      if (index == this.getCustomerHistoryAllData.length - 1) {
        nextFirstTime = null;
      } else {
        nextFirstTime = this.getCustomerHistoryAllData[index + 1].firstTime.substr(0, this.getCustomerHistoryAllData[index + 1].firstTime.length - 2);
      }

      var data = {
        visitorId: this.getCustomerInfoAllData.id,
        thisFirstTime: this.getCustomerHistoryAllData[index].firstTime.substr(0, this.getCustomerHistoryAllData[index].firstTime.length - 2),
        lastFirstTime: this.getCustomerHistoryAllData[index - 1].firstTime.substr(0, this.getCustomerHistoryAllData[index - 1].firstTime.length - 2),
        lastLastFirstTime: lastLastFirstTime,
        nextFirstTime: nextFirstTime,
        redisKey: this.getCustomerInfoAllData.redisKey,
        visitNum: this.getCustomerInfoAllData.visitNum,
        thisNum: index + 1,
        imageName: this.getCustomerHistoryAllData[index].imageName,
        anchangId: this.fieldId,
        corId: this.corId
      };

      this.$confirm("确认删除该条数据么？", "信息", {
        confirmButtonText: "确定",
        cancelButtonText: "取消",
        type: "warning"
      }).then(function () {
        _this5.deleteStatus = "正在删除中...";
        _this5.getCustomerHistoryAllData[index].deleteStatus = true;
        _this5.$request.deleteFufangAndCreateNewId(data).then(function (res) {
          console.log(res);
          if (res.status == 200) {
            _this5.getCustomerHistoryAllData.splice(index, 1);
            _this5.deleteStatus = "删除成功";
            _this5.$message({
              type: "success",
              message: "用户删除成功",
              duration: 1000
            });
          }
        }).catch(function () {
          _this5.deleteStatus = "删除失败";
          _this5.getCustomerHistoryAllData[index].deleteStatus = false;
        });
      });
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-1f93b1b4","hasScoped":true,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/component/fengkong/signCustomerDetail.vue
var signCustomerDetail_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"dialogPerson",staticStyle:{"flex-direction":"column"}},[_vm._m(0),_vm._v(" "),_c('div',{staticClass:"dialogPerson"},[_c('div',{staticClass:"dialogPersonBtn"},[_vm._t("buttonSlot1")],2),_vm._v(" "),_c('div',{staticClass:"dialogPersonCase"},[_c('table',{attrs:{"width":"100%","cellspacing":"0","cellpadding":"6","border":"0"}},[_c('tr',[_c('td',{attrs:{"width":"60"}},[_vm._v("客户姓名:")]),_vm._v(" "),_c('td',{attrs:{"width":"220"}},[_vm._v("\n            "+_vm._s(_vm.getCustomerInfoAllData.realName || "暂无数据")+"\n          ")]),_vm._v(" "),_c('td',{attrs:{"width":"60"}},[_vm._v("客户性别:")]),_vm._v(" "),_c('td',{attrs:{"width":"220"}},[_vm._v("\n            "+_vm._s(_vm._f("formatGender")(_vm.getCustomerInfoAllData.gender))+"\n          ")]),_vm._v(" "),_c('td',{attrs:{"width":"60","align":"right"}},[_vm._v("年龄:")]),_vm._v(" "),_c('td',{attrs:{"width":"220"}},[_vm._v(_vm._s(_vm._f("formatAge")(_vm.getCustomerInfoAllData.age)))])]),_vm._v(" "),_c('tr',[_c('td',[_vm._v("来访次数:")]),_vm._v(" "),_c('td',[_vm._v(_vm._s(_vm.getCustomerInfoAllData.visitNum || "0")+" 次")]),_vm._v(" "),_c('td',[_vm._v("联系方式:")]),_vm._v(" "),_c('td',[_vm._v(_vm._s(_vm.getCustomerInfoAllData.phone || "暂无数据"))]),_vm._v(" "),_c('td',{attrs:{"align":"right"}},[_vm._v("顾问:")]),_vm._v(" "),_c('td',[_vm._v(_vm._s(_vm.getCustomerInfoAllData.saler || "暂无数据"))])]),_vm._v(" "),_c('tr',[_c('td',[_vm._v("首次到访:")]),_vm._v(" "),(_vm.getCustomerInfoAllData.children[0].imageName)?_c('td',[(_vm.verson == 2 || _vm.verson == 3)?[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('img',{staticStyle:{"width":"330px","margin":"-7px -7px -10px -7px"},attrs:{"src":_vm.imgPath1 + '/v5' + _vm.getCustomerInfoAllData.children[0].imageName,"draggable":"false"}})]),_vm._v(" "),_c('img',{staticStyle:{"display":"block"},attrs:{"src":_vm.imgPath1 + '/v5' + _vm.getCustomerInfoAllData.children[0].imageName,"alt":"","height":"30"}})])]:[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"contentImg",staticStyle:{"width":"150px","margin":"-7px"}},[_c('div',{staticClass:"contentImg_Box"},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{attrs:{"src":_vm.imgPath1 + _vm.getCustomerInfoAllData.children[0].imageName,"draggable":"false"}})])])])]),_vm._v(" "),_c('img',{staticStyle:{"display":"block"},attrs:{"src":_vm.imgPath1 + _vm.getCustomerInfoAllData.children[0].imageName,"alt":"","height":"30"}})])]],2):_c('td',[_vm._v("暂无图片")]),_vm._v(" "),_c('td',[_vm._v("到访时间:")]),_vm._v(" "),_c('td',{attrs:{"colspan":"3"}},[_vm._v("\n            "+_vm._s(_vm.getCustomerInfoAllData.children[0].firstTime || "暂无数据")+"\n          ")])]),_vm._v(" "),_c('tr',[_c('td',[_vm._v("最新到访:")]),_vm._v(" "),(_vm.getCustomerInfoAllData.children[0].imageName)?_c('td',[(_vm.verson == 2 || _vm.verson == 3)?[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('img',{staticStyle:{"width":"330px","margin":"-7px -7px -10px -7px"},attrs:{"src":_vm.imgPath1 + '/v5' +
                        _vm.getCustomerInfoAllData.children.slice(-1)[0].imageName,"draggable":"false"}})]),_vm._v(" "),_c('img',{staticStyle:{"display":"block"},attrs:{"src":_vm.imgPath1 + '/v5' +
                      _vm.getCustomerInfoAllData.children.slice(-1)[0].imageName,"alt":"","height":"30"}})])]:[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"contentImg",staticStyle:{"width":"150px","margin":"-7px"}},[_c('div',{staticClass:"contentImg_Box"},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{attrs:{"src":_vm.imgPath1 + _vm.getCustomerInfoAllData.children.slice(-1)[0].imageName,"draggable":"false"}})])])])]),_vm._v(" "),_c('img',{staticStyle:{"display":"block"},attrs:{"src":_vm.imgPath1 + _vm.getCustomerInfoAllData.children.slice(-1)[0].imageName,"alt":"","height":"30"}})])]],2):_c('td',[_vm._v("暂无图片")]),_vm._v(" "),_c('td',[_vm._v("到访时间:")]),_vm._v(" "),_c('td',{attrs:{"colspan":"3"}},[_vm._v("\n            "+_vm._s(_vm.getCustomerInfoAllData.children.slice(-1)[0].firstTime ||
                "暂无数据")+"\n          ")])]),_vm._v(" "),_vm._m(1),_vm._v(" "),_vm._m(2)]),_vm._v(" "),_c('div',{staticClass:"itemBox"},_vm._l((_vm.getCustomerHistoryAllData),function(item,index){return _c('div',{key:index,staticClass:"historyList"},[_c('div',{staticClass:"lineCase"},[_c('div',{staticClass:"lineCase_name"},[_vm._v("\n              "+_vm._s(_vm._f("formatDate1")(item.firstTime))+"\n            ")]),_vm._v(" "),_c('div',{staticClass:"lineCase_name"},[_vm._v("\n              "+_vm._s(_vm._f("formatDate2")(item.firstTime))+"\n            ")]),_vm._v(" "),_vm._m(3,true),_vm._v(" "),_c('div',{staticClass:"libeBtn"},[(item.deleteStatus)?[_vm._v(_vm._s(_vm.deleteStatus))]:[(item.setDelete == false)?_c('span',{staticClass:"delete_icon",on:{"click":function($event){return _vm.deleteItem(index)}}},[_c('i',{staticClass:"el-icon-delete"})]):_vm._e()]],2)]),_vm._v(" "),_c('div',{staticClass:"itemList02"},[(_vm.verson == 2 || _vm.verson == 3)?_c('div',{staticClass:"snapImg_case"},[_c('div',{staticClass:"snapImg02"},[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('img',{staticStyle:{"width":"330px","margin":"-7px -7px -10px -7px"},attrs:{"src":_vm.imgPath1 + item.shotImages[0],"draggable":"false"}})]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"100px","height":"75px"},attrs:{"src":_vm.imgPath1 + item.shotImages[0],"draggable":"false"}})])],1),_vm._v(" "),_c('div',{staticClass:"lineCase_name"},[_vm._v("\n                "+_vm._s(item.name)+"\n              ")]),_vm._v(" "),_c('div',{staticClass:"snapImg_btn"},[_c('button',{staticClass:"btn btn06 mini",on:{"click":function($event){(_vm.innerVideo = true), _vm.openVideo(index)}}},[_vm._v("点击查看视频")])])]):_c('div',{staticClass:"snapImg_case"},[_c('div',{staticClass:"snapImg"},[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"contentImg",staticStyle:{"width":"150px","margin":"-7px"}},[_c('div',{staticClass:"contentImg_Box"},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{attrs:{"src":_vm.imgPath1 + item.shotImages[0],"draggable":"false"}})]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box_name"},[_vm._v("签约照片")])])])]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"60px","height":"75px"},attrs:{"src":_vm.imgPath1 + item.shotImages[0],"draggable":"false"}})])],1),_vm._v(" "),_c('div',{staticClass:"lineCase_name"},[_vm._v("\n                "+_vm._s(item.name)+"\n              ")]),_vm._v(" "),_c('div',{staticClass:"snapImg_btn"},[_c('button',{staticClass:"btn btn06 mini",on:{"click":function($event){(_vm.innerVideo = true), _vm.openVideo(index)}}},[_vm._v("点击查看视频")])])])])])}),0)]),_vm._v(" "),_c('div',{staticClass:"dialogPersonBtn"},[_vm._t("buttonSlot2")],2)]),_vm._v(" "),_c('div',{staticClass:"innerVideo"},[_c('el-dialog',{staticStyle:{"background":"rgba(0,0,0,.8)"},attrs:{"width":"1000px","title":"查看视频","visible":_vm.innerVideo,"before-close":_vm.handleClose,"center":"","append-to-body":""},on:{"update:visible":function($event){_vm.innerVideo=$event}}},[_c('signViewVideo',{ref:"v",on:{"slowPlay":_vm.slowPlay,"fastPlay":_vm.fastPlay}})],1)],1)])}
var signCustomerDetail_staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"header_detail_modal",staticStyle:{"margin-top":"0"}},[_c('h1',[_vm._v("客户概况")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('tr',[_c('td',{attrs:{"valign":"top"}},[_vm._v("历史到访:")]),_vm._v(" "),_c('td',{attrs:{"colspan":"5"}})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('tr',[_c('td'),_vm._v(" "),_c('td',{attrs:{"colspan":"5"}})])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"lineStyle"},[_c('span')])}]
var signCustomerDetail_esExports = { render: signCustomerDetail_render, staticRenderFns: signCustomerDetail_staticRenderFns }
/* harmony default export */ var fengkong_signCustomerDetail = (signCustomerDetail_esExports);
// CONCATENATED MODULE: ./src/component/fengkong/signCustomerDetail.vue
function signCustomerDetail_injectStyle (ssrContext) {
  __webpack_require__("OxAu")
}
var signCustomerDetail_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var signCustomerDetail___vue_template_functional__ = false
/* styles */
var signCustomerDetail___vue_styles__ = signCustomerDetail_injectStyle
/* scopeId */
var signCustomerDetail___vue_scopeId__ = "data-v-1f93b1b4"
/* moduleIdentifier (server only) */
var signCustomerDetail___vue_module_identifier__ = null
var signCustomerDetail_Component = signCustomerDetail_normalizeComponent(
  signCustomerDetail,
  fengkong_signCustomerDetail,
  signCustomerDetail___vue_template_functional__,
  signCustomerDetail___vue_styles__,
  signCustomerDetail___vue_scopeId__,
  signCustomerDetail___vue_module_identifier__
)

/* harmony default export */ var component_fengkong_signCustomerDetail = (signCustomerDetail_Component.exports);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/component/fengkong/transferBox.vue
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//


/* harmony default export */ var transferBox = ({
  props: {
    getAllData: {
      type: [Array, Object],
      default: function _default() {
        return [];
      }
    },
    getObjective: {
      type: [Array, Object],
      default: function _default() {
        return [];
      }
    },
    currentIndex: {
      type: [Number, String],
      default: function _default() {
        return "";
      }
    }
  },
  data: function data() {
    return {
      staffTemp: {
        similarity: "",
        id: ""
      },
      staffList: [],
      selectedStaffList: [],
      staffData: [],
      selectedStaffData: [],
      tableKey: 0,
      rowKey: "rowKey",

      tableData: []
    };
  },
  mounted: function mounted() {
    this.fieldId = window.sessionStorage.getItem("fieldId");
  },

  watch: {
    getAllData: {
      handler: function handler(v, x) {
        this.staffList = [];
        console.log(v[0]);
        this.staffList = v[0];
      },

      immediate: true
    },
    getObjective: {
      handler: function handler(v, x) {
        console.log(v);
        this.tableData = [v];
      },

      immediate: true
    },
    currentIndex: {
      handler: function handler(v, x) {
        var _this = this;

        console.log(v);
        this.$nextTick(function () {
          [_this.staffList[v]].forEach(function (row) {
            console.log(row);
            _this.$refs.staffTable.clearSelection();
            _this.$refs.staffTable.toggleRowSelection(row);
          });
        });
      },

      immediate: true
    }
  },
  methods: {
    // 从后台获取左边表格的数据
    getStaffList: function getStaffList() {},

    // 将左边表格选择项存入staffData中
    handleStaffChange: function handleStaffChange(rows) {
      var _this2 = this;

      this.staffData = [];
      if (rows) {
        rows.forEach(function (row) {
          if (row) {
            _this2.staffData.push(row);
          }
        });
      }
    },
    getRowKey: function getRowKey(row) {
      return row.id;
    },

    // 左边表格选择项移到右边
    addStaff: function addStaff() {
      var _this3 = this;

      setTimeout(function () {
        _this3.$refs["staffTable"].clearSelection();
        _this3.$refs["selectedStaffTable"].clearSelection();
      }, 0);
      var repeat = false;
      // this.$nextTick(() => {
      //   for (let i = 0; i < this.selectedStaffList.length; i++) {
      //     this.$refs.staffTable.toggleRowSelection(
      //       this.selectedStaffList[i],
      //       true
      //     );
      //   }
      // });
      this.selectedStaffList.forEach(function (item) {
        if (_this3.staffData[0] && item.similarity === _this3.staffData[0].similarity) {
          repeat = true;
          return;
        }
      });
      if (repeat === false) {
        this.staffData.forEach(function (item) {
          _this3.selectedStaffList.push(item);
        });
        for (var i = 0; i < this.staffList.length; i++) {
          for (var j = 0; j < this.staffData.length; j++) {
            if (this.staffList[i] && this.staffData[j] && this.staffList[i].similarity == this.staffData[j].similarity) {
              // this.staffList.splice(i, 1);
            }
          }
        }
      }
    },

    // 右边表格选择项移到左边
    removeStaff: function removeStaff() {
      var _this4 = this;

      this.staffList = [];
      setTimeout(function () {
        _this4.$refs["staffTable"].clearSelection();
        _this4.$refs["selectedStaffTable"].clearSelection();
      }, 0);
      this.selectedStaffData.forEach(function (item) {
        _this4.staffList.push(item);
      });
      for (var i = 0; i < this.selectedStaffList.length; i++) {
        for (var j = 0; j < this.selectedStaffData.length; j++) {
          if (this.selectedStaffList[i] && this.selectedStaffData[j] && this.selectedStaffList[i].similarity === this.selectedStaffData[j].similarity) {
            this.selectedStaffList.splice(i, 1);
            this.staffList = JSON.parse(window.sessionStorage.getItem("allData"));
          }
        }
      }
    },

    // 将右边表格选择项存入selectedStaffData中
    handleSelectedStaffChange: function handleSelectedStaffChange(rows) {
      var _this5 = this;

      this.selectedStaffData = [];
      if (rows) {
        rows.forEach(function (row) {
          if (row) {
            _this5.selectedStaffData.push(row);
          }
        });
      }
    },

    // 当关闭的时候，清空当前选中数据列表
    whenCloseAndClearList: function whenCloseAndClearList() {
      this.selectedStaffList = [];
      this.tableData = [];
    },

    // 提交
    modifyStaff: function modifyStaff() {
      var _this6 = this;

      console.log(this.selectedStaffList);
      if (this.selectedStaffList.length > 0) {
        var ids = [];
        this.selectedStaffList.forEach(function (v) {
          ids.push(v.id);
        });
        // 删除指定的id元素
        ids.splice(ids.findIndex(function (item) {
          return item == _this6.getObjective.id;
        }), 1);
        // ids.filter(v => !this.getObjective.includes(v))
        this.formData = new FormData();
        // 主合并的id
        this.formData.append("toVisitorId", this.getObjective.id);
        // 零碎合并的id<Array>
        this.formData.append("formVisitorIds", ids.toString());
        this.formData.append("anchangId", this.fieldId);

        this.$request.mergeVisitors2One(this.formData).then(function (res) {
          console.log(res);
          if (res.data.code == 1000) {
            _this6.selectedStaffList = [];
            _this6.tableData = [];
            // this.staffList = []
            _this6.$emit("closeMerge");
            _this6.$message({
              showClose: true,
              message: "归并相似到访记录成功",
              type: "success"
            });
          } else {
            _this6.$message({
              showClose: true,
              message: "归并相似到访记录失败",
              type: "error"
            });
          }
        });
      } else {
        this.$message({
          showClose: true,
          message: "请选择要归并的相似到访记录",
          type: "error"
        });
      }
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-b1a3eacc","hasScoped":false,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/component/fengkong/transferBox.vue
var transferBox_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"transferBox",staticStyle:{"text-align":"center"}},[_c('div',{staticStyle:{"flex":"1","overflow-y":"auto","overflow-x":"hidden"}},[_c('el-row',{attrs:{"gutter":20}},[_c('el-col',{attrs:{"span":10}},[_c('el-table',{key:_vm.tableKey,ref:"staffTable",attrs:{"data":_vm.staffList,"border":"","fit":"","highlight-current-row":""},on:{"selection-change":_vm.handleStaffChange}},[_c('el-table-column',{attrs:{"type":"selection","reserve-selection":true}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"index","label":"相似到访"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"similarity","label":"相似度"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"id","label":"ID"}})],1)],1),_vm._v(" "),_c('el-col',{staticStyle:{"text-align":"center"},attrs:{"span":4}},[_c('el-button',{staticStyle:{"margin-top":"92px"},attrs:{"type":"primary","size":"small","disabled":!_vm.staffData.length},on:{"click":_vm.addStaff}},[_vm._v("添加归并"),_c('i',{staticClass:"el-icon-arrow-right el-icon--right"})]),_vm._v(" "),_c('el-button',{staticStyle:{"margin-left":"0","margin-top":"10px"},attrs:{"type":"primary","disabled":!_vm.selectedStaffData.length,"size":"small","icon":"el-icon-arrow-left"},on:{"click":_vm.removeStaff}},[_vm._v("移除归并")])],1),_vm._v(" "),_c('el-col',{attrs:{"span":10}},[_c('div',{staticClass:"MergeTitle"},[_c('h1',[_vm._v("目标归并")])]),_vm._v(" "),_c('el-table',{staticStyle:{"width":"100%"},attrs:{"data":_vm.tableData,"border":""}},[_c('el-table-column',{attrs:{"prop":"index","label":"相似到访"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"similarity","label":"相似度"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"id","label":"ID"}})],1),_vm._v(" "),_c('div',{staticClass:"MergeTitle"}),_vm._v(" "),_c('el-table',{key:_vm.tableKey,ref:"selectedStaffTable",attrs:{"data":_vm.selectedStaffList,"border":"","fit":"","highlight-current-row":""},on:{"selection-change":_vm.handleSelectedStaffChange}},[_c('el-table-column',{attrs:{"type":"selection","reserve-selection":true,"width":"55"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"index","label":"相似到访"}}),_vm._v(" "),_c('el-table-column',{attrs:{"label":"相似度","align":"center"},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var row = ref.row;
return [_c('span',[_vm._v(_vm._s(row.similarity))])]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"label":"ID","align":"center"},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var row = ref.row;
return [_c('span',[_vm._v(_vm._s(row.id))])]}}])})],1)],1)],1)],1),_vm._v(" "),_c('div',{staticClass:"transferBoxFooter"},[_c('span',{staticStyle:{"flex":"1","text-align":"left"}},[_vm._v("共 "+_vm._s(_vm.staffList.length)+" 条数据")]),_vm._v(" "),_c('el-button',{attrs:{"type":"primary","size":"small"},on:{"click":_vm.modifyStaff}},[_vm._v("确认归并")])],1)])}
var transferBox_staticRenderFns = []
var transferBox_esExports = { render: transferBox_render, staticRenderFns: transferBox_staticRenderFns }
/* harmony default export */ var fengkong_transferBox = (transferBox_esExports);
// CONCATENATED MODULE: ./src/component/fengkong/transferBox.vue
var transferBox_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var transferBox___vue_template_functional__ = false
/* styles */
var transferBox___vue_styles__ = null
/* scopeId */
var transferBox___vue_scopeId__ = null
/* moduleIdentifier (server only) */
var transferBox___vue_module_identifier__ = null
var transferBox_Component = transferBox_normalizeComponent(
  transferBox,
  fengkong_transferBox,
  transferBox___vue_template_functional__,
  transferBox___vue_styles__,
  transferBox___vue_scopeId__,
  transferBox___vue_module_identifier__
)

/* harmony default export */ var component_fengkong_transferBox = (transferBox_Component.exports);

// EXTERNAL MODULE: ./src/request/axios.js + 1 modules
var axios = __webpack_require__("2NMA");

// EXTERNAL MODULE: ./src/component/fengkong/compareImage.vue + 2 modules
var compareImage = __webpack_require__("TQNy");

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/component/fengkong/signHistorySimilar.vue




//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//










/* harmony default export */ var signHistorySimilar = ({
  props: {
    snapImageUrl: {
      type: [Number, String],
      default: function _default() {
        return "";
      }
    },
    customerInfo: {
      type: [Array, Object],
      default: function _default() {
        return [];
      }
    },
    reBindNewTime: {
      type: [Number, String],
      default: function _default() {
        return "";
      }
    },
    bindingTypeStatus: {
      type: [Number, String],
      default: function _default() {
        return "";
      }
    }
  },
  filters: {
    formatDate1: function formatDate1(value) {
      var format = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "YYYY-MM-DD";

      return moment_default()(value).format(format);
    },
    formatDate2: function formatDate2(value) {
      var format = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : "HH:mm:ss";

      return moment_default()(value).format(format);
    }
  },
  components: { signViewVideo: component_fengkong_signViewVideo, signCustomerDetail: component_fengkong_signCustomerDetail, transferBox: component_fengkong_transferBox, compareImage: compareImage["a" /* default */] },
  data: function data() {
    return {
      flvPlayer: null,
      allData: [],
      datas: [], //相似列表数据
      crashDatas: [], //回收站数据
      datas02: [],
      // page
      getDataTotalNum: 0,
      getListData: {
        pageIndex: 1,
        pageSize: 10
      },
      DataTotalNum: 1,
      tipMsg: "视频正在加载中...",
      shotImages: [],
      newArrImg: [],
      newArrImg02: [],
      loadingData: false,
      innerVideo1: false,
      innerVideo: false,
      innerExamineList: false,
      innerMerge: false,
      getCurrentVideo: "",
      getThisIndex: "",
      beforeSeconds: 10,
      afterSeconds: 10,
      setData: "",
      isDataState: true,
      isDataState02: true,
      showTips: "数据正在加载中...",
      showTips02: "数据正在加载中...",
      getHistoryAllData: [],
      getCustomerInfoAllData: [],
      getCustomerHistoryAllData: [],
      environment: "",
      verson: "",
      deleteStatus: "",
      similarity: [],
      currentIndex: 0,
      getAllData: [],
      getObjective: [],
      getCmdId: "",
      // 如果当前数据少于5条，控制加载更多按钮显隐
      ifHasMoreDataShow: false,
      // 数据状态
      alreadyAllData: false,
      //从sessionStorage中获取的用户权限
      level: "",
      loading: false, //相似列表loading
      loadingC: false, //回收站loading
      value: false,
      index1: "",
      index2: "",
      //相似列表排序
      options: [{
        value: 'time',
        label: '时间排序'
      }, {
        value: 'similarity',
        label: '相似度排序'
      }],
      sortRadio: 'desc',
      rankType: 'similarity',
      listType: 0, //0--相似列表，1-回收站
      similarityValue: [0.9, 1],
      marks: {
        0: '低',
        0.7: '中',
        0.9: '高'
      },
      minSimilarity: '0.9',
      maxSimilarity: '1'
    };
  },

  watch: {
    datas: function datas(newval) {
      console.log(newval, 111111);
    },

    snapImageUrl: {
      handler: function handler(v, x) {
        this.imgPath1 = JSON.parse(window.localStorage.getItem("param")).imagePathPrefix;
        this.imgPath = JSON.parse(window.localStorage.getItem("param")).riskImagePathPrefix;
        this.fieldId = window.sessionStorage.getItem("fieldId");
        // 清空列表
        this.datas = [];
        this.datas02 = [];
        this.itemList();
      },

      immediate: true
    },
    reBindNewTime: {
      handler: function handler(v, x) {
        console.log(v);
      },

      immediate: true
    },
    customerInfo: {
      handler: function handler(v, x) {
        var _this2 = this;

        this.rankType = 'similarity';
        this.sortRadio = 'desc';
        this.listType = 0;
        console.log(v, x);
        console.log(v.firstVisitTime);
        this.isDataState = true;
        this.isDataState02 = false;
        if (v.firstVisitTime == null) {
          this.showTips = "暂无历史到访记录";
        } else {
          this.showTips = "数据正在加载中...", this.showTips02 = "数据正在加载中...";
        }
        var isBind = "";
        this.allData.forEach(function (item, index) {
          item.isBind = false;
          if (_this2.customerInfo.visitorId) {
            if (item.id == _this2.customerInfo.visitorId) {
              item.isBind = true;
              // window.sessionStorage.setItem("isBind",item.id)
              isBind = item.id;
              _this2.getAlreadyBindId(isBind);
            }
          } else {
            if (Math.abs(item.createTime - _this2.timeToTimestamp(_this2.customerInfo.firstVisitTime)) < 999) {
              console.log(Math.abs(item.createTime - _this2.timeToTimestamp(_this2.customerInfo.firstVisitTime)));
              item.isBind = true;
              // window.sessionStorage.setItem("isBind",item.id)
              isBind = item.id;
              _this2.getAlreadyBindId(isBind);
            }
          }
        });
      },

      immediate: true
    }
  },
  created: function created() {
    this.imgPath1 = JSON.parse(window.localStorage.getItem("param")).imagePathPrefix;
    this.imgPath = JSON.parse(window.localStorage.getItem("param")).riskImagePathPrefix;
    this.fieldId = window.sessionStorage.getItem("fieldId");
    var rootAdminInfo = JSON.parse(Object(utils["a" /* Decrypt */])(window.sessionStorage.getItem("rootAdminInfo")));
    this.level = rootAdminInfo.level;
    console.log(this.level);
  },
  mounted: function mounted() {
    var _this3 = this;

    this.environment = window.sessionStorage.getItem("environment") || "1";
    // verson == 1 : 人脸版
    // verson != 1 || verson == 2 || verson == 3 : 非人脸版
    this.verson = window.sessionStorage.getItem("version");
    this.getHistoryAllData.forEach(function (v) {
      _this3.$set(v, "deleteStatus", false);
    });
    console.log(this.getHistoryAllData, 11111);

    console.log(this.getHistoryAllData.length);
  },

  methods: {
    // 封装的这么一个格式化日期的方法
    timestampToTimeNoY: function timestampToTimeNoY(timestamp) {
      var date = new Date(parseInt(timestamp)),
          Y = date.getFullYear() + "-",
          M = (date.getMonth() + 1 < 10 ? "0" + (date.getMonth() + 1) : date.getMonth() + 1) + "-",
          D = (date.getDate() < 10 ? "0" + date.getDate() : date.getDate()) + " ",
          h = (date.getHours() < 10 ? "0" + date.getHours() : date.getHours()) + ":",
          m = (date.getMinutes() < 10 ? "0" + date.getMinutes() : date.getMinutes()) + ":",
          s = (date.getSeconds() < 10 ? "0" + date.getSeconds() : date.getSeconds()) + "";
      return [Y + M + D, h + m + s];
    },

    //日期转时间戳，精确到毫秒
    timeToTimestamp: function timeToTimestamp(time) {
      var date = new Date(time);
      return date.getTime();
    },
    fnSource: function fnSource(data) {
      var _this4 = this;

      return asyncToGenerator_default()( /*#__PURE__*/regenerator_default.a.mark(function _callee() {
        var _loop, i;

        return regenerator_default.a.wrap(function _callee$(_context2) {
          while (1) {
            switch (_context2.prev = _context2.next) {
              case 0:
                // 判断当前状态是否链接内网
                // environment = 0 => 内网
                // environment = 1 => 外网
                _this4.datas = data;
                // console.log(this.allData)
                _loop = /*#__PURE__*/regenerator_default.a.mark(function _loop(i) {
                  var date, start, end, data, data2;
                  return regenerator_default.a.wrap(function _loop$(_context) {
                    while (1) {
                      switch (_context.prev = _context.next) {
                        case 0:
                          date = _this4.timestampToTimeNoY(_this4.datas[i].createTime)[0].replace("-", "").replace("-", "");
                          start = _this4.timestampToTimeNoY(_this4.datas[i].createTime - 10000)[1].replace(":", "").replace(":", "");
                          end = _this4.timestampToTimeNoY(_this4.datas[i].createTime + 10000)[1].replace(":", "").replace(":", "");
                          data = {
                            anchangId: _this4.datas[i].anchangId,
                            beginTime: (date + "t" + start + "z").replace(" ", ""),
                            endTime: (date + "t" + end + "z").replace(" ", ""),
                            camId: _this4.datas[i].imageName.split("-")[9]
                          };

                          // let statusWinodow = `当前模式 : ${this.environment} - 状态 : ${this.environment == 0 ? '内网' : '外网'}`
                          // console.log(statusWinodow)
                          // 加判断当前设备是够为内网，如果是内网，则运行适配适配播放接口

                          if (_this4.environment == 0) {
                            _this4.$request.getMp4(data).then(function (res) {
                              // console.log(res);
                              if (res.data.data) {
                                var func = function func() {
                                  // 暂时先测试用的
                                  // document
                                  //   .getElementById("v" + that.datas[i].id)
                                  //   .setAttribute(
                                  //     "src",
                                  //     "http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"
                                  //   );
                                  // document.getElementById("v" + that.datas[i].id).style.display =
                                  //   "";
                                  // that.tipMsg = "";

                                  count++;
                                  axios["a" /* request */].get(checkUrl + "?temp=" + Math.random()).then(function (res) {
                                    console.log(res);
                                    if (res.status == 200) {
                                      if (res.data == "OK") {
                                        console.log(playUrl);
                                        document.getElementById("v" + that.datas[i].id).setAttribute("src", playUrl);
                                        document.getElementById("v" + that.datas[i].id).style.display = "";
                                        that.tipMsg = "";
                                        clearInterval(interval); //停止
                                      }
                                      if (res.data == "ER") {
                                        console.log("视频加载错误01");
                                        clearInterval(interval); //停止
                                      }
                                      if (count == 20) {
                                        clearInterval(interval); //停止
                                      }
                                    } else {
                                      that.tipMsg = "视频加载失败，请检查网络";
                                      clearInterval(interval); //停止
                                    }
                                  }).catch(function (err) {
                                    console.log("视频加载失败，请检查网络");
                                    // console.log("error=", err);
                                    that.tipMsg = "视频加载失败，请检查网络";
                                    // console.log("视频加载错误02");
                                    clearInterval(interval); //停止
                                  });
                                };

                                var count = 0,
                                    checkUrl = res.data.data.checkUrl,
                                    playUrl = res.data.data.playUrl;
                                // console.log(res);
                                _this4.loadingData = true;
                                var that = _this4;

                                var interval = setInterval(func, 6000); //轮询
                              } else {
                                console.log("视频加载错误03");
                              }
                            });
                          }
                          /******************************** 对每一个相似到访循环查历史到访 *****************************/

                          data2 = {
                            anchangId: _this4.datas[i].anchangId,
                            visitorId: _this4.datas[i].id,
                            entAreaId: 1,
                            contractId: _this4.customerInfo.id
                          };
                          _context.next = 8;
                          return _this4.$request.getArrangeRecord(data2).then(function (res) {
                            if (res.data.data) {
                              _this4.newArrImg = res.data.data.reverse();
                              if (res.data.data.length <= 0) {
                                _this4.isDataState02 = true;
                                _this4.showTips02 = "暂无相似到访记录";
                              } else {
                                _this4.isDataState02 = false;
                                _this4.showTips02 = "";
                              }
                              return res.data.data;
                            }
                          });

                        case 8:
                          _this4.datas[i].children = _context.sent;

                        case 9:
                        case "end":
                          return _context.stop();
                      }
                    }
                  }, _loop, _this4);
                });
                i = 0;

              case 3:
                if (!(i < _this4.datas.length)) {
                  _context2.next = 8;
                  break;
                }

                return _context2.delegateYield(_loop(i), "t0", 5);

              case 5:
                i++;
                _context2.next = 3;
                break;

              case 8:
              case "end":
                return _context2.stop();
            }
          }
        }, _callee, _this4);
      }))();
    },

    //相似列表
    itemList: function itemList() {
      var _this5 = this;

      // window.sessionStorage.setItem("isBind","")
      this.loading = true;
      // 清空数据
      this.getHistoryAllData = [];
      var isBind = "";
      this.$request.getPersonDetail({
        anchangId: this.fieldId,
        imageName: this.snapImageUrl,
        limit: 24,
        orderBy: this.rankType,
        direction: this.sortRadio,
        contractId: this.customerInfo.id,
        minSimilarity: this.minSimilarity,
        maxSimilarity: this.maxSimilarity
      }).then(function (res) {
        // console.log("--------------------------||||-----",res)
        if (res.data.data && res.data.data.length) {
          res.data.data.forEach(function (v) {
            return v.children = [];
          });
          _this5.allData = res.data.data;
          _this5.allData.forEach(function (v, index) {
            v.index = "相似到访" + (index + 1);
          });
          window.sessionStorage.setItem("allData", stringify_default()(_this5.allData));
          _this5.datas = _this5.allData.slice(0 + 5 * _this5.getDataTotalNum, 5 + 5 * _this5.getDataTotalNum);
          console.log(_this5.allData);
          console.log("当前最新数据----------->", _this5.datas);
          console.log(_this5.allData.length, keys_default()(_this5.datas).length);
          // 如果当前数据总数量少于等于5条，那么不显示加载更多按钮
          if (keys_default()(_this5.datas).length <= 5) {
            _this5.ifHasMoreDataShow = false;
          } else {
            _this5.ifHasMoreDataShow = true;
          }

          _this5.loading = false;
          // this.isDataState = false;
          _this5.showTips = "暂无历史到访记录";
          _this5.fnSource(_this5.datas);
          _this5.allData.forEach(function (item, index) {
            item.isBind = false;
            if (_this5.customerInfo.visitorId) {
              if (item.id == _this5.customerInfo.visitorId) {
                item.isBind = true;
                // window.sessionStorage.setItem("isBind",item.id)
                isBind = item.id;
                _this5.getAlreadyBindId(isBind);
              }
            } else {
              _this5.showTips = "暂无历史到访记录";
              if (Math.abs(item.createTime - _this5.timeToTimestamp(_this5.customerInfo.firstVisitTime)) < 999) {
                console.log(Math.abs(item.createTime - _this5.timeToTimestamp(_this5.customerInfo.firstVisitTime)));
                item.isBind = true;
                // window.sessionStorage.setItem("isBind",item.id)
                isBind = item.id;
                _this5.getAlreadyBindId(isBind);
              }
            }
          });
          console.log(_this5.allData);
          // 如果当前数据总数量少于等于5条，那么不显示加载更多按钮
          if (_this5.allData.length <= 5) {
            _this5.ifHasMoreDataShow = false;
          } else {
            _this5.ifHasMoreDataShow = true;
          }
          _this5.isDataState02 = false;
          _this5.showTips02 = "";
        } else {
          _this5.loading = false;
          _this5.allData = [];
          _this5.datas = [];
          _this5.ifHasMoreDataShow = false;
          _this5.isDataState02 = true;
          _this5.showTips02 = "暂无数据";
        }
      }).catch(function (thrown) {
        if (_this5.$request.isCancel(thrown)) {
          console.log("Request canceled", thrown.message);
        } else {
          // handle error
        }
      });
    },

    //回收站列表
    crashList: function crashList() {
      var _this6 = this;

      this.loadingC = true;
      this.$request.getCrashList({
        anchangId: this.fieldId,
        contractId: this.customerInfo.id,
        type: 2
      }).then(function (res) {
        if (res.data.code == "1000") {
          res.data.data.forEach(function (v) {
            return v.children = [];
          });
          _this6.crashDatas = res.data.data;
          _this6.crashDatas.forEach(function (v, index) {
            v.index = "回收站记录" + (index + 1);
          });
          _this6.loadingC = false;
          _this6.fnSourceC(_this6.crashDatas);
        } else {
          _this6.$message({
            type: "error",
            message: res.data.msg,
            duration: 1000
          });
        }
      }).catch(function (err) {
        console.log(err);
        _this6.$message({
          type: "error",
          message: '回收站记录获取失败，请稍后再试！',
          duration: 1000
        });
      });
    },
    fnSourceC: function fnSourceC(data) {
      var _this7 = this;

      return asyncToGenerator_default()( /*#__PURE__*/regenerator_default.a.mark(function _callee2() {
        var _loop2, i;

        return regenerator_default.a.wrap(function _callee2$(_context4) {
          while (1) {
            switch (_context4.prev = _context4.next) {
              case 0:
                _this7.crashDatas = data;
                // environment = 0 => 内网
                // environment = 1 => 外网
                _loop2 = /*#__PURE__*/regenerator_default.a.mark(function _loop2(i) {
                  var date, start, end, param, param2;
                  return regenerator_default.a.wrap(function _loop2$(_context3) {
                    while (1) {
                      switch (_context3.prev = _context3.next) {
                        case 0:
                          date = _this7.timestampToTimeNoY(data[i].createTime)[0].replace("-", "").replace("-", "");
                          start = _this7.timestampToTimeNoY(data[i].createTime - 10000)[1].replace(":", "").replace(":", "");
                          end = _this7.timestampToTimeNoY(data[i].createTime + 10000)[1].replace(":", "").replace(":", "");
                          param = {
                            anchangId: data[i].anchangId,
                            beginTime: (date + "t" + start + "z").replace(" ", ""),
                            endTime: (date + "t" + end + "z").replace(" ", ""),
                            camId: data[i].imageName.split("-")[9]
                          };

                          // 加判断当前设备是够为内网，如果是内网，则运行适配适配播放接口

                          if (_this7.environment == 0) {
                            _this7.$request.getMp4(param).then(function (res) {
                              if (res.data.data) {
                                var func = function func() {
                                  _count++;
                                  axios["a" /* request */].get(_checkUrl + "?temp=" + Math.random()).then(function (res) {
                                    if (res.status == 200) {
                                      if (res.data == "OK") {
                                        document.getElementById("v" + data[i].id).setAttribute("src", _playUrl);
                                        document.getElementById("v" + data[i].id).style.display = "";
                                        _that.tipMsg = "";
                                        clearInterval(interval); //停止
                                      }
                                      if (res.data == "ER") {
                                        console.log("视频加载错误01");
                                        clearInterval(interval); //停止
                                      }
                                      if (_count == 20) {
                                        clearInterval(interval); //停止
                                      }
                                    } else {
                                      _that.tipMsg = "视频加载失败，请检查网络";
                                      clearInterval(interval); //停止
                                    }
                                  }).catch(function (err) {
                                    console.log("视频加载失败，请检查网络");
                                    _that.tipMsg = "视频加载失败，请检查网络";
                                    clearInterval(interval); //停止
                                  });
                                };

                                var _count = 0,
                                    _checkUrl = res.data.data.checkUrl,
                                    _playUrl = res.data.data.playUrl;
                                var _that = _this7;

                                var interval = setInterval(func, 6000); //轮询
                              } else {
                                console.log("视频加载错误03");
                              }
                            });
                          }
                          /******************************** 对每一个相似到访循环查历史到访 *****************************/
                          param2 = {
                            anchangId: data[i].anchangId,
                            visitorId: data[i].id,
                            entAreaId: 1,
                            contractId: _this7.customerInfo.id
                          };
                          _context3.next = 8;
                          return _this7.$request.getArrangeRecord(param2).then(function (res) {
                            if (res.data.data) {
                              return res.data.data;
                            }
                          });

                        case 8:
                          _this7.crashDatas[i].children = _context3.sent;

                        case 9:
                        case "end":
                          return _context3.stop();
                      }
                    }
                  }, _loop2, _this7);
                });
                i = 0;

              case 3:
                if (!(i < data.length)) {
                  _context4.next = 8;
                  break;
                }

                return _context4.delegateYield(_loop2(i), "t0", 5);

              case 5:
                i++;
                _context4.next = 3;
                break;

              case 8:
              case "end":
                return _context4.stop();
            }
          }
        }, _callee2, _this7);
      }))();
    },
    getAlreadyBindId: function getAlreadyBindId(data) {
      var _this8 = this;

      return asyncToGenerator_default()( /*#__PURE__*/regenerator_default.a.mark(function _callee3() {
        var data3, _loop3, k;

        return regenerator_default.a.wrap(function _callee3$(_context5) {
          while (1) {
            switch (_context5.prev = _context5.next) {
              case 0:
                console.log("id:", data);
                data3 = {
                  anchangId: _this8.fieldId,
                  visitorId: data,
                  entAreaId: 1,
                  contractId: _this8.customerInfo.id
                };

                console.log(data3);

                _context5.next = 5;
                return _this8.$request.getArrangeRecord(data3).then(function (res) {
                  console.log(res);
                  if (res.data.data) {
                    if (res.data.data.length <= 0) {
                      _this8.isDataState = true;
                      _this8.showTips = "暂无历史到访记录";
                    } else {
                      _this8.isDataState = false;
                      _this8.showTips = "";
                    }
                    console.log(_this8.getHistoryAllData);

                    // const min = Math.min.apply(Math, res.data.data.map(function(v) {return moment(v.firstTime).valueOf()}))
                    // console.log(min)

                    console.log(res.data.data.reduce(function (prev, current) {
                      return prev.firstTime < current.firstTime ? prev : current;
                    }));

                    // 首先要给整个对象默认设置删除状态为false
                    res.data.data.forEach(function (v) {
                      v.setDelete = false;
                    });
                    // 然后找出对象的最小值(firstTime)去找对应的对象并且给对应的整个对象设置属性为true
                    res.data.data.reduce(function (prev, current) {
                      return prev.firstTime < current.firstTime ? prev : current;
                    }).setDelete = true;

                    return _this8.getHistoryAllData = res.data.data.reverse();
                  }
                });

              case 5:
                // 添加删除状态
                _this8.getHistoryAllData.forEach(function (v) {
                  _this8.$set(v, "deleteStatus", false);
                });
                console.log(_this8.getHistoryAllData);

                _loop3 = function _loop3(k) {
                  // 20201018t095121z
                  var formatData = _this8.getHistoryAllData[k].firstTime;
                  var newformat = moment_default()(formatData).valueOf();
                  var date = _this8.timestampToTimeNoY(newformat)[0].replace("-", "").replace("-", "");
                  var start = _this8.timestampToTimeNoY(newformat - 10000)[1].replace(":", "").replace(":", "");
                  var end = _this8.timestampToTimeNoY(newformat + 10000)[1].replace(":", "").replace(":", "");
                  var dataVideo = {
                    anchangId: _this8.fieldId,
                    beginTime: (date + "t" + start + "z").replace(" ", ""),
                    endTime: (date + "t" + end + "z").replace(" ", ""),
                    camId: _this8.getHistoryAllData[k].imageName.split("-")[9]
                  };
                  // 加判断当前设备是够为内网，如果是内网，则运行适配适配播放接口
                  if (_this8.environment == 0) {
                    _this8.$request.getMp4(dataVideo).then(function (res) {
                      if (res.data.data) {
                        var funcVideo = function funcVideo() {
                          var _this9 = this;

                          // 暂时先测试用的
                          // document
                          //   .getElementById("k" + that.getHistoryAllData[k].id)
                          //   .setAttribute(
                          //     "src",
                          //     "http://clips.vorwaerts-gmbh.de/big_buck_bunny.mp4"
                          //   );
                          // document.getElementById(
                          //   "k" + that.getHistoryAllData[k].id
                          // ).style.display = "";
                          // this.tipMsg = "";
                          _count2++;
                          axios["a" /* request */].get(_checkUrl2 + "?temp=" + Math.random()).then(function (res) {
                            // console.log(res);
                            if (res.status == 200) {
                              if (res.data == "OK") {
                                // console.log(playUrl);
                                document.getElementById("k" + _that2.getHistoryAllData[k].id).setAttribute("src", _playUrl2);
                                document.getElementById("k" + _that2.getHistoryAllData[k].id).style.display = "";
                                _this9.tipMsg = "";
                                clearInterval(interval); //停止
                              }
                              if (res.data == "ER") {
                                console.log("视频加载错误01");
                                clearInterval(interval); //停止
                              }
                              if (_count2 == 20) {
                                clearInterval(interval); //停止
                              }
                            } else {
                              _that2.tipMsg = "视频加载失败，请检查网络";
                              clearInterval(interval); //停止
                            }
                          }).catch(function (err) {
                            // console.log("error=", err);
                            _that2.tipMsg = "视频加载失败，请检查网络";

                            // console.log("视频加载错误02");
                            clearInterval(interval); //停止
                          });
                        };

                        var _count2 = 0,
                            _checkUrl2 = res.data.data.checkUrl,
                            _playUrl2 = res.data.data.playUrl;

                        var _that2 = _this8;

                        var interval = setInterval(funcVideo, 6000); //轮询
                      }
                    });
                  }
                };

                for (k = 0; k < _this8.getHistoryAllData.length; k++) {
                  _loop3(k);
                }

              case 9:
              case "end":
                return _context5.stop();
            }
          }
        }, _callee3, _this8);
      }))();
    },
    changeArray: function changeArray() {
      var arr = this.allData.slice(0 + 5 * this.DataTotalNum++, 5 * this.DataTotalNum);
      arr.forEach(function (v) {});
      this.datas = this.datas.concat(arr);
      this.fnSource(this.datas);
      console.log(arr, this.datas);
      console.log(this.allData.length, keys_default()(this.datas).length);
      console.log("数据加载进度 ====> ", this.allData.length - keys_default()(this.datas).length);
      console.log(keys_default()(arr).length);
      // 如果当前数据总数量少于等于5条，那么不显示加载更多按钮
      // 如果当前数据加载条小于5条并且当前加载进度条数等于0 ==>
      // 20-5 == 15
      // 20-10 == 10
      // 20-15 == 5
      // 20-20 == 0
      if (keys_default()(arr).length < 5 || this.allData.length - keys_default()(this.datas).length == 0) {
        this.ifHasMoreDataShow = false;
        this.alreadyAllData = true;
      } else {
        this.ifHasMoreDataShow = true;
      }
    },
    deleteItem: function deleteItem(index) {
      var _this10 = this;

      var lastLastFirstTime = "";
      var nextFirstTime = "";

      console.log(this.getHistoryAllData);

      if (index <= 1) {
        lastLastFirstTime = this.getHistoryAllData[index - 1].firstTime.substr(0, this.getHistoryAllData[index - 1].firstTime.length - 2);
      } else {
        lastLastFirstTime = this.getHistoryAllData[index - 2].firstTime.substr(0, this.getHistoryAllData[index - 2].firstTime.length - 2);
      }

      console.log(index, this.getHistoryAllData.length - 1);
      if (index == this.getHistoryAllData.length - 1) {
        nextFirstTime = null;
      } else {
        nextFirstTime = this.getHistoryAllData[index + 1].firstTime.substr(0, this.getHistoryAllData[index + 1].firstTime.length - 2);
      }

      var filterData = "";
      this.allData.forEach(function (v) {
        if (v.isBind == true) {
          filterData = v;
        }
      });
      var data = {
        visitorId: filterData.id,
        thisFirstTime: this.getHistoryAllData[index].firstTime.substr(0, this.getHistoryAllData[index].firstTime.length - 2),
        lastFirstTime: this.getHistoryAllData[index - 1].firstTime.substr(0, this.getHistoryAllData[index - 1].firstTime.length - 2),
        lastLastFirstTime: lastLastFirstTime,
        nextFirstTime: nextFirstTime,
        redisKey: filterData.redisKey,
        visitNum: filterData.visitNum,
        thisNum: index + 1,
        imageName: this.getHistoryAllData[index].imageName,
        anchangId: this.fieldId,
        corId: filterData.corId
      };

      this.$confirm("确认删除该条数据么？", "信息", {
        confirmButtonText: "确定",
        cancelButtonText: "取消",
        type: "warning"
      }).then(function () {
        _this10.deleteStatus = "正在删除中...";
        _this10.getHistoryAllData[index].deleteStatus = true;
        _this10.$request.deleteFufangAndCreateNewId(data).then(function (res) {
          console.log(res);
          if (res.status == 200) {
            _this10.getCustomerHistoryAllData.splice(index, 1);
            _this10.deleteStatus = "删除成功";
            _this10.$message({
              type: "success",
              message: "用户删除成功",
              duration: 1000
            });
            _this10.itemList();
          }
        }).catch(function () {
          _this10.deleteStatus = "删除失败";
          _this10.getHistoryAllData[index].deleteStatus = false;
        });
      });
    },

    // 重新绑定
    reBinding: function reBinding(index) {
      var _this11 = this;

      console.log(this.bindingTypeStatus);
      if (this.bindingTypeStatus == 1) {
        // 绑定/解绑同行人相似到访记录
        if (this.allData[index].isBind) {
          // 解绑
          this.$emit("reBinding", "");
          var data4 = {
            followerId: this.customerInfo.id,
            anchangId: this.fieldId
          };
          this.$request.getAunbindContractFollower(data4).then(function (res) {
            console.log(res);
            if (res.data.msg == "ok") {
              var isBind = "";
              _this11.allData.forEach(function (item, index) {
                item.isBind = false;
                // console.log(moment(item.createTime).format("YYYY-MM-DD HH:mm:ss"),this.customerInfo.firstVisitTime)
                if (moment_default()(item.createTime).format("YYYY-MM-DD HH:mm:ss") == _this11.customerInfo.firstVisitTime) {
                  item.isBind = true;
                  // window.sessionStorage.setItem("isBind",item.id)
                  isBind = item.id;
                  _this11.getAlreadyBindId(isBind);
                } else {
                  console.log("aaaaaaaaaa");
                  item.isBind = false;
                  isBind = item.id;
                  _this11.getAlreadyBindId("");
                }
              });
              _this11.$message({
                type: "success",
                message: "解除绑定成功",
                duration: 1000
              });
            }
          });
        } else {
          console.log(false);
          // 重新绑定
          this.$emit("reBinding", this.datas[index]);
          var _data = {
            followerId: this.customerInfo.id,
            visitorId: this.allData[index].id,
            anchangId: this.fieldId
          };
          console.log(_data);
          console.log(this.allData[index]);
          this.$request.getAUpdateContractIdFollower(_data).then(function (res) {
            console.log(res);
            if (res.data.msg == "ok") {
              var isBind = "";
              _this11.allData.forEach(function (item, index) {
                item.isBind = false;
                if (moment_default()(item.createTime).format("YYYY-MM-DD HH:mm:ss") == _this11.customerInfo.firstVisitTime) {
                  item.isBind = true;
                  // window.sessionStorage.setItem("isBind",item.id)
                  isBind = item.id;
                  _this11.getAlreadyBindId(isBind);
                }
              });
              _this11.$message({
                type: "success",
                message: "重新绑定成功",
                duration: 1000
              });
            } else {
              _this11.$message({
                type: "error",
                message: "重新绑定失败",
                duration: 1000
              });
            }
          });
        }
      } else {
        // 绑定/解绑客户自己相似到访记录
        if (this.allData[index].isBind) {
          // 解绑
          this.$emit("reBinding", "");
          var _data2 = {
            id: this.customerInfo.id
          };
          this.$request.getAunbindContract(_data2).then(function (res) {
            console.log(res);
            if (res.data.msg == "ok") {
              var isBind = "";
              _this11.allData.forEach(function (item, index) {
                item.isBind = false;
                // console.log(moment(item.createTime).format("YYYY-MM-DD HH:mm:ss"),this.customerInfo.firstVisitTime)
                if (moment_default()(item.createTime).format("YYYY-MM-DD HH:mm:ss") == _this11.customerInfo.firstVisitTime) {
                  item.isBind = true;
                  // window.sessionStorage.setItem("isBind",item.id)
                  isBind = item.id;
                  _this11.getAlreadyBindId(isBind);
                } else {
                  console.log("aaaaaaaaaa");
                  item.isBind = false;
                  isBind = item.id;
                  _this11.getAlreadyBindId("");
                }
              });
              _this11.$message({
                type: "success",
                message: "解除绑定成功",
                duration: 1000
              });
            } else {
              _this11.$message({
                type: "error",
                message: "解除绑定失败",
                duration: 1000
              });
            }
          });
        } else {
          console.log(false);
          // 重新绑定
          this.$emit("reBinding", this.datas[index]);
          var _data3 = {
            id: this.customerInfo.id,
            visitorId: this.allData[index].id
          };
          console.log(_data3);
          this.$request.getAUpdateContractId(_data3).then(function (res) {
            console.log(res);
            if (res.data.msg == "ok") {
              var isBind = "";
              _this11.allData.forEach(function (item, index) {
                item.isBind = false;
                if (moment_default()(item.createTime).format("YYYY-MM-DD HH:mm:ss") == _this11.customerInfo.firstVisitTime) {
                  item.isBind = true;
                  // window.sessionStorage.setItem("isBind",item.id)
                  isBind = item.id;
                  _this11.getAlreadyBindId(isBind);
                }
              });
              // 点击绑定置顶
              // this.datas = this.datas.sort((a, b) => b.isBind - a.isBind)
              _this11.$message({
                type: "success",
                message: "重新绑定成功",
                duration: 1000
              });
            } else {
              _this11.$message({
                type: "error",
                message: "重新绑定失败",
                duration: 1000
              });
            }
          });
        }
      }
    },
    viewDetailPerson: function viewDetailPerson(index) {
      this.getCustomerInfoAllData = this.allData[index];
      this.getCustomerHistoryAllData = this.allData[index].children;
      // 首先要给整个对象默认设置删除状态为false
      this.getCustomerHistoryAllData.forEach(function (v) {
        v.setDelete = false;
      });
      // 然后找出对象的最小值(firstTime)去找对应的对象并且给对应的整个对象设置属性为true
      this.getCustomerHistoryAllData.reduce(function (prev, current) {
        return prev.firstTime < current.firstTime ? prev : current;
      }).setDelete = true;

      // 判断当前绑定状态
      // 无论绑定谁
      // 都取最顶部客户详情的姓名和联系方式并赋值
      // 如果取消绑定，那么把客户姓名和联系方式置空
      if (this.allData[index].isBind) {
        this.getCustomerInfoAllData.realName = this.customerInfo.cName;
        this.getCustomerInfoAllData.phone = this.customerInfo.phoneNum;
      } else {
        this.getCustomerInfoAllData.realName = "";
        this.getCustomerInfoAllData.phone = "";
      }
    },
    openVideo: function openVideo(index, indexs, value) {
      console.log(index, indexs, value);
      this.index1 = index;
      this.index2 = indexs;
      this.value = value;
      this.viewVideo();
    },
    viewVideo: function viewVideo() {
      var _this12 = this;

      console.log(this.beforeSeconds, this.afterSeconds, this.index1, this.index2, this.value);
      var newImagesUrl = "";
      var newFirstTime = "";
      if (this.value == "true") {
        newImagesUrl = this.getHistoryAllData[this.index1].imageName;
        newFirstTime = this.getHistoryAllData[this.index1].firstTime;
      } else {
        // console.log(`${this.imgPath1+this.datas[index].children[indexs].imageName}`)
        newImagesUrl = this.datas[this.index1].children[this.index2].imageName;
        newFirstTime = this.datas[this.index1].children[this.index2].firstTime;
      }
      console.log(newImagesUrl, newFirstTime);
      this.getThisIndex = this.index2;
      console.log("----------------->", "anchangId:", this.fieldId, "imageName:", newImagesUrl, "createTime:", moment_default()(newFirstTime).valueOf(), "beforeSeconds:", this.beforeSeconds, "afterSeconds:", this.afterSeconds);
      this.$request.getVideo({
        anchangId: this.fieldId,
        imageName: newImagesUrl,
        createTime: moment_default()(newFirstTime).valueOf(),
        beforeSeconds: this.beforeSeconds,
        afterSeconds: this.afterSeconds
      }).then(function (res) {
        console.log(res);
        console.log(res.data.data, "video");
        _this12.videoSrc = res.data.data.playUrl;
        _this12.getCurrentVideo = res.data.data.playUrl;
        _this12.getCmdId = res.data.data.cmdId;
        var count = 0;
        var flag = 0;
        var _this = _this12;
        if (_this12.getCmdId == -1) {
          if (_this12.flvPlayer) {
            _this12.flvPlayer.pause();
            _this12.flvPlayer.unload();
            _this12.flvPlayer.detachMediaElement();
            _this12.flvPlayer.destroy();
            _this12.flvPlayer = null;
          }
          _this12.flvPlayer = flv["a" /* default */].createPlayer({
            type: "flv",
            url: _this12.getCurrentVideo,
            hasAudio: false,
            config: {
              enableWorker: true,
              enableStashBuffer: false,
              stashInitialSize: 128
            }
          });
          var dom = _this12.$refs.v.$el.children[0];
          _this12.flvPlayer.attachMediaElement(dom);
          _this12.flvPlayer.load();
          _this12.flvPlayer.play();
        } else {
          var func = function func() {
            var _this13 = this;

            //定时任务
            count++;
            console.log(count);
            _this.$request.checkVideo({
              cmdId: _this.getCmdId
            }).then(function (response) {
              console.log(response);
              if (response.data.data.code == "3") {
                if (_this13.flvPlayer) {
                  _this.flvPlayer.pause();
                  _this.flvPlayer.unload();
                  _this.flvPlayer.detachMediaElement();
                  _this.flvPlayer.destroy();
                  _this.flvPlayer = null;
                }
                _this.flvPlayer = flv["a" /* default */].createPlayer({
                  type: "flv",
                  url: _this.getCurrentVideo,
                  hasAudio: false,
                  config: {
                    enableWorker: true,
                    enableStashBuffer: false,
                    stashInitialSize: 128
                  }
                });
                var _dom = _this.$refs.v.$el.children[0];
                _this.flvPlayer.attachMediaElement(_dom);
                _this.flvPlayer.load();
                _this.flvPlayer.play();
                flag = 1;
                clearInterval(_this.interval); //停止
              }
              if (count == 20 && flag == 0) {
                _this.$message({
                  type: "error",
                  message: "获取视频失败1",
                  duration: 1000
                });
                clearInterval(_this.interval); //停止
              }
            }).catch(function (error) {
              _this.$message({
                type: "error",
                message: "获取视频失败2",
                duration: 1000
              });
              console.log("error=", error);
              clearInterval(_this.interval); //停止
            });
          };

          _this.interval = setInterval(func, 1000); //轮询
        }
      });
    },

    // 点击停止录像播放
    handleClose: function handleClose(done) {
      this.beforeSeconds = 10;
      this.afterSeconds = 10;
      this.value = "false";
      console.log(done);
      clearInterval(this.interval); //停止
      var param = void 0;
      // if (this.getCmdId == -1) {
      //   param = {
      //     anchangId: this.fieldId,
      //     url: this.getCurrentVideo,
      //     // 强哥说就算cmd为-1，停止播放也要传cmdId:-1
      //     cmdId: this.getCmdId
      //   };
      // } else {
      param = {
        anchangId: this.fieldId,
        url: this.getCurrentVideo,
        cmdId: this.getCmdId
      };
      // }
      this.$request.stopVideo(param).then(function (res) {});

      if (this.flvPlayer) {
        this.flvPlayer.pause();
        this.flvPlayer.unload();
        this.flvPlayer.detachMediaElement();
        this.flvPlayer.destroy();
        this.flvPlayer = null;
      }
      this.innerVideo = false;
    },
    watchVideo: function watchVideo(index) {
      var _this14 = this;

      console.log(index);
      this.getThisIndex = index;
      console.log(this.$refs.setSrc[index].src);
      setTimeout(function () {
        document.getElementById("viewVideo").setAttribute("src", _this14.$refs.setSrc[index].src);
      }, 0);
    },
    handleClose1: function handleClose1() {
      this.innerVideo1 = false;
    },

    // 后退
    slowPlay: function slowPlay() {
      this.beforeSeconds += -20;
      this.afterSeconds += 20;
      this.viewVideo();
    },

    // 快进
    fastPlay: function fastPlay() {
      this.beforeSeconds += 20;
      this.afterSeconds += -20;
      this.viewVideo();
    },

    // 归并
    merge: function merge(index) {
      console.log(index);
      this.currentIndex = index;
      this.allData.forEach(function (v, index) {
        v.index = "相似到访" + (index + 1);
      });
      this.getAllData = [this.allData, new Date()];
      this.getObjective = this.allData[index];
      window.sessionStorage.setItem("objective", stringify_default()(this.getObjective));
      console.log(this.getObjective);
      console.log(this.getAllData);
    },
    closeMerge: function closeMerge() {
      this.itemList();
      this.innerMerge = false;
    },

    // 当关闭的时候，清空当前选中数据列表
    closeTheDialog: function closeTheDialog() {
      this.$refs.closeTheDialogFn.whenCloseAndClearList();
      this.innerMerge = false;
    },

    //相似列表排序
    chooseRank: function chooseRank(value) {
      console.log(this.rankType, this.sortRadio);
      if (this.rankType == 'time') {
        this.sortRadio = 'asc';
        this.similarityValue = ['0.9', '1'];
        this.minSimilarity = '0.9';
        this.maxSimilarity = '1';
      } else {
        this.sortRadio = 'desc';
        this.similarityValue = [];
        this.minSimilarity = '';
        this.maxSimilarity = '';
      }
      this.itemList();
    },

    //选择相似度
    chooseSimilarity: function chooseSimilarity(data) {
      console.log(data);
      this.minSimilarity = data[0];
      this.maxSimilarity = data[1];
    },

    //切换回收站
    toBin: function toBin() {
      this.listType = 1;
      this.crashList();
    },
    toList: function toList() {
      this.listType = 0;
      this.itemList();
    },

    //移除
    remove: function remove(item) {
      var _this15 = this;

      console.log('移除', item);
      this.$request.toSimilarCrash({
        anchangId: this.fieldId,
        contractId: this.customerInfo.id,
        contractImgName: this.customerInfo.snapImageUrl,
        visitorId: item.id
      }).then(function (res) {
        if (res.data.code == "1000") {
          _this15.$message({
            type: "success",
            message: "移除成功！",
            duration: 1000
          });
          _this15.itemList();
        } else {
          _this15.$message({
            type: "error",
            message: res.data.msg,
            duration: 1000
          });
        }
      }).catch(function (err) {
        console.log(err);
        _this15.$message({
          type: "error",
          message: "移除失败，请稍后重试!",
          duration: 1000
        });
      });
    },

    //恢复
    recover: function recover(item) {
      var _this16 = this;

      console.log('恢复', item);
      this.$request.toSimilarList({
        anchangId: this.fieldId,
        contractId: this.customerInfo.id,
        visitorId: item.id
      }).then(function (res) {
        if (res.data.code == "1000") {
          _this16.$message({
            type: "success",
            message: "恢复成功！",
            duration: 1000
          });
          _this16.crashList();
        } else {
          _this16.$message({
            type: "error",
            message: res.data.msg,
            duration: 1000
          });
        }
      }).catch(function (err) {
        console.log(err);
        _this16.$message({
          type: "error",
          message: "恢复失败，请稍后重试!",
          duration: 1000
        });
      });
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-64b512aa","hasScoped":true,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/component/fengkong/signHistorySimilar.vue
var signHistorySimilar_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"dialogPerson"},[_vm._m(0),_vm._v(" "),_c('div',{staticStyle:{"padding":"0 15px"}},[(_vm.environment == 0)?_c('div',{staticClass:"itemBox"},_vm._l((_vm.getHistoryAllData),function(item,index){return _c('div',{key:index,staticClass:"historyList"},[_c('div',{staticClass:"lineCase"},[_c('div',{staticClass:"lineCase_name"},[_vm._v(_vm._s(_vm._f("formatDate1")(item.firstTime)))]),_vm._v(" "),_c('div',{staticClass:"lineCase_name"},[_vm._v(_vm._s(_vm._f("formatDate2")(item.firstTime)))]),_vm._v(" "),_vm._m(1,true),_vm._v(" "),_c('div',{staticClass:"libeBtn"},[(item.deleteStatus)?[_vm._v(_vm._s(_vm.deleteStatus))]:[(item.setDelete == false)?_c('span',{staticClass:"delete_icon",on:{"click":function($event){return _vm.deleteItem(index)}}},[_c('i',{staticClass:"el-icon-delete"})]):_vm._e()]],2)]),_vm._v(" "),_c('div',{staticClass:"itemList02"},[_c('div',{staticClass:"itemList_video"},[_c('video',{staticClass:"record1",staticStyle:{"width":"210px","height":"140px","margin":"0","display":"none"},attrs:{"id":("k" + (item.id)),"data-name":item.imageName,"data-time":item.firstTime,"src":"","loop":"","muted":"","autoplay":""},domProps:{"muted":true}}),_vm._v(" "),_c('span',[_vm._v(_vm._s(_vm.tipMsg))])]),_vm._v(" "),_c('div',{staticClass:"snapImg_case"},[(_vm.verson == 2 || _vm.verson == 3)?_c('div',{staticClass:"snapImg"},[_c('el-tooltip',{attrs:{"placement":"bottom","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"compareImages"},[_c('compare-image',{attrs:{"src1":_vm.imgPath1 + item.shotImages[0],"src2":_vm.imgPath + _vm.customerInfo.snapImageUrl,"x":item.x,"y":item.y,"width":item.width,"height":item.height}})],1)]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"100px","height":"75px"},attrs:{"src":_vm.imgPath1 + item.shotImages[0],"draggable":"false"}})])],1):_c('div',{staticClass:"snapImg"},[_c('el-tooltip',{attrs:{"placement":"bottom","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"contentImg"},[_c('div',{staticClass:"contentImg_Box"},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{staticStyle:{"width":"100%"},attrs:{"src":_vm.imgPath1 + item.shotImages[0],"draggable":"false"}})]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box_name"},[_vm._v("当前图片")])]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box"},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{attrs:{"src":_vm.imgPath + _vm.customerInfo.snapImageUrl,"draggable":"false"}})]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box_name"},[_vm._v("签约照片")])])])]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"60px","height":"75px"},attrs:{"src":_vm.imgPath1 + item.shotImages[0],"draggable":"false"}})])],1)])])])}),0):_c('div',{staticClass:"itemBox"},_vm._l((_vm.getHistoryAllData),function(item,index){return _c('div',{key:index,staticClass:"historyList"},[_c('div',{staticClass:"lineCase"},[_c('div',{staticClass:"lineCase_name"},[_vm._v(_vm._s(_vm._f("formatDate1")(item.firstTime)))]),_vm._v(" "),_c('div',{staticClass:"lineCase_name"},[_vm._v(_vm._s(_vm._f("formatDate2")(item.firstTime)))]),_vm._v(" "),_vm._m(2,true),_vm._v(" "),_c('div',{staticClass:"libeBtn"},[(item.deleteStatus)?[_vm._v(_vm._s(_vm.deleteStatus))]:[(item.setDelete == false)?_c('span',{staticClass:"delete_icon",on:{"click":function($event){return _vm.deleteItem(index)}}},[_c('i',{staticClass:"el-icon-delete"})]):_vm._e()]],2)]),_vm._v(" "),_c('div',{staticClass:"itemList02"},[_c('div',{staticClass:"snapImg_case snapCenter"},[(_vm.verson == 2 || _vm.verson == 3)?[_c('div',{staticClass:"snapImg",staticStyle:{"width":"100px"}},[_c('el-tooltip',{attrs:{"placement":"bottom","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"compareImages"},[_c('compare-image',{attrs:{"src1":_vm.imgPath1 + item.shotImages[0],"src2":_vm.imgPath + _vm.customerInfo.snapImageUrl,"x":item.x,"y":item.y,"width":item.width,"height":item.height}})],1)]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"100px","height":"75px"},attrs:{"src":_vm.imgPath1 + item.shotImages[0],"draggable":"false"}})])],1),_vm._v(" "),_c('div',{staticClass:"snapImg_btn"},[_c('button',{staticClass:"btn btn06 mini",staticStyle:{"margin-bottom":"10px"},on:{"click":function($event){(_vm.innerVideo = true), _vm.openVideo(index,index,'true')}}},[_vm._v("\n                  点击查看视频\n                ")])])]:[_c('div',{staticClass:"snapImg"},[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"contentImg"},[_c('div',{staticClass:"contentImg_Box",staticStyle:{"margin-right":"10px"}},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{attrs:{"src":_vm.imgPath1 + item.shotImages[0],"draggable":"false"}})]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box_name"},[_vm._v("当前图片")])]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box"},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{attrs:{"src":_vm.imgPath + _vm.customerInfo.snapImageUrl,"draggable":"false"}})]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box_name"},[_vm._v("签约照片")])])])]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"60px","height":"75px"},attrs:{"src":_vm.imgPath1 + item.shotImages[0],"draggable":"false"}})])],1),_vm._v(" "),_c('div',{staticClass:"snapImg_btn"},[_c('button',{staticClass:"btn btn06 mini",staticStyle:{"margin-bottom":"10px"},on:{"click":function($event){(_vm.innerVideo = true), _vm.openVideo(index,index,'true')}}},[_vm._v("\n                  点击查看视频\n                ")])])]],2)])])}),0)]),_vm._v(" "),(_vm.isDataState)?_c('div',{staticClass:"isDataState"},[_vm._v(_vm._s(_vm.showTips))]):_vm._e(),_vm._v(" "),_c('div',{staticClass:"header_detail_modal",staticStyle:{"margin-bottom":"20px"}},[_c('h1',[_vm._v("\n      相似到访记录\n    ")]),_vm._v(" "),_c('div',{directives:[{name:"show",rawName:"v-show",value:(_vm.listType==0),expression:"listType==0"}],staticClass:"caozuo"},[_c('el-select',{staticStyle:{"margin-left":"30px"},attrs:{"placeholder":"请选择","size":"mini"},on:{"change":_vm.chooseRank},model:{value:(_vm.rankType),callback:function ($$v) {_vm.rankType=$$v},expression:"rankType"}},_vm._l((_vm.options),function(item){return _c('el-option',{key:item.value,attrs:{"label":item.label,"value":item.value}})}),1),_vm._v(" "),_c('el-radio-group',{on:{"change":_vm.itemList},model:{value:(_vm.sortRadio),callback:function ($$v) {_vm.sortRadio=$$v},expression:"sortRadio"}},[_c('el-radio',{attrs:{"label":"asc"}},[_vm._v("正序")]),_vm._v(" "),_c('el-radio',{attrs:{"label":"desc"}},[_vm._v("倒序")])],1)],1),_vm._v(" "),_c('el-tooltip',{directives:[{name:"show",rawName:"v-show",value:(_vm.listType == 0),expression:"listType == 0"}],attrs:{"content":"回收站","placement":"top","effect":"light"}},[_c('svg',{staticClass:"icon caozuo",staticStyle:{"position":"absolute","right":"40px","cursor":"pointer"},attrs:{"t":"1615536442055","viewBox":"0 0 1027 1024","version":"1.1","xmlns":"http://www.w3.org/2000/svg","p-id":"4516","width":"25","height":"25"},on:{"click":_vm.toBin}},[_c('path',{attrs:{"d":"M38.771627 310.656a36.608 36.608 0 1 1 0-73.130667h220.117333a255.957333 255.957333 0 0 1 510.634667 0h220.074666a36.608 36.608 0 1 1 0 73.130667h-76.288L850.37696 919.296c-6.272 59.605333-53.205333 104.661333-109.056 104.661333H287.006293c-55.850667 0-102.784-45.098667-108.928-104.661333L114.931627 310.656H38.771627z m212.053333 599.978667a37.546667 37.546667 0 0 0 36.224 34.901333h454.229333a37.546667 37.546667 0 0 0 36.352-34.901333l62.122667-599.936H188.531627l62.293333 599.936zM696.13696 237.482667a182.826667 182.826667 0 0 0-363.904 0h363.904z m-64.938667 566.997333l-43.904-73.130667h53.504l-63.36-109.781333 41.472-74.581333 116.992 202.624a36.608 36.608 0 0 1-31.744 54.869333h-72.96z m-73.088 0H324.126293a36.48 36.48 0 0 1-31.658666-54.869333l36.48-63.189334 85.290666-1.450666-26.752 46.378666h126.72l43.904 73.130667z m24.277334-320.810667l-41.472 74.624L514.163627 511.914667l-63.36 109.696-85.248 1.493333 116.906666-202.666667a36.522667 36.522667 0 0 1 63.317334 0l36.608 63.232z","p-id":"4517","fill":"#2c2c2c"}})])]),_vm._v(" "),_c('el-tooltip',{directives:[{name:"show",rawName:"v-show",value:(_vm.listType == 1),expression:"listType == 1"}],attrs:{"content":"相似列表","placement":"top","effect":"light"}},[_c('svg',{staticClass:"icon caozuo",staticStyle:{"position":"absolute","right":"40px","cursor":"pointer"},attrs:{"t":"1615538268075","viewBox":"0 0 1025 1024","version":"1.1","xmlns":"http://www.w3.org/2000/svg","p-id":"5572","width":"25","height":"25"},on:{"click":_vm.toList}},[_c('path',{attrs:{"d":"M358.058 552C399.999 552 434 586 434 627.942v207.116C434 876.999 400 911 358.058 911H150.942C109.001 911 75 877 75 835.058V627.942C75 586.001 109 552 150.942 552zM921 804.6c16.513 0 29.9 13.387 29.9 29.9 0 16.348-13.12 29.632-29.406 29.896l-0.494 0.004H576c-16.513 0-29.9-13.387-29.9-29.9 0-16.348 13.12-29.632 29.406-29.896l0.494-0.004h345z m0-211c16.513 0 29.9 13.387 29.9 29.9 0 16.348-13.12 29.632-29.406 29.896l-0.494 0.004H576c-16.513 0-29.9-13.387-29.9-29.9 0-16.348 13.12-29.632 29.406-29.896l0.494-0.004h345zM358.058 113C399.999 113 434 147 434 188.942v207.116C434 437.999 400 472 358.058 472H150.942C109.001 472 75 438 75 396.058V188.942C75 147.001 109 113 150.942 113zM921 368.6c16.513 0 29.9 13.387 29.9 29.9 0 16.348-13.12 29.632-29.406 29.896l-0.494 0.004H576c-16.513 0-29.9-13.387-29.9-29.9 0-16.348 13.12-29.632 29.406-29.896l0.494-0.004h345z m0-212c16.513 0 29.9 13.387 29.9 29.9 0 16.348-13.12 29.632-29.406 29.896l-0.494 0.004H576c-16.513 0-29.9-13.387-29.9-29.9 0-16.348 13.12-29.632 29.406-29.896l0.494-0.004h345z","fill":"#333333","p-id":"5573"}})])])],1),_vm._v(" "),_c('el-row',{directives:[{name:"show",rawName:"v-show",value:(_vm.listType==0 && _vm.rankType=='time'),expression:"listType==0 && rankType=='time'"}],staticClass:"slider",attrs:{"gutter":20}},[_c('el-col',{attrs:{"span":2}},[_c('p',[_vm._v("相似度")])]),_vm._v(" "),_c('el-col',{attrs:{"span":16}},[_c('el-slider',{attrs:{"range":"","marks":_vm.marks,"max":"1","step":"0.01"},on:{"change":_vm.chooseSimilarity},model:{value:(_vm.similarityValue),callback:function ($$v) {_vm.similarityValue=$$v},expression:"similarityValue"}})],1),_vm._v(" "),_c('el-col',{attrs:{"span":6}},[_c('el-input',{staticStyle:{"width":"38%"},attrs:{"size":"mini","readonly":"true"},model:{value:(_vm.minSimilarity),callback:function ($$v) {_vm.minSimilarity=$$v},expression:"minSimilarity"}}),_vm._v("\n      -\n      "),_c('el-input',{staticStyle:{"width":"38%"},attrs:{"size":"mini","readonly":"true"},model:{value:(_vm.maxSimilarity),callback:function ($$v) {_vm.maxSimilarity=$$v},expression:"maxSimilarity"}}),_vm._v(" "),_c('i',{staticClass:"el-icon-search",staticStyle:{"cursor":"pointer"},on:{"click":_vm.itemList}})],1)],1),_vm._v(" "),_c('div',{directives:[{name:"show",rawName:"v-show",value:(_vm.listType==0),expression:"listType==0"}]},[_c('div',{directives:[{name:"loading",rawName:"v-loading",value:(_vm.loading),expression:"loading"}],staticStyle:{"padding":"0 15px"}},[_c('div',{staticClass:"cardBox"},_vm._l((_vm.datas),function(item,index){return _c('div',{key:index},[_c('el-card',{staticClass:"box-card",staticStyle:{"margin-bottom":"30px"}},[_c('div',{staticClass:"box_list"},[_c('div',{staticClass:"box_slide01"},[_c('h1',[_vm._v("相似到访 "+_vm._s(index + 1))]),_vm._v(" "),_c('h2',{directives:[{name:"show",rawName:"v-show",value:(_vm.level == -1),expression:"level == -1"}]},[_vm._v("ID : "+_vm._s(item.id))]),_vm._v(" "),_c('h2',[_vm._v("相似度")]),_vm._v(" "),_c('h2',[_vm._v(_vm._s(parseFloat(item.similarity).toFixed(3)))]),_vm._v(" "),_c('el-tooltip',{attrs:{"content":"移除至回收站","placement":"bottom","effect":"light"}},[_c('i',{staticClass:"el-icon-delete",staticStyle:{"cursor":"pointer"},on:{"click":function($event){return _vm.remove(item)}}})])],1),_vm._v(" "),_c('div',{staticClass:"box_slide01"},[_c('button',{staticClass:"btn btn06 mini",attrs:{"data-id":item.id},on:{"click":function($event){_vm.viewDetailPerson(index), (_vm.innerExamineList = true)}}},[_vm._v("\n                  查看详情\n                ")]),_vm._v(" "),_c('button',{staticClass:"btn btn06 mini",attrs:{"data-msg":JSON.stringify(item)},on:{"click":function($event){return _vm.reBinding(index)}}},[_vm._v("\n                  "+_vm._s(item.isBind ? "解除绑定" : "绑定ID")+"\n                ")]),_vm._v(" "),_c('button',{directives:[{name:"show",rawName:"v-show",value:(_vm.level == -1),expression:"level == -1"}],staticClass:"btn btn06 mini",attrs:{"data-msg":JSON.stringify(item)},on:{"click":function($event){_vm.merge(index), (_vm.innerMerge = true)}}},[_vm._v("\n                  归并\n                ")])]),_vm._v(" "),(_vm.environment == 0)?_c('div',[_c('div',{staticClass:"box_slide02"},[_c('div',{staticClass:"box_video"},[_c('video',{ref:"setSrc",refInFor:true,staticClass:"record1",staticStyle:{"width":"170px","height":"110px","margin":"0","display":"none"},attrs:{"id":("v" + (item.id)),"data-name":item.imageName,"data-time":item.createTime,"src":"","loop":"","muted":"","autoplay":""},domProps:{"muted":true},on:{"click":function($event){(_vm.innerVideo1 = true), _vm.watchVideo(index)}}}),_vm._v(" "),_c('span',[_vm._v(_vm._s(_vm.tipMsg))])]),_vm._v(" "),_c('div',{staticClass:"box_videoset"},[_c('p',[_vm._v(_vm._s(_vm._f("formatDate1")(item.createTime)))]),_vm._v(" "),_c('p',[_vm._v(_vm._s(_vm._f("formatDate2")(item.createTime)))]),_vm._v(" "),_c('p',[_vm._v("视频")])])])]):_c('div'),_vm._v(" "),(_vm.verson == 2 || _vm.verson == 3)?_c('div',{staticClass:"box_slide03"},_vm._l((item.children),function(item1,indexs){return _c('div',{key:indexs,staticClass:"itemList",staticStyle:{"margin":"0 5px"}},[_c('div',{},[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"compareImages"},[_c('compare-image',{attrs:{"src1":_vm.imgPath1 + item1.shotImages[0],"src2":_vm.imgPath + _vm.customerInfo.snapImageUrl,"x":item1.x,"y":item1.y,"width":item1.width,"height":item1.height}})],1)]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"170px","height":"110px"},attrs:{"src":_vm.imgPath1 + item1.shotImages[0],"draggable":"false"}})])],1),_vm._v(" "),_c('div',{staticClass:"box_photoset_noface"},[_c('p',[_vm._v(_vm._s(_vm._f("formatDate1")(item1.firstTime)))]),_vm._v(" "),_c('p',[_vm._v(_vm._s(_vm._f("formatDate2")(item1.firstTime)))]),_vm._v(" "),_c('p',[_vm._v(_vm._s(item1.name))]),_vm._v(" "),_c('button',{staticClass:"btn btn06 mini",staticStyle:{"margin-bottom":"10px"},on:{"click":function($event){(_vm.innerVideo = true), _vm.openVideo(index,indexs)}}},[_vm._v("\n                      点击查看视频\n                    ")])])])}),0):_c('div',{staticClass:"box_slide03"},_vm._l((item.children),function(item1,indexs){return _c('div',{key:indexs,staticClass:"itemList",staticStyle:{"width":"120px"}},[_c('div',{staticClass:"box_photos"},[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"contentImg"},[_c('div',{staticClass:"contentImg_Box",staticStyle:{"margin-right":"10px"}},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{attrs:{"src":_vm.imgPath1 + item1.shotImages[0],"draggable":"false"}})]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box_name"},[_vm._v("当前图片")])]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box"},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{attrs:{"src":_vm.imgPath + _vm.customerInfo.snapImageUrl,"draggable":"false"}})]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box_name"},[_vm._v("签约照片")])])])]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"90px","height":"110px"},attrs:{"src":_vm.imgPath1 + item1.shotImages[0],"draggable":"false"}})])],1),_vm._v(" "),_c('div',{staticClass:"box_photoset"},[_c('p',[_vm._v(_vm._s(_vm._f("formatDate1")(item1.firstTime)))]),_vm._v(" "),_c('p',[_vm._v(_vm._s(_vm._f("formatDate2")(item1.firstTime)))]),_vm._v(" "),_c('p',[_vm._v(_vm._s(item1.name))]),_vm._v(" "),_c('button',{staticClass:"btn btn06 mini",staticStyle:{"margin-bottom":"10px"},on:{"click":function($event){(_vm.innerVideo = true), _vm.openVideo(index,indexs)}}},[_vm._v("\n                      点击查看视频\n                    ")])])])}),0)])])],1)}),0)]),_vm._v(" "),(_vm.isDataState02)?_c('div',{staticClass:"isDataState"},[_vm._v(_vm._s(_vm.showTips02))]):_vm._e(),_vm._v(" "),(_vm.ifHasMoreDataShow)?_c('div',{staticClass:"loadingMore"},[_c('button',{staticClass:"btn btn02 mini",on:{"click":_vm.changeArray}},[_vm._v("加载更多")])]):_vm._e(),_vm._v(" "),(_vm.alreadyAllData)?_c('div',{staticClass:"loadingMore"},[_vm._v("\n      已经是全部数据了\n    ")]):_vm._e()]),_vm._v(" "),_c('div',{directives:[{name:"loading",rawName:"v-loading",value:(_vm.loadingC),expression:"loadingC"},{name:"show",rawName:"v-show",value:(_vm.listType==1),expression:"listType==1"}],staticStyle:{"padding":"0 15px"}},[(_vm.crashDatas.length>0)?_c('div',{staticClass:"cardBox"},_vm._l((_vm.crashDatas),function(item,index){return _c('div',{key:index},[_c('el-card',{staticClass:"box-card",staticStyle:{"margin-bottom":"30px"}},[_c('div',{staticClass:"box_list"},[_c('div',{staticClass:"box_slide01"},[_c('h1',[_vm._v("回收站记录 "+_vm._s(index + 1))]),_vm._v(" "),_c('h2',{directives:[{name:"show",rawName:"v-show",value:(_vm.level == -1),expression:"level == -1"}]},[_vm._v("ID : "+_vm._s(item.id))]),_vm._v(" "),_c('el-tooltip',{attrs:{"content":"恢复至列表","placement":"bottom","effect":"light"}},[_c('i',{staticClass:"el-icon-refresh-right",staticStyle:{"cursor":"pointer"},on:{"click":function($event){return _vm.recover(item)}}})])],1),_vm._v(" "),_c('div',{staticClass:"box_slide01"},[_c('button',{staticClass:"btn btn06 mini",attrs:{"data-id":item.id},on:{"click":function($event){_vm.viewDetailPerson(index), (_vm.innerExamineList = true)}}},[_vm._v("\n                查看详情\n              ")])]),_vm._v(" "),(_vm.environment == 0)?_c('div',[_c('div',{staticClass:"box_slide02"},[_c('div',{staticClass:"box_video"},[_c('video',{ref:"setSrc",refInFor:true,staticClass:"record1",staticStyle:{"width":"170px","height":"110px","margin":"0","display":"none"},attrs:{"id":("v" + (item.id)),"data-name":item.imageName,"data-time":item.createTime,"src":"","loop":"","muted":"","autoplay":""},domProps:{"muted":true},on:{"click":function($event){(_vm.innerVideo1 = true), _vm.watchVideo(index)}}}),_vm._v(" "),_c('span',[_vm._v(_vm._s(_vm.tipMsg))])]),_vm._v(" "),_c('div',{staticClass:"box_videoset"},[_c('p',[_vm._v(_vm._s(_vm._f("formatDate1")(item.createTime)))]),_vm._v(" "),_c('p',[_vm._v(_vm._s(_vm._f("formatDate2")(item.createTime)))]),_vm._v(" "),_c('p',[_vm._v("视频")])])])]):_c('div'),_vm._v(" "),(_vm.verson == 2 || _vm.verson == 3)?_c('div',{staticClass:"box_slide03"},_vm._l((item.children),function(item1,indexs){return _c('div',{key:indexs,staticClass:"itemList",staticStyle:{"margin":"0 5px"}},[_c('div',{},[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"compareImages"},[_c('compare-image',{attrs:{"src1":_vm.imgPath1 + item1.shotImages[0],"src2":_vm.imgPath + _vm.customerInfo.snapImageUrl,"x":item1.x,"y":item1.y,"width":item1.width,"height":item1.height}})],1)]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"170px","height":"110px"},attrs:{"src":_vm.imgPath1 + item1.shotImages[0],"draggable":"false"}})])],1),_vm._v(" "),_c('div',{staticClass:"box_photoset_noface"},[_c('p',[_vm._v(_vm._s(_vm._f("formatDate1")(item1.firstTime)))]),_vm._v(" "),_c('p',[_vm._v(_vm._s(_vm._f("formatDate2")(item1.firstTime)))]),_vm._v(" "),_c('p',[_vm._v(_vm._s(item1.name))]),_vm._v(" "),_c('button',{staticClass:"btn btn06 mini",staticStyle:{"margin-bottom":"10px"},on:{"click":function($event){(_vm.innerVideo = true), _vm.openVideo(index,indexs)}}},[_vm._v("\n                    点击查看视频\n                  ")])])])}),0):_c('div',{staticClass:"box_slide03"},_vm._l((item.children),function(item1,indexs){return _c('div',{key:indexs,staticClass:"itemList",staticStyle:{"width":"120px"}},[_c('div',{staticClass:"box_photos"},[_c('el-tooltip',{attrs:{"placement":"top-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('div',{staticClass:"contentImg"},[_c('div',{staticClass:"contentImg_Box",staticStyle:{"margin-right":"10px"}},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{attrs:{"src":_vm.imgPath1 + item1.shotImages[0],"draggable":"false"}})]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box_name"},[_vm._v("当前图片")])]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box"},[_c('div',{staticClass:"contentImg_Box_img"},[_c('img',{attrs:{"src":_vm.imgPath + _vm.customerInfo.snapImageUrl,"draggable":"false"}})]),_vm._v(" "),_c('div',{staticClass:"contentImg_Box_name"},[_vm._v("签约照片")])])])]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"90px","height":"110px"},attrs:{"src":_vm.imgPath1 + item1.shotImages[0],"draggable":"false"}})])],1),_vm._v(" "),_c('div',{staticClass:"box_photoset"},[_c('p',[_vm._v(_vm._s(_vm._f("formatDate1")(item1.firstTime)))]),_vm._v(" "),_c('p',[_vm._v(_vm._s(_vm._f("formatDate2")(item1.firstTime)))]),_vm._v(" "),_c('p',[_vm._v(_vm._s(item1.name))]),_vm._v(" "),_c('button',{staticClass:"btn btn06 mini",staticStyle:{"margin-bottom":"10px"},on:{"click":function($event){(_vm.innerVideo = true), _vm.openVideo(index,indexs)}}},[_vm._v("\n                    点击查看视频\n                  ")])])])}),0)])])],1)}),0):_c('div',{staticStyle:{"text-align":"center"}},[_vm._v("暂无回收记录")])]),_vm._v(" "),_c('div',{staticClass:"innerVideo"},[_c('el-dialog',{staticStyle:{"background":"rgba(0,0,0,.8)"},attrs:{"width":"1000px","title":"查看视频","visible":_vm.innerVideo,"before-close":_vm.handleClose,"center":"","append-to-body":""},on:{"update:visible":function($event){_vm.innerVideo=$event}}},[_c('signViewVideo',{ref:"v",on:{"slowPlay":_vm.slowPlay,"fastPlay":_vm.fastPlay}})],1)],1),_vm._v(" "),_c('div',{staticClass:"innerVideo"},[_c('el-dialog',{staticStyle:{"background":"rgba(0,0,0,.8)"},attrs:{"width":"1000px","title":"查看视频","visible":_vm.innerVideo1,"before-close":_vm.handleClose1,"center":"","append-to-body":""},on:{"update:visible":function($event){_vm.innerVideo1=$event}}},[_c('video',{staticStyle:{"width":"100%"},attrs:{"id":"viewVideo","src":"","loop":"","muted":"","autoplay":""},domProps:{"muted":true}})])],1),_vm._v(" "),_c('el-dialog',{attrs:{"width":"1000px","title":"客户详情","visible":_vm.innerExamineList,"center":"","append-to-body":""},on:{"update:visible":function($event){_vm.innerExamineList=$event}}},[_c('signCustomerDetail',{attrs:{"getCustomerInfoAllData":_vm.getCustomerInfoAllData,"getCustomerHistoryAllData":_vm.getCustomerHistoryAllData}})],1),_vm._v(" "),_c('el-dialog',{attrs:{"width":"1000px","title":"相似到访记录归并","visible":_vm.innerMerge,"center":"","append-to-body":""},on:{"update:visible":function($event){_vm.innerMerge=$event},"close":_vm.closeTheDialog}},[_c('transferBox',{ref:"closeTheDialogFn",attrs:{"getAllData":_vm.getAllData,"getObjective":_vm.getObjective,"currentIndex":_vm.currentIndex},on:{"closeMerge":_vm.closeMerge}})],1)],1)}
var signHistorySimilar_staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"header_detail_modal"},[_c('h1',[_vm._v("历史到访记录")])])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"lineStyle"},[_c('span')])},function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"lineStyle"},[_c('span')])}]
var signHistorySimilar_esExports = { render: signHistorySimilar_render, staticRenderFns: signHistorySimilar_staticRenderFns }
/* harmony default export */ var fengkong_signHistorySimilar = (signHistorySimilar_esExports);
// CONCATENATED MODULE: ./src/component/fengkong/signHistorySimilar.vue
function signHistorySimilar_injectStyle (ssrContext) {
  __webpack_require__("jFrU")
}
var signHistorySimilar_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var signHistorySimilar___vue_template_functional__ = false
/* styles */
var signHistorySimilar___vue_styles__ = signHistorySimilar_injectStyle
/* scopeId */
var signHistorySimilar___vue_scopeId__ = "data-v-64b512aa"
/* moduleIdentifier (server only) */
var signHistorySimilar___vue_module_identifier__ = null
var signHistorySimilar_Component = signHistorySimilar_normalizeComponent(
  signHistorySimilar,
  fengkong_signHistorySimilar,
  signHistorySimilar___vue_template_functional__,
  signHistorySimilar___vue_styles__,
  signHistorySimilar___vue_scopeId__,
  signHistorySimilar___vue_module_identifier__
)

/* harmony default export */ var component_fengkong_signHistorySimilar = (signHistorySimilar_Component.exports);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/component/fengkong/jointBuyers.vue
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//







/* harmony default export */ var jointBuyers = ({
  props: {
    customerInfo: {
      type: [Array, Object],
      default: function _default() {
        return [];
      }
    }
  },
  components: { signUpBasic: component_fengkong_signUpBasic, signTradeRecord: component_fengkong_signTradeRecord, signHistorySimilar: component_fengkong_signHistorySimilar },
  data: function data() {
    return {
      getContractId: "",
      innerExamineList: false,
      jointlyData: [],
      colleaguesData: [],
      showDataStatus01: false,
      showDataStatus02: false,
      showClose: false,
      snapImageUrl: [],
      getColleaguesData: [],
      setHistoryAllData: [],
      bindingTypeStatus: 1,
      NoHostStatus: 1,
      whenClickStatus: ""
    };
  },
  created: function created() {
    this.imgPath = JSON.parse(window.localStorage.getItem("param")).riskImagePathPrefix;
    this.fieldId = window.sessionStorage.getItem("fieldId");
    this.jointlyData = [];
    this.colleaguesData = [];
    this.getColleaguesData = [];
  },

  watch: {
    customerInfo: {
      handler: function handler(v, x) {
        console.log(v);
        this.getContractId = v.id;
        this.jointlyData = [];
        this.colleaguesData = [];
        this.getColleaguesData = [];
        this.itemList();
      },

      immediate: true
    }
  },
  methods: {
    itemList: function itemList() {
      var _this = this;

      this.$request.getBuyFollowers({
        contractId: this.getContractId
      }).then(function (res) {
        _this.showDataStatus01 = false;
        _this.showDataStatus02 = false;
        res.data.data.forEach(function (v) {
          // ==2:联名购房人，==3:的是同行人
          if (v.visitorType == 2) {
            _this.jointlyData.push(v);
            if (_this.jointlyData.length > 0) {
              _this.showDataStatus01 = true;
            } else {
              _this.showDataStatus01 = false;
            }
          }
          if (v.visitorType == 3) {
            _this.colleaguesData.push(v);
            _this.snapImageUrl = v.snapImageUrl;
            if (_this.colleaguesData.length > 0) {
              _this.showDataStatus02 = true;
            } else {
              _this.showDataStatus02 = false;
            }
          }
        });
      });
    },
    viewDetailPersonColleagues: function viewDetailPersonColleagues(index) {
      var _this2 = this;

      this.whenClickStatus = "Colleagues";
      console.log(index);
      this.getColleaguesData = [];
      this.getColleaguesData = this.colleaguesData[index];
      this.getColleaguesData.cName = this.colleaguesData[index].realName;
      this.customerInfo.firstVisitTime = this.colleaguesData[index].firstVisitTime;
      this.snapImageUrl = this.getColleaguesData.snapImageUrl;
      // 根据状态判断当前是否是主人还是联名购房人/同行人
      this.$nextTick(function () {
        _this2.NoHostStatus = 1;
        eventBus.$emit("NoHostStatus", _this2.NoHostStatus);
      });
      console.log(this.customerInfo);
    },
    viewDetailPersonJointlyData: function viewDetailPersonJointlyData(index) {
      var _this3 = this;

      this.whenClickStatus = "Jointly";
      console.log(index);
      this.getColleaguesData = [];
      this.getColleaguesData = this.jointlyData[index];
      this.getColleaguesData.cName = this.jointlyData[index].realName;
      this.customerInfo.firstVisitTime = this.jointlyData[index].firstVisitTime;
      this.snapImageUrl = this.getColleaguesData.snapImageUrl;
      // 根据状态判断当前是否是主人还是联名购房人/同行人
      this.$nextTick(function () {
        _this3.NoHostStatus = 1;
        eventBus.$emit("NoHostStatus", _this3.NoHostStatus);
      });
      console.log(this.customerInfo);
    },
    getHistoryAllData: function getHistoryAllData(data) {
      this.setHistoryAllData = data;
    },
    reBinding: function reBinding(data) {
      this.bindingTypeStatus = 1;
      if (data) {
        this.getColleaguesData.firstVisitTime = moment_default()(data.createTime).format("YYYY-MM-DD HH:mm:ss");
        this.customerInfo.firstVisitTime = moment_default()(data.createTime).format("YYYY-MM-DD HH:mm:ss");
        this.reBindNewTime = moment_default()(data.createTime).format("YYYY-MM-DD HH:mm:ss");
      } else {
        this.getColleaguesData.firstVisitTime = "";
        this.customerInfo.firstVisitTime = "";
        this.reBindNewTime = "";
      }
      this.dialogVisible = true;
      this.snapImageUrl = this.getColleaguesData.snapImageUrl;
    },
    slotModelBackTo: function slotModelBackTo() {
      var _this4 = this;

      this.innerExamineList = false;
      // 根据状态判断当前是否是主人还是联名购房人/同行人
      this.$nextTick(function () {
        _this4.NoHostStatus = 2;
        eventBus.$emit("NoHostStatus", _this4.NoHostStatus);
      });
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-298ee3aa","hasScoped":true,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/component/fengkong/jointBuyers.vue
var jointBuyers_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('el-row',{staticStyle:{"margin-top":"15px"}},[(_vm.showDataStatus01)?_c('el-col',{attrs:{"span":12}},[_c('div',{staticClass:"dialogPerson join",staticStyle:{"flex-direction":"column"}},[_c('div',{staticClass:"header_detail_modal",staticStyle:{"margin-top":"0"}},[_c('h1',[_vm._v("联名购房人")])]),_vm._v(" "),_c('div',{staticClass:"dialogPerson"},_vm._l((_vm.jointlyData),function(item,index){return _c('table',{key:index,attrs:{"width":"100%","cellspacing":"0","cellpadding":"6","border":"0"}},[_c('tr',[_c('td',{attrs:{"rowspan":"4","width":"100","align":"center"}},[_c('div',{staticClass:"snapImg"},[_c('el-tooltip',{attrs:{"placement":"right-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('img',{staticStyle:{"width":"200px","margin":"-7px -7px -10px -7px"},attrs:{"src":_vm.imgPath + item.snapImageUrl,"draggable":"false"}})]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee","width":"100px","height":"125px"},attrs:{"src":_vm.imgPath + item.snapImageUrl,"draggable":"false"}})])],1)]),_vm._v(" "),_c('td',[_vm._v("姓名 : "+_vm._s(item.realName))])]),_vm._v(" "),_c('tr',[_c('td',[_vm._v("身份证号码 : "+_vm._s(item.idNumMark))])]),_vm._v(" "),_c('tr',[_c('td',{staticStyle:{"color":"#f00","font-weight":"bold"}},[_vm._v("\n                风险提示 : "+_vm._s(item.riskTypeDesc)+"\n              ")])]),_vm._v(" "),_c('tr',[_c('button',{staticClass:"btn btn06",on:{"click":function($event){_vm.viewDetailPersonJointlyData(index), (_vm.innerExamineList = true)}}},[_vm._v("\n                查看详情\n              ")])])])}),0)])]):_vm._e(),_vm._v(" "),(_vm.showDataStatus02)?_c('el-col',{attrs:{"span":12}},[_c('div',{staticClass:"dialogPerson join"},[_c('div',{staticClass:"header_detail_modal",staticStyle:{"margin-top":"0"}},[_c('h1',[_vm._v("同行人")])]),_vm._v(" "),_c('div',{staticClass:"itemBox"},_vm._l((_vm.colleaguesData),function(item,index){return _c('div',{key:index,staticClass:"aaa",staticStyle:{"width":"auto"}},[_c('ul',[_c('li',{staticClass:"itemImg"},[_c('el-tooltip',{attrs:{"placement":"right-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('img',{staticStyle:{"width":"200px","margin":"-7px -7px -10px -7px"},attrs:{"src":_vm.imgPath + item.snapImageUrl,"draggable":"false"}})]),_vm._v(" "),_c('img',{staticStyle:{"border":"1px solid #eee"},attrs:{"src":_vm.imgPath + item.snapImageUrl,"draggable":"false"}})])],1),_vm._v(" "),_c('li',{staticClass:"itemDataBtn"},[_c('span',{staticStyle:{"padding":"1px 0","color":"#f00","font-weight":"700"}},[_vm._v(_vm._s(item.riskTypeDesc))]),_vm._v(" "),_c('button',{staticClass:"btn btn06",on:{"click":function($event){_vm.viewDetailPersonColleagues(index), (_vm.innerExamineList = true)}}},[_vm._v("\n                  查看详情\n                ")])])])])}),0)])]):_vm._e(),_vm._v(" "),_c('el-dialog',{attrs:{"width":"1000px","visible":_vm.innerExamineList,"fullscreen":"","show-close":_vm.showClose,"append-to-body":""},on:{"update:visible":function($event){_vm.innerExamineList=$event}}},[_c('div',{staticClass:"slotModelTitle",attrs:{"slot":"title"},slot:"title"},[_c('span',{staticClass:"slotModelBackTo",on:{"click":_vm.slotModelBackTo}},[_c('i',{staticClass:"el-icon-back"})]),_vm._v(" "),_c('span',{staticClass:"title-age"},[_vm._v(_vm._s(_vm.whenClickStatus == "Jointly" ? "联名购房人详情" : "同行人详情"))])]),_vm._v(" "),_c('div',{staticStyle:{"padding":"0 15px"}},[_c('signUpBasic',{attrs:{"customerInfo":_vm.getColleaguesData}}),_vm._v(" "),_c('signTradeRecord',{attrs:{"customerInfo":_vm.customerInfo,"itemList":_vm.itemList,"reBindNewTime":_vm.reBindNewTime}}),_vm._v(" "),_c('signHistorySimilar',{attrs:{"snapImageUrl":_vm.snapImageUrl,"customerInfo":_vm.getColleaguesData,"reBindNewTime":_vm.reBindNewTime,"bindingTypeStatus":_vm.bindingTypeStatus},on:{"getHistoryAllData":_vm.getHistoryAllData,"reBinding":_vm.reBinding}})],1)])],1)],1)}
var jointBuyers_staticRenderFns = []
var jointBuyers_esExports = { render: jointBuyers_render, staticRenderFns: jointBuyers_staticRenderFns }
/* harmony default export */ var fengkong_jointBuyers = (jointBuyers_esExports);
// CONCATENATED MODULE: ./src/component/fengkong/jointBuyers.vue
function jointBuyers_injectStyle (ssrContext) {
  __webpack_require__("JScw")
}
var jointBuyers_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var jointBuyers___vue_template_functional__ = false
/* styles */
var jointBuyers___vue_styles__ = jointBuyers_injectStyle
/* scopeId */
var jointBuyers___vue_scopeId__ = "data-v-298ee3aa"
/* moduleIdentifier (server only) */
var jointBuyers___vue_module_identifier__ = null
var jointBuyers_Component = jointBuyers_normalizeComponent(
  jointBuyers,
  fengkong_jointBuyers,
  jointBuyers___vue_template_functional__,
  jointBuyers___vue_styles__,
  jointBuyers___vue_scopeId__,
  jointBuyers___vue_module_identifier__
)

/* harmony default export */ var component_fengkong_jointBuyers = (jointBuyers_Component.exports);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/views/fengkong/newSignUp.vue


//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//









/* harmony default export */ var newSignUp = ({
  filters: {
    changeState: function changeState(data) {
      switch (data) {
        case 0:
          {
            return "已核验";
            break;
          }
        case 1:
          {
            return "待核验";
            break;
          }
        case 2:
          {
            return "确认飞单";
            break;
          }
        case 3:
          {
            return "撤销飞单";
            break;
          }
        case 4:
          {
            return "审批中";
            break;
          }
        case 5:
          {
            return "无效";
            break;
          }
        default:
          {
            return "未知状态";
            break;
          }
      }
    }
  },
  components: {
    signUpBasic: component_fengkong_signUpBasic,
    jointBuyers: component_fengkong_jointBuyers,
    signTradeRecord: component_fengkong_signTradeRecord,
    signHistorySimilar: component_fengkong_signHistorySimilar
  },
  data: function data() {
    return {
      tableData: [],
      // page
      getDataTotalNum: 0,
      getListData: {
        pageIndex: 1,
        pageSize: 10
      },
      currentPage: 1,
      // 签约审核顶部汇总数据
      getqyshTopCountData: {
        today: "0",
        total: "0",
        fdCount: "0",
        cxCount: "0"
      },
      // 签约二维码
      takeVSCode: false,
      // 点击表格弹窗
      dialogVisible: false,
      showClose: false,
      getStatusSearch: "0~1~2~3~4~5",
      snapImageUrl: "",
      customerInfo: [],
      setHistoryAllData: [],
      getTableIndex: "",
      reBindNewTime: "",
      showTablePage: false,
      NoHostStatus: "",
      //搜索栏部分
      searchTextType: '1',
      searchText: '',
      searchTimeType: '3',
      timeOptions: [{
        value: '1',
        label: '报备时间'
      }, {
        value: '2',
        label: '首访时间'
      }, {
        value: '3',
        label: '签约时间'
      }, {
        value: '4',
        label: '核验时间'
      }],
      searchTime: [],
      pickerOptions: {
        shortcuts: [{
          text: "今天",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 0);
            picker.$emit("pick", [start, end]);
          }
        }, {
          text: "昨天",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 1);
            picker.$emit("pick", [start, end]);
          }
        }, {
          text: "3天前",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 2);
            picker.$emit("pick", [start, end]);
          }
        }, {
          text: "7天前",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 6);
            picker.$emit("pick", [start, end]);
          }
        }, {
          text: "14天前",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 13);
            picker.$emit("pick", [start, end]);
          }
        }, {
          text: "30天前",
          onClick: function onClick(picker) {
            var end = new Date();
            var start = new Date();
            start.setTime(start.getTime() - 3600 * 1000 * 24 * 29);
            picker.$emit("pick", [start, end]);
          }
        }]
      },
      checkType: '', //核验方式
      riskType: '', //风险类型
      cardType: '' //证件类型
    };
  },
  created: function created() {
    this.imgPath = JSON.parse(window.localStorage.getItem("param")).riskImagePathPrefix;
    if (this.$route.params.data) {
      this.fieldId = this.$route.params.data.anchangId;
    } else {
      this.fieldId = window.sessionStorage.getItem("fieldId");
    }
    console.log('fieldId=', this.fieldId);
    this.fieldId02 = window.sessionStorage.getItem("fieldId02");

    // 默认显示前7天的数据
    // 当前时间
    var currentTime = moment_default()().format("YYYY-MM-DD 23:59:59");
    // 7天前
    var beforeTime = moment_default()().subtract(6, "days").format("YYYY-MM-DD 00:00:00");
    this.searchTime = [beforeTime, currentTime];
  },
  mounted: function mounted() {
    this.itemList();
  },

  watch: {
    "$store.state.saveSearchKeyWord_signUp": function $storeStateSaveSearchKeyWord_signUp(data) {
      console.log(data);
      if (data) {
        this.$store.commit("getSearchFromData_signUp", []);
        this.itemList();
      } else {
        this.$store.commit("getSearchFromData_signUp", JSON.parse(window.sessionStorage.getItem("signUpDate")));
        this.itemList();
      }
    },
    "$store.state.saveSearchFromData_signUp": function $storeStateSaveSearchFromData_signUp(data) {
      this.getListData.pageIndex = 1;
      this.currentPage = 1;
      this.itemList();
    },
    $route: function $route(to, from) {
      this.dialogVisible = false;
    }
  },
  methods: {
    itemList: function itemList() {
      var _this = this;

      this.$request.getqyshTableList({
        currentPage: this.getListData.pageIndex,
        pageSize: this.getListData.pageSize,
        anchangId: this.fieldId,
        timeType: this.searchTimeType,
        startTime: this.searchTime ? this.searchTime[0] : '',
        endTime: this.searchTime ? this.searchTime[1] : '',
        textType: this.searchTextType,
        name: this.searchText,
        status: this.getStatusSearch,
        checkType: this.checkType,
        riskType: this.riskType,
        cardType: this.cardType
      }).then(function (res) {
        console.log(res);
        if (res.status == 200) {
          _this.tableData = res.data.data.list;
          if (_this.tableData.length >= 1) {
            _this.showTablePage = true;
          } else {
            _this.showTablePage = false;
          }
          // 获取总页数
          _this.getDataTotalNum = res.data.data.total;
          // 格式化身份证
          var reg = /(\d{10})\d*(\d{4})/;
          _this.tableData.forEach(function (v) {
            v.idNum = v.idNum.replace(reg, "$1****$2");
            switch (v.cardType) {
              case 1:
                v.cardType = '身份证';
                break;
              case 2:
                v.cardType = '护照';
                break;
              case 3:
                v.cardType = '港澳通行证';
                break;
              case 4:
                v.cardType = '台湾通行证';
                break;
              default:
                v.cardType = '身份证';
            }
          });
        }
      }).catch(function (err) {
        // console.log(err);
        _this.$message({
          type: "error",
          message: "请求超时，请稍后重试!",
          duration: 1000
        });
      });

      this.$request.getqyshTopCount({
        anchangId: this.fieldId,
        startTime: this.searchTime ? this.searchTime[0] : '',
        endTime: this.searchTime ? this.searchTime[1] : ''
      }).then(function (res) {
        console.log(res);
        _this.getqyshTopCountData = res.data.data;
      }).catch(function (err) {
        // console.log(err);
        _this.$message({
          type: "error",
          message: "请求超时，请稍后重试!",
          duration: 1000
        });
      });
    },
    getHistoryAllData: function getHistoryAllData(data) {
      console.log(data, "000000000000000000");
      this.setHistoryAllData = data;
    },

    // 表格数据操作状态筛选
    // 注意数据类型，该state数据类型为Number
    filterTag: function filterTag(value, row) {
      console.log(value);
      this.getStatusSearch = value;
      return row.status === value;
    },

    //条件筛选
    filterChange: function filterChange(filters) {
      console.log("------------>", filters);
      if (keys_default()(filters)[0] == 'cardType') {
        this.cardType = values_default()(filters)[0][0] || '';
      }
      if (keys_default()(filters)[0] == 'checkType') {
        this.checkType = values_default()(filters)[0][0] || '';
      }
      if (keys_default()(filters)[0] == 'riskType') {
        this.riskType = values_default()(filters)[0][0] || '';
      }
      if (keys_default()(filters)[0] == 'status') {
        if (values_default()(filters)[0].length == 0) {
          this.getStatusSearch = '0~1~2~3~4~5';
        } else {
          var status = '';
          for (var i = 0; i < values_default()(filters)[0].length; i++) {
            status += values_default()(filters)[0][i] + '~';
          }
          this.getStatusSearch = status.slice(0, status.length - 1);
        }
      }
      this.getDataList('search');
    },
    changeTextType: function changeTextType() {
      console.log(this.searchTextType);
      this.searchText = '';
    },
    changeTimeType: function changeTimeType() {
      console.log(this.searchTimeType);
      var currentTime = moment_default()().format("YYYY-MM-DD 23:59:59");
      // 7天前
      var beforeTime = moment_default()().subtract(6, "days").format("YYYY-MM-DD 00:00:00");
      this.searchTime = [beforeTime, currentTime];
      this.getDataList('search');
    },
    changeTime: function changeTime(data) {
      console.log(data);
      if (!data) {
        this.searchTime = ['', ''];
        this.searchTimeType = '';
      } else {
        this.searchTime = data;
      }
      this.getDataList('search');
    },

    // get All res and Search
    getDataList: function getDataList() {
      var searchs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "default";

      if (searchs == "search") {
        this.getListData.pageIndex = 1;
        this.currentPage = 1;
        this.itemList();
      } else {
        this.itemList();
      }
    },
    tableRowClassName: function tableRowClassName(_ref) {
      var row = _ref.row,
          rowIndex = _ref.rowIndex;

      //把每一行的索引放进row
      row.index = rowIndex;
      this.getTableIndex = row.index;
    },
    handleIndex: function handleIndex(row, event, column) {
      var _this2 = this;

      // 根据状态判断当前是否是主人还是联名购房人/同行人
      this.$nextTick(function () {
        _this2.NoHostStatus = 2;
        eventBus.$emit("NoHostStatus", _this2.NoHostStatus);
      });
      console.log(row.index);
      console.log(this.tableData[row.index]);
      this.customerInfo = this.tableData[row.index];
      this.dialogVisible = true;
      console.log(this.customerInfo.snapImageUrl);
      this.snapImageUrl = this.customerInfo.snapImageUrl;
      this.getDataList('search');
    },
    slotModelBackTo: function slotModelBackTo() {
      this.dialogVisible = false;
      this.getDataList('search');
    },
    handleSizeChange: function handleSizeChange(val) {
      console.log("\u6BCF\u9875 " + val + " \u6761");
    },
    handleCurrentChange: function handleCurrentChange(index) {
      // console.log(index);
      this.getListData.pageIndex = index;
      this.getDataList();
    },

    // 签约二维码/生成
    showVSCode: function showVSCode() {
      console.log(window.sessionStorage.getItem("IP"));
      this.takeVSCode = true;
      // console.log(this.$refs.qrCodeUrl);
      var qrcode = new qrcode_default.a(this.$refs.qrCodeUrl, {
        text: window.sessionStorage.getItem("IP") + "/#/phone/verification?name=" + window.sessionStorage.getItem("fieldName") + "&id=" + window.sessionStorage.getItem("fieldId"), // 需要转换为二维码的内容
        width: 180,
        height: 180,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: qrcode_default.a.CorrectLevel.H
      });
    },

    // 下载已生成的二维码
    downLoadImg: function downLoadImg(index, item) {
      var img = document.querySelectorAll(".vsdCodeCaseImg img");
      var url = img[0].src;
      var a = document.createElement("a");
      var event = new MouseEvent("click");
      // 下载图名字
      a.download = "签约核验二维码";
      a.href = url;
      // 合成函数，执行下载
      a.dispatchEvent(event);
    },

    // 关闭签约二维码弹窗
    closeVSCode: function closeVSCode() {
      this.takeVSCode = false;
      // 当关闭窗口的时候，删除DOM节点，防止重复渲染二维码图片
      var list = document.getElementsByClassName("vsdCodeCaseImg")[0];
      var canvas = list.getElementsByTagName("canvas");
      var image = list.getElementsByTagName("img");
      console.log(image);
      // 因为存在空白节点
      for (var index = 0; index < image.length; index++) {
        list.removeChild(canvas[index]);
        list.removeChild(image[index]);
      }
    },

    // 表格刷新
    refresh: function refresh() {
      this.tableData = [];
      this.itemList();
    },
    reBinding: function reBinding(data) {
      var _this3 = this;

      console.log(data);
      if (data) {
        this.customerInfo.firstVisitTime = moment_default()(data.createTime).format("YYYY-MM-DD HH:mm:ss");
        this.reBindNewTime = moment_default()(data.createTime).format("YYYY-MM-DD HH:mm:ss");
        console.log(this.customerInfo, data);
      } else {
        this.customerInfo.firstVisitTime = "";
        this.reBindNewTime = "";
        console.log(this.customerInfo, data);
      }
      this.dialogVisible = true;
      console.log(this.customerInfo.snapImageUrl);
      this.snapImageUrl = this.customerInfo.snapImageUrl;
      setTimeout(function () {
        _this3.$refs.report.getDealNodes();
      }, 500);
    },

    // 下载表格数据
    downLoadTable: function downLoadTable() {
      console.log(this.searchTime);
      var start = void 0,
          end = void 0;
      if (this.searchTime.length == 0) {
        start = '';
        end = '';
      } else {
        start = this.searchTime[0];
        end = this.searchTime[1];
      }
      var url = this.$request.getDownLoadTable();
      url = url + "?anchangId=" + this.fieldId + "&startTime=" + start + "&endTime=" + end + "&name=" + this.$store.state.saveSearchKeyWord_signUp + "&status=" + this.getStatusSearch;
      console.log(url);
      window.open(url);
    },
    gotoTakePhoto: function gotoTakePhoto() {
      var url = window.sessionStorage.getItem("IP") + "/#/mainPage/windControl?cityId=" + this.$route.params.cityId + "&cityfId=" + this.$route.params.cityfId + "&cityName=" + this.$route.params.cityName + "&anchangId=" + this.$route.params.anchangId;
      window.open(url, "_blank"); //新页面打开
    },

    //报备信息改变，重新加载成交记录
    changeReport: function changeReport() {
      this.$refs.report.getDealNodes();
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-3fe5896c","hasScoped":true,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/fengkong/newSignUp.vue
var newSignUp_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:"newSignUp_search"},[_c('div',{staticStyle:{"width":"40%"}},[_c('span',{staticStyle:{"font-size":"14px"}},[_vm._v("搜索筛选")]),_vm._v(" "),_c('el-select',{staticStyle:{"width":"110px"},attrs:{"placeholder":"请选择","size":"small"},on:{"change":_vm.changeTextType},model:{value:(_vm.searchTextType),callback:function ($$v) {_vm.searchTextType=$$v},expression:"searchTextType"}},[_c('el-option',{attrs:{"label":"客户姓名","value":"1"}}),_vm._v(" "),_c('el-option',{attrs:{"label":"经纪公司","value":"2"}})],1),_vm._v(" "),_c('el-input',{staticStyle:{"width":"50%","left":"-1%"},attrs:{"placeholder":"请输入内容","size":"small","clearable":""},model:{value:(_vm.searchText),callback:function ($$v) {_vm.searchText=$$v},expression:"searchText"}},[_c('el-button',{attrs:{"slot":"append","icon":"el-icon-search","size":"small"},on:{"click":function($event){return _vm.getDataList('search');}},slot:"append"})],1)],1),_vm._v(" "),_c('div',[_c('span',{staticStyle:{"font-size":"14px"}},[_vm._v("时间筛选")]),_vm._v(" "),_c('el-select',{attrs:{"placeholder":"请选择","size":"small"},on:{"change":_vm.changeTimeType},model:{value:(_vm.searchTimeType),callback:function ($$v) {_vm.searchTimeType=$$v},expression:"searchTimeType"}},_vm._l((_vm.timeOptions),function(item){return _c('el-option',{key:item.value,attrs:{"label":item.label,"value":item.value}})}),1),_vm._v(" "),_c('el-date-picker',{staticStyle:{"left":"-1%"},attrs:{"type":"daterange","picker-options":_vm.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":['00:00:00', '23:59:59'],"align":"right","size":"small"},on:{"change":_vm.changeTime},model:{value:(_vm.searchTime),callback:function ($$v) {_vm.searchTime=$$v},expression:"searchTime"}})],1)]),_vm._v(" "),_c('hr',{staticClass:"hrstyle"}),_vm._v(" "),_c('div',{staticClass:"newSignUp_header"},[_c('div',{staticClass:"newSignUp_mark"},[_c('span',{staticClass:"top",staticStyle:{"font-size":"20px","color":"#0950F7"}},[_c('el-badge',{staticClass:"item",attrs:{"is-dot":"","hidden":""}},[_c('i',{staticClass:"el-icon-bell"})])],1),_vm._v(" "),_c('span',{staticClass:"top"},[_vm._v("累计签约："+_vm._s(_vm.getqyshTopCountData.qyTotal)+" 组")]),_vm._v(" "),_c('span',{staticClass:"top"},[_vm._v("累计核验："+_vm._s(_vm.getqyshTopCountData.hyTotal)+" 组")]),_vm._v(" "),_c('span',{staticClass:"top"},[_vm._v("确认飞单："+_vm._s(_vm.getqyshTopCountData.fdCount)+" 组")]),_vm._v(" "),_c('span',{staticClass:"top"},[_vm._v("撤销飞单："+_vm._s(_vm.getqyshTopCountData.cxCount)+" 组")])]),_vm._v(" "),_c('div',{staticClass:"newSignUp_btn"},[_c('button',{staticClass:"btn btn01",on:{"click":_vm.refresh}},[_vm._v("刷新")]),_vm._v(" "),_c('button',{staticClass:"btn btn02",on:{"click":_vm.downLoadTable}},[_vm._v("批量导出")]),_vm._v(" "),_c('button',{staticClass:"btn btn03",on:{"click":_vm.showVSCode}},[_vm._v("签约二维码")]),_vm._v(" "),_c('div',{directives:[{name:"show",rawName:"v-show",value:(_vm.takeVSCode),expression:"takeVSCode"}],staticClass:"vsCodeMask"},[_c('div',{staticClass:"vsCodeCase"},[_c('div',{staticClass:"vsCodeCaseHeader"},[_vm._v("\n            签约二维码\n            "),_c('span',{on:{"click":_vm.closeVSCode}},[_c('i',{staticClass:"el-icon-close"})])]),_vm._v(" "),_c('div',{staticClass:"vsCodeCaseBody"},[_c('div',{ref:"qrCodeUrl",staticClass:"vsdCodeCaseImg"})]),_vm._v(" "),_c('div',{staticClass:"vsCodeCaseFooter",on:{"click":function($event){return _vm.downLoadImg(_vm.index, _vm.item)}}},[_c('button',[_vm._v("保存图片")])])])])])]),_vm._v(" "),_c('div',{staticClass:"newSignUp_Table TableData"},[_c('el-table',{staticStyle:{"width":"100%"},attrs:{"data":_vm.tableData,"border":"","row-class-name":_vm.tableRowClassName,"highlight-current-row":""},on:{"row-click":_vm.handleIndex,"filter-change":_vm.filterChange}},[_c('el-table-column',{attrs:{"prop":"date","label":"证件照片","width":"95"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [_c('el-tooltip',{attrs:{"placement":"right-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('img',{staticStyle:{"width":"200px","margin":"-7px -7px -10px -7px"},attrs:{"src":_vm.imgPath + scope.row.idImageUrl,"draggable":"false"}})]),_vm._v(" "),_c('img',{staticClass:"head_pic",attrs:{"src":_vm.imgPath + scope.row.idImageUrl,"width":"32","height":"42"}})])]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"name","label":"签约照片","width":"95"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [_c('el-tooltip',{attrs:{"placement":"right-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('img',{staticStyle:{"width":"200px","margin":"-7px -7px -10px -7px"},attrs:{"src":_vm.imgPath + scope.row.snapImageUrl,"draggable":"false"}})]),_vm._v(" "),_c('img',{staticClass:"head_pic",attrs:{"src":_vm.imgPath + scope.row.snapImageUrl,"width":"32","height":"42"}})])]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"cName","label":"姓名","width":"70"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"cardType","label":"证件类型","width":"90","filters":[{ text: '身份证', value: '1' }, 
          { text: '护照', value: '2' },
          { text: '港澳通行证', value: '3' },
          { text: '台湾通行证', value: '4' }],"filter-multiple":false,"columnKey":"cardType"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"idNum","label":"证件号码","width":"180"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"companyName","label":"经纪公司","minWidth":"180"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"reportTime","label":"报备时间","width":"170","sortable":""}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"firstVisitTime","label":"首访时间","width":"170","sortable":""}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"contractTime","label":"签约时间","width":"170","sortable":""}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"operateTime","label":"核验时间","width":"170","sortable":""}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"source","label":"核验方式","width":"100","filters":[{ text: '人证机核验', value: '0' }, 
          { text: '线上核验', value: '1' }],"filter-multiple":false,"columnKey":"checkType"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [(scope.row.source==0)?_c('p',[_vm._v("人证机核验")]):_vm._e(),_vm._v(" "),(scope.row.source==1)?_c('p',[_vm._v("线上核验")]):_vm._e(),_vm._v(" "),(scope.row.source==null)?_c('p',[_vm._v("暂无")]):_vm._e()]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"label":"状态","prop":"status","filters":[
          { text: '已核验', value: 0 },
          { text: '待核验', value: 1 },
          { text: '确认飞单', value: 2 },
          { text: '撤销飞单', value: 3 },
          { text: '审批中', value: 4 },
          { text: '无效', value: 5 } ],"width":"100","columnKey":"status"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [(scope.row.status === -1)?_c('el-tag',{attrs:{"type":'info',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):_vm._e(),_vm._v(" "),(scope.row.status === 0)?_c('el-tag',{attrs:{"type":'success',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):(scope.row.status === 1)?_c('el-tag',{attrs:{"type":'warning',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):(scope.row.status === 2)?_c('el-tag',{attrs:{"type":'danger',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):(scope.row.status === 3)?_c('el-tag',{attrs:{"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):_vm._e(),_vm._v(" "),(scope.row.status === 4)?_c('el-tag',{attrs:{"type":'success',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):(scope.row.status === 5)?_c('el-tag',{attrs:{"type":'danger',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):_vm._e()]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"width":"150","prop":"riskTypeDesc","label":"状态信息","filters":[{ text: '没有相关访客信息', value: '4' }, 
          { text: '没有相关报备信息', value: '5' },
          { text: '疑似自访后异常报备', value: '6' },
          { text: '报备有效期外到访', value: '7' },
          { text: '疑似渠道截客', value: '8' },
          { text: '成交保护期外签约', value: '9' },
          { text: '多渠道报备', value: '10' },
          { text: '逾期签约', value: '11' }],"filter-multiple":false,"columnKey":"riskType"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [(scope.row.riskType==4)?_c('p',{staticStyle:{"color":"rgb(148 86 86)"}},[_vm._v(_vm._s(scope.row.riskTypeDesc))]):_vm._e(),_vm._v(" "),(scope.row.riskType==5)?_c('p',{staticStyle:{"color":"rgb(138 131 131)"}},[_vm._v(_vm._s(scope.row.riskTypeDesc))]):_vm._e(),_vm._v(" "),(scope.row.riskType==6)?_c('p',{staticStyle:{"color":"#f00"}},[_vm._v(_vm._s(scope.row.riskTypeDesc))]):_vm._e(),_vm._v(" "),(scope.row.riskType==7)?_c('p',{staticStyle:{"color":"#f37b7b"}},[_vm._v(_vm._s(scope.row.riskTypeDesc))]):_vm._e(),_vm._v(" "),(scope.row.riskType==8)?_c('p',{staticStyle:{"color":"#f00"}},[_vm._v(_vm._s(scope.row.riskTypeDesc))]):_vm._e(),_vm._v(" "),(scope.row.riskType==9)?_c('p',{staticStyle:{"color":"#279050"}},[_vm._v(_vm._s(scope.row.riskTypeDesc))]):_vm._e(),_vm._v(" "),(scope.row.riskType==10)?_c('p',{staticStyle:{"color":"#f37b7b"}},[_vm._v(_vm._s(scope.row.riskTypeDesc))]):_vm._e(),_vm._v(" "),(scope.row.riskType==11)?_c('p',{staticStyle:{"color":"#279050"}},[_vm._v(_vm._s(scope.row.riskTypeDesc))]):_vm._e()]}}])})],1),_vm._v(" "),_c('el-dialog',{attrs:{"visible":_vm.dialogVisible,"center":"","fullscreen":"","show-close":_vm.showClose,"close-on-click-modal":false},on:{"update:visible":function($event){_vm.dialogVisible=$event}}},[_c('div',{staticStyle:{"position":"relative","height":"22px"},attrs:{"slot":"title"},slot:"title"},[_c('div',{staticClass:"slotModelTitle"},[_c('span',{staticClass:"slotModelBackTo",on:{"click":_vm.slotModelBackTo}},[_c('i',{staticClass:"el-icon-back"})]),_vm._v(" "),_c('span',{staticClass:"title-age"},[_vm._v("人工审核")])])]),_vm._v(" "),_c('div',{staticStyle:{"padding":"0 15px"},attrs:{"id":"page"}},[_c('signUpBasic',{attrs:{"customerInfo":_vm.customerInfo,"itemList":_vm.itemList},on:{"changeReport":_vm.changeReport}}),_vm._v(" "),_c('jointBuyers',{attrs:{"customerInfo":_vm.customerInfo}}),_vm._v(" "),_c('signTradeRecord',{ref:"report",attrs:{"customerInfo":_vm.customerInfo,"itemList":_vm.itemList,"reBindNewTime":_vm.reBindNewTime}}),_vm._v(" "),_c('signHistorySimilar',{attrs:{"snapImageUrl":_vm.snapImageUrl,"customerInfo":_vm.customerInfo,"reBindNewTime":_vm.reBindNewTime},on:{"getHistoryAllData":_vm.getHistoryAllData,"reBinding":_vm.reBinding}}),_vm._v(" "),_c('div',{staticClass:"otherTakePhotos",staticStyle:{"border-top":"1px solid #ccc"}},[_vm._v("\n          如果未找到到访记录？请试试"),_c('span',{on:{"click":_vm.gotoTakePhoto}},[_vm._v("拍照核验")])])],1)])],1),_vm._v(" "),(_vm.showTablePage)?_c('div',{staticClass:"zhfk_detail_tablePage"},[_c('el-pagination',{attrs:{"current-page":_vm.currentPage,"page-size":_vm.getListData.pageSize,"page-sizes":[10, 20, 30, 40],"pager-count":20,"background":"","layout":"total, prev, pager, next, jumper","total":_vm.getDataTotalNum},on:{"size-change":_vm.handleSizeChange,"current-change":_vm.handleCurrentChange,"update:currentPage":function($event){_vm.currentPage=$event},"update:current-page":function($event){_vm.currentPage=$event}}})],1):_vm._e()])}
var newSignUp_staticRenderFns = []
var newSignUp_esExports = { render: newSignUp_render, staticRenderFns: newSignUp_staticRenderFns }
/* harmony default export */ var fengkong_newSignUp = (newSignUp_esExports);
// CONCATENATED MODULE: ./src/views/fengkong/newSignUp.vue
function newSignUp_injectStyle (ssrContext) {
  __webpack_require__("jDRm")
}
var newSignUp_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var newSignUp___vue_template_functional__ = false
/* styles */
var newSignUp___vue_styles__ = newSignUp_injectStyle
/* scopeId */
var newSignUp___vue_scopeId__ = "data-v-3fe5896c"
/* moduleIdentifier (server only) */
var newSignUp___vue_module_identifier__ = null
var newSignUp_Component = newSignUp_normalizeComponent(
  newSignUp,
  fengkong_newSignUp,
  newSignUp___vue_template_functional__,
  newSignUp___vue_styles__,
  newSignUp___vue_scopeId__,
  newSignUp___vue_module_identifier__
)

/* harmony default export */ var views_fengkong_newSignUp = (newSignUp_Component.exports);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/views/fengkong/newPhotos.vue
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//


/* harmony default export */ var newPhotos = ({
  filters: {
    changeState: function changeState(data) {
      switch (data) {
        case -1:
          {
            return "未判断";
            break;
          }
        case 0:
          {
            return "已核验";
            break;
          }
        case 1:
          {
            return "待核验";
            break;
          }
        case 2:
          {
            return "确认飞单";
            break;
          }
        case 3:
          {
            return "撤销飞单";
            break;
          }
        default:
          {
            return "未知状态";
            break;
          }
      }
    }
  },
  data: function data() {
    return {
      // 表格列表数据
      tableData: [],
      // page
      getDataTotalNum: 0,
      getListData: {
        pageIndex: 1,
        pageSize: 10
      },
      // 拍照核验顶部汇总数据
      getpzhjTopCountData: {
        today: "0",
        total: "0",
        fdCount: "0",
        cxCount: "0"
      },
      imgPath: "",
      fieldId: "",
      showTablePage: false
    };
  },
  created: function created() {
    this.imgPath = JSON.parse(window.localStorage.getItem("param")).riskImagePathPrefix;
    this.fieldId = window.sessionStorage.getItem("fieldId");
  },
  mounted: function mounted() {
    this.itemList();
  },

  watch: {
    "$store.state.saveSearchKeyWord_takePhotos": function $storeStateSaveSearchKeyWord_takePhotos(data) {
      if (data) {
        this.$store.commit("getSearchFromData_takePhotos", []);
        this.itemList();
      } else {
        this.$store.commit("getSearchFromData_takePhotos", JSON.parse(window.sessionStorage.getItem("takePhoneDate")));
        this.itemList();
      }
      this.itemList();
    },
    "$store.state.saveSearchFromData_takePhotos": function $storeStateSaveSearchFromData_takePhotos(data) {
      this.itemList();
    }
  },
  methods: {
    itemList: function itemList() {
      var _this = this;

      this.$request.getQueryPageByPhoto({
        currentPage: this.getListData.pageIndex,
        pageSize: this.getListData.pageSize,
        anchangId: this.fieldId,
        startTime: this.$store.state.saveSearchFromData_takePhotos[0],
        endTime: this.$store.state.saveSearchFromData_takePhotos[1],
        name: this.$store.state.saveSearchKeyWord_takePhotos
      }).then(function (res) {
        console.log(res);
        if (res.status == 200) {
          _this.tableData = res.data.data.list;
          if (_this.tableData.length > 1) {
            _this.showTablePage = true;
          } else {
            _this.showTablePage = false;
          }
          // 获取总页数
          console.log(res.data.data.total);
          _this.getDataTotalNum = res.data.data.total;
        }
      });
      // 拍照核验顶部汇总数据
      this.$request.getQueryCountByPhoto({
        anchangId: this.fieldId,
        startTime: this.$store.state.saveSearchFromData_takePhotos[0],
        endTime: this.$store.state.saveSearchFromData_takePhotos[1]
      }).then(function (res) {
        console.log(res);
        if (res.status == 200) {
          _this.getpzhjTopCountData = res.data.data;
        }
      });
    },

    // 表格数据操作状态筛选
    // 注意数据类型，该state数据类型为Number
    filterTag: function filterTag(value, row) {
      // console.log(value, row);
      return row.status === value;
    },

    // get All res and Search
    getDataList: function getDataList() {
      var searchs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "default";

      if (searchs == "search") {
        this.getListData.pageIndex = 1;
        this.itemList();
      } else {
        this.itemList();
      }
    },

    // 表格刷新
    refresh: function refresh() {
      this.itemList();
      this.$message({
        message: "刷新成功",
        type: "success"
      });
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-fa6c770c","hasScoped":false,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/fengkong/newPhotos.vue
var newPhotos_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:"newSignUp_header"},[_c('div',{staticClass:"newSignUp_mark"},[_c('span',{staticClass:"top",staticStyle:{"font-size":"20px","color":"#0950F7"}},[_c('el-badge',{staticClass:"item",attrs:{"is-dot":"","hidden":""}},[_c('i',{staticClass:"el-icon-bell"})])],1),_vm._v(" "),_c('span',{staticClass:"top"},[_vm._v("今日核验："+_vm._s(_vm.getpzhjTopCountData.today)+" 组")]),_vm._v(" "),_c('span',{staticClass:"top"},[_vm._v("累计核验："+_vm._s(_vm.getpzhjTopCountData.total)+" 组")]),_vm._v(" "),_c('span',{staticClass:"top"},[_vm._v("确认飞单："+_vm._s(_vm.getpzhjTopCountData.fdCount)+" 组")]),_vm._v(" "),_c('span',{staticClass:"top"},[_vm._v("撤销飞单："+_vm._s(_vm.getpzhjTopCountData.cxCount)+" 组")])]),_vm._v(" "),_c('div',{staticClass:"newSignUp_btn"},[_c('button',{staticClass:"btn btn01",on:{"click":_vm.refresh}},[_vm._v("刷新")]),_vm._v(" "),_c('button',{staticClass:"btn btn02"},[_vm._v("批量导出")])])]),_vm._v(" "),_c('div',{staticClass:"newSignUp_Table TableData"},[_c('el-table',{ref:"multipleTable",staticStyle:{"width":"100%"},attrs:{"data":_vm.tableData,"border":"","highlight-current-row":"","tooltip-effect":"dark"},on:{"selection-change":_vm.handleSelectionChange}},[_c('el-table-column',{attrs:{"label":"核验照片"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [_c('el-tooltip',{attrs:{"placement":"right-start","popper-class":"draw_share_atooltip"}},[_c('div',{attrs:{"slot":"content"},slot:"content"},[_c('img',{staticStyle:{"width":"200px","margin":"-7px -7px -10px -7px"},attrs:{"src":_vm.imgPath + scope.row.snapImageUrl,"draggable":"false"}})]),_vm._v(" "),_c('img',{staticClass:"head_pic",attrs:{"src":_vm.imgPath + scope.row.snapImageUrl,"width":"32","height":"42"}})])]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"cName","label":"姓名"},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var row = ref.row;
return [_vm._v("\n          "+_vm._s(row.cName || "---")+"\n        ")]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"idNum","label":"身份证号码"},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var row = ref.row;
return [_vm._v("\n          "+_vm._s(row.idNum || "---")+"\n        ")]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"reportTime","label":"报备时间","sortable":""},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var row = ref.row;
return [_vm._v("\n          "+_vm._s(row.reportTime || "---")+"\n        ")]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"operateTime","label":"核验时间"},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var row = ref.row;
return [_vm._v("\n          "+_vm._s(row.operateTime || "---")+"\n        ")]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"firstVisitTime","label":"首次到访时间","sortable":""},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var row = ref.row;
return [_vm._v("\n          "+_vm._s(row.firstVisitTime || "---")+"\n        ")]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"aName","label":"经纪人"},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var row = ref.row;
return [_vm._v("\n          "+_vm._s(row.aName || "---")+"\n        ")]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"cardTime","label":"刷身份证时间","sortable":""},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var row = ref.row;
return [_vm._v("\n          "+_vm._s(row.cardTime || "---")+"\n        ")]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"contractTime","label":"签约时间","sortable":""},scopedSlots:_vm._u([{key:"default",fn:function(ref){
var row = ref.row;
return [_vm._v("\n          "+_vm._s(row.contractTime || "---")+"\n        ")]}}])}),_vm._v(" "),_c('el-table-column',{attrs:{"label":"状态","filters":[
          { text: '未判断', value: -1 },
          { text: '已核验', value: 0 },
          { text: '待核验', value: 1 },
          { text: '确认飞单', value: 2 },
          { text: '撤销飞单', value: 3 },
          { text: '未知状态', value: null }
        ],"filter-method":_vm.filterTag,"width":"100"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [(scope.row.status === -1)?_c('el-tag',{attrs:{"type":'info',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):_vm._e(),_vm._v(" "),(scope.row.status === 0)?_c('el-tag',{attrs:{"type":'success',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):(scope.row.status === 1)?_c('el-tag',{attrs:{"type":'warning',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):(scope.row.status === 2)?_c('el-tag',{attrs:{"type":'danger',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):(scope.row.status === null)?_c('el-tag',{attrs:{"type":'info',"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):(scope.row.status === 3)?_c('el-tag',{attrs:{"disable-transitions":""}},[_vm._v(_vm._s(_vm._f("changeState")(scope.row.status))+"\n          ")]):_vm._e()]}}])})],1)],1),_vm._v(" "),(_vm.showTablePage)?_c('div',{staticClass:"zhfk_detail_tablePage"},[_c('el-pagination',{attrs:{"page-size":_vm.getListData.pageSize,"pager-count":20,"background":"","layout":"total, prev, pager, next, jumper","total":_vm.getDataTotalNum},on:{"size-change":_vm.handleSizeChange,"current-change":_vm.handleCurrentChange}})],1):_vm._e()])}
var newPhotos_staticRenderFns = []
var newPhotos_esExports = { render: newPhotos_render, staticRenderFns: newPhotos_staticRenderFns }
/* harmony default export */ var fengkong_newPhotos = (newPhotos_esExports);
// CONCATENATED MODULE: ./src/views/fengkong/newPhotos.vue
var newPhotos_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var newPhotos___vue_template_functional__ = false
/* styles */
var newPhotos___vue_styles__ = null
/* scopeId */
var newPhotos___vue_scopeId__ = null
/* moduleIdentifier (server only) */
var newPhotos___vue_module_identifier__ = null
var newPhotos_Component = newPhotos_normalizeComponent(
  newPhotos,
  fengkong_newPhotos,
  newPhotos___vue_template_functional__,
  newPhotos___vue_styles__,
  newPhotos___vue_scopeId__,
  newPhotos___vue_module_identifier__
)

/* harmony default export */ var views_fengkong_newPhotos = (newPhotos_Component.exports);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/views/fengkong/newReport.vue
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//




/* harmony default export */ var newReport = ({
  data: function data() {
    return {
      fieldId: "",
      getbblbTopCountData: {
        today: "0",
        total: "0"
      },
      // 签约二维码
      takeVSCode: false,
      // 获取下拉经纪人公司
      getCompanyList: [],
      // 弹窗
      dialogVisible: false,
      dialogImport: false,
      // 弹窗表单
      ruleForm: {
        cName: "",
        cPhonenum: "",
        aName: "",
        companyName: "",
        companys: "",
        date1: ""
      },
      rules: {
        cName: [{ required: true, message: "请输入活动名称", trigger: "blur" }],
        cPhonenum: [{ required: true, message: "请输入活动名称", trigger: "blur" }],
        aName: [{ required: true, message: "请输入活动名称", trigger: "blur" }],
        companyName: [{ required: true, message: "请输入活动名称", trigger: "blur" }],
        companys: [{ required: true, message: "请输入活动名称", trigger: "blur" }],
        date1: [{
          required: true,
          message: "请选择日期",
          trigger: "change"
        }],
        selectCurrentTime: ""
      },
      // 获取表格数据
      tableData: [],
      // page
      getDataTotalNum: 0,
      getListData: {
        pageIndex: 1,
        pageSize: 10
      },
      currentPage: 1,

      checkAllRows: [],
      getSelectIds: [],

      showDels: false,
      showTablePage: false,

      rootAdminInfo: {}
    };
  },
  created: function created() {
    this.fieldId = window.sessionStorage.getItem("fieldId");

    this.rootAdminInfo = JSON.parse(Object(utils["a" /* Decrypt */])(window.sessionStorage.getItem("rootAdminInfo")));
    console.log(this.rootAdminInfo);
  },
  mounted: function mounted() {
    this.itemList();
  },

  watch: {
    "$store.state.saveSearchKeyWord_report": function $storeStateSaveSearchKeyWord_report(data) {
      if (data) {
        this.$store.commit("getSearchFromData_report", []);
        this.itemList();
      } else {
        this.$store.commit("getSearchFromData_report", JSON.parse(window.sessionStorage.getItem("reportDate")));
        this.itemList();
      }
    },
    "$store.state.saveSearchFromData_report": function $storeStateSaveSearchFromData_report(data) {
      this.getListData.pageIndex = 1;
      this.currentPage = 1;
      this.itemList();
    },
    ruleForm: function ruleForm() {
      this.selectChange();
    }
  },
  methods: {
    itemList: function itemList() {
      var _this = this;

      // 表格列表
      this.$request.getbblbTableList({
        currentPage: this.getListData.pageIndex,
        pageSize: this.getListData.pageSize,
        anchangId: this.fieldId,
        startTime: this.$store.state.saveSearchFromData_report[0],
        endTime: this.$store.state.saveSearchFromData_report[1],
        name: this.$store.state.saveSearchKeyWord_report01
      }).then(function (res) {
        console.log(res);
        if (res.status == 200) {
          _this.tableData = res.data.data.list;
          if (_this.tableData.length >= 1) {
            _this.showTablePage = true;
          } else {
            _this.showTablePage = false;
          }
          console.log(_this.tableData);
          // 获取总页数
          _this.getDataTotalNum = res.data.data.total;
        }
      });
      // 顶部报备列表数据
      this.$request.getbblbTopCount({
        anchangId: this.fieldId
      }).then(function (res) {
        console.log(res);
        if (res.status == 200) {
          _this.getbblbTopCountData = res.data.data;
          console.log(_this.getbblbTopCountData);
        }
      });
      // 获取下拉经纪人公司
      this.$request.getCompanyList2({
        anchangId: this.fieldId,
        corpId: this.rootAdminInfo.corId
      }).then(function (res) {
        console.log(res);
        if (res.status == 200) {
          _this.getCompanyList = res.data.data;
        }
      });
    },

    // 刷新表格
    refresh: function refresh() {
      this.itemList();
      this.$message({
        message: "刷新成功",
        type: "success"
      });
    },

    // 批量删除
    batchDelete: function batchDelete() {
      var _this2 = this;

      this.$confirm("确认删除当前选中的数据么？", "信息", {
        confirmButtonText: "确定",
        cancelButtonText: "取消",
        type: "warning"
      }).then(function () {
        _this2.formData = new FormData();
        _this2.getSelectIds.forEach(function (v) {
          _this2.formData.append("ids", v.id);
        });
        _this2.$request.getbblbTableDeletes(_this2.formData).then(function (res) {
          console.log(res);
          if (res.status == 200) {
            _this2.itemList();
            _this2.$message({
              type: "success",
              message: "数据删除成功",
              duration: 1000
            });
          } else {
            _this2.$message({
              type: "error",
              message: "数据删除失败",
              duration: 1000
            });
          }
        });
      }).catch(function () {});
    },

    // 导出excel
    exportExcel: function exportExcel() {
      var start = void 0,
          end = void 0;
      if (this.$store.state.saveSearchFromData_report.length == 0) {
        start = '';
        end = '';
      } else {
        start = this.$store.state.saveSearchFromData_report[0];
        end = this.$store.state.saveSearchFromData_report[1];
      }
      var url = this.$request.getbblbDownLoadTable();
      url = url + "?anchangId=" + this.fieldId + "&startTime=" + start + "&endTime=" + end + "&name=" + this.$store.state.saveSearchKeyWord_report + "&status=0~1";
      window.open(url);
      console.log(url);
    },

    // 下载excel模板
    downloadTemplateExcel: function downloadTemplateExcel() {
      var url = this.$request.getbblbImportTemplate();
      window.open(url);
    },

    // 上传excel
    handleFileChange: function handleFileChange(e) {
      var _this3 = this;

      console.log(e);
      var inputDOM = this.$refs.inputer;
      this.file = inputDOM.files[0];
      if (this.file.name.split('.')[1] !== 'xls' && this.file.name.split('.')[1] !== 'xlsx') {
        this.$message({
          type: "warning",
          message: '只能上传excel文件！',
          duration: 1000
        });
        return;
      }
      var size = Math.floor(this.file.size / 1024);
      this.formData = new FormData();
      this.formData.append("excelFile", this.file);
      this.formData.append("anchangId", this.fieldId);

      // 解决当前用户上传相同名称的图片，只执行一次上传的问题
      document.getElementById("fileExport").value = null;

      this.$request.getbelReportReadFile(this.formData).then(function (res) {
        console.log(res);
        if (res.data.code == "0000") {
          _this3.$message({
            type: "error",
            message: res.data.msg,
            duration: 1000
          });
        } else {
          _this3.itemList();
          _this3.$message({
            type: "success",
            message: res.data.msg,
            duration: 1000
          });
          _this3.dialogVisible = false;
        }
      });
    },

    // 全选
    handleSelectionChange: function handleSelectionChange(val) {
      this.getSelectIds = val;
      if (this.getSelectIds.length > 0) {
        console.log("have");
        this.showDels = true;
      } else {
        console.log("noop");
        this.showDels = false;
      }
    },

    // get All res and Search
    getDataList: function getDataList() {
      var searchs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : "default";

      if (searchs == "search") {
        this.getListData.pageIndex = 1;
        this.itemList();
      } else {
        this.itemList();
      }
    },
    handleSizeChange: function handleSizeChange(val) {
      console.log("\u6BCF\u9875 " + val + " \u6761");
    },
    handleCurrentChange: function handleCurrentChange(index) {
      // console.log(index);
      this.getListData.pageIndex = index;
      this.getDataList();
    },

    // 报备二维码/生成
    showVSCode: function showVSCode() {
      this.takeVSCode = true;
      // console.log(this.$refs.qrCodeUrl);
      var qrcode = new qrcode_default.a(this.$refs.qrCodeUrl, {
        text: window.sessionStorage.getItem("IP") + "/#/phone/report?" + window.sessionStorage.getItem("fieldId"), // 需要转换为二维码的内容
        width: 180,
        height: 180,
        colorDark: "#000000",
        colorLight: "#ffffff",
        correctLevel: qrcode_default.a.CorrectLevel.H
      });
    },

    // 下载已生成的二维码
    downLoadImg: function downLoadImg(index, item) {
      var img = document.querySelectorAll(".vsdCodeCaseImg img");
      var url = img[0].src;
      var a = document.createElement("a");
      var event = new MouseEvent("click");
      // 下载图名字
      a.download = "报备二维码";
      a.href = url;
      // 合成函数，执行下载
      a.dispatchEvent(event);
    },

    // 关闭签约二维码弹窗
    closeVSCode: function closeVSCode() {
      this.takeVSCode = false;
      // 当关闭窗口的时候，删除DOM节点，防止重复渲染二维码图片
      var list = document.getElementsByClassName("vsdCodeCaseImg")[0];
      var canvas = list.getElementsByTagName("canvas");
      var image = list.getElementsByTagName("img");
      console.log(image);
      // 因为存在空白节点
      for (var index = 0; index < image.length; index++) {
        list.removeChild(canvas[index]);
        list.removeChild(image[index]);
      }
    },

    // 获取当前点击的数据详情
    handleEdit: function handleEdit(index, row) {
      this.currentData = row;
      this.ruleForm = {
        cName: row.cName,
        cPhonenum: row.cPhonenum,
        aName: row.aName,
        companyName: row.companyName,
        companys: row.companyName,
        date1: row.subscribeTime == null ? "" : new Date(row.subscribeTime)
      };
    },

    // 选中删除
    deleteList: function deleteList(index, row) {
      var _this4 = this;

      console.log(index, row);
      this.$confirm("确认删除该条数据么？", "信息", {
        confirmButtonText: "确定",
        cancelButtonText: "取消",
        type: "warning"
      }).then(function () {
        _this4.$request.getbblbTableDelete({
          id: row.id
        }).then(function (res) {
          console.log(res);
          if (res.status == 200) {
            _this4.itemList();
            _this4.$message({
              type: "success",
              message: "用户删除成功",
              duration: 1000
            });
          }
        });
      }).catch(function () {});
    },

    // 获取修改之后的新数据
    // 提交表单
    submitForm: function submitForm() {
      var _this5 = this;

      if (this.ruleForm.companyName == "custom") {
        console.log(this.ruleForm.subscribeTime);
        this.queryInfo = {
          id: this.currentData.id,
          cName: this.ruleForm.cName,
          cPhonenum: this.ruleForm.cPhonenum,
          aName: this.ruleForm.aName,
          companyName: this.ruleForm.companys,
          subscribeTime: this.selectCurrentTime
        };
      } else {
        console.log(this.selectCurrentTime);
        this.queryInfo = {
          id: this.currentData.id,
          cName: this.ruleForm.cName,
          cPhonenum: this.ruleForm.cPhonenum,
          aName: this.ruleForm.aName,
          companyName: this.ruleForm.companyName,
          subscribeTime: this.selectCurrentTime
        };
      }
      this.$request.getbblbTableUpdate(this.queryInfo).then(function (res) {
        if (res.status == 200) {
          _this5.itemList();
          _this5.$message({
            type: "success",
            message: "用户修改成功",
            duration: 1000
          });
          // 关闭弹窗
          _this5.dialogVisible = false;
        }
      });
    },
    selectChange: function selectChange(e) {
      if (e != "custom") {
        this.showCompanys = false;
      } else {
        this.showCompanys = true;
      }
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-c0b7dcbe","hasScoped":true,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/fengkong/newReport.vue
var newReport_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',[_c('div',{staticClass:"newSignUp_header"},[_c('div',{staticClass:"newSignUp_mark"},[_c('span',{staticClass:"top",staticStyle:{"font-size":"20px","color":"#0950F7"}},[_c('el-badge',{staticClass:"item",attrs:{"is-dot":"","hidden":""}},[_c('i',{staticClass:"el-icon-bell"})])],1),_vm._v(" "),_c('span',{staticClass:"top"},[_vm._v("今日报备："+_vm._s(_vm.getbblbTopCountData.today)+" 组")]),_vm._v(" "),_c('span',{staticClass:"top"},[_vm._v("累计报备："+_vm._s(_vm.getbblbTopCountData.total)+" 组")])]),_vm._v(" "),_c('div',{staticClass:"newSignUp_btn"},[_c('button',{staticClass:"btn btn01",on:{"click":_vm.refresh}},[_vm._v("刷新")]),_vm._v(" "),_c('button',{staticClass:"btn btn02",on:{"click":function($event){_vm.dialogImport = true}}},[_vm._v("批量导入")]),_vm._v(" "),_c('button',{staticClass:"btn btn02",on:{"click":_vm.exportExcel}},[_vm._v("批量导出")]),_vm._v(" "),_c('button',{staticClass:"btn btn03",on:{"click":_vm.showVSCode}},[_vm._v("报备二维码")]),_vm._v(" "),_c('div',{directives:[{name:"show",rawName:"v-show",value:(_vm.takeVSCode),expression:"takeVSCode"}],staticClass:"vsCodeMask"},[_c('div',{staticClass:"vsCodeCase"},[_c('div',{staticClass:"vsCodeCaseHeader"},[_vm._v("\n            报备二维码\n            "),_c('span',{on:{"click":_vm.closeVSCode}},[_c('i',{staticClass:"el-icon-close"})])]),_vm._v(" "),_c('div',{staticClass:"vsCodeCaseBody"},[_c('div',{ref:"qrCodeUrl",staticClass:"vsdCodeCaseImg"})]),_vm._v(" "),_c('div',{staticClass:"vsCodeCaseFooter",on:{"click":function($event){return _vm.downLoadImg(_vm.index, _vm.item)}}},[_c('button',[_vm._v("保存图片")])])])])])]),_vm._v(" "),_c('div',{staticClass:"newSignUp_Table TableData TableDataSet"},[_c('el-table',{ref:"tableRef",staticStyle:{"width":"100%"},attrs:{"data":_vm.tableData,"tooltip-effect":"dark","border":"","highlight-current-row":"","row-key":function (row) {return row.id}},on:{"selection-change":_vm.handleSelectionChange}},[_c('el-table-column',{attrs:{"prop":"cName","label":"客户姓名"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"cPhonenum","label":"手机号"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"cIdnum","label":"身份证后六位"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"reportTime","label":"报备时间","sortable":""}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"companyName","label":"经纪人公司"}}),_vm._v(" "),_c('el-table-column',{attrs:{"prop":"aName","label":"经纪人"}}),_vm._v(" "),_c('el-table-column',{attrs:{"label":"操作","width":"140","fixed":"right"},scopedSlots:_vm._u([{key:"default",fn:function(scope){return [_c('el-button',{attrs:{"type":"primary","size":"mini"},on:{"click":function($event){_vm.handleEdit(scope.$index, scope.row), (_vm.dialogVisible = true)}}},[_vm._v("编辑")]),_vm._v(" "),_c('el-button',{attrs:{"type":"danger","size":"mini"},on:{"click":function($event){return _vm.deleteList(scope.$index, scope.row)}}},[_vm._v("删除")])]}}])})],1),_vm._v(" "),_c('el-dialog',{attrs:{"title":"批量导入","visible":_vm.dialogImport,"width":"700px","close-on-click-modal":false},on:{"update:visible":function($event){_vm.dialogImport=$event}}},[_c('div',{staticClass:"modalBox"},[_c('h1',[_vm._v("请先下载导入模板，按照模板中的格式生成Excel文件并上传。")]),_vm._v(" "),_c('button',{staticClass:"btn btn02",staticStyle:{"float":"left"},on:{"click":_vm.downloadTemplateExcel}},[_vm._v("\n          下载excel模板\n        ")]),_vm._v(" "),_c('input',{ref:"inputer",staticStyle:{"display":"none"},attrs:{"id":"fileExport","type":"file"},on:{"change":_vm.handleFileChange}}),_vm._v(" "),_c('label',{attrs:{"for":"fileExport"}},[_c('span',{staticClass:"btn btn03 btns"},[_vm._v("表格导入")])])])]),_vm._v(" "),_c('el-dialog',{attrs:{"title":"修改报备信息","visible":_vm.dialogVisible,"width":"700px","close-on-click-modal":false},on:{"update:visible":function($event){_vm.dialogVisible=$event}}},[_c('div',{staticStyle:{"padding":"20px 10px"}},[_c('el-form',{ref:"ruleForm",attrs:{"model":_vm.ruleForm,"rules":_vm.rules,"label-width":"100px","size":"small"}},[_c('el-form-item',{attrs:{"label":"客户姓名","prop":"cName"}},[_c('el-input',{attrs:{"placeholder":"请输入客户姓名"},model:{value:(_vm.ruleForm.cName),callback:function ($$v) {_vm.$set(_vm.ruleForm, "cName", $$v)},expression:"ruleForm.cName"}})],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"客户手机号","prop":"cPhonenum"}},[_c('el-input',{attrs:{"placeholder":"请输入客户手机号"},model:{value:(_vm.ruleForm.cPhonenum),callback:function ($$v) {_vm.$set(_vm.ruleForm, "cPhonenum", $$v)},expression:"ruleForm.cPhonenum"}})],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"经纪人姓名","prop":"aName"}},[_c('el-input',{attrs:{"placeholder":"请输入经纪人姓名"},model:{value:(_vm.ruleForm.aName),callback:function ($$v) {_vm.$set(_vm.ruleForm, "aName", $$v)},expression:"ruleForm.aName"}})],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"经纪人公司","prop":"companyName"}},[_c('el-select',{staticStyle:{"width":"100%"},attrs:{"placeholder":"请选择经纪人公司"},on:{"change":_vm.selectChange},model:{value:(_vm.ruleForm.companyName),callback:function ($$v) {_vm.$set(_vm.ruleForm, "companyName", $$v)},expression:"ruleForm.companyName"}},_vm._l((_vm.getCompanyList),function(item,index){return _c('el-option',{key:index,attrs:{"label":item.name,"value":item.name}})}),1)],1),_vm._v(" "),_c('el-form-item',{directives:[{name:"show",rawName:"v-show",value:(_vm.showCompanys),expression:"showCompanys"}],attrs:{"label":"经纪人公司","prop":"companys"}},[_c('el-input',{attrs:{"placeholder":"请输入经纪人公司"},model:{value:(_vm.ruleForm.companys),callback:function ($$v) {_vm.$set(_vm.ruleForm, "companys", $$v)},expression:"ruleForm.companys"}})],1),_vm._v(" "),_c('el-form-item',{attrs:{"label":"预约时间","required":""}},[_c('el-form-item',{attrs:{"prop":"date1"}},[_c('el-date-picker',{staticStyle:{"width":"100%"},attrs:{"type":"datetime","placeholder":"选择日期","value-format":"yyyy-MM-dd HH:mm:ss"},on:{"change":_vm.formatTime},model:{value:(_vm.ruleForm.date1),callback:function ($$v) {_vm.$set(_vm.ruleForm, "date1", $$v)},expression:"ruleForm.date1"}})],1)],1),_vm._v(" "),_c('el-form-item',[_c('el-button',{attrs:{"type":"primary"},on:{"click":function($event){return _vm.submitForm('ruleForm')}}},[_vm._v("确认修改")])],1)],1)],1)])],1),_vm._v(" "),(_vm.showTablePage)?_c('div',{staticClass:"zhfk_detail_tablePage"},[_c('el-pagination',{attrs:{"current-page":_vm.currentPage,"page-size":_vm.getListData.pageSize,"pager-count":20,"background":"","layout":"total, prev, pager, next, jumper","total":_vm.getDataTotalNum},on:{"size-change":_vm.handleSizeChange,"current-change":_vm.handleCurrentChange,"update:currentPage":function($event){_vm.currentPage=$event},"update:current-page":function($event){_vm.currentPage=$event}}})],1):_vm._e()])}
var newReport_staticRenderFns = []
var newReport_esExports = { render: newReport_render, staticRenderFns: newReport_staticRenderFns }
/* harmony default export */ var fengkong_newReport = (newReport_esExports);
// CONCATENATED MODULE: ./src/views/fengkong/newReport.vue
function newReport_injectStyle (ssrContext) {
  __webpack_require__("kG6S")
}
var newReport_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var newReport___vue_template_functional__ = false
/* styles */
var newReport___vue_styles__ = newReport_injectStyle
/* scopeId */
var newReport___vue_scopeId__ = "data-v-c0b7dcbe"
/* moduleIdentifier (server only) */
var newReport___vue_module_identifier__ = null
var newReport_Component = newReport_normalizeComponent(
  newReport,
  fengkong_newReport,
  newReport___vue_template_functional__,
  newReport___vue_styles__,
  newReport___vue_scopeId__,
  newReport___vue_module_identifier__
)

/* harmony default export */ var views_fengkong_newReport = (newReport_Component.exports);

// CONCATENATED MODULE: ./node_modules/babel-loader/lib!./node_modules/vue-loader/lib/selector.js?type=script&index=0!./src/views/fengkong/fengkong.vue
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//
//





/* harmony default export */ var fengkong = ({
  components: { commonHeader: header_newHeader_commonHeader, newSignUp: views_fengkong_newSignUp, newPhotos: views_fengkong_newPhotos, newReport: views_fengkong_newReport },
  data: function data() {
    return {
      currentIndex: 0
    };
  },

  watch: {
    $route: function $route(to, from) {
      this.currentIndex = this.$route.query.type || 0;
    }
  },
  created: function created() {
    this.currentIndex = this.$route.query.type || 0;
  },

  methods: {
    getTab: function getTab(index) {
      this.currentIndex = index;
      // if(this.currentIndex == 0){
      //   this.$store.commit('getSearchKeyWord_report', '')
      //   this.$store.commit('getSearchFromData_report', '')
      // }
      // if(this.currentIndex == 2){
      //   this.$store.commit('getSearchKeyWord_signUp', '')
      //   this.$store.commit('getSearchFromData_signUp', '')
      // }
    }
  }
});
// CONCATENATED MODULE: ./node_modules/vue-loader/lib/template-compiler?{"id":"data-v-5572fa5a","hasScoped":true,"transformToRequire":{"video":["src","poster"],"source":"src","img":"src","image":"xlink:href"},"buble":{"transforms":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/fengkong/fengkong.vue
var fengkong_render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:"main_App_content"},[_c('commonHeader',{on:{"getTab":_vm.getTab}}),_vm._v(" "),_c('div',{directives:[{name:"show",rawName:"v-show",value:(0 == _vm.currentIndex),expression:"0 == currentIndex"}]},[_c('newSignUp')],1),_vm._v(" "),_c('div',{directives:[{name:"show",rawName:"v-show",value:(1 == _vm.currentIndex),expression:"1 == currentIndex"}]},[_c('newReport')],1)],1)}
var fengkong_staticRenderFns = []
var fengkong_esExports = { render: fengkong_render, staticRenderFns: fengkong_staticRenderFns }
/* harmony default export */ var fengkong_fengkong = (fengkong_esExports);
// CONCATENATED MODULE: ./src/views/fengkong/fengkong.vue
function fengkong_injectStyle (ssrContext) {
  __webpack_require__("sKZb")
}
var fengkong_normalizeComponent = __webpack_require__("VU/8")
/* script */


/* template */

/* template functional */
var fengkong___vue_template_functional__ = false
/* styles */
var fengkong___vue_styles__ = fengkong_injectStyle
/* scopeId */
var fengkong___vue_scopeId__ = "data-v-5572fa5a"
/* moduleIdentifier (server only) */
var fengkong___vue_module_identifier__ = null
var fengkong_Component = fengkong_normalizeComponent(
  fengkong,
  fengkong_fengkong,
  fengkong___vue_template_functional__,
  fengkong___vue_styles__,
  fengkong___vue_scopeId__,
  fengkong___vue_module_identifier__
)

/* harmony default export */ var views_fengkong_fengkong = __webpack_exports__["default"] = (fengkong_Component.exports);


/***/ }),

/***/ "gRE1":
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__("TmV0"), __esModule: true };

/***/ }),

/***/ "ht6P":
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),

/***/ "i/C/":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("exh5");
module.exports = __webpack_require__("FeBl").Object.setPrototypeOf;


/***/ }),

/***/ "iInB":
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
var toIObject = __webpack_require__("TcQ7");
var $getOwnPropertyDescriptor = __webpack_require__("LKZe").f;

__webpack_require__("uqUo")('getOwnPropertyDescriptor', function () {
  return function getOwnPropertyDescriptor(it, key) {
    return $getOwnPropertyDescriptor(toIObject(it), key);
  };
});


/***/ }),

/***/ "jDRm":
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),

/***/ "jFbC":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("Cdx3");
module.exports = __webpack_require__("FeBl").Object.keys;


/***/ }),

/***/ "jFrU":
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),

/***/ "jyFz":
/***/ (function(module, exports, __webpack_require__) {

/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

// This method of obtaining a reference to the global object needs to be
// kept identical to the way it is obtained in runtime.js
var g = (function() { return this })() || Function("return this")();

// Use `getOwnPropertyNames` because not all browsers support calling
// `hasOwnProperty` on the global `self` object in a worker. See #183.
var hadRuntime = g.regeneratorRuntime &&
  Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime") >= 0;

// Save the old regeneratorRuntime in case it needs to be restored later.
var oldRuntime = hadRuntime && g.regeneratorRuntime;

// Force reevalutation of runtime.js.
g.regeneratorRuntime = undefined;

module.exports = __webpack_require__("SldL");

if (hadRuntime) {
  // Restore the original runtime.
  g.regeneratorRuntime = oldRuntime;
} else {
  // Remove the global property added by runtime.js.
  try {
    delete g.regeneratorRuntime;
  } catch(e) {
    g.regeneratorRuntime = undefined;
  }
}


/***/ }),

/***/ "kG6S":
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),

/***/ "kiBT":
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__("i/C/"), __esModule: true };

/***/ }),

/***/ "mClu":
/***/ (function(module, exports, __webpack_require__) {

var $export = __webpack_require__("kM2E");
// 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)
$export($export.S + $export.F * !__webpack_require__("+E39"), 'Object', { defineProperty: __webpack_require__("evD5").f });


/***/ }),

/***/ "mbce":
/***/ (function(module, exports, __webpack_require__) {

var DESCRIPTORS = __webpack_require__("+E39");
var getKeys = __webpack_require__("lktj");
var toIObject = __webpack_require__("TcQ7");
var isEnum = __webpack_require__("NpIQ").f;
module.exports = function (isEntries) {
  return function (it) {
    var O = toIObject(it);
    var keys = getKeys(O);
    var length = keys.length;
    var i = 0;
    var result = [];
    var key;
    while (length > i) {
      key = keys[i++];
      if (!DESCRIPTORS || isEnum.call(O, key)) {
        result.push(isEntries ? [key, O[key]] : O[key]);
      }
    }
    return result;
  };
};


/***/ }),

/***/ "n0T6":
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)
var $keys = __webpack_require__("Ibhu");
var hiddenKeys = __webpack_require__("xnc9").concat('length', 'prototype');

exports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {
  return $keys(O, hiddenKeys);
};


/***/ }),

/***/ "nErl":
/***/ (function(module, exports) {

/* WEBPACK VAR INJECTION */(function(__webpack_amd_options__) {/* globals __webpack_amd_options__ */
module.exports = __webpack_amd_options__;

/* WEBPACK VAR INJECTION */}.call(exports, {}))

/***/ }),

/***/ "oM7Q":
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__("sF+V");
var $Object = __webpack_require__("FeBl").Object;
module.exports = function create(P, D) {
  return $Object.create(P, D);
};


/***/ }),

/***/ "pFYg":
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _iterator = __webpack_require__("Zzip");

var _iterator2 = _interopRequireDefault(_iterator);

var _symbol = __webpack_require__("5QVw");

var _symbol2 = _interopRequireDefault(_symbol);

var _typeof = typeof _symbol2.default === "function" && typeof _iterator2.default === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof _symbol2.default === "function" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? "symbol" : typeof obj; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = typeof _symbol2.default === "function" && _typeof(_iterator2.default) === "symbol" ? function (obj) {
  return typeof obj === "undefined" ? "undefined" : _typeof(obj);
} : function (obj) {
  return obj && typeof _symbol2.default === "function" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof(obj);
};

/***/ }),

/***/ "sF+V":
/***/ (function(module, exports, __webpack_require__) {

var $export = __webpack_require__("kM2E");
// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])
$export($export.S, 'Object', { create: __webpack_require__("Yobk") });


/***/ }),

/***/ "sKZb":
/***/ (function(module, exports) {

// removed by extract-text-webpack-plugin

/***/ }),

/***/ "uqUo":
/***/ (function(module, exports, __webpack_require__) {

// most Object methods by ES6 should accept primitives
var $export = __webpack_require__("kM2E");
var core = __webpack_require__("FeBl");
var fails = __webpack_require__("S82l");
module.exports = function (KEY, exec) {
  var fn = (core.Object || {})[KEY] || Object[KEY];
  var exp = {};
  exp[KEY] = exec(fn);
  $export($export.S + $export.F * fails(function () { fn(1); }), 'Object', exp);
};


/***/ })

});